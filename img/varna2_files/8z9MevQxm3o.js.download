if (self.CavalryLogger) { CavalryLogger.start_js(["ZyBBd"]); }

__d("MessageBorderType",[],(function a(b,c,d,e,f,g){f.exports={FLOWERS:"flowers"};}),null);
__d("MessageCustomizationType",[],(function a(b,c,d,e,f,g){f.exports={BORDER:"border"};}),null);
__d("MessagingThreadType",[],(function a(b,c,d,e,f,g){f.exports={ONE_TO_ONE:1,GROUP:2,ROOM:3,MONTAGE:4,MARKETPLACE:5};}),null);
__d("MNBotsLoggerEvents",[],(function a(b,c,d,e,f,g){f.exports={BOT_COMPOSER_MENU_ICON_DISPLAYED:"bot_composer_menu_icon_displayed",BOT_COMPOSER_MENU_ICON_TAPPED:"bot_composer_menu_icon_tapped",BOT_COMPOSER_MENU_ITEM_DID_SELECT:"bot_composer_menu_item_did_select",BOT_COMPOSER_QUICK_REPLY_DISPLAYED:"bot_composer_quick_reply_displayed",BOT_COMPOSER_QUICK_REPLY_TAPPED:"bot_composer_quick_reply_tapped"};}),null);
__d("TextWithEntitiesMetadataType",[],(function a(b,c,d,e,f,g){f.exports={NONE:0,CONCEPT:1,INTENT:2};}),null);
__d("WorkUserAvailabilityStatusType",[],(function a(b,c,d,e,f,g){f.exports={NONE:"None",AVAILABLE:"Available",SPORADIC:"Sporadic",TENTATIVE:"Tentative",BUSY:"Busy",DO_NOT_DISTURB:"Do Not Disturb",FOCUS:"Focus"};}),null);
__d('P2PTriggersUtils',['P2PGKValues'],(function a(b,c,d,e,f,g){var h=/\$((\d{1,3}(,\d{3})*)|\d+)(\.\d{1,2})?(?=\s|\.\s|\,\s|$|\.$|\,$|\?|\!|\")/,i={canSeeTriggers:function j(k){if(!c('P2PGKValues').P2PEnabled)return false;return true;},getMatches:function j(k){return k.match(h);}};f.exports=i;}),null);
__d('MercuryMessageBody.react',['cx','fbt','BootloadedComponent.react','EmojiRenderer','EmoticonsList','EmoticonEmojiList','EmployeeLinkMatcher','EmployeeLinkRanges','JSResource','Link.react','MercuryConfig','MessengerSupportedEmoji','MessengerTextWithEntities.react','P2PTriggersUtils','React','TextWithEntities.react','TextWithEntitiesMetadataType','URI','URLMatcher','emptyFunction','getURLRanges','ifRequired','shouldAddMRefParam'],(function a(b,c,d,e,f,g,h,i){'use strict';var j,k,l=c('React').PropTypes,m=function o(){m=c('emptyFunction');c('ifRequired')('ChatAppActions',function(p){p.setInitialDisplayDone();});};j=babelHelpers.inherits(n,c('React').PureComponent);k=j&&j.prototype;function n(){var o,p;for(var q=arguments.length,r=Array(q),s=0;s<q;s++)r[s]=arguments[s];return p=(o=k.constructor).call.apply(o,[this].concat(r)),this.targetBlankLinkInterpolator=function(t,u){if(u.className)return c('React').createElement('span',{className:u.className},t);if(u.id){var v={};if(!this.props.isFromViewer&&this.props.threadCustomColor)v.color=this.props.threadCustomColor;return (c('React').createElement(c('Link.react'),{className:"_ih-",href:u.url,style:v},t));}if(u.entity&&u.entity.url){var w=new (c('URI'))(u.entity.url.replace(/#+$/,''));if(c('shouldAddMRefParam')(w))w.addQueryData({__mref:'message_bubble'});return (c('React').createElement(c('Link.react'),{href:{url:w.toString(),shimhash:u.entity.shimhash},s:u.entity.s,target:'_blank'},t));}else if(!u.entity)switch(u.type){case c('TextWithEntitiesMetadataType').NONE:return (c('React').createElement('span',{className:"_2y9",title:JSON.stringify(u.data)},t));default:return t;}return t;}.bind(this),p;}n.prototype.render=function(){var o=this.props,p=o.body,q=o.ranges,r=o.metaRanges;p=p||'';if(p.startsWith('?OTR'))return (c('React').createElement('span',{className:"_89h"},i._("[encrypted message]")));p=p.replace(/\s+$/,'');if(p.length===0)return null;var s=false,t=!!(this.props.threadID&&c('P2PTriggersUtils').canSeeTriggers(this.props.threadID)&&c('P2PTriggersUtils').getMatches(p));if(q&&q.length||r&&r.length||c('EmoticonsList').noncapturingRegexp.test(p)||c('EmojiRenderer').containsEmoji(p)||c('URLMatcher').match(p)||c('EmployeeLinkMatcher').isMatch(p)||t||c('MercuryConfig').MessengerNewEmojiGK&&(c('MessengerSupportedEmoji').findEmoji(p)||c('EmoticonEmojiList').noncapturingRegexp.test(p)))s=true;if(!s){m();return c('React').createElement('span',{className:this.props.className},p);}if(q==undefined)q=c('getURLRanges')(p);if(q==undefined){q=c('EmployeeLinkRanges').get(p);}else{q=q.concat(c('EmployeeLinkRanges').get(p));q=q.filter(function(w){return w!=undefined;});}var u={className:this.props.className,interpolator:this.targetBlankLinkInterpolator,metaRanges:this.props.metaRanges,ranges:q,renderEmoji:true,renderEmoticons:true,text:p},v=c('React').createElement(c('TextWithEntities.react'),u);m();if(t){return (c('React').createElement(c('BootloadedComponent.react'),babelHelpers['extends']({bootloadPlaceholder:v,bootloadLoader:c('JSResource')('TextWithEntitiesAndP2P.react').__setRef('MercuryMessageBody.react')},u,{getMessengerEmote:this.$MercuryMessageBody1,isSupportedEmoji:this.$MercuryMessageBody2,threadID:this.props.threadID})));}else if(c('MercuryConfig').MessengerNewEmojiGK){return (c('React').createElement(c('MessengerTextWithEntities.react'),u));}else return v;};n.prototype.$MercuryMessageBody2=function(o){return !!c('MessengerSupportedEmoji').emoji[o];};n.prototype.$MercuryMessageBody1=function(o){var p=c('EmoticonEmojiList').emote2emojis[o];return c('MessengerSupportedEmoji').emoji[p]?p:null;};n.propTypes={body:l.string,customLike:l.object,isFromViewer:l.bool,metaRanges:l.array,ranges:l.array,threadCustomColor:l.string,threadID:l.string};f.exports=n;}),null);
__d('EmojiDispatcher',['ExplicitRegistrationDispatcher'],(function a(b,c,d,e,f,g){'use strict';f.exports=new (c('ExplicitRegistrationDispatcher'))({strict:false});}),null);
__d('EmojiActions',['EmojiDispatcher','keyMirror'],(function a(b,c,d,e,f,g){'use strict';var h=c('keyMirror')({CHANGE_CURRENT_CATEGORY:null,CHANGE_EMOJI_COLOR:null,EMOJI_COLOR_READY:null,GET_EMOJI_COLOR:null,TRAY_DATA_READY:null,UPDATE_TRAY_DATA:null}),i={Types:h,loadedTrayData:function j(){c('EmojiDispatcher').dispatch({type:i.Types.TRAY_DATA_READY});},updateTrayData:function j(){c('EmojiDispatcher').dispatch({type:i.Types.UPDATE_TRAY_DATA});},changeEmojiColor:function j(k){c('EmojiDispatcher').dispatch({type:i.Types.CHANGE_EMOJI_COLOR,color:k});},changeCurrentCategory:function j(k){c('EmojiDispatcher').dispatch({type:i.Types.CHANGE_CURRENT_CATEGORY,currentCategory:k});},getEmojiColor:function j(){c('EmojiDispatcher').dispatch({type:i.Types.GET_EMOJI_COLOR});},emojiColorReady:function j(k){c('EmojiDispatcher').dispatch({type:i.Types.EMOJI_COLOR_READY,color:k});}};f.exports=i;}),null);
__d("XMessagingGetEmojiRecentUsageController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/emoji_recent_usage\/",{});}),null);
__d('EmojiServerRequests',['Promise','AsyncRequest','XMessagingGetEmojiRecentUsageController'],(function a(b,c,d,e,f,g){'use strict';var h={fetchTrayData:function j(k){return i(c('XMessagingGetEmojiRecentUsageController').getURIBuilder().getURI(),k,true);}};function i(j,k,l){return new (c('Promise'))(function(m,n){return (new (c('AsyncRequest'))(j).setHandler(function(o){return m(o.getPayload());}).setAllowCrossPageTransition(l).send());}).then(k);}f.exports=h;}),null);
__d("XMessagingGetEmojiColorPrefController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/get_emoji_color\/",{});}),null);
__d("XMessagingSetEmojiColorPrefController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/set_emoji_color\/",{});}),null);
__d('EmojiState',['fbt','AsyncRequest','EmojiActions','EmojiServerRequests','MessengerSupportedEmoji','XMessagingGetEmojiColorPrefController','XMessagingSetEmojiColorPrefController'],(function a(b,c,d,e,f,g,h){'use strict';var i=null,j=null,k=void 0,l={onTrayDataReady:function m(n){if(!k)k=c('EmojiServerRequests').fetchTrayData(function(o){j=o;});k.then(function(){n();c('EmojiActions').loadedTrayData();});k.done();},getEmojiColor:function m(){var n=c('XMessagingGetEmojiColorPrefController').getURIBuilder().getURI();new (c('AsyncRequest'))(n).setMethod('POST').setHandler(function(o){c('EmojiActions').emojiColorReady(o.payload);}).send();},changeEmojiColor:function m(n){var o=c('XMessagingSetEmojiColorPrefController').getURIBuilder().getURI();new (c('AsyncRequest'))(o).setMethod('POST').setData({color:n}).send();},addMRUCategory:function m(){if(j){var n=j.map(function(o){var p=c('MessengerSupportedEmoji').findEmoji(o);if(!p)return null;return p.emoji.split('_').map(function(q){return parseInt(q,16);});}).filter(function(o){return !!o;});i={name:h._("Recently Sent"),emojis:n,icon:[128340]};c('EmojiActions').updateTrayData();j=null;}},_addRecentlyUsedEmoji:function m(n){var o,p=i&&i.emojis;if(!p)return;var q=function s(t){var u=n[t];for(var v=0;v<p.length;++v)if(p[v].length==u.length&&p[v].every(function(w,x){return w===u[x];})){p.splice(v,1);break;}p.unshift(u);};for(var r=0;r<n.length;++r)q(r);c('EmojiActions').updateTrayData();},getMRUCategory:function m(){if(!i)this.addMRUCategory();return i;},updateRecentlyUsed:function m(n){if(!i){this.addMRUCategory();return;}this._addRecentlyUsedEmoji(n);}};f.exports=l;}),null);
__d('MessengerBotsWebTypedLogger',['Banzai','GeneratedLoggerUtils','nullthrows'],(function a(b,c,d,e,f,g){'use strict';function h(){this.clear();}h.prototype.log=function(){c('GeneratedLoggerUtils').log('logger:MessengerBotsWebLoggerConfig',this.$MessengerBotsWebTypedLogger1,c('Banzai').BASIC);};h.prototype.logVital=function(){c('GeneratedLoggerUtils').log('logger:MessengerBotsWebLoggerConfig',this.$MessengerBotsWebTypedLogger1,c('Banzai').VITAL);};h.prototype.clear=function(){this.$MessengerBotsWebTypedLogger1={};return this;};h.prototype.updateData=function(j){this.$MessengerBotsWebTypedLogger1=babelHelpers['extends']({},this.$MessengerBotsWebTypedLogger1,j);return this;};h.prototype.setCount=function(j){this.$MessengerBotsWebTypedLogger1.count=j;return this;};h.prototype.setEvent=function(j){this.$MessengerBotsWebTypedLogger1.event=j;return this;};h.prototype.setIndex=function(j){this.$MessengerBotsWebTypedLogger1.index=j;return this;};h.prototype.setPageID=function(j){this.$MessengerBotsWebTypedLogger1.page_id=j;return this;};h.prototype.setPayload=function(j){this.$MessengerBotsWebTypedLogger1.payload=j;return this;};h.prototype.setTitle=function(j){this.$MessengerBotsWebTypedLogger1.title=j;return this;};h.prototype.setTitles=function(j){this.$MessengerBotsWebTypedLogger1.titles=c('GeneratedLoggerUtils').serializeVector(j);return this;};h.prototype.setType=function(j){this.$MessengerBotsWebTypedLogger1.type=j;return this;};h.prototype.setURL=function(j){this.$MessengerBotsWebTypedLogger1.url=j;return this;};h.prototype.setVC=function(j){this.$MessengerBotsWebTypedLogger1.vc=j;return this;};var i={count:true,event:true,index:true,page_id:true,payload:true,title:true,titles:true,type:true,url:true,vc:true};f.exports=h;}),null);
__d('ChatAnimatedGifs',['URI'],(function a(b,c,d,e,f,g){var h={shouldHideBody:function i(j){if(!j.has_attachment)return false;for(var k=0;k<j.attachments.length;k++){var l=j.attachments[k];if(l.preview_url){var m=h.getRawUrlFromSafeUrl(l.preview_url);if(j.body==m)return true;}}return false;},getRawUrlFromSafeUrl:function i(j){return new (c('URI'))(j).getQueryData().url;}};f.exports=h;}),null);
__d('EmojiOnlyMessage.react',['cx','React'],(function a(b,c,d,e,f,g,h){'use strict';var i,j,k=c('React').PropTypes;i=babelHelpers.inherits(l,c('React').Component);j=i&&i.prototype;l.prototype.render=function(){var m=this.props.sourceURIs,n=0,o=m.map(function(p){n++;if(p.emoji){return c('React').createElement('span',{key:n,title:p.title},p.emoji);}else if(p.title){return c('React').createElement('span',{className:"_5qi2",key:n,style:{backgroundImage:'url('+p.url+')'},title:p.title});}else return c('React').createElement('span',{key:n},p.text);});return (c('React').createElement('div',{className:this.props.className,tabIndex:'0'},o));};function l(){i.apply(this,arguments);}l.propTypes={sourceURIs:k.arrayOf(k.shape({emoji:k.any,text:k.string,title:k.string,type:k.string.isRequired,url:k.string.isRequired})).isRequired};f.exports=l;}),null);
__d('ChatBubble.react',['cx','DOMDimensions','EmojiLikeUtils','EmojiOnlyMessage.react','MercuryMessageBody.react','MessagingGiftWrap.react','React','ReactDOM','joinClasses','messengerCustomColorUtils'],(function a(b,c,d,e,f,g,h){'use strict';var i=c('React').PropTypes,j=2,k=c('React').createClass({displayName:'ChatBubble',_boxWidth:0,propTypes:{attachments:i.node,body:i.string,customColor:i.string,customLike:i.object,isEmojiLike:i.bool,isFromViewer:i.bool,isGiftWrapped:i.bool,maxWidth:i.number.isRequired,metaRanges:i.array,onUnwrap:i.func,ranges:i.array,threadCustomColor:i.string,threadID:i.string},getInitialState:function l(){return {emojis:undefined,bubbleWidth:null};},componentDidMount:function l(){if(this.props.attachments&&!this.props.isEmojiLike)return;if(!this.props.emojis){var m=this.props.body||'',n=c('EmojiLikeUtils').richContent(m);if(n)this.setState({emojis:n});}this._restyleBubble(this.props);},componentDidUpdate:function l(m){if(m.maxWidth!==this.props.maxWidth||m.body!==this.props.body||!m.attachments&&this.props.attachments)this._restyleBubble(m);},render:function l(){var m=this.props.body||'';return (c('React').createElement('div',babelHelpers['extends']({},this.props,{className:c('joinClasses')("_5w1r"+(!this.state.emojis?' '+"_3_om":'')+(!!this.state.emojis?' '+"_31xx":''),this.props.className),ref:'bubble',style:{maxWidth:this.props.maxWidth,width:this.state.emojis?null:this.state.bubbleWidth,wordWrap:m.length>=15?'break-word':'inherit'}}),c('React').createElement('div',{className:"_4gx_",ref:'inner'},this._renderContent(),this.props.attachments),this.props.isGiftWrapped?c('React').createElement(c('MessagingGiftWrap.react'),{onUnwrap:this.props.onUnwrap}):null));},_renderContent:function l(){if(!this.props.body||this.props.isEmojiLike)return null;var m={};if(this.state.emojis){var n=c('EmojiLikeUtils').getSourceURIs(this.state.emojis),o=c('React').createElement(c('EmojiOnlyMessage.react'),{sourceURIs:n});}else{o=c('React').createElement(c('MercuryMessageBody.react'),{body:this.props.body,ranges:this.props.ranges,metaRanges:this.props.metaRanges,threadID:this.props.threadID,customLike:this.props.customLike,threadCustomColor:this.props.threadCustomColor,isFromViewer:this.props.isFromViewer});if(this.props.customColor)m=c('messengerCustomColorUtils').customBubbleStyle(this.props.customColor,m);}return (c('React').createElement('div',{className:"_d97"+(!!this.state.emojis?' '+"_31xy":''),ref:'contentWrapper',style:m},c('React').createElement('span',{className:"_5yl5",ref:'content'},o)));},_restyleBubble:function l(m){if(this.props.attachments){this.setState({bubbleWidth:null});return;}var n=c('ReactDOM').findDOMNode(this.refs.bubble);if(m.maxWidth!==this.props.maxWidth||c('DOMDimensions').getElementDimensions(n).width>this.props.maxWidth){var o=this.props.maxWidth;this.setState({bubbleWidth:o},this._shrinkBubble);return;}this._shrinkBubble();},_shrinkBubble:function l(){var m=c('ReactDOM').findDOMNode(this.refs.bubble),n=c('DOMDimensions').getElementDimensions(m).width,o=c('ReactDOM').findDOMNode(this.refs.content),p=o?c('DOMDimensions').getElementDimensions(o).width+c('DOMDimensions').measureElementBox(c('ReactDOM').findDOMNode(this.refs.contentWrapper),'width',true,false,false):0,q=p+j;if(p>0&&q<this.props.maxWidth&&n-q-this.getBoxWidth()>0)this.setState({bubbleWidth:q});},contentWraps:function l(){var m=c('ReactDOM').findDOMNode(this.refs.content);if(!m)return false;var n=m.getClientRects(),o=c('DOMDimensions').getElementDimensions(m).height;return n&&n.length>1&&n[0].height<o;},getBoxWidth:function l(){if(!this._boxWidth)this._boxWidth=c('DOMDimensions').measureElementBox(c('ReactDOM').findDOMNode(this.refs.bubble),'width',true,true,false);return this._boxWidth;}});f.exports=k;}),null);
__d('ChatCodePasteUtils',['cx','BanzaiODS','ChatBubble.react','React'],(function a(b,c,d,e,f,g,h){'use strict';var i=/`{3,}/;function j(l){return !!(l&&i.test(l)&&l.split('\n').length>1);}function k(l,m,n,o,p){var q=l.split(i),r=[];for(var s=0;s<q.length;s+=2){var t=q[s].trim();if(t)r.push(c('React').createElement('div',{key:s,className:"_5wde"+(' '+"_n4o")},c('React').createElement(c('ChatBubble.react'),{body:t,customColor:p||undefined,className:"clearfix _5wdf",maxWidth:m,ranges:n||undefined,threadID:o||undefined})));if(s+1<q.length&&q[s+1]){var u=q[s+1].split('\n'),v=u[0].replace(/[^a-zA-Z]+/g,''),w=u.slice(1).join('\n');c('BanzaiODS').bumpEntityKey('chat_code_paste','render_bubble');r.push(c('React').createElement('div',{key:s+1,className:"_5wde"+(' '+"_n4o")},c('React').createElement('div',{ref:'bubble',className:"_3_om _4yng _5wdf"},c('React').createElement('div',{ref:'syntaxTarget'+s,className:'language-'+v},w))));}}return r;}f.exports={containsCodeBlock:j,getCodeAndMessageBubbles:k};}),null);
__d('ChatPrivacyActionController',['ChatVisibility','JSLogger','PresencePrivacy'],(function a(b,c,d,e,f,g){var h=function i(j,k){this._userID=j;this._logger=c('JSLogger').create('blackbird');this._getState=function(){if(c('ChatVisibility').isOnline())return c('PresencePrivacy').allows(this._userID)?i.NORMAL:i.BLOCKED;return i.OFFLINE;};this._togglePrivacy=function(){var m=this._getState();switch(this._getState()){case i.OFFLINE:if(c('ChatVisibility').isOnline()){this._logger.error('tabs_already_online');break;}this._logger.log('tabs_go_online',{tab_id:this._userID});c('ChatVisibility').goOnline(function(){if(!c('PresencePrivacy').allows(this._userID)){if(this._getState()!==i.BLOCKED)this._logger.error('privacy_action_controller_blocked_inconsistency');this._togglePrivacy();}}.bind(this));break;case i.BLOCKED:c('PresencePrivacy').allow(this._userID);this._logger.log('tabs_unblock',{tab_id:this._userID});break;case i.NORMAL:c('PresencePrivacy').disallow(this._userID);this._logger.log('tabs_block',{tab_id:this._userID});break;}};var l=function(){k&&k(this._getState());}.bind(this);l();this._subscribeToken=c('PresencePrivacy').subscribe('privacy-changed',l);};h.OFFLINE='offline';h.BLOCKED='blocked';h.NORMAL='normal';Object.assign(h.prototype,{togglePrivacy:function i(){this._logger.log('gear_menu_toggle_privacy',{tab_id:this._userID});this._togglePrivacy();},destroy:function i(){this._subscribeToken&&c('PresencePrivacy').unsubscribe(this._subscribeToken);}});f.exports=h;}),null);
__d('ChatTabBlinking',['cx','CSS','setIntervalAcrossTransitions'],(function a(b,c,d,e,f,g,h){'use strict';var i=600,j="highlightTitle",k={_blinkMap:{},_interval:null,_isHighlighting:false,blinkTab:function l(m,n){if(!this._blinkMap[m])this._blinkMap[m]={view:n,elem:n.getTabElem()};this.checkInterval();},unblinkTab:function l(m){if(this._blinkMap[m]){var n=this._blinkMap[m].elem;if(n)c('CSS').removeClass(n,j);delete this._blinkMap[m];}this.checkInterval();},checkInterval:function l(){var m=Object.keys(this._blinkMap).length;if(m>0){if(!this._interval)this._interval=c('setIntervalAcrossTransitions')(this._toggleBlinkHighlight.bind(this),i);}else if(this._interval){clearInterval(this._interval);this._interval=null;}},_toggleBlinkHighlight:function l(){this._isHighlighting=!this._isHighlighting;for(var m in this._blinkMap)if(this._blinkMap.hasOwnProperty(m)){var n=this._blinkMap[m],o=n.elem,p=n.view;if(o&&o.parentNode&&!p.isFocused()&&!p.isHovered()){c('CSS').conditionClass(o,j,this._isHighlighting);}else this.unblinkTab(m);}}};f.exports=k;}),null);
__d('ChatCollapsedLogMessageGroup.react',['cx','fbt','Link.react','React'],(function a(b,c,d,e,f,g,h,i){'use strict';var j,k;j=babelHelpers.inherits(l,c('React').PureComponent);k=j&&j.prototype;function l(){var m,n;for(var o=arguments.length,p=Array(o),q=0;q<o;q++)p[q]=arguments[q];return n=(m=k.constructor).call.apply(m,[this].concat(p)),this.state={collapsed:true},n;}l.prototype.render=function(){var m=i._("See more"),n=i._("See less");return (c('React').createElement('div',{className:"_5w0o"},i._("New Activities in the Room."),' ',c('React').createElement(c('Link.react'),{className:"_4ea1",onClick:function(){return this.setState({collapsed:!this.state.collapsed});}.bind(this)},this.state.collapsed?m:n),!this.state.collapsed?c('React').createElement('div',null,c('React').createElement('div',{className:"_2zsu"}),this.props.children,c('React').createElement('div',{className:"_2zsu"})):null));};f.exports=l;}),null);
__d('ChatDateBreak.react',['cx','React','formatDate','joinClasses'],(function a(b,c,d,e,f,g,h){var i,j,k=c('React').PropTypes;i=babelHelpers.inherits(l,c('React').Component);j=i&&i.prototype;l.prototype.shouldComponentUpdate=function(m){'use strict';return this.props.date.getTime()!==m.date.getTime();};l.prototype.render=function(){'use strict';var m=c('formatDate')(this.props.date,{today:'g:ia',withinWeek:'D g:ia',thisYear:'M jS, g:ia',older:'m/d/Y g:ia'});return (c('React').createElement('time',{className:c('joinClasses')(this.props.className,"_5w-5")},c('React').createElement('span',{className:"_5w-6"},m)));};function l(){'use strict';i.apply(this,arguments);}l.propTypes={date:k.instanceOf(Date).isRequired};f.exports=l;}),null);
__d('ChatMessageSeenHeads.react',['cx','fbt','Image.react','immutable','ImmutableObject','MercuryMessageInfo','MercuryTimestamp','React','joinClasses'],(function a(b,c,d,e,f,g,h,i){'use strict';var j,k,l=c('React').PropTypes,m=8;j=babelHelpers.inherits(n,c('React').PureComponent);k=j&&j.prototype;n.prototype.render=function(){var o=this.props,p=o.message,q=o.nextTimestamp,r=o.participants,s=o.readReceipts;if(c('MercuryMessageInfo').isSending(p)||s.isEmpty()||c('MercuryMessageInfo').hasError(p))return null;var t=c('immutable').Seq(s).filter(function(ba,ca){return (ba.watermark>=p.timestamp&&ba.watermark<q);}).sort(function(ba,ca){return ba.action-ca.action;});if(t.isEmpty())return null;var u=m,v=t.count()>u+1,w=v?t.slice(0,u):t,x=w.map(function(ba,ca){var da=r.get(ca);if(!da)return null;var ea=ba?i._("Seen by {full name} at {seen time}",[i.param('full name',da.name),i.param('seen time',c('MercuryTimestamp').getPreciseTimestamp(ba.action))]):i._("Seen by {full name}",[i.param('full name',da.name)]);return (c('React').createElement(c('Image.react'),{alt:ea,className:"_4ret",key:ca,src:da.image_src,title:ea}));}).toArray(),y=x.length;if(!y)return null;var z=v?t.slice(u).count():0;if(z>0){var aa=t.slice(u).map(function(ba,ca){var da=r.get(ca);return da?da.name:null;}).filter(function(ba){return !!ba;}).join('\n')+' ';x.unshift(c('React').createElement('span',{className:"_4reu",key:'overflow',title:aa},'+'+z));}return (c('React').createElement('span',{className:c('joinClasses')(this.props.className,"_4rev"+(y+z===1?' '+"_4rf3":''))},x));};function n(){j.apply(this,arguments);}n.propTypes={isFromViewer:l.bool,message:l.instanceOf(c('ImmutableObject')).isRequired,nextTimestamp:l.number.isRequired,participants:l.instanceOf(c('immutable').Map).isRequired,readReceipts:l.instanceOf(c('immutable').OrderedMap).isRequired};f.exports=n;}),null);
__d('MessengerReactionsUtil',['EmojiFormat'],(function a(b,c,d,e,f,g){'use strict';var h=[[128525],[128518],[128558],[128546],[128544],[128077],[128078]],i={};h.forEach(function(j,k){i[c('EmojiFormat').codeArrayToUnicode(j)]=k+1;});f.exports={sortFunction:function j(k,l){if(!i[k]&&!i[l]){return 0;}else if(!i[k]){return 1;}else if(!i[l])return -1;return i[k]-i[l];}};}),null);
__d('MessengerReactions.react',['cx','Bootloader','MercuryConfig','MessengerEnvironment','MessengerReactionsUtil','MessengerTextWithEmoticons.react','React'],(function a(b,c,d,e,f,g,h){'use strict';var i,j,k=c('React').PropTypes;i=babelHelpers.inherits(l,c('React').Component);j=i&&i.prototype;function l(){var m,n;for(var o=arguments.length,p=Array(o),q=0;q<o;q++)p[q]=arguments[q];return n=(m=j.constructor).call.apply(m,[this].concat(p)),this.$MessengerReactions1=function(){var r=c('MessengerEnvironment').messengerui,s=this.props,t=s.isFromViewer,u=s.message,v=s.participants;if(r){c('Bootloader').loadModules(["MessengerActions","MessengerReactionsDialog.react"],function(w,x){w.showDialog(x,{isFromViewer:t,participants:v,message:u});},'MessengerReactions.react');}else c('Bootloader').loadModules(["ChatReactionsDialog"],function(w){w.show(u,v,t);},'MessengerReactions.react');}.bind(this),n;}l.prototype.render=function(){var m=this.props.message,n=m.reactions;if(!n)return null;var o={},p=0;Object.values(n).forEach(function(s){if(typeof s==='string'){if(!o[s])o[s]=0;o[s]++;p++;}});var q=Object.keys(o).sort(c('MessengerReactionsUtil').sortFunction).map(function(s){return c('React').createElement('span',{className:"_4kf5 _3-99",key:s},c('React').createElement(c('MessengerTextWithEmoticons.react'),{renderEmoticons:true,renderEmoji:true,text:s}));}),r=p>0?c('React').createElement('span',{className:"_4kf6 _3-99"},p):null;if(c('MercuryConfig').ReactionsPreview){return c('React').createElement('div',{className:"_4kf7 _3-95 preview",onClick:this.$MessengerReactions1,role:'button',tabIndex:'0'},q,r);}else return c('React').createElement('div',{className:"_4kf7 _3-95"},q,r);};l.propTypes={isFromViewer:k.bool.isRequired,message:k.object.isRequired,participants:k.object.isRequired};f.exports=l;}),null);
__d('MessengerDecorator',['cssVar','cx','BootloadedComponent.react','JSResource','MercuryConfig','MercuryMessageActions','MercuryMessageCustomizations','MercuryTagHelper','MessageBorderType','MessageCustomizationType','MessagingFlowerBorder.react','MessagingGiftWrap.react','MessagingGiftWrapConstants','MessengerEnvironment','MessengerReactions.react','React'],(function a(b,c,d,e,f,g,h,i){'use strict';var j=[{name:'GiftWrap',check:function n(o){var p=function r(s){return c('MercuryTagHelper').get(s,c('MessagingGiftWrapConstants').TAG_PREFIX)===c('MessagingGiftWrapConstants').VALENTINES_GIFT;},q=function r(s){return !!c('MercuryTagHelper').get(s,c('MessagingGiftWrapConstants').UNWRAPPED_TAG);};return !!(c('MercuryConfig').GiftWrapViewerGK&&o.tags&&p(o.tags)&&!q(o.tags));},render:function n(o,p){return (c('React').createElement(c('MessagingGiftWrap.react'),{key:'giftwrap',onUnwrap:function q(){var r="2500ms",s=parseInt(r.substring(0,r.length-2),10);setTimeout(function(){return c('MercuryMessageActions').get().unwrap(o);},s);}}));},getAdditionalClassNames:function n(){return null;}},{name:'FlowerBorder',check:function n(o){return (c('MercuryConfig').WWWMessengerFlowerBorderViewer&&c('MercuryMessageCustomizations').getCustomizationValue(o,c('MessageCustomizationType').BORDER)===c('MessageBorderType').FLOWERS);},render:function n(o,p){if(c('MessengerEnvironment').messengerui)return c('React').createElement(c('MessagingFlowerBorder.react'),{offset:-10,key:'giftwrap:'+o.message_id});return c('React').createElement(c('MessagingFlowerBorder.react'),{key:'giftwrap:'+o.message_id});},getAdditionalClassNames:function n(){if(!c('MessengerEnvironment').messengerui)return "_337n";return null;}}],k=[{name:'Reactions',check:function n(o){return !!(c('MercuryConfig').Reactions&&o.reactions&&Object.keys(o.reactions).length>0);},render:function n(o,p,q){return (c('React').createElement(c('MessengerReactions.react'),{isFromViewer:p,key:o.message_id+'-reactions',message:o,participants:q}));},getAdditionalClassNames:function n(){return null;}}],l=[{name:'MontageReply',check:function n(o){if(!c('MercuryConfig').MontageThreadViewer)return false;var p=o.montage_reply_data&&o.montage_reply_data.message_id;return !!p;},render:function n(o,p){var q=o.montage_reply_data&&o.montage_reply_data.message_id;return c('React').createElement(c('BootloadedComponent.react'),{key:'montagereply:'+o.message_id,bootloadPlaceholder:c('React').createElement('div',null),bootloadLoader:c('JSResource')('MontageReplyDecoratorContainer.react').__setRef('MessengerDecorator'),isFromViewer:p,messageID:q,replyAuthorID:o.author,threadID:o.thread_id});},getAdditionalClassNames:function n(){return null;}}],m={getBeforeDecorators:function n(){return l;},getAfterDecorators:function n(){return j;},getAfterExternalDecorators:function n(){return k;}};f.exports=m;}),null);
__d('MessengerVideoAutoplayActions',['immutable','MessengerFluxReduceDispatcher','keyMirror'],(function a(b,c,d,e,f,g){'use strict';var h='messenger_video',i=c('keyMirror')({DESTROY:null,DSTROY_ALL:null,SCROLL:null,UPDATE:null}),j={Types:i,Namespace:h,onScroll:function k(l,m,n,o){c('MessengerFluxReduceDispatcher').dispatch({type:i.SCROLL,namespace:h,threadID:l,messageIDs:m,messageRectMap:n,viewportRect:o});},updateStore:function k(l,m){c('MessengerFluxReduceDispatcher').dispatch({type:i.UPDATE,namespace:h,threadID:l,messageIDs:m});},deleteThread:function k(l){c('MessengerFluxReduceDispatcher').dispatch({type:i.DESTROY,namespace:h,threadID:l});},deleteAllThreads:function k(){c('MessengerFluxReduceDispatcher').dispatch({type:i.DESTROY_ALL,namespace:h});}};f.exports=j;}),null);
__d('MessengerVideoAutoplayStore',['FluxReduceStore','immutable','MessengerVideoAutoplayActions','MessengerFluxReduceDispatcher'],(function a(b,c,d,e,f,g){'use strict';var h,i,j,k,l=c('MessengerVideoAutoplayActions').Types;h=babelHelpers.inherits(m,c('immutable').Record({currentVideoMessageID:null,lastVideoMessageID:null,messageIDs:null,videoVisibilityMap:null}));i=h&&h.prototype;function m(){h.apply(this,arguments);}j=babelHelpers.inherits(n,c('FluxReduceStore'));k=j&&j.prototype;n.prototype.getInitialState=function(){return c('immutable').Map();};n.prototype.reduce=function(o,p){if(p.namespace!==c('MessengerVideoAutoplayActions').Namespace)return o;switch(p.type){case l.SCROLL:if(p.messageIDs)o=this.$MessengerVideoAutoplayStore1(o,p.threadID,p.messageIDs);return this.$MessengerVideoAutoplayStore2(o,p.threadID,p.messageRectMap,p.viewportRect);case l.UPDATE:return this.$MessengerVideoAutoplayStore1(o,p.threadID,p.messageIDs);case l.DESTROY:return this.$MessengerVideoAutoplayStore3(o,p.threadID);case l.DESTROY_ALL:return o.clear();}return o;};n.prototype.$MessengerVideoAutoplayStore1=function(o,p,q){if(!q)return o['delete'](p);return o.set(p,new m({currentVideoMessageID:null,lastVideoMessageID:q.first(),messageIDs:q,videoVisibilityMap:null}));};n.prototype.$MessengerVideoAutoplayStore3=function(o,p){return o['delete'](p);};n.prototype.$MessengerVideoAutoplayStore4=function(o,p,q,r,s){var t=null,u=q.map(function(v){if(t){return [v,false];}else{var w=this.$MessengerVideoAutoplayStore5(v,r,s);if(w)t=v;return [v,w];}}.bind(this)).fromEntrySeq().toOrderedMap();return o.mergeIn([p],{currentVideoMessageID:t,videoVisibilityMap:u});};n.prototype.$MessengerVideoAutoplayStore2=function(o,p,q,r){var s=o.getIn([p,'messageIDs']);if(!s||!q||!r)return o;if(!o.getIn([p,'currentVideoMessageID'])){return this.$MessengerVideoAutoplayStore4(o,p,s,q,r);}else{var t=o.getIn([p,'videoVisibilityMap']),u=o.getIn([p,'lastVideoMessageID']),v=o.getIn([p,'currentVideoMessageID']);if(this.$MessengerVideoAutoplayStore5(u,q,r)){if(t&&t.first())return o;}else if(this.$MessengerVideoAutoplayStore5(v,q,r))return o;o=o.setIn([p,'currentVideoMessageID'],null);return this.$MessengerVideoAutoplayStore4(o,p,s,q,r);}};n.prototype.$MessengerVideoAutoplayStore6=function(o,p){if(!o)return false;return o.top>p.top&&o.bottom<p.bottom;};n.prototype.$MessengerVideoAutoplayStore5=function(o,p,q){var r=p.get(o);return this.$MessengerVideoAutoplayStore6(r,q);};n.prototype.getVideoVisibilityMap=function(o){return this.getState().getIn([o,'videoVisibilityMap']);};n.prototype.getMessageIDs=function(o){return this.getState().getIn([o,'messageIDs']);};n.prototype.isVisible=function(o,p){return !!this.getState().getIn([o,'videoVisibilityMap',p]);};function n(){j.apply(this,arguments);}f.exports=new n(c('MessengerFluxReduceDispatcher'));}),null);
__d('convertMIGColorToFIGColor',['cssVar'],(function a(b,c,d,e,f,g,h){'use strict';var i={'#0077e5':"#4080ff",'#44bec7':"#54C7EC",'#ffc300':'#f5c33b','#fa3c4c':"#F35369",'#d696bb':'#d696bb','#6699cc':"#A3CEDF",'#13cf13':"#42b72a",'#ff7e29':"#F7923B",'#e68585':'#e68585','#7646ff':"#8C72CB",'#20cef5':"#54C7EC",'#67b868':"#A3CE71",'#d4a88c':'#cfa588','#ff5ca1':"#EC7EBD",'#a695c7':"#AF9CDA"};function j(k){return k&&i[k]||k||'';}f.exports=j;}),null);
__d('ChatMessage.react',['cx','fbt','BootloadedComponent.react','ChatAnimatedGifs','ChatBubble.react','ChatMessageSeenHeads.react','EmojiLikeUtils','FluxContainer','MercuryTimestamp','CSS','immutable','ImmutableObject','JSResource','MercuryAttachment','MercuryConfig','MercuryErrorInfo','MercuryIDs','MercuryMessageCustomizations','MercuryMessageError.react','MercuryMessageInfo','MessageBorderType','MessageCustomizationType','MessagingGiftWrapChecker','MessengerDecorator','MessengerVideoAutoplayStore','ChatCodePasteUtils','MNCommerceMessageType','MercuryDisplayTimeFilterMessageRenderer','React','ReactDOM','TooltipData','XUISpinner.react','convertMIGColorToFIGColor','isRTL','joinClasses'],(function a(b,c,d,e,f,g,h,i){'use strict';var j,k,l=c('React').PropTypes;j=babelHelpers.inherits(m,c('React').Component);k=j&&j.prototype;function m(){var n,o;for(var p=arguments.length,q=Array(p),r=0;r<p;r++)q[r]=arguments[r];return o=(n=k.constructor).call.apply(n,[this].concat(q)),this.state={isVisible:false},o;}m.getStores=function(){return [c('MessengerVideoAutoplayStore')];};m.calculateState=function(n,o){return {isVisible:c('MessengerVideoAutoplayStore').isVisible(o.message.thread_id,o.message.message_id)};};m.prototype.componentDidMount=function(){c('CSS').conditionClass(c('ReactDOM').findDOMNode(this),"_2cnu",this.isOneLine());};m.prototype.isOneLine=function(){var n=this.props.message;return (c('MercuryMessageInfo').isInbound(n)&&!this.refs.attachmentsInside&&this.refs.bubble&&!this.refs.bubble.contentWraps());};m.prototype.shouldComponentUpdate=function(n,o){var p=n.message!==this.props.message,q=false,r=false,s=this.props.thread;if(s){q=s.custom_like_icon!==n.thread.custom_like_icon;r=s.custom_color!==n.thread.custom_color;}else if(n.thread)return true;return (p||q||r||o.isVisible!==this.state.isVisible);};m.prototype.render=function(){var n=this.props.message,o=c('MercuryAttachment').get(n).length>0,p=c('MercuryMessageInfo').isInbound(n),q=c('MercuryIDs').isGroupChat(n.thread_id),r=c('isRTL')(n.body),s=c('MercuryErrorInfo').hasErrorStatus(n),t="_5wd4"+(p?' '+"_1nc7":'')+(!p?' '+"_1nc6":'')+(o?' '+"_2_-t":'')+(p&&q?' '+"_5ysy":'')+(s?' '+"_1zcs":'')+(r?' '+"direction_rtl":'')+(!r?' '+"direction_ltr":''),u=this.props,v=u.isFromViewer,w=u.participants,x=[],y=n;if(y)c('MessengerDecorator').getBeforeDecorators().forEach(function(z){if(z.check(y))x.push(z.render(y,v));});return (c('React').createElement('div',{className:c('joinClasses')(this.props.className,t)},c('React').createElement('div',{className:"_h8t"},x,this.$ChatMessage1()),this.$ChatMessage2(y,v,w),this.$ChatMessage3(),this.$ChatMessage4()));};m.prototype.$ChatMessage1=function(){var n=this.props.message,o={};if(c('MercuryMessageInfo').isOutbound(n)){var p=i._("{time}",[i.param('time',c('MercuryTimestamp').getPreciseTimestamp(n.timestamp))]);Object.assign(o,c('TooltipData').propsFor(p,'right'));}if(n.is_filtered_content)return (c('React').createElement('div',babelHelpers['extends']({className:"_5wd9"+(c('MercuryConfig').ChatSeenHeadsEnabled?' '+"_ysk":'')+(' '+"_5wdc")+(' '+"uiBoxYellow")+(' '+"clearfix"),ref:'inner'},o),c('MercuryDisplayTimeFilterMessageRenderer').renderFilteredContent(n)));return (c('React').createElement('div',babelHelpers['extends']({className:"_5wd9"+(c('MercuryConfig').ChatSeenHeadsEnabled?' '+"_ysk":''),ref:'inner'},o),this.$ChatMessage5(),this.$ChatMessage6('outside')));};m.prototype.$ChatMessage2=function(n,o,p){var q;if(n){var q=function(){var r=[],s=[];c('MessengerDecorator').getAfterExternalDecorators().forEach(function(u){if(n&&u.check(n)){r.push(u.render(n,o,p));s.push(u.getAdditionalClassNames());}});if(s.length===0&&r.length===0)return {v:null};var t=s.join(' ');return {v:c('React').createElement('div',{className:c('joinClasses')(t,"_5ijz"+(!o?' '+"isFromOther":''))},r)};}();if(typeof q==="object")return q.v;}return null;};m.prototype.$ChatMessage3=function(){var n=this.props.message;if(n.is_filtered_content||!c('MercuryMessageInfo').hasError(n))return null;return (c('React').createElement('div',{className:"_3ry4",ref:'undertext'},c('React').createElement(c('MercuryMessageError.react'),{className:"_5wda clearfix",message:n,ref:'status'}),this.$ChatMessage7()));};m.prototype.$ChatMessage4=function(){if(!c('MercuryConfig').ChatSeenHeadsEnabled)return null;return (c('React').createElement(c('ChatMessageSeenHeads.react'),{className:"_ysl",isFromViewer:this.props.isFromViewer,message:this.props.message,nextTimestamp:this.props.nextTimestamp,participants:this.props.participants,readReceipts:this.props.readReceipts}));};m.prototype.$ChatMessage7=function(){return (this.props.message.is_spoof_warning?c('React').createElement(c('BootloadedComponent.react'),{bootloadPlaceholder:c('React').createElement('span',null),bootloadLoader:c('JSResource')('MercurySpoofWarning.react').__setRef('ChatMessage.react'),authorID:this.props.message.author,className:"_5wdb"}):null);};m.prototype.$ChatMessage8=function(){return (c('React').createElement('div',{style:{padding:'20px',text_align:'center'}},c('React').createElement(c('XUISpinner.react'),null)));};m.prototype.$ChatMessage6=function(n){if(this.props.message.commerce_message_type===c('MNCommerceMessageType').RIDE_INTENT)return null;var o=this.props.message,p=this.props.thread?this.props.thread.custom_like_icon:null,q=n=='inside'?'attachmentsInside':'attachmentsOutside',r=c('MercuryAttachment').get(o).filter(function(t){var u=c('MercuryAttachment').isBubblePreferred(t);return u&&n==='inside'||!u&&n==='outside';}),s=this.props.thread?c('convertMIGColorToFIGColor')(this.props.thread.custom_color):'';if(r.length>0)return (c('React').createElement(c('BootloadedComponent.react'),{bootloadPlaceholder:this.$ChatMessage8(),bootloadLoader:c('JSResource')('MercuryAttachments.react').__setRef('ChatMessage.react'),className:(n==='outside'?"_3e7u":'')+(!!o.body?' '+"_16ys":'')+(!!s?' '+"_3al":'')+(' '+"_n4o"),attachments:r,customLike:p,customColor:s,hasFlowerBorder:c('MercuryConfig').WWWMessengerFlowerBorderViewer&&c('MercuryMessageCustomizations').getCustomizationValue(o,c('MessageCustomizationType').BORDER)===c('MessageBorderType').FLOWERS&&n==='outside',isChat:true,isGiftWrapped:c('MessagingGiftWrapChecker').shouldRenderWithGiftWrap(o)&&n==='outside',isVisible:this.state.isVisible,maxWidth:this.props.maxBubbleWidth,message:o,onUnwrap:this.$ChatMessage9,onAttachmentLoad:this.props.onAttachmentLoad,onStickerClick:this.props.onStickerClick,ref:q}));return null;};m.prototype.$ChatMessage5=function(){var n=this.props,o=n.isFromViewer,p=n.message,q=n.thread,r=p.body,s=this.$ChatMessage6('inside'),t=[],u=[],v=p;if(v){c('MessengerDecorator').getAfterDecorators().forEach(function(y){if(y.check(v,q)){t.push(y.render(v,o));u.push(y.getAdditionalClassNames());}});c('MessengerDecorator').getBeforeDecorators().forEach(function(y){if(y.check(v,q))u.push(y.getAdditionalClassNames());});}var w=u.join(' ');if(c('ChatAnimatedGifs').shouldHideBody(p))r='';var x=p.ranges;if(p.profile_ranges&&p.profile_ranges.length)x=(x||[]).concat(p.profile_ranges.map(function(y){return babelHelpers['extends']({},y,{url:'/'+y.id});}));if(c('ChatCodePasteUtils').containsCodeBlock(r))return (c('React').createElement(c('BootloadedComponent.react'),{bootloadPlaceholder:c('React').createElement('div',{style:{height:22}}),bootloadLoader:c('JSResource')('ChatCodeBubble.react').__setRef('ChatMessage.react'),body:r,className:"_5wdf",maxWidth:this.props.maxBubbleWidth,ranges:x,threadID:p.thread_id,customColor:q&&o?c('convertMIGColorToFIGColor')(q.custom_color):''}));if(r||s)return (c('React').createElement('div',{className:c('joinClasses')(w,"_5wde"+(' '+"_n4o"))},c('React').createElement(c('ChatBubble.react'),{attachments:s,body:r,className:"_5wdf",ranges:x,metaRanges:p.meta_ranges,message:p,maxWidth:this.props.maxBubbleWidth,ref:'bubble',isEmojiLike:c('EmojiLikeUtils').isEmojiLike(p),isFromViewer:this.props.isFromViewer,threadID:p.thread_id,customLike:p.customLike,customColor:q&&o?c('convertMIGColorToFIGColor')(q.custom_color):'',threadCustomColor:q&&c('convertMIGColorToFIGColor')(q.custom_color)}),t));return null;};m.propTypes={message:l.instanceOf(c('ImmutableObject')).isRequired,maxBubbleWidth:l.number.isRequired,onAttachmentLoad:l.func,onStickerClick:l.func,participants:l.instanceOf(c('immutable').Map).isRequired,readReceipts:l.instanceOf(c('immutable').OrderedMap).isRequired,thread:l.instanceOf(c('ImmutableObject'))};f.exports=c('FluxContainer').create(m,{withProps:true});}),null);
__d('ChatMessageGroup.react',['cx','fbt','ChatConfig','ChatDateBreak.react','ChatMessage.react','Image.react','immutable','ImmutableObject','MercuryConfig','MercuryIDs','MercuryParticipants','MercuryTimestamp','MessengerTextWithEmoticons.react','React','ReactDOM','StoreAndPropBasedStateMixin'],(function a(b,c,d,e,f,g,h,i){'use strict';var j=c('immutable').OrderedMap,k=c('React').PropTypes,l=new (c('ImmutableObject'))({name:'',href:'#',image_src:''}),m=c('ChatConfig').get('chattab_rounded_profile',false),n=c('React').createClass({displayName:'ChatMessageGroup',mixins:[c('StoreAndPropBasedStateMixin')(c('MercuryParticipants'))],propTypes:{activeMessageID:k.string,author:k.string,hasDateBreak:k.bool,isCanonical:k.bool,isFromViewer:k.bool,isPageMessage:k.bool,maxBubbleWidth:k.number,messages:k.instanceOf(c('immutable').List).isRequired,readReceipts:k.instanceOf(j).isRequired,onAttachmentLoad:k.func,onStickerClick:k.func,thread:k.instanceOf(c('ImmutableObject')),threadID:k.string},statics:{calculateState:function p(q){return {participants:o(q)};}},shouldComponentUpdate:function p(q,r){return (this.props.activeMessageID!==q.activeMessageID||this.props.isFromViewer!==q.isFromViewer||!c('immutable').is(this.props.messages,q.messages)||!c('immutable').is(this.state.participants,r.participants)||!c('immutable').is(this.props.thread,q.thread));},render:function p(){return (c('React').createElement('div',{className:"_4tdt"+(this.props.isFromViewer?' '+"_ua0":'')+(!this.props.isFromViewer?' '+"_ua1":'')+(this._hasSeenHeadsAtBottom()?' '+"_3lil":'')},this._renderProfileColumn(),c('React').createElement('div',{className:"_ua2"},this._renderName(),c('React').createElement('div',{className:"_4tdv"},this._renderMessages()))));},_renderProfileColumn:function p(){if(this.props.isFromViewer)return null;var q=this.state.participants.get(this.props.author)||l,r=i._("{name} {time}",[i.param('name',q.name),i.param('time',c('MercuryTimestamp').getPreciseTimestamp(this.props.messages.last().timestamp))]),s=q.image_src?c('React').createElement(c('Image.react'),{src:q.image_src}):null;return (c('React').createElement('div',{className:"_31o4"+(m?' '+"_3njy":'')},c('React').createElement('a',{'aria-label':r,className:"_4tdw",'data-hover':'tooltip','data-tooltip-content':r,'data-tooltip-position':'left',href:q.href,ref:'link'},s)));},_renderName:function p(){if(this.props.isCanonical||this.props.isFromViewer)return null;var q=this.state.participants.get(this.props.messages.first().author);if(!q)return null;var r=q.short_name;if(this.props.thread&&this.props.thread.custom_nickname){var s=c('MercuryIDs').getUserIDFromParticipantID(q.id);if(this.props.thread.custom_nickname[s]){r=this.props.thread.custom_nickname[s];if(c('MercuryConfig').MessengerNewEmojiGK)r=c('React').createElement(c('MessengerTextWithEmoticons.react'),{renderEmoticons:true,renderEmoji:true,text:r});}}return (c('React').createElement('div',{className:"_4tdx"},r));},_renderMessages:function p(){var q=this.props.messages.size,r=[];this.props.messages.forEach(function(s,t,u){var v=s.message_id===this.props.activeMessageID;if(v&&!(t===0&&this.props.hasDateBreak))r.push(c('React').createElement(c('ChatDateBreak.react'),{date:new Date(s.timestamp),key:'db:'+s.message_id}));r.push(c('React').createElement(c('ChatMessage.react'),{isFromViewer:this.props.isFromViewer,key:s.message_id,maxBubbleWidth:this.props.maxBubbleWidth,message:s,participants:this.state.participants,readReceipts:this.props.readReceipts,ref:s.message_id,nextTimestamp:this._getNextTimestamp(u,q,t),onAttachmentLoad:this.props.onAttachmentLoad,onStickerClick:this.props.onStickerClick,thread:this.props.thread}));}.bind(this));return r;},_hasSeenHeadsAtBottom:function p(){var q=this.props,r=q.messages,s=q.nextTimestamp,t=q.readReceipts,u=r.last().timestamp,v=0;t.forEach(function(w){if(w>=u&&w<s)if(++v===2)return false;return null;});return v===2;},_getNextTimestamp:function p(q,r,s){return s<r-1?q.get(s+1).timestamp:this.props.nextTimestamp;},getMessageElement:function p(q){return c('ReactDOM').findDOMNode(this.refs[q]);}});function o(p){return c('immutable').Map().withMutations(function(q){p.readReceipts.forEach(function(r,s){q.set(s,c('MercuryParticipants').getOrFetch(s));});q.set(p.author,c('MercuryParticipants').getOrFetch(p.author));});}f.exports=n;}),null);
__d('MercuryLogMessage.react',['cx','fbt','DOM','DOMDimensions','Event','ImmutableObject','MercuryLogMessageRenderer','MercuryLogMessageType','React','cancelAnimationFrame','emptyFunction','formatDate','joinClasses','requestAnimationFrame','requireWeak'],(function a(b,c,d,e,f,g,h,i){'use strict';var j,k,l=c('React').PropTypes;j=babelHelpers.inherits(m,c('React').Component);k=j&&j.prototype;function m(){var n,o;for(var p=arguments.length,q=Array(p),r=0;r<p;r++)q[r]=arguments[r];return o=(n=k.constructor).call.apply(n,[this].concat(q)),this.state={messageText:null,showEventReminderFlyout:false},this.$MercuryLogMessage3=function(){var s=this.props.loadMoreMessages&&this.props.loadMoreMessages();if(s){this.setState({messageText:this.$MercuryLogMessage2()});}else{var t=i._("Couldn't find previous messages.");this.setState({messageText:t});}}.bind(this),this.$MercuryLogMessage7=function(){this.setState({showEventReminderFlyout:!this.state.showEventReminderFlyout});}.bind(this),this.$MercuryLogMessage9=function(s){if(s!==this.state.showEventReminderFlyout)this.setState({showEventReminderFlyout:s});}.bind(this),o;}m.prototype.componentDidMount=function(){this.componentWillReceiveProps(this.props);};m.prototype.componentWillUnmount=function(){if(this.$MercuryLogMessage1)c('cancelAnimationFrame')(this.$MercuryLogMessage1);};m.prototype.$MercuryLogMessage2=function(){return c('React').createElement('a',{onClick:this.$MercuryLogMessage3,role:'button',tabIndex:'0'},i._("Show previous messages."));};m.prototype.componentWillReceiveProps=function(n){if(n.message.log_message_type===c('MercuryLogMessageType').SERVER_ERROR){this.$MercuryLogMessage3();return;}c('MercuryLogMessageRenderer').renderText(n.message,n.thread,n.isLastOfType,function(o){this.setState({messageText:o});}.bind(this));};m.prototype.shouldComponentUpdate=function(n,o){return this.state.messageText!=o.messageText||n.maxWidth!==this.props.maxWidth||this.state.showEventReminderFlyout!==o.showEventReminderFlyout;};m.prototype.componentDidUpdate=function(){this.$MercuryLogMessage4();if(!this.refs.attachment)return;c('MercuryLogMessageRenderer').renderAttachmentLegacy(this.refs.attachment,this.props.message);c('DOM').scry(this.refs.wrap,'img').forEach(function(n){var o=c('Event').listen(n,'load',function(){this.$MercuryLogMessage4();o.remove();}.bind(this));}.bind(this));};m.prototype.render=function(){return c('React').createElement('div',babelHelpers['extends']({},this.props,{className:c('joinClasses')(this.props.className,"_5ye6"),ref:'wrap',style:babelHelpers['extends']({},this.props.style,this.$MercuryLogMessage5()),title:c('formatDate')(new Date(this.props.message.timestamp),'g:ia')}),c('React').createElement('div',{className:"_5ye7"},c('MercuryLogMessageRenderer').renderIcon(this.props.message),this.state.messageText),c('React').createElement('div',{className:"_5ye8",ref:'attachment'},this.$MercuryLogMessage6()));};m.prototype.$MercuryLogMessage6=function(){if(this.props.thread&&!this.props.thread.lightweight_events||!this.props.message.log_message_data)return null;var n=void 0;c('requireWeak')('EventReminderStateStore',function(r){var s=this.props.thread.lightweight_events.message_thread_id;n=r.getEvent(s.toString());}.bind(this));if(!n||!n.exists)return null;var o;c('requireWeak')('Link.react',function(r){o=r;});var p='';switch(this.props.message.log_message_data.message_type){case 'lightweight_event_create':p=i._("Add Name");break;case 'lightweight_event_update_time':p=i._("Change Time");break;case 'lightweight_event_update_title':p=i._("Change Name");break;case 'lightweight_event_update':p=i._("Update Event");break;default:return null;}var q=c('React').createElement(o,{href:'#',onClick:this.$MercuryLogMessage7,title:i._("Edit Event"),ref:'event_rem_link'},p);if(this.props.displayItems)q=null;return c('React').createElement('span',null,q,this.$MercuryLogMessage8());};m.prototype.$MercuryLogMessage8=function(){if(!this.state.showEventReminderFlyout)return null;var event={eventDate:this.props.thread.lightweight_events.event_time,eventName:this.props.thread.lightweight_events.title,eventID:this.props.thread.lightweight_events.oid,threadID:this.props.thread.lightweight_events.message_thread_id},n=void 0;c('requireWeak')('EventReminderStateStore',function(q){var r;n=q.getEvent(event.threadID);if(!n||!n.exists)return;if(n&&n.eventDate===0){(function(){var s={eventName:event.eventName,eventDate:event.eventDate,eventID:event.eventID.toString(),threadID:event.threadID.toString()};c('requireWeak')('EventReminderActions',function(t){t.updateEventReminder(s);});})();}else{event.eventDate=n.eventDate;event.eventName=n.eventName;event.eventID=n.eventID;}});if(!n)return null;var o={position:'above',contextRef:function(){return this.refs.event_rem_link;}.bind(this),shown:this.state.showEventReminderFlyout,onToggle:this.$MercuryLogMessage9},p;c('requireWeak')('ChatEventReminderContainer.react',function(q){p=q;});return c('React').createElement(p,{eventDate:event.eventDate,eventName:event.eventName,eventID:event.eventID,threadID:event.threadID,dialogProps:o,flyoutNoSheet:true});};m.prototype.$MercuryLogMessage5=function(){return this.props.maxWidth?{maxWidth:this.props.maxWidth}:null;};m.prototype.$MercuryLogMessage4=function(){if(this.$MercuryLogMessage1)c('cancelAnimationFrame')(this.$MercuryLogMessage1);this.$MercuryLogMessage1=c('requestAnimationFrame')(function(){this.props.onImageLoad&&this.props.onImageLoad(c('DOMDimensions').getElementDimensions(this.refs.wrap).height);delete this.$MercuryLogMessage1;}.bind(this));};m.propTypes={loadMoreMessages:l.func,maxWidth:l.number,message:l.instanceOf(c('ImmutableObject')).isRequired,onImageLoad:l.func,thread:l.object};m.defaultProps={onImageLoad:c('emptyFunction')};f.exports=m;}),null);
__d('MessengerPageGreetingStore',['AsyncRequest','EventEmitter','Map','XMercuryChatTabPagesGreetingConfigController'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=new (c('Map'))(),k=new (c('Map'))();h=babelHelpers.inherits(l,c('EventEmitter'));i=h&&h.prototype;l.prototype.getOrFetch=function(m){var n=j.get(m);n||this.$MessengerPageGreetingStore1(m);return n;};l.prototype.$MessengerPageGreetingStore1=function(m){if(k.get(m))return;var n=c('XMercuryChatTabPagesGreetingConfigController').getURIBuilder().getURI(),o=new (c('AsyncRequest'))().setAllowCrossPageTransition(true).setURI(n).setData({page_id:m}).setHandler(this.$MessengerPageGreetingStore2.bind(this,m));k.set(m,o);o.send();};l.prototype.$MessengerPageGreetingStore2=function(m,n){j.set(m,{shouldShow:n.payload.shouldShow||false,content:n.payload.content||'',sayHelloMessage:n.payload.sayHelloMessage||''});k['delete'](m);this.emit('change');};function l(){h.apply(this,arguments);}f.exports=new l();}),null);
__d('MessageListGreeting.react',['cx','React','MercuryIDs','MessengerPageGreetingStore'],(function a(b,c,d,e,f,g,h){var i,j;i=babelHelpers.inherits(k,c('React').PureComponent);j=i&&i.prototype;function k(){var l,m;'use strict';for(var n=arguments.length,o=Array(n),p=0;p<n;p++)o[p]=arguments[p];return m=(l=j.constructor).call.apply(l,[this].concat(o)),this.state={shouldShowGreeting:false,greeting:''},this.$MessageListGreeting1=false,this.$MessageListGreeting2=function(q){if(!this.$MessageListGreeting1)return;var r=(q||this.props).threadID;if(!r)return;var s=c('MercuryIDs').getUserIDFromThreadID(r);if(!s)return;var t=c('MessengerPageGreetingStore').getOrFetch(s);if(t){this.setState({shouldShowGreeting:t.shouldShow,greeting:t.content});}else c('MessengerPageGreetingStore').once('change',this.$MessageListGreeting2);}.bind(this),m;}k.prototype.componentDidMount=function(){'use strict';this.$MessageListGreeting1=true;this.$MessageListGreeting2();};k.prototype.componentWillUnmount=function(){'use strict';this.$MessageListGreeting1=false;};k.prototype.componentWillReceiveProps=function(l){'use strict';this.$MessageListGreeting2(l);};k.prototype.render=function(){'use strict';if(this.props.messageCount>0)return null;if(!this.state.shouldShowGreeting||this.state.greeting.trim().length===0)return null;return (c('React').createElement('div',{className:"_4fsh _3-8z"},this.state.greeting));};f.exports=k;}),null);
__d("messengerDomIDsRe",["uniqueID"],(function a(b,c,d,e,f,g){'use strict';var h={COMPOSER_INPUT_DESCRIPTION:c("uniqueID")(),CONVERSATION:c("uniqueID")(),MAIN_LABEL:c("uniqueID")(),MUTE_DIALOG_TITLE:c("uniqueID")(),THREAD_INFO_PANEL:c("uniqueID")(),THREAD_TITLE:c("uniqueID")()};g.ids=h;}),null);
__d('MessageList.react',['cx','immutable','ImmutableObject','MercuryActionType','MercuryIDs','MercuryLogMessageType','MercuryMessageGroup','MessagingGenericAdminTextType','MessengerAdminGroupUtils','messengerDomIDsRe','MessageListGreeting.react','React','ReactDOM','MercuryShareAttachmentRenderLocations','idx'],(function a(b,c,d,e,f,g,h){'use strict';var i,j,k=c('messengerDomIDsRe').ids,l=c('React').PropTypes,m=1000*60*60,n=function u(v){var w,x,y,z,aa,ba,ca,da,ea=(w=v)!=null?(x=w.log_message_data)!=null?x.message_type:x:w;switch(ea){case c('MessagingGenericAdminTextType').GROUP_POLL:return (y=v)!=null?(z=y.log_message_data)!=null?(aa=z.untypedData)!=null?aa.question_id:aa:z:y;case c('MessagingGenericAdminTextType').INSTANT_GAME_UPDATE:return (ba=v)!=null?(ca=ba.log_message_data)!=null?(da=ca.untypedData)!=null?da.game_id:da:ca:ba;default:return null;}};i=babelHelpers.inherits(o,c('React').PureComponent);j=i&&i.prototype;function o(){var u,v;for(var w=arguments.length,x=Array(w),y=0;y<w;y++)x[y]=arguments[y];return v=(u=j.constructor).call.apply(u,[this].concat(x)),this.state={activeMessageID:null,messageGroups:c('MercuryMessageGroup').calculateMessageGroups(this.props.messages,this.props.location),shouldShowGreeting:false,greeting:''},this.$MessageList3=function(z){this.setState(function(aa){return {activeMessageID:aa.activeMessageID===z?null:aa.activeMessageID};});}.bind(this),this.$MessageList4=function(z){this.setState({activeMessageID:z});}.bind(this),v;}o.prototype.componentWillReceiveProps=function(u){if(u.messages!==this.props.messages)this.setState({messageGroups:c('MercuryMessageGroup').calculateMessageGroups(u.messages,u.location)});};o.prototype.render=function(){var u=this.props,v=u.DateBreak,w=u.location,x=u.MessageGroup,y=u.CollapsedLogMessageGroup,z=[],aa=[],ba=void 0,ca=this.props.thread&&this.props.thread.custom_color,da=ca?{backgroundColor:ca}:null,ea=this.state.activeMessageID,fa=this.state.messageGroups,ga=fa.length,ha=this.props.readReceipts,ia=ha.last(),ja=ia?ia.watermark:0,ka=c('MercuryIDs').getParticipantIDFromUserID(this.props.viewer),la={};for(var ma=this.props.messages.size-1;ma>=0;ma--){var na=this.props.messages.get(ma),oa=n(na);if(oa&&!la[oa])la[oa]=na.message_id;}for(var pa=0;pa<ga;pa++){var qa=pa>0?fa[pa-1]:null,ra=qa&&qa.length>0?qa[qa.length-1]:null,sa=fa[pa],ta=sa[0],ua=sa[sa.length-1],va=false;if(!ra||ta.timestamp-ra.timestamp>m){va=true;var wa=c('React').createElement(v,{date:new Date(ta.timestamp),key:'db:'+ta.message_id,ref:'db:'+ta.message_id});if(aa.length===0)z.push(wa);}if(ta.action_type==c('MercuryActionType').LOG_MESSAGE){var xa=ta.log_message_data.message_type===c('MessagingGenericAdminTextType').INSTANT_GAME_UPDATE,ya=ta.log_message_data.message_type===c('MessagingGenericAdminTextType').GROUP_POLL;if((w===c('MercuryShareAttachmentRenderLocations').CHAT||w===c('MercuryShareAttachmentRenderLocations').MESSENGER)&&(ta.log_message_type===c('MercuryLogMessageType').VIDEO_CALL||ta.log_message_type===c('MercuryLogMessageType').PHONE_CALL)){var za=this.$MessageList1(ta,ka,fa,ga,pa,ha,ja,ua);z.push(za);}else{var ab=this.$MessageList2(ta,la);ba=ta.message_id;if(c('MessengerAdminGroupUtils').isJoinableThread(this.props.thread)&&!xa&&!ya){aa.push(ab);}else{if(aa.length!==0){if(aa.length>1){z.push(c('React').createElement(y,{key:'mg:'+ba,style:da},aa));}else z.push(c('React').createElement('div',{key:'mg:'+ba},aa));aa=[];}z.push(ab);}}continue;}if(aa.length!==0){if(aa.length>1){z.push(c('React').createElement(y,{key:'mg:'+ba,style:da},aa));}else z.push(c('React').createElement('div',{key:'mg:'+ba},aa));aa=[];}sa=c('immutable').List(sa);var bb=q(fa,ga,pa),cb=!s(ha,sa,bb),db=r(ja,ua),eb=t(this.props.deliveryTimestamp,ua);z.push(c('React').createElement(x,{activeMessageID:p(ea,sa),author:sa.first().author,deliveryTimestamp:eb,hasDateBreak:va,isCanonical:this.props.isCanonical,isFromViewer:ka===ta.author,isPageMessage:this.props.isPageMessage,key:'mg:'+ta.message_id,lastReadTimestamp:db,maxBubbleWidth:this.props.maxBubbleWidth,messages:sa,nextTimestamp:bb,onAttachmentLoad:this.props.onAttachmentLoad,onMessageDeselect:this.$MessageList3,onMessageSelect:this.$MessageList4,onStickerClick:this.props.onStickerClick,readReceipts:cb?ha:c('immutable').OrderedMap(),ref:'mg:'+ta.message_id,thread:this.props.thread,threadID:this.props.threadID}));}if(aa.length!==0){if(aa.length>1){z.push(c('React').createElement(y,{key:'mg:'+ba,style:da},aa));}else z.push(c('React').createElement('div',{key:'mg:'+ba},aa));aa=[];}var fb=this.props.threadID||this.props.thread&&this.props.thread.thread_id||this.props.thread&&this.props.thread.thread_fbid,gb=null;if(w===c('MercuryShareAttachmentRenderLocations').MESSENGER)gb=c('React').createElement(c('MessageListGreeting.react'),{messageCount:aa.length+ga,threadID:fb});return c('React').createElement('div',{id:w===c('MercuryShareAttachmentRenderLocations').MESSENGER?k.CONVERSATION:null},gb,z);};o.prototype.getMessageElement=function(u,v){if(v){var w=this.refs['db:'+u];if(w)return c('ReactDOM').findDOMNode(w);}var x=this.state.messageGroups.find(function(aa){return aa.some(function(ba){return ba.message_id===u;});});if(!x)return null;var y=x[0].message_id,z=this.refs['mg:'+y];if(!z)return null;if(v&&y===u)return c('ReactDOM').findDOMNode(z);return z.getMessageElement(u);};o.prototype.$MessageList1=function(u,v,w,x,y,z,aa,ba){var ca=this.props.MessageGroup,da={attach_type:'share',share:{style_list:['rtc_call_log','fallback'],log_message_body:u.log_message_body,log_message_data:u.log_message_data,log_message_type:u.log_message_type,timestamp:u.timestamp}},ea=c('ImmutableObject').setProperty(u,'attachments',[da]);ea=c('ImmutableObject').setProperty(ea,'body','');var fa=c('immutable').List([ea]),ga=q(w,x,y),ha=!s(z,fa,ga),ia=r(aa,ba),ja=t(this.props.deliveryTimestamp,ba);return (c('React').createElement(ca,{author:fa.first().author,deliveryTimestamp:ja,isFromViewer:v===u.author,key:u.message_id,lastReadTimestamp:ia,maxBubbleWidth:this.props.maxBubbleWidth,messages:fa,nextTimestamp:ga,onAttachmentLoad:this.props.onAttachmentLoad,onMessageDeselect:this.$MessageList3,onMessageSelect:this.$MessageList4,onStickerClick:this.props.onStickerClick,readReceipts:ha?z:c('immutable').OrderedMap(),thread:this.props.thread,threadID:this.props.threadID}));};o.prototype.$MessageList2=function(u,v){var w=this.props.LogMessage,x=v[n(u)];return (c('React').createElement(w,{className:this.props.location===c('MercuryShareAttachmentRenderLocations').CHAT?"_5w0o":null,key:u.message_id,onLogMessageExpanded:this.props.onAttachmentLoad,loadMoreMessages:this.props.loadMoreMessages,message:u,onImageLoad:this.props.onAttachmentLoad,viewer:this.props.viewer,thread:this.props.thread,isLastOfType:x===u.message_id}));};o.propTypes={CollapsedLogMessageGroup:l.func.isRequired,DateBreak:l.func.isRequired,deliveryTimestamp:l.number.isRequired,isCanonical:l.bool,isPageMessage:l.bool,location:l.string.isRequired,LogMessage:l.func.isRequired,loadMoreMessages:l.func,MessageGroup:l.func.isRequired,messages:l.instanceOf(c('immutable').List).isRequired,onAttachmentLoad:l.func,onStickerClick:l.func,readReceipts:l.instanceOf(c('immutable').OrderedMap).isRequired,viewer:l.string.isRequired,thread:l.object,threadID:l.string};function p(u,v){return v.find(function(w){return w.message_id===u;})?u:null;}function q(u,v,w){return w<v-1?u[w+1][0].timestamp:Infinity;}function r(u,v){return v.timestamp>u?u:Infinity;}function s(u,v,w){return (v.isEmpty()||u.last()<v.first().timestamp||u.first()>=w);}function t(u,v){return v.timestamp>u?u:Infinity;}f.exports=o;}),null);
__d('ChatConversation.react',['cx','invariant','ChatCollapsedLogMessageGroup.react','ChatDateBreak.react','ChatMessageGroup.react','immutable','ImmutableObject','MercuryConfig','MercuryLogMessage.react','MercuryIDs','MercuryRoger','MessageList.react','React','Set','MercuryShareAttachmentRenderLocations','cancelAnimationFrame','requestAnimationFrame'],(function a(b,c,d,e,f,g,h,i){'use strict';var j=c('MercuryRoger').get(),k=c('immutable').OrderedMap,l=c('React').PropTypes,m=c('React').createClass({displayName:'ChatConversation',_raf:(undefined,Number),_onMountTimeout:(undefined,Number),propTypes:{contextBanner:l.object,isCanonical:l.bool.isRequired,loadMoreMessages:l.func,maxBubbleWidth:l.number.isRequired,messages:l.instanceOf(c('immutable').List).isRequired,onAttachmentLoad:l.func,onMount:l.func,onStickerClick:l.func,viewer:l.string.isRequired,thread:l.object,threadID:l.string.isRequired},componentDidMount:function n(){this._raf=c('requestAnimationFrame')(function(){this._onMountTimeout=setTimeout(function(){this.props.onMount&&this.props.onMount();delete this._onMountTimeout;}.bind(this),0);delete this._raf;}.bind(this));},componentWillUnmount:function n(){if(this._raf)c('cancelAnimationFrame')(this._raf);clearTimeout(this._onMountTimeout);},componentWillReceiveProps:function n(o){o.maxBubbleWidth===this.props.maxBubbleWidth||i(0);},render:function n(){var o=c('MercuryConfig').MessengerPlatformPinProtectionGK&&this.props.thread&&this.props.thread.is_pin_protected;return (c('React').createElement('div',null,this.props.contextBanner,o?this._renderPinProtectedMessage():c('React').createElement(c('MessageList.react'),{DateBreak:c('ChatDateBreak.react'),LogMessage:c('MercuryLogMessage.react'),MessageGroup:c('ChatMessageGroup.react'),deliveryTimestamp:0,isCanonical:this.props.isCanonical,location:c('MercuryShareAttachmentRenderLocations').CHAT,loadMoreMessages:this.props.loadMoreMessages,maxBubbleWidth:this.props.maxBubbleWidth,CollapsedLogMessageGroup:c('ChatCollapsedLogMessageGroup.react'),messages:this.props.messages,onAttachmentLoad:this.props.onAttachmentLoad,onStickerClick:this.props.onStickerClick,readReceipts:this._calculateReceipts(this.props),ref:'messageList',viewer:this.props.viewer,thread:this.props.thread,threadID:this.props.threadID})));},_renderPinProtectedMessage:function n(){return (c('React').createElement('div',{className:"_2ph_"},'This conversation is protected by pin. Use your device to unlock the conversation.'));},_calculateReceipts:function n(o){var p=c('MercuryIDs').getParticipantIDFromUserID(o.viewer),q=j.getSeenTimestamps(o.threadID),r=new (c('Set'))(o.thread?o.thread.participants:q.keys());r['delete'](p);return q.withMutations(function(s){c('immutable').Seq(o.messages).reverse().forEach(function(t){if(r.size===0)return false;if(!r.has(t.author))return null;s.update(t.author,function(u){if(!u||u.watermark<=t.timestamp)return {watermark:t.timestamp,action:t.timestamp};return u;});r['delete'](t.author);return null;});});},getMessageList:function n(){return this.refs.messageList;}});f.exports=m;}),null);
__d('ChatTypingIndicator.react',['cx','fbt','ChatConfig','Image.react','MercuryParticipants','MercuryTypingAnimation.react','ReactComponentWithPureRenderMixin','React'],(function a(b,c,d,e,f,g,h,i){var j=c('React').PropTypes,k=c('ChatConfig').get('chattab_rounded_profile',false),l=c('React').createClass({displayName:'ChatTypingIndicator',mixins:[c('ReactComponentWithPureRenderMixin')],propTypes:{userID:j.string,showName:j.bool},render:function n(){var o=void 0;if(this.props.userID)o=c('MercuryParticipants').getNow(this.props.userID);if(!o)return null;return (c('React').createElement('div',{className:"_4tdt"},m(o),this._renderBubble()));},getBubble:function n(){return this.refs.bubble;},_renderBubble:function n(){var o=this.props.showName;return (c('React').createElement('div',{className:"_4tdv"},c('React').createElement('div',{className:"_5wd4"+(' '+"_1nc7")+(' '+"_2cnu")+(o?' '+"_5ysy":'')},c('React').createElement('div',{className:"_5wd9"+(' '+"_n4o")},c('React').createElement('div',{className:"_5w1r"+(' '+"_5wdf")+(' '+"_3_om")},c('React').createElement(c('MercuryTypingAnimation.react'),{className:"_5x7x",ref:'bubble'}))))));}});function m(n){var o=i._("{name}",[i.param('name',n.name)]);return (c('React').createElement('div',{className:"_31o4"+(k?' '+"_3njy":'')},c('React').createElement('a',{'aria-label':o,className:"_4tdw",'data-hover':'tooltip','data-tooltip-content':o,'data-tooltip-position':'left',href:n.href||'#',ref:'link'},c('React').createElement(c('Image.react'),{src:n.image_src,ref:'image'}))));}f.exports=l;}),null);
__d('ChatTypingIndicators.react',['fbt','ChatTypingIndicator.react','DOM','MercuryIDs','MercuryThreadInformer','MercuryThreads','MercuryTypingReceiver','MercuryParticipants','React','ReactDOM','SubscriptionsHandler','TooltipData','createObjectFrom','emptyFunction'],(function a(b,c,d,e,f,g,h){var i=c('MercuryThreads').get(),j=c('React').PropTypes,k=c('React').createClass({displayName:'ChatTypingIndicators',propTypes:{indicatorClass:j.func,indicatorsWillShow:j.func,indicatorsDidShow:j.func,rootClassName:j.string,threadID:j.string.isRequired,viewer:j.string.isRequired},getDefaultProps:function l(){return {indicatorClass:c('ChatTypingIndicator.react'),indicatorsWillShow:c('emptyFunction'),indicatorsDidShow:c('emptyFunction')};},getInitialState:function l(){return {typingUserIDs:[]};},componentDidMount:function l(){var m=c('MercuryThreadInformer').getForFBID(this.props.viewer),n=c('MercuryTypingReceiver').getForFBID(this.props.viewer);this._subscriptions=new (c('SubscriptionsHandler'))();this._subscriptions.addSubscriptions(n.addRetroactiveListener('state-changed',this.typingStateChanged),m.subscribe('messages-received',this.messagesReceived));},componentWillReceiveProps:function l(m){if(m.threadID!=this.props.threadID)this.setState({typingUserIDs:[]});},componentWillUpdate:function l(m,n){if(n.typingUserIDs.length>0)this.props.indicatorsWillShow();},componentDidUpdate:function l(){if(this.state.typingUserIDs.length>0)this.props.indicatorsDidShow();c('MercuryParticipants').getMulti(this.state.typingUserIDs,function(m){if(this.isMounted())this.state.typingUserIDs.forEach(function(n){var o=m[n],p=this.refs[n]&&this.refs[n].getBubble();if(p&&o)c('TooltipData').set(c('ReactDOM').findDOMNode(p),this.renderTooltip(o.short_name),'above','left');}.bind(this));}.bind(this));},componentWillUnmount:function l(){this._subscriptions.release();},render:function l(){if(!c('MercuryIDs').isValid(this.props.threadID))return null;var m=i.getThreadMetaNow(this.props.threadID);if(m&&!m.is_subscribed)return null;var n=c('MercuryIDs').isGroupChat(this.props.threadID);return (c('React').createElement('div',{className:this.props.rootClassName},this.state.typingUserIDs.map(function(o){return (this._renderTypingIndicator(o,!!n));}.bind(this))));},_renderTypingIndicator:function l(m,n){var o=this.props.indicatorClass;return (c('React').createElement(o,{key:m,ref:m,showName:n,userID:m}));},renderTooltip:function l(m){var n=c('DOM').create('span');c('ReactDOM').render(c('React').createElement('span',null,h._("{name} is typing...",[h.param('name',m)])),n);return n;},typingStateChanged:function l(m){if(this.props.threadID in m)this.setState({typingUserIDs:m[this.props.threadID].slice().sort()});},messagesReceived:function l(m,n){if(this.props.threadID in n){var o=n[this.props.threadID],p=c('createObjectFrom')(o.map(function(q){return q.author;}));this.setState({typingUserIDs:this.state.typingUserIDs.filter(function(q){return !p[q];}).sort()});}}});f.exports=k;}),null);
__d('MessengerQuickCamOrigins',[],(function a(b,c,d,e,f,g){'use strict';var h={CHAT_TAB:'chat tab',MESSENGER:'messenger',getValues:function i(){return [h.CHAT_TAB,h.MESSENGER];}};f.exports=h;}),null);
__d('MercuryCamQuickReply.react',['cx','fbt','BootloadedComponent.react','JSResource','MercuryIDs','MercuryThreads','MessengerQuickCamOrigins','React','XUISpinner.react','convertMIGColorToFIGColor'],(function a(b,c,d,e,f,g,h,i){'use strict';var j,k,l=c('MercuryThreads').get(),m=c('React').PropTypes;j=babelHelpers.inherits(n,c('React').PureComponent);k=j&&j.prototype;n.prototype.componentWillUpdate=function(o,p){if(o&&this.props.lastMessage!==o.lastMessage&&this.props.camQuickReplyWillShow)this.props.camQuickReplyWillShow();};n.prototype.componentDidUpdate=function(o,p){if(o&&this.props.lastMessage!==o.lastMessage&&this.props.camQuickReplyDidShow)this.props.camQuickReplyDidShow();};n.prototype.render=function(){var o=this.props.lastMessage,p=c('MercuryIDs').getParticipantIDFromUserID(this.props.viewer);if(!(o&&o.message_source&&o.author!==p&&o.message_source==='camera'))return null;var q=l.getThreadMetaNow(this.props.threadID),r=q?c('convertMIGColorToFIGColor')(q.custom_color):null,s=c('React').createElement('div',{className:"_zdf",style:r&&{color:r}},i._("Send a photo reply"));return (c('React').createElement('div',{className:"_zdg"},c('React').createElement(c('BootloadedComponent.react'),{bootloadLoader:c('JSResource')('MessengerQuickCamButtonHTML5.react').__setRef('MercuryCamQuickReply.react'),bootloadPlaceholder:c('React').createElement(c('XUISpinner.react'),{className:"_5h-9"}),className:"_5yhk"+(' '+"_6gb"),location:c('MessengerQuickCamOrigins').CHAT_TAB,threadID:this.props.threadID,viewer:this.props.viewer,textChild:s})));};function n(){j.apply(this,arguments);}n.propTypes={camQuickReplyWillShow:m.func,camQuickReplyDidShow:m.func,lastMessage:m.object,threadID:m.string.isRequired,viewer:m.string.isRequired};f.exports=n;}),null);
__d('MercuryMessageList',['immutable','LogHistory','Map','setTimeoutAcrossTransitions'],(function a(b,c,d,e,f,g){'use strict';var h=c('LogHistory').getInstance('mercury_message_list');function i(k){this.$MercuryMessageList1=c('immutable').List(k||[]);this.$MercuryMessageList2();}i.prototype.append=function(k){var l;this.$MercuryMessageList1=(l=this.$MercuryMessageList1).push.apply(l,k);this.$MercuryMessageList2();j('append',k);};i.prototype.prepend=function(k){var l;this.$MercuryMessageList1=(l=this.$MercuryMessageList1).unshift.apply(l,k);this.$MercuryMessageList2();j('prepend',k);};i.prototype.update=function(k){var l=k.filter(function(m){return this.contains(m);}.bind(this));if(l.length===0)return;this.$MercuryMessageList1=this.$MercuryMessageList1.withMutations(function(m){l.forEach(function(n){var o=this.$MercuryMessageList3.get(n.message_id);if(o!==undefined)m.set(o,n);}.bind(this));}.bind(this));j('update',l);};i.prototype.reorder=function(k){this.$MercuryMessageList1=c('immutable').List(k);this.$MercuryMessageList2();j('reorder',k);};i.prototype.at=function(k){return this.$MercuryMessageList1.get(k);};i.prototype.contains=function(k){return this.$MercuryMessageList3.has(k.message_id);};i.prototype.toArray=function(){return this.$MercuryMessageList1.toArray();};i.prototype.toMap=function(){return new (c('Map'))(c('immutable').Seq(this.$MercuryMessageList1).map(function(k){return [k.message_id,k];}));};i.prototype.$MercuryMessageList2=function(){this.$MercuryMessageList3=new (c('Map'))(c('immutable').Seq(this.$MercuryMessageList1).map(function(k,l){return [k.message_id,l];}));};function j(event,k){c('setTimeoutAcrossTransitions')(function(){h.debug(event,JSON.stringify({messageIDs:k.map(function(l){return l.message_id;})}));},0);}f.exports=i;}),null);
__d('MercuryMessageStore',['MercuryAPIArgsSource','LogHistory','MercuryMessages','MercuryViewer','MercuryMessageList','SubscriptionsHandler','MercuryThreadInformer','MercuryThreadlistConstants','MercuryThreads','mixInEventEmitter','setImmediate','setTimeoutAcrossTransitions'],(function a(b,c,d,e,f,g){'use strict';var h=c('MercuryThreads').get(),i=c('LogHistory').getInstance('mercury_message_store');function j(l,m,n){this.$MercuryMessageStore1=l;this.$MercuryMessageStore2=new (c('MercuryMessageList'))();this.$MercuryMessageStore3=n?c('MercuryMessages').getForFBID(n):c('MercuryMessages').get();this.$MercuryMessageStore4=1;this.$MercuryMessageStore5=null;this.$MercuryMessageStore6=0;this.$MercuryMessageStore7=m||c('MercuryThreadlistConstants').RECENT_MESSAGES_LIMIT;this.$MercuryMessageStore8=n?c('MercuryThreadInformer').getForFBID(n):c('MercuryThreadInformer').get();this.$MercuryMessageStore9=new (c('SubscriptionsHandler'))();this.$MercuryMessageStore9.addSubscriptions(this.$MercuryMessageStore8.subscribe('messages-received',function(o,p){return this.$MercuryMessageStore10(p);}.bind(this)),this.$MercuryMessageStore8.subscribe('messages-updated',function(o,p){return p[this.$MercuryMessageStore1]&&this.$MercuryMessageStore11(p[this.$MercuryMessageStore1]);}.bind(this)),this.$MercuryMessageStore8.subscribe('messages-reordered',function(o,p){return p[this.$MercuryMessageStore1]&&this.$MercuryMessageStore12();}.bind(this)),this.$MercuryMessageStore8.subscribe('thread-invalidated',function(o,p){return p[this.$MercuryMessageStore1]&&this.$MercuryMessageStore13();}.bind(this)));i.debug('constructed',JSON.stringify({threadID:this.$MercuryMessageStore1}));this.$MercuryMessageStore14();}j.prototype.setNewThreadID=function(l){this.$MercuryMessageStore15=l;};j.prototype.destroy=function(){this.$MercuryMessageStore9&&this.$MercuryMessageStore9.release();i.debug('destroyed',JSON.stringify({threadID:this.$MercuryMessageStore1}));};j.prototype.subscribe=function(l){return this.addRetroactiveListener('updated',l);};j.prototype.fetchMoreMessages=function(){if(this.hasFetchedAll())return false;this.$MercuryMessageStore14();return true;};j.prototype.hasFetchedAll=function(){if(this.$MercuryMessageStore3.hasLoadedExactlyNMessages(this.$MercuryMessageStore1,this.$MercuryMessageStore6)&&this.$MercuryMessageStore3.hasLoadedAllMessages(this.$MercuryMessageStore1))return true;return h.isNewEmptyLocalThread(this.$MercuryMessageStore1);};j.prototype.$MercuryMessageStore14=function(){var l=this.$MercuryMessageStore6+this.$MercuryMessageStore7*this.$MercuryMessageStore4;i.debug('fetching',JSON.stringify({threadID:this.$MercuryMessageStore1,limit:l}));this.$MercuryMessageStore3.getThreadMessagesRange(this.$MercuryMessageStore1,0,l,this.$MercuryMessageStore16.bind(this),null,c('MercuryAPIArgsSource').MERCURY);if(this.$MercuryMessageStore4<10)this.$MercuryMessageStore4+=1;if(this.$MercuryMessageStore3.hasLoadedNMessages(this.$MercuryMessageStore1,l))c('setImmediate')(function(){this.$MercuryMessageStore12();}.bind(this));};j.prototype.$MercuryMessageStore16=function(l){if(l&&l.length){this.$MercuryMessageStore5=l[0].timestamp;this.$MercuryMessageStore6=l.length;i.debug('fetched',JSON.stringify({threadID:this.$MercuryMessageStore1,earliestMessageTimestamp:this.$MercuryMessageStore5,count:this.$MercuryMessageStore6}));}else if(l&&!l.length&&!this.$MercuryMessageStore6)this.$MercuryMessageStore17(j.THREAD_IS_EMPTY);};j.prototype.$MercuryMessageStore10=function(l){var m=[],n=l[this.$MercuryMessageStore1];if(n&&n.length)m=m.concat(n);if(this.$MercuryMessageStore15){var o=l[this.$MercuryMessageStore15];if(o&&o.length){m=m.concat(o);this.$MercuryMessageStore15=null;}}if(m.length){this.$MercuryMessageStore2.append(m);this.$MercuryMessageStore6+=m.length;var p=m.every(function(q){return q.author!=c('MercuryViewer').getID();});this.$MercuryMessageStore17(j.MESSAGES_RECEIVED,{allFromOthers:p});}};j.prototype.$MercuryMessageStore11=function(l){this.$MercuryMessageStore2.update(this.$MercuryMessageStore3.getMessagesFromIDs(Object.keys(l)));this.$MercuryMessageStore18();this.$MercuryMessageStore17(j.MESSAGES_CHANGED);};j.prototype.$MercuryMessageStore12=function(){if(!this.$MercuryMessageStore5)return;this.$MercuryMessageStore2.reorder(this.$MercuryMessageStore3.getThreadMessagesSinceTimestamp(this.$MercuryMessageStore1,this.$MercuryMessageStore5));this.$MercuryMessageStore18();this.$MercuryMessageStore17(j.MESSAGES_REORDERED);};j.prototype.$MercuryMessageStore13=function(){this.$MercuryMessageStore2=new (c('MercuryMessageList'))();this.$MercuryMessageStore4=1;this.$MercuryMessageStore5=null;this.$MercuryMessageStore6=0;this.$MercuryMessageStore14();};j.prototype.$MercuryMessageStore17=function(l,m){var n=this.$MercuryMessageStore2.toArray();this.releaseHeldEventType('updated');this.emitAndHold('updated',babelHelpers['extends']({messages:n,eventType:l},m));k(this.$MercuryMessageStore1,l,n);};j.prototype.$MercuryMessageStore18=function(){var l=this.$MercuryMessageStore2.at(0);if(l)this.$MercuryMessageStore5=l.timestamp;};function k(l,m,n){c('setTimeoutAcrossTransitions')(function(){i.debug('update:'+m,JSON.stringify({threadID:l,messageIDs:n.map(function(o){return o.message_id;})}));},0);}Object.assign(j,{MESSAGES_FETCHED:'fetched',MESSAGES_CHANGED:'changed',MESSAGES_RECEIVED:'received',MESSAGES_REORDERED:'reordered',THREAD_IS_EMPTY:'thread-is-empty'});c('mixInEventEmitter')(j,{updated:true});f.exports=j;}),null);
__d('MercuryQuickReply.react',['cx','BootloadedComponent.react','JSResource','MercuryConfig','MercuryIDs','MNOmniMConstants','OmniMStore','React','XUISpinner.react','FluxContainer'],(function a(b,c,d,e,f,g,h){'use strict';var i,j,k=c('React').PropTypes;i=babelHelpers.inherits(l,c('React').PureComponent);j=i&&i.prototype;function l(){var m,n;for(var o=arguments.length,p=Array(o),q=0;q<o;q++)p[q]=arguments[q];return n=(m=j.constructor).call.apply(m,[this].concat(p)),this.state={suggestions:null,omniMPrefs:null},n;}l.getStores=function(){return [c('OmniMStore')];};l.calculateState=function(m,n){return {suggestions:c('OmniMStore').suggestionsForThread(n.threadID),omniMPrefs:c('OmniMStore').prefs()};};l.prototype.componentWillMount=function(){if(this.props.quickReplyWillShow&&this.$MercuryQuickReply1(this.state))this.props.quickReplyWillShow();};l.prototype.componentDidMount=function(){if(this.props.quickReplyDidShow&&this.$MercuryQuickReply1(this.state))this.props.quickReplyDidShow();};l.prototype.componentWillUpdate=function(m,n){if(this.props.quickReplyWillShow&&n&&this.$MercuryQuickReply1(n)&&!this.$MercuryQuickReply1(this.state))this.props.quickReplyWillShow();};l.prototype.componentDidUpdate=function(m,n){if(this.props.quickReplyDidShow&&this.$MercuryQuickReply1(this.state)&&!this.$MercuryQuickReply1(n))this.props.quickReplyDidShow();};l.prototype.render=function(){var m=this.props.lastMessage;if(!m)return null;var n=null,o=null,p=c('MercuryIDs').getParticipantIDFromUserID(this.props.viewer),q=this.state.suggestions||{},r=q.quickReplies,s=q.agentSuggestions;if(r&&r.length&&m.author!==p){n=r;o=c('MNOmniMConstants').QUICKREPLIES;}else if(s&&s.length&&c('MercuryConfig').EnableOmniM){n=s;o=c('MNOmniMConstants').OMNIM;}if(!n||!n.length||!n.filter(function(t){return !t.dismissed;}).length)return null;return (c('React').createElement('div',{className:"_419m",ref:'quickReply'},c('React').createElement(c('BootloadedComponent.react'),{bootloadLoader:c('JSResource')('MessengerBotsQuickReplyButtonList.react').__setRef('MercuryQuickReply.react'),bootloadPlaceholder:c('React').createElement(c('XUISpinner.react'),{className:"_5h-9"}),omniMPrefs:this.state.omniMPrefs,options:n,threadID:m.thread_id,source:o})));};l.prototype.$MercuryQuickReply1=function(m){var n=m.suggestions||{},o=n.quickReplies,p=n.agentSuggestions,q=o&&o.length,r=p&&p.length&&c('MercuryConfig').EnableOmniM;return !!(q||r);};l.propTypes={quickReplyWillShow:k.func,quickReplyDidShow:k.func,lastMessage:k.object,threadID:k.string.isRequired,viewer:k.string.isRequired};f.exports=c('FluxContainer').create(l,{withProps:true});}),null);
__d('ChatTabMessagesView',['Animation','Arbiter','BanzaiLogger','Bootloader','CSS','ChatConversation.react','ChatPerfInstrumentation','ChatTabViewEvents','ChatTypingIndicators.react','ChatWelcomeMessage','CurrentUser','DOM','Event','immutable','MercuryLastMessageIndicator.react','LiveTimer','MercuryConfig','MercuryIDs','MercuryCamQuickReply.react','MercuryThreadInformer','MercuryThreads','MercuryQuickReply.react','MercuryMessageStore','MercuryAttachment','MessengerContextBannerBootloader','MessengerHotLikePreviewEvents','MessengerVideoAutoplayActions','MessengerVideoAutoplayStore','React','ReactDOM','ReactComponentRenderer','MercuryShareAttachmentRenderLocations','Scroll','ServerTime','StickerInterfaces','Style','SubscriptionsHandler','UserAgent_DEPRECATED','emptyFunction','getElementPosition','isEventSupported','throttle'],(function a(b,c,d,e,f,g){'use strict';var h=c('MercuryThreadInformer').get(),i=c('MercuryThreads').get(),j=64,k=null,l=20;function m(o){if(k===null){var p=o.childNodes[0];c('Style').set(o,'overflow','scroll');k=p.clientWidth-j;c('Style').set(o,'overflow','');}return k;}function n(o,p,q,r,s,t,u,v,w,x,y){this.loadingIcon=s;this.threadID=o;this.sheetController=p;this.scrollContainer=q;this.conversationElem=r;this.contextBannerEligible=w;this.contextBannerElem=null;this.tabView=v;this._shouldTrackBottom=true;c('LiveTimer').restart(c('ServerTime').get()/1000);this._loadingMoreMessages=false;this._initialLoadFinished=false;if(this.threadID&&!i.isEmptyLocalThread(this.threadID))c('CSS').show(this.loadingIcon);function z(){this._clearScrollTimers();this._shouldTrackBottom=false;c('ChatTabViewEvents').inform('interaction-with-tab',this.threadID);}function aa(){this._checkAndSetScrolledToBottom();}function ba(){this._clearScrollTimers();setTimeout(function(){this._checkAndSetScrolledToBottom();}.bind(this),500);}this._subscriptions=new (c('SubscriptionsHandler'))();this._subscriptions.addSubscriptions(c('Arbiter').subscribe('overflow-applied-to-body',function(){return this.trackBottomIfRequired();}.bind(this)),c('Event').listen(this.scrollContainer,'mousedown',z.bind(this)),c('Event').listen(this.scrollContainer,'mouseup',aa.bind(this)));this._initOverflowObserver();var ca=c('isEventSupported')('wheel')?'wheel':c('isEventSupported')('mousewheel')?'mousewheel':'DOMMouseScroll';this._subscriptions.addSubscriptions(c('Event').listen(this.scrollContainer,ca,ba.bind(this)));this._subscriptions.addSubscriptions(c('Event').listen(this.scrollContainer,'scroll',c('throttle')(this.scrolling,50,this)));this._setupScrollInterval();var da=c('CurrentUser').getID();c('ReactDOM').render(c('React').createElement(c('ChatTypingIndicators.react'),{threadID:this.threadID,indicatorsWillShow:c('emptyFunction'),indicatorsDidShow:function(){return this.trackBottomIfRequired(true);}.bind(this),viewer:da}),u);if(!c('MercuryConfig').ChatSeenHeadsEnabled){this.lastMessageIndicatorNode=t;this.lastMessageIndicator=new (c('ReactComponentRenderer'))(c('MercuryLastMessageIndicator.react'),this.lastMessageIndicatorNode);this.lastMessageIndicator.setProps({threadID:this.threadID,hideTyping:true,indicatorWillShow:c('emptyFunction'),indicatorDidShow:function(){return this.trackBottomIfRequired(true);}.bind(this)});}if(c('MercuryConfig').WebCamQuickReply){this.camQuickReplyNode=y;this.camQuickReply=new (c('ReactComponentRenderer'))(c('MercuryCamQuickReply.react'),this.camQuickReplyNode);this.camQuickReply.setProps({camQuickReplyWillShow:c('emptyFunction'),camQuickReplyDidShow:function(){return this.trackBottomIfRequired(true);}.bind(this),threadID:this.threadID,viewer:da});}if(c('MercuryConfig').EnableQuickReply){this.quickReplyNode=x;this.quickReply=new (c('ReactComponentRenderer'))(c('MercuryQuickReply.react'),this.quickReplyNode);this.quickReply.setProps({threadID:this.threadID,quickReplyWillShow:c('emptyFunction'),quickReplyDidShow:function(){return this.trackBottomIfRequired(true);}.bind(this),viewer:da});}this.initializeConversation();}Object.assign(n.prototype,{initializeConversation:function o(){this._store=new (c('MercuryMessageStore'))(this.threadID);this._conversation=new (c('ReactComponentRenderer'))(c('ChatConversation.react'),this.conversationElem);this._conversation.setProps({isCanonical:c('MercuryIDs').isCanonical(this.threadID),loadMoreMessages:this._loadMoreMessages.bind(this),maxBubbleWidth:m(this.scrollContainer),messages:c('immutable').List(),onAttachmentLoad:function(){return this.trackBottomIfRequired();}.bind(this),onMount:function(){return this.trackBottomIfRequired();}.bind(this),onStickerClick:this._onStickerClick.bind(this),viewer:c('CurrentUser').getID(),threadID:this.threadID});if(c('MercuryIDs').isCanonical(this.threadID))this._hideLoadingIconTimeout=setTimeout(function(){c('CSS').hide(this.loadingIcon);if(this.contextBannerEligible)this.renderContextBanner(this.threadID);}.bind(this),6000);i.getThreadMeta(this.threadID,function(p){this._conversation.setProps({thread:p});if(!p||p.message_count>0){c('CSS').hide(this.loadingIcon);clearTimeout(this._hideLoadingIconTimeout);}}.bind(this));if(i.isEmptyLocalThread(this.threadID)&&this.contextBannerEligible)this.renderContextBanner(this.threadID);this._subscriptions.addSubscriptions(h.subscribe('threads-updated',function(){return this._updateThreadInfo();}.bind(this)));this._subscriptions.addSubscriptions(this._store.subscribe(this._updateMessageFromStore.bind(this)),c('MessengerHotLikePreviewEvents').addListener(c('MessengerHotLikePreviewEvents').START,function(p,q){if(this.threadID!==q||!this._messages)return;this._likePreview=p;this._conversation.setProps({messages:this._getNormalizedMessages()},this.scrollToBottom.bind(this));this.trackBottomIfRequired();clearInterval(this._scrollToBottomInterval);this._scrollToBottomInterval=setInterval(this.scrollToBottom.bind(this),50);}.bind(this)),c('MessengerHotLikePreviewEvents').addListener(c('MessengerHotLikePreviewEvents').STOP,function(p){if(this.threadID!==p)return;this._likePreview=null;}.bind(this)),c('MessengerHotLikePreviewEvents').addListener(c('MessengerHotLikePreviewEvents').STOP_EMOJI,function(p){if(this.threadID!==p)return;this._likePreview=null;}.bind(this)),c('MessengerHotLikePreviewEvents').addListener(c('MessengerHotLikePreviewEvents').FINISH_ANIMATION,function(p){clearInterval(this._scrollToBottomInterval);}.bind(this)),c('MessengerHotLikePreviewEvents').addListener(c('MessengerHotLikePreviewEvents').FINISH_EMOJI_ANIMATION,function(p){clearInterval(this._scrollToBottomInterval);}.bind(this)),c('MessengerHotLikePreviewEvents').addListener(c('MessengerHotLikePreviewEvents').REMOVE,function(p){if(this.threadID!==p)return;clearInterval(this._scrollToBottomInterval);this._likePreview=null;this._conversation.setProps({messages:this._getNormalizedMessages()});}.bind(this)));},_initOverflowObserver:function o(){if(!c('UserAgent_DEPRECATED').firefox())return;var p=function u(){return c('Style').get(document.body,'overflowX')+' '+c('Style').get(document.body,'overflowY');},q=p(),r=function u(){var v=p();if(v!==q){q=v;c('Arbiter').inform('overflow-applied-to-body');}};if('MutationObserver' in window){var s=new MutationObserver(r),t={attributes:true,attributeFilter:['class','style']};s.observe(document.documentElement,t);}else document.documentElement.addEventListener('DOMAttrModified',function(event){if(event.getTarget()===document.documentElement&&(event.attrName==='class'||event.attrName==='style'))r();},false);},_checkAndSetScrolledToBottom:function o(){if(this.isScrolledToBottom(0)){this._shouldTrackBottom=true;this._setupScrollInterval();}else{this._shouldTrackBottom=false;this._clearScrollTimers();}},_setupScrollInterval:function o(){if(!c('MercuryConfig').ChatScrollInterval)return;this._clearScrollTimers();this._scrollInterval=setInterval(function(){this.trackBottomIfRequired();}.bind(this),500);},_clearScrollTimers:function o(){clearInterval(this._scrollInterval);},_updateThreadInfo:function o(){i.getThreadMeta(this.threadID,function(p){this._conversation.setProps({thread:p});if(p.has_montage&&!this._montageSheetOpenedByThread&&c('MercuryConfig').MontageThreadViewer){this.sheetController.openMontageSheet();this._montageSheetOpened=true;this._montageSheetOpenedByThread=true;}}.bind(this));},_updateMessageFromStore:function o(p){var q=p.eventType==c('MercuryMessageStore').MESSAGES_REORDERED,r=p.eventType==c('MercuryMessageStore').MESSAGES_RECEIVED,s=p.eventType==c('MercuryMessageStore').THREAD_IS_EMPTY;if(r&&p.allFromOthers&&!this.isScrolledToBottom()){this.sheetController.openNewMessagesSheet();this._newMessagesSheetOpened=true;}if(q)this._loadingMoreMessages=false;if(q||r||s)c('CSS').hide(this.loadingIcon);var t=this.isScrolledToBottom(),u=this._getLoadingHeight(),v=this.scrollContainer.scrollHeight,w=c('Scroll').getTop(this.scrollContainer);this._messages=p.messages;var x=c('ChatWelcomeMessage').getWelcomeMessage(this.threadID);if(x)this._messages.push(x);clearTimeout(this._hideLoadingIconTimeout);this._conversation.setProps({messages:this._getNormalizedMessages()},function(){if(t){this.trackBottomIfRequired();}else if(q){this.scrollToPosition(this.scrollContainer.scrollHeight-v-u+w);}else this.trackBottomIfRequired();if(!this._initialLoadFinished){this._initialLoadFinished=true;c('ChatPerfInstrumentation').logCHAT_CONVERSATION_TTI();}if(this._store.hasFetchedAll()&&this.contextBannerEligible)this.renderContextBanner(this.threadID);if(!this._store.hasFetchedAll()&&this._getNormalizedMessages().size===0)this._store.fetchMoreMessages();}.bind(this));i.getThreadMeta(this.threadID,function(y){return this._conversation.setProps({thread:y});}.bind(this));if(!c('MercuryConfig').ChatSeenHeadsEnabled)this.lastMessageIndicator.setProps({lastMessage:this._messages.length>0?this._messages[this._messages.length-1]:null});if(this.camQuickReply)this.camQuickReply.setProps({lastMessage:this._messages.length>0?this._messages[this._messages.length-1]:null});if(this.quickReply)this.quickReply.setProps({lastMessage:this._messages.length>0?this._messages[this._messages.length-1]:null});if(p.eventType==c('MercuryMessageStore').MESSAGES_CHANGED)this._checkToAnimateSticker();c('MessengerVideoAutoplayActions').updateStore(this.threadID,this._getVideoMessageIDs());},scrolling:function o(p){this._checkToAnimateSticker();if(this.isScrolledNearTop()&&!this._loadingMoreMessages&&!this.isScrolledToBottom()&&!this.tabView._isDragDropActive)if(this._store.fetchMoreMessages()){c('CSS').show(this.loadingIcon);this._loadingMoreMessages=true;}this._checkVideoMessageVisibility();var q=this._montageSheetOpened||this._montageSheetOpenedByThread;if(!this._newMessagesSheetOpened&&!q)return;if(this.isScrolledToBottom()){if(this._newMessagesSheetOpened){this.sheetController.closeNewMessagesSheet();this._newMessagesSheetOpened=false;}if(!this._montageSheetOpened){this.sheetController.openMontageSheet();this._montageSheetOpened=true;}}else if(this._montageSheetOpened){this.sheetController.closeMontageSheet();this._montageSheetOpened=false;}},getScrollTop:function o(){return this.scrollContainer&&c('Scroll').getTop(this.scrollContainer);},getThreadID:function o(){return this.threadID;},destroy:function o(){this._clearScrollTimers();c('DOM').scry(this.conversationElem,'.stickerContainer').forEach(function(p){return c('ReactDOM').unmountComponentAtNode(p);});this.unmountContextBanner();c('ReactDOM').unmountComponentAtNode(this.conversationElem);this._subscriptions&&this._subscriptions.release();if(!c('MercuryConfig').ChatSeenHeadsEnabled){c('ReactDOM').unmountComponentAtNode(this.lastMessageIndicatorNode);delete this.lastMessageIndicator;}if(this.camQuickReplyNode){c('ReactDOM').unmountComponentAtNode(this.camQuickReplyNode);delete this.camQuickReply;}if(this.quickReplyNode){c('ReactDOM').unmountComponentAtNode(this.quickReplyNode);delete this.quickReply;}this._store&&this._store.destroy();c('MessengerVideoAutoplayActions').deleteThread(this.threadID);this.destroyed=true;},_getLoadingHeight:function o(){return this.loadingHeight||this.loadingIcon.clientHeight;},isScrolledToBottom:function o(p){var q=this.scrollContainer;p=p===0?0:p||l;return c('Scroll').getTop(q)+q.clientHeight>=q.scrollHeight-p;},isScrolledNearTop:function o(){return c('Scroll').getTop(this.scrollContainer)<this.scrollContainer.clientHeight;},messageSent:function o(){this._shouldTrackBottom=true;this.scrollToBottom();},scrollToBottom:function o(p){this.scrollToPosition(this.scrollContainer.scrollHeight,p);},scrollToPosition:function o(p,q){this._scrollTopAnimation&&this._scrollTopAnimation.stop();if(q===true){this._scrollTopAnimation=new (c('Animation'))(this.scrollContainer).to('scrollTop',p).ease(c('Animation').ease.end).duration(400).go();}else c('Scroll').setTop(this.scrollContainer,p);},trackBottomIfRequired:function o(p){if(this._shouldTrackBottom){this._setupScrollInterval();this.scrollToBottom(p);}else this._clearScrollTimers();},_getVideoMessageIDs:function o(){return this._messages&&c('immutable').List(this._messages).filter(function(p){return (c('MercuryAttachment').isSingleVideoAttachment(p)||c('MercuryAttachment').isSharedVideoAttachmentMessage(p));}).reverse().map(function(p){return p.message_id;});},_checkVideoMessageVisibility:function o(){var p=this.scrollContainer.getBoundingClientRect(),q=this._conversation.component.refs.messageList;if(!q||!p)return;var r=[],s=c('MessengerVideoAutoplayStore').getMessageIDs(this.threadID),t=s||this._getVideoMessageIDs()||c('immutable').List();t.map(function(u){var v=c('MercuryAttachment').getVideoElem(u,q);if(v)r.push([u,v.getBoundingClientRect()]);});if(r.length)c('MessengerVideoAutoplayActions').onScroll(this.threadID,s?null:t,c('immutable').Map(r),p);},_loadMoreMessages:function o(){return this._store.fetchMoreMessages();},_onStickerClick:function o(p,q){if(!p||!this.threadID)return;c('BanzaiLogger').log('StickersLoggerConfig',{event:'click_sticker',packid:p,stickerid:q});c('Bootloader').loadModules(["StickersPackInTray","StickersActions","StickersStoreController"],function(r,s,t){r.onIsPackInTray(p,c('StickerInterfaces').MESSAGES,function(u){if(u.in_sticker_tray){s.selectTrayPack(p);s.showStickerFlyout(this.threadID);}else t.showStore(p);}.bind(this));}.bind(this),'ChatTabMessagesView');},_checkToAnimateSticker:function o(){var p=c('getElementPosition')(this.scrollContainer);c('Arbiter').inform('chatScrolled/'+this.threadID,{scrollTop:c('Scroll').getTop(this.scrollContainer),top:p.y,viewHeight:p.height});},setNewThreadID:function o(p){this._store.setNewThreadID(p);},_getNormalizedMessages:function o(){if(this._likePreview){this._messages.push(this._likePreview);}else this._messages=this._messages.filter(function(p){return !p.is_like_preview;});return c('immutable').List(this._messages);},renderContextBanner:function o(p,q){c('MessengerContextBannerBootloader').getBootloadedComponent(p,c('MercuryShareAttachmentRenderLocations').CHAT,function(r){c('Style').set(this.conversationElem,'padding-top','80px');this._conversation.setProps({contextBanner:r});}.bind(this),q,function(r){c('Style').set(this.conversationElem,'padding-top',r+'px');}.bind(this));},unmountContextBanner:function o(){if(this._conversation)this._conversation.setProps({contextBanner:null});}});f.exports=n;}),null);
__d('ChatNubLogger',['BanzaiLogger','ScriptPath','pageID'],(function a(b,c,d,e,f,g){var h='TimeSpentChatNubLoggerConfig',i={INPUT_ACTIVE:'active',INPUT_INACTIVE:'inactive'},j={ENTER:'enter',LEAVE:'leave'},k=i.INPUT_INACTIVE,l=0,m=false;function n(){if(k==i.INPUT_ACTIVE&&!m){k=i.INPUT_INACTIVE;o(j.LEAVE);l=0;}else if(k==i.INPUT_INACTIVE&&m){k=i.INPUT_ACTIVE;l=Date.now();o(j.ENTER);}}function o(event){var q=c('BanzaiLogger').create({retry:true}),r=Date.now();q.log(h,{event:event,client_event_time_ms:r,active_time_ms:event==j.LEAVE?r-l:0,page_id:c('pageID'),script_path:c('ScriptPath').getScriptPath(),page_data:c('ScriptPath').getPageInfo()?c('ScriptPath').getPageInfo().extraData:{}});}var p={processEvent:function q(r){switch(r){case 'focus':m=true;break;case 'blur':m=false;break;default:break;}n();}};f.exports=p;}),null);
__d('ContextualLayerAutoFlipHorizontal',['ContextualLayerAutoFlip'],(function a(b,c,d,e,f,g){var h,i;h=babelHelpers.inherits(j,c('ContextualLayerAutoFlip'));i=h&&h.prototype;j.prototype.getValidPositions=function(k){'use strict';return [k.getPosition()];};function j(){'use strict';h.apply(this,arguments);}f.exports=j;}),null);
__d('ChatContentSearchContextualDialog.react',['cx','ContextualLayerAutoFlipHorizontal','LayerHideOnEscape','ReactAbstractContextualDialog','ReactLayer'],(function a(b,c,d,e,f,g,h){'use strict';var i=c('ReactLayer').createClass(c('ReactAbstractContextualDialog').createSpec({addedBehaviors:[c('ContextualLayerAutoFlipHorizontal'),c('LayerHideOnEscape')],displayName:'StickerXUIContextualDialog',theme:{wrapperClassName:"_53ii",arrowDimensions:{offset:47,length:16}}}));f.exports=i;}),null);
__d('ChatFlyoutPlaceholder.react',['React','XUISpinner.react'],(function a(b,c,d,e,f,g){'use strict';var h={padding:'30px',textAlign:'center'},i=function j(){return (c('React').createElement('div',{style:h},c('React').createElement(c('XUISpinner.react'),{size:'large'})));};f.exports=i;}),null);
__d('ChatContentSearchButton.react',['cx','fbt','BootloadOnRender.react','ChatFlyoutPlaceholder.react','ChatContentSearchContextualDialog.react','JSResource','LazyComponent.react','Link.react','ReactComponentWithPureRenderMixin','React','MercuryShareAttachmentRenderLocations','joinClasses'],(function a(b,c,d,e,f,g,h,i){'use strict';var j=c('React').PropTypes,k=278,l=c('React').createClass({displayName:'ChatContentSearchButton',_clickGuard:false,mixins:[c('ReactComponentWithPureRenderMixin')],propTypes:{clicked:j.bool,ContextualDialogClass:j.func,flyoutAlignment:j.oneOf(['left','right']),getQuery:j.func.isRequired,location:j.oneOf(c('MercuryShareAttachmentRenderLocations').getValues()),onLoad:j.func,onSelect:j.func.isRequired},getDefaultProps:function m(){return {flyoutAlignment:'left',location:c('MercuryShareAttachmentRenderLocations').CHAT};},getInitialState:function m(){return {query:'',shown:!!this.props.clicked};},componentDidMount:function m(){this.props.onLoad&&this.props.onLoad(this);},updateQuery:function m(){this.setState({query:this.props.getQuery()});},hideFlyout:function m(){this.setState(this.getInitialState());},render:function m(){return (c('React').createElement('span',null,c('React').createElement(c('Link.react'),{className:c('joinClasses')(this.props.className,this.state.shown?"open":''),href:'#',onMouseDown:this._handleMouseDown,onClick:this._handleClick,role:'button',title:i._("Choose a gif or sticker"),ref:'link'}),this.renderLayers()));},renderLayers:function m(){if(!this.state.shown)return null;var n=this.props.ContextualDialogClass||c('ChatContentSearchContextualDialog.react');return (c('React').createElement(n,{alignment:this.props.flyoutAlignment,contextRef:function(){return this.refs.link;}.bind(this),onBlur:this.hideFlyout,onToggle:this._handleContextualDialogToggle,shown:this.state.shown,width:k,key:'contextualDialog'},c('React').createElement(c('BootloadOnRender.react'),{component:c('React').createElement(c('LazyComponent.react'),{location:this.props.location,onEscKeyDown:this.hideFlyout,onSelect:this._handleSelect,query:this.state.query}),loader:c('JSResource')('ChatContentSearchFlyout.react').__setRef('ChatContentSearchButton.react'),placeholder:c('React').createElement(c('ChatFlyoutPlaceholder.react'),null)})));},_handleMouseDown:function m(n){this._clickGuard=this.state.shown;},_handleClick:function m(n){n.stopPropagation();if(this.state.shown||this._clickGuard)return;this.setState({query:this.props.getQuery(),shown:!this.state.shown});},_handleSelect:function m(n,o){this.props.onSelect(n,o);this.hideFlyout();},_handleContextualDialogToggle:function m(n){this.setState({shown:n});}});f.exports=l;}),null);
__d('ChatEmojiButton.react',['cx','fbt','BootloadOnRender.react','ChatFlyoutPlaceholder.react','JSResource','LazyComponent.react','Link.react','ReactComponentWithPureRenderMixin','React','XUIContextualDialog.react','joinClasses'],(function a(b,c,d,e,f,g,h,i){'use strict';var j=c('React').PropTypes,k=278,l=c('React').createClass({displayName:'ChatEmojiButton',_clickGuard:false,mixins:[c('ReactComponentWithPureRenderMixin')],propTypes:{ContextualDialogClass:j.func.isRequired,flyoutAlignment:j.oneOf(['left','right']),fromChatTab:j.bool,onMount:j.func,onSelect:j.func,sendCustomEmoji:j.func,threadID:j.string},getDefaultProps:function m(){return {ContextualDialogClass:c('XUIContextualDialog.react'),flyoutAlignment:'left'};},getInitialState:function m(){return {shown:false};},componentDidMount:function m(){this.props.onMount&&this.props.onMount(this);},hideFlyout:function m(){this.setState(this.getInitialState());this.props.getInput&&this.props.getInput().focus();},render:function m(){return (c('React').createElement(c('Link.react'),{className:c('joinClasses')(this.props.className,this.state.shown?"open":''),href:'#',onMouseDown:this._handleMouseDown,onClick:this._handleClick,role:'button',title:i._("Choose an emoji"),ref:'link'},this.renderLayers()));},renderLayers:function m(){if(!this.state.shown)return null;var n=this.props.ContextualDialogClass;return (c('React').createElement(n,{alignment:this.props.flyoutAlignment,contextRef:function(){return this.refs.link;}.bind(this),offsetY:this.props.fromChatTab?-20:10,onBlur:this.hideFlyout,onToggle:this._handleContextualDialogToggle,shown:this.state.shown,width:k,key:'contextualDialog'},c('React').createElement(c('BootloadOnRender.react'),{component:c('React').createElement(c('LazyComponent.react'),{onCategorySelect:this._focusInput,onEscKeyDown:this.hideFlyout,onSelect:this._handleSelect,sendCustomEmoji:this.props.sendCustomEmoji,threadID:this.props.threadID,width:k}),loader:c('JSResource')('ChatEmojiFlyout.react').__setRef('ChatEmojiButton.react'),placeholder:c('React').createElement(c('ChatFlyoutPlaceholder.react'),null)})));},_focusInput:function m(){this.props.getInput&&this.props.getInput().focus();},_handleMouseDown:function m(){this._clickGuard=this.state.shown;},_handleClick:function m(n){n.stopPropagation();if(this._clickGuard){this._clickGuard=false;return;}this.setState({shown:!this.state.shown});this._focusInput();},_handleSelect:function m(n){this.props.onSelect&&this.props.onSelect(n);},_handleContextualDialogToggle:function m(n){this.setState({shown:n});}});f.exports=l;}),null);
__d('MessengerSupportedEmojiUtils',['cx','EmojiImageURL','EmojiLikeConstants','EmojiRenderer','Image.react','MessengerSupportedEmoji','React','Utf16','joinClasses'],(function a(b,c,d,e,f,g,h){'use strict';var i=65039,j='_fe0f',k={isSupportedEmoji:function l(m){if(!m)return null;var n=null,o=this.parse(m);if(o.length===1&&o[0].length===m.length){var p=o[0].emoji.map(function(q){return c('Utf16').decode(q);});p[p.length-1]===i&&p.pop();n=p.map(function(q){return q.toString(16);}).join('_');if(c('MessengerSupportedEmoji').emoji[n])return n;}return null;},getClassSizeMap:function l(){var m,n=c('EmojiLikeConstants').size;return m={},m[n.XSMALL]="_2560",m[n.SMALL]="_1ifu",m[n.MEDIUM]="_19_r",m[n.LARGE]="_19_s",m;},getNewEmojiData:function l(m,n){if(!m)return null;var o=this.isSupportedEmoji(m);if(!o)return null;var p=this.getClassSizeMap();n=this.transferSize(n);var q=c('joinClasses')(p[n],"_1ift"),r=c('EmojiImageURL').getMessengerURL(o,c('EmojiLikeConstants').sizeMap[n]);return {emoji:c('React').createElement(c('Image.react'),{className:q,src:r}),emoji_key:o,url:r};},getUrl:function l(m,n){if(m.endsWith(j))m=m.replace(j,'');if(!c('MessengerSupportedEmoji').emoji[m])return null;n=this.transferSize(n);return c('EmojiImageURL').getMessengerURL(m,c('EmojiLikeConstants').sizeMap[n]);},parse:function l(m,n){return c('EmojiRenderer').parse(m,n);},renderFromSize:function l(m,n){n=this.transferSize(n);var o=this.getClassSizeMap(),p=c('joinClasses')(o[n],"_1ift");return (c('React').createElement(c('Image.react'),{className:p,src:this.getUrl(m,n)}));},transferSize:function l(m){return c('EmojiLikeConstants').sizeMapTransfer[m]||m;}};f.exports=k;}),null);
__d('MessengerEmojiSpan.react',['cx','DraftEntity','EmojiLikeConstants','MessengerSupportedEmojiUtils','React'],(function a(b,c,d,e,f,g,h){'use strict';var i,j,k=c('React').PropTypes;i=babelHelpers.inherits(l,c('React').PureComponent);j=i&&i.prototype;l.prototype.render=function(){var m=c('DraftEntity').get(this.props.entityKey),n=m.getData(),o=n.type,p=c('MessengerSupportedEmojiUtils').getUrl(o,c('EmojiLikeConstants').size.SMALL);p=p?p:'';return (c('React').createElement('span',{className:"_21wj",style:{backgroundImage:'url('+p+')'},'data-offset-key':this.props.offsetKey},c('React').createElement('span',{className:"_21wk"},this.props.children)));};function l(){i.apply(this,arguments);}l.propTypes={children:k.arrayOf(k.object),entityKey:k.string.isRequired,offsetKey:k.string};f.exports=l;}),null);
__d('MessengerEmoticonSpan.react',['cx','DraftEntity','EmojiLikeConstants','MessengerSupportedEmojiUtils','EmoticonEmojiList','React'],(function a(b,c,d,e,f,g,h){'use strict';var i,j,k=c('React').PropTypes;i=babelHelpers.inherits(l,c('React').PureComponent);j=i&&i.prototype;l.prototype.render=function(){var m=c('DraftEntity').get(this.props.entityKey),n=m.getData(),o=n.type,p=c('EmoticonEmojiList').emote2emojis[o],q=c('MessengerSupportedEmojiUtils').getUrl(p,c('EmojiLikeConstants').size.XSMALL);q=q?q:'';return (c('React').createElement('span',{className:"_21wj",style:{backgroundImage:'url('+q+')'},'data-offset-key':this.props.offsetKey},c('React').createElement('span',{className:"_21wk"},this.props.children)));};function l(){i.apply(this,arguments);}l.propTypes={children:k.arrayOf(k.object),entityKey:k.string.isRequired,offsetKey:k.string};f.exports=l;}),null);
__d('MessengerMentionsEntityDecorator.react',['cx','React'],(function a(b,c,d,e,f,g,h){'use strict';var i,j;i=babelHelpers.inherits(k,c('React').PureComponent);j=i&&i.prototype;k.prototype.render=function(){return (c('React').createElement('span',{className:"_fy2"},this.props.children));};function k(){i.apply(this,arguments);}f.exports=k;}),null);
__d('createMessengerMentionDraftEntity',['DraftEntity'],(function a(b,c,d,e,f,g){'use strict';function h(i){return c('DraftEntity').create('MENTION','IMMUTABLE',{id:i.getUniqueID()});}f.exports=h;}),null);
__d('getProfileRangesForContentState',['DraftEntity','EmojiFormat','emptyFunction'],(function a(b,c,d,e,f,g){'use strict';var h=c('emptyFunction').thatReturnsTrue;function i(j){var k=[],l=0;j.getBlockMap().forEach(function(m){var n=0,o=m.getText();m.findEntityRanges(h,function(p,q){var r=m.getEntityAt(p);if(r){var s=c('DraftEntity').get(r);if(s.getType()==='EMOTICON'){n+=s.getData().originalEmoticon.length-1;}else if(s.getType()==='EMOJI'){var t=s.getData().type,u=c('EmojiFormat').codeStringToCodeArray(t),v=String.fromCodePoint.apply(String,u);n+=v.length-1;}else if(s.getType()==='MENTION'){var w=s.getData().id,x=p+n+l;if(/^\d+$/.test(w))k.push({offset:x,length:q-p,id:w});}}});l+=o.length+n+1;});return k;}f.exports=i;}),null);
__d('getThreadTypeNameFromThreadType',['MessagingThreadType'],(function a(b,c,d,e,f,g){'use strict';function h(i){for(var j in c('MessagingThreadType'))if(c('MessagingThreadType')[j]===i)return j;return '';}f.exports=h;}),null);
__d('getVisibleValueForContentStateWithMessengerEmoji',['ContentState','DraftEntity','EmojiFormat','emptyFunction'],(function a(b,c,d,e,f,g){'use strict';function h(i){var j=i.getBlockMap().map(function(k){var l=k.getText(),m='';k.findEntityRanges(c('emptyFunction').thatReturnsTrue,function(n,o){var p=k.getEntityAt(n);if(!p){m+=l.slice(n,o);}else{var q=c('DraftEntity').get(p);if(q.getType()==='EMOTICON'){m+=q.getData().originalEmoticon;}else if(q.getType()==='EMOJI'){var r=q.getData().type,s=c('EmojiFormat').codeStringToCodeArray(r);m+=String.fromCodePoint.apply(String,s);}else m+=l.slice(n,o);}});return m;});return j.join('\n');}f.exports=h;}),null);
__d('getTextAfterNearestEntity',[],(function a(b,c,d,e,f,g){'use strict';function h(i,j){var k=j;while(k>0&&i.getEntityAt(k-1)===null)k--;return i.getText().slice(k,j);}f.exports=h;}),null);
__d('applyEmoticonToContentState',['EmoticonsList','applyEmoticonToContentBlock','getTextAfterNearestEntity'],(function a(b,c,d,e,f,g){'use strict';var h=new RegExp(c('EmoticonsList').regexp.source,'g');function i(j,k){var l=k.getAnchorKey(),m=k.getAnchorOffset(),n=j.getBlockForKey(l),o=c('getTextAfterNearestEntity')(n,m),p,q;while(q!==null){q=h.exec(o);if(q!==null)p=q;}if(!p)return j;var r=p[1];if(!r&&m!==o.length)return j;var s=p[2],t=m-o.length,u=t+p.index+p[1].length,v=j.getBlockMap().set(l,c('applyEmoticonToContentBlock')(n,s,u));m-=s.length-1;return j.merge({blockMap:v,selectionBefore:k,selectionAfter:k.merge({anchorOffset:m,focusOffset:m})});}f.exports=i;}),null);
__d('handleBeforeInputForEmoticon',['DraftModifier','EditorState','applyEmoticonToContentState'],(function a(b,c,d,e,f,g){var h=new RegExp(/[\s'".,!?]/);function i(j,k){var l=j.getSelection();if(!l.isCollapsed()||!k||!h.test(k))return j;var m=j.getCurrentContent(),n=c('applyEmoticonToContentState')(m,l);if(n===m)return j;var o=c('DraftModifier').insertText(n,n.getSelectionAfter(),k);return c('EditorState').push(j,o,'insert-characters');}f.exports=i;}),null);
__d('insertMessengerEmojiIntoContentState',['ContentState','DraftEntity','DraftModifier','SelectionState'],(function a(b,c,d,e,f,g){'use strict';var h='\u3000';function i(j,k,l,m){var n=c('DraftEntity').create('EMOJI','IMMUTABLE',{type:j});return c('DraftModifier').insertText(k,l,h,m,n);}f.exports=i;}),null);
__d('handleBeforeInputForMessengerEmoji',['EditorState','MessengerSupportedEmoji','insertMessengerEmojiIntoContentState'],(function a(b,c,d,e,f,g){'use strict';function h(i,j){var k=i.getSelection();if(!k.isCollapsed()||!j)return i;var l=c('MessengerSupportedEmoji').findEmoji(j);if(!l)return i;var m=c('insertMessengerEmojiIntoContentState')(l.emoji,i.getCurrentContent(),k,i.getCurrentInlineStyle());return c('EditorState').push(i,m,'insert-characters');}f.exports=h;}),null);
__d('applyMessengerEmoticonToContentBlock',['CharacterMetadata','DraftEntity','EmoticonEmojiList','immutable'],(function a(b,c,d,e,f,g){'use strict';var h=c('immutable').List,i='\u3000';function j(k,l,m){if(!c('EmoticonEmojiList').names[l])return k;var n=c('DraftEntity').create('EMOTICON','IMMUTABLE',{type:c('EmoticonEmojiList').names[l],originalEmoticon:l}),o=k.getText(),p=k.getCharacterList(),q=l.length,r=p.get(m);return k.merge({text:o.slice(0,m)+i+o.slice(m+q),characterList:p.slice(0,m).concat(h.of(c('CharacterMetadata').applyEntity(r,n)),p.slice(m+q))});}f.exports=j;}),null);
__d('applyMessengerEmoticonToContentState',['EmoticonEmojiList','applyMessengerEmoticonToContentBlock','getTextAfterNearestEntity'],(function a(b,c,d,e,f,g){'use strict';function h(i,j){var k=j.getAnchorKey(),l=j.getAnchorOffset(),m=i.getBlockForKey(k),n=c('getTextAfterNearestEntity')(m,l),o=c('EmoticonEmojiList').regexp.exec(n);if(!o)return i;var p=o[1];if(!p&&l!==n.length)return i;var q=o[2],r=l-n.length,s=r+o.index+o[1].length,t=i.getBlockMap().set(k,c('applyMessengerEmoticonToContentBlock')(m,q,s));l-=q.length-1;return i.merge({blockMap:t,selectionBefore:j,selectionAfter:j.merge({anchorOffset:l,focusOffset:l})});}f.exports=h;}),null);
__d('handleBeforeInputForMessengerEmoticon',['DraftModifier','EditorState','applyMessengerEmoticonToContentState'],(function a(b,c,d,e,f,g){'use strict';var h=new RegExp(/[\s'".,!?]/);function i(j,k){var l=j.getSelection();if(!l.isCollapsed()||!k||!h.test(k))return j;var m=j.getCurrentContent(),n=c('applyMessengerEmoticonToContentState')(m,l);if(n===m)return j;var o=c('DraftModifier').insertText(n,n.getSelectionAfter(),k);return c('EditorState').push(j,o,'insert-characters');}f.exports=i;}),null);
__d('handleSoftNewlineForEmoticon',['DraftModifier','EditorState','applyEmoticonToContentState'],(function a(b,c,d,e,f,g){function h(i){var j=i.getCurrentContent(),k=i.getSelection(),l=c('applyEmoticonToContentState')(j,k),m=c('DraftModifier').splitBlock(l,j===l?k:l.getSelectionAfter());return c('EditorState').push(i,m,'split-block');}f.exports=h;}),null);
__d('handleSoftNewlineForMessengerEmoticon',['DraftModifier','EditorState','applyMessengerEmoticonToContentState'],(function a(b,c,d,e,f,g){'use strict';function h(i){var j=i.getCurrentContent(),k=i.getSelection(),l=c('applyMessengerEmoticonToContentState')(j,k),m=c('DraftModifier').splitBlock(l,j===l?k:l.getSelectionAfter());return c('EditorState').push(i,m,'split-block');}f.exports=h;}),null);
__d('isSoftNewlineEvent',['Keys'],(function a(b,c,d,e,f,g){'use strict';function h(i){return i.which===c('Keys').RETURN&&(i.getModifierState('Shift')||i.getModifierState('Alt')||i.getModifierState('Control'));}f.exports=h;}),null);
__d('ChatInput.react',['AbstractMentionsTextEditor.react','BootloadedComponent.react','Bootloader','CompositeDraftDecorator','ContentState','DraftEditor.react','DraftEntity','DraftModifier','EditorState','EmojiFormat','EmoticonSpan.react','JSResource','MercuryConfig','MessengerEmojiSpan.react','MessengerEmoticonSpan.react','MessengerMentionsEntityDecorator.react','React','ReactDOM','clearImmediate','createMessengerMentionDraftEntity','emptyFunction','getDefaultKeyBinding','getEntityMatcher','getProfileRangesForContentState','getThreadTypeNameFromThreadType','getVisibleValueForContentState','getVisibleValueForContentStateWithMessengerEmoji','handleBeforeInputForEmoticon','handleBeforeInputForMessengerEmoji','handleBeforeInputForMessengerEmoticon','handleSoftNewlineForEmoticon','handleSoftNewlineForMessengerEmoticon','insertEmoticonIntoEditorState','insertMessengerEmojiIntoContentState','isSoftNewlineEvent','setImmediate','requestAnimationFrame'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=c('React').PropTypes,k=c('emptyFunction').thatReturnsNull,l='handled',m=8,n='not-handled';h=babelHelpers.inherits(o,c('React').Component);i=h&&h.prototype;function o(){var p,q;for(var r=arguments.length,s=Array(r),t=0;t<r;t++)s[t]=arguments[t];return q=(p=i.constructor).call.apply(p,[this].concat(s)),this.$ChatInput3=function(){var u=this.$ChatInput5();c('setImmediate')(function(){var v=c('EditorState').set(this.state.editorState,{decorator:u});this.setState({editorState:v});}.bind(this));}.bind(this),this.onChange=function(u){if(u!==this.state.editorState){this.setState({editorState:u});if(this.props.onTextChange)this.props.onTextChange(this.getValueFromEditorState(u));}}.bind(this),this.onReturn=function(event){if(c('isSoftNewlineEvent')(event)){this.setState(function(u){var v=u.editorState,w=c('MercuryConfig').MessengerNewEmojiGK?c('handleSoftNewlineForMessengerEmoticon'):c('handleSoftNewlineForEmoticon');return {editorState:w(v)};});return l;}event.persist();this.setState({},function(){this.props.inputKeyDown(event,this.getValue());}.bind(this));return l;}.bind(this),this.getValue=function(){return this.getValueFromEditorState(this.state.editorState);}.bind(this),this.$ChatInput6=function(u){this.props.onBeforeInput&&this.props.onBeforeInput();var v=this.$ChatInput7(u),w=this.$ChatInput8(u);return v||w?l:n;}.bind(this),this.$ChatInput10=function(u){return this.$ChatInput9(u);}.bind(this),this.$ChatInput11=function(u,v){return this.$ChatInput9(v);}.bind(this),this.state={editorState:this.$ChatInput4(this.props.defaultText)},this.$ChatInput13=function(){var u=(this.state.addedMentionsCount||0)+1;this.setState({addedMentionsCount:u});}.bind(this),this.$ChatInput14=function(){var u=(this.state.mentionsTriggeredCount||0)+1;this.setState({mentionsTriggeredCount:u});}.bind(this),q;}o.prototype.componentDidMount=function(){this.$ChatInput1=c('ReactDOM').findDOMNode(this).getBoundingClientRect().height;this.props.resizeFn(this.$ChatInput1);this.props.initializeThingsWithInputFn(c('ReactDOM').findDOMNode(this.refs.input),this.getValue);this.setState({triggeredWord:this.props.triggeredWord});};o.prototype.componentWillUnmount=function(){if(this.$ChatInput2)c('clearImmediate')(this.$ChatInput2);this.$ChatInput2=null;};o.prototype.componentWillReceiveProps=function(p){if(this.state.triggeredWord!==p.triggeredWord)this.setState({triggeredWord:p.triggeredWord},this.$ChatInput3);if(c('MercuryConfig').Mentions&&p.participants!==this.props.participants)c('Bootloader').loadModules(["createMentionsSearchSourceFromParticipants"],function(q){var r=p.participants,s=p.viewer,t=p.thread;this.setState({mentionsSource:q(s,r,t)});}.bind(this),'ChatInput.react');};o.prototype.componentDidUpdate=function(){this.$ChatInput2=c('requestAnimationFrame')(function(){this.$ChatInput2=null;var p=c('ReactDOM').findDOMNode(this).getBoundingClientRect(),q=p.height;if(this.$ChatInput1!==q)this.props.resizeFn(q);this.$ChatInput1=q;}.bind(this));};o.prototype.$ChatInput4=function(p){return c('EditorState').createWithContent(c('ContentState').createFromText(p),this.$ChatInput5());};o.prototype.resetState=function(){if(this.state.typeaheadReporter){this.state.typeaheadReporter.sessionEnd();this.state.typeaheadReporter.sessionStart();}this.setState({editorState:c('EditorState').moveFocusToEnd(this.$ChatInput4('')),triggeredWord:null,addedMentionsCount:0,mentionsTriggeredCount:0});};o.prototype.resetAfterSend=function(p){var q,r=this;if(c('MercuryConfig').Mentions)(function(){var s=r.getMentions();if(p&&c('MercuryConfig').Mentions&&s&&s.length)c('Bootloader').loadModules(["CurrentUser","MessengerMentionsTypedLogger","MessengerMentionsLoggerEvents"],function(t,u,v){new u().setEvent(v.MENTION).setGroupSize(this.props.participants&&this.props.participants.size).setNumDelivered(s.length).setNumSelects(this.state.addedMentionsCount).setNumTriggers(this.state.mentionsTriggeredCount).setThreadid(this.props.thread&&this.props.thread.thread_id).setThreadType(c('getThreadTypeNameFromThreadType')(this.props.thread&&this.props.thread.thread_type)).setOfflineThreadid(p.offline_threading_id).setVC(this.props.viewer).log();}.bind(r),'ChatInput.react');})();this.resetState();};o.prototype.$ChatInput5=function(){var p=c('MercuryConfig').MessengerNewEmojiGK,q=p?c('MessengerEmoticonSpan.react'):c('EmoticonSpan.react'),r=[{strategy:c('getEntityMatcher')(function(s){return s.getType()==='EMOTICON';}),component:q}];if(p)r.push({strategy:c('getEntityMatcher')(function(s){return s.getType()==='EMOJI';}),component:c('MessengerEmojiSpan.react')});if(c('MercuryConfig').Mentions)r.push({strategy:c('getEntityMatcher')(function(s){return s.getType()==='MENTION';}),component:c('MessengerMentionsEntityDecorator.react')});return new (c('CompositeDraftDecorator'))(r);};o.prototype.getValueFromEditorState=function(p){var q=p.getCurrentContent();return c('MercuryConfig').MessengerNewEmojiGK?c('getVisibleValueForContentStateWithMessengerEmoji')(q):c('getVisibleValueForContentState')(q);};o.prototype.getMentions=function(){return c('getProfileRangesForContentState')(this.state.editorState.getCurrentContent());};o.prototype.focus=function(){this.refs.input&&this.refs.input.focus&&this.refs.input.focus();};o.prototype.$ChatInput7=function(p){var q=c('MercuryConfig').MessengerNewEmojiGK?c('handleBeforeInputForMessengerEmoticon')(this.state.editorState,p):c('handleBeforeInputForEmoticon')(this.state.editorState,p);if(q===this.state.editorState)return false;this.setState({editorState:q});return true;};o.prototype.$ChatInput8=function(p){if(!c('MercuryConfig').MessengerNewEmojiGK)return false;var q=c('handleBeforeInputForMessengerEmoji')(this.state.editorState,p);if(q===this.state.editorState)return false;this.setState({editorState:q});return true;};o.prototype.$ChatInput9=function(p){var q=/^image\//,r=p.filter(function(s){return q.test(s.type);});if(r.length){this.props.uploadPhotoFn(r[0]);return true;}return false;};o.prototype.insertEmoticon=function(p){var q=c('insertEmoticonIntoEditorState')(p,this.state.editorState);if(q!==this.state.editorState)this.setState({editorState:q});};o.prototype.insertEmoji=function(p){var q=this.state.editorState,r=c('insertMessengerEmojiIntoContentState')(c('EmojiFormat').codeArrayToCodeString(p),q.getCurrentContent(),q.getSelection(),q.getCurrentInlineStyle()),s=c('EditorState').push(q,r,'insert-characters');if(s!==this.state.editorState)this.setState({editorState:c('EditorState').forceSelection(s,r.getSelectionAfter())});};o.prototype.appendText=function(p){var q=this.state.editorState,r=q.getSelection(),s=q.getCurrentContent();s=c('DraftModifier').insertText(s,r,p);q=c('EditorState').push(q,s,'insert-characters');this.setState({editorState:q});};o.prototype.render=function(){var p=c('DraftEditor.react'),q=babelHelpers['extends']({},this.props);if(c('MercuryConfig').Mentions){q=babelHelpers['extends']({},q,this.$ChatInput12());p=c('AbstractMentionsTextEditor.react');}return c('React').createElement(p,babelHelpers['extends']({ref:'input'},q,{editorState:this.state.editorState,onChange:this.onChange,handleBeforeInput:this.$ChatInput6,handlePastedFiles:this.$ChatInput10,handleDroppedFiles:this.$ChatInput11,handleReturn:this.onReturn,spellCheck:true,stripPastedStyles:true,textAlignment:'left'}));};o.prototype.$ChatInput12=function(){return {handleContentReturn:this.onReturn,maxResults:m,mentionResultsProps:{typeaheadView:c('BootloadedComponent.react').create(c('JSResource')('ChatMentionsInputTypeaheadView.react').__setRef('ChatInput.react')),typeaheadViewProps:{},position:'above',autoflip:true},mentionResultsComponent:c('BootloadedComponent.react').create(c('JSResource')('MentionsLayer.react').__setRef('ChatInput.react')),mentionCreationFn:c('createMessengerMentionDraftEntity'),mentionsSource:this.state.mentionsSource,onAddMention:this.$ChatInput13,onShowMentions:this.$ChatInput14};};o.propTypes={blockStyleFn:j.func,initializeThingsWithInputFn:j.func,inputKeyDown:j.func,keyBindingFn:j.func,onBeforeInput:j.func,onBlur:j.func,onEscape:j.func,onFocus:j.func,onTab:j.func,resizeFn:j.func,viewer:j.string};o.defaultProps={blockStyleFn:k,keyBindingFn:c('getDefaultKeyBinding')};f.exports=o;}),null);
__d('ChatPhotoUploader.react',['cx','fbt','Promise','Bootloader','InlineBlock.react','Link.react','MercuryConfig','React','ReactDOM','SubscriptionsHandler','emptyFunction','joinClasses'],(function a(b,c,d,e,f,g,h,i){'use strict';var j=c('React').PropTypes,k=c('React').createClass({displayName:'ChatPhotoUploader',_uploader:null,_uploaderPromiseIsResolving:false,_uploaderPromise:null,_subscriptions:null,propTypes:{actionURI:j.string,allowCrossPage:j.bool,customUI:j.bool,disabled:j.bool,imageClassName:j.string,imagesOnly:j.bool,inputClassname:j.string,linkClassName:j.string,onSubmit:j.func,onAllUploadsComplete:j.func,onLastUploadFail:j.func,onLastUploadCancel:j.func,onMount:j.func,onUploadError:j.func},getDefaultProps:function l(){return {actionURI:c('MercuryConfig').upload_url,allowCrossPage:true,costomUI:false,disabled:false,imageClassName:"_509w",imagesOnly:true,linkClassName:'',onSubmit:c('emptyFunction'),onAllUploadsComplete:c('emptyFunction'),onLastUploadFail:c('emptyFunction'),onLastUploadCancel:c('emptyFunction')};},shouldComponentUpdate:function l(m){return m.actionURI!=this.props.actionURI||m.disabled!==this.props.disabled;},componentDidMount:function l(){if(this.props.onMount)this.props.onMount(this);},componentDidUpdate:function l(m){if(this._uploader)this._uploader.setAllowCrossPage(this.props.allowCrossPage);},componentWillUnmount:function l(){if(!this.isUploading()||!this.props.allowCrossPage)this._cleanup();},render:function l(){var m=this.props.imagesOnly?i._("Add Photos"):i._("Add Files"),n=c('joinClasses')("_4q61"+(!this.props.customUI?' '+"_5f0v":'')+(!this.props.customUI?' '+"_509v":''),this.props.linkClassName);return (c('React').createElement('form',{action:this.props.actionURI,className:"_vzk",title:m,method:'post',onClick:function(o){o.stopPropagation();if(this.props.disabled)o.preventDefault();}.bind(this),ref:'form'},c('React').createElement('input',{type:'hidden',name:'attach_id',ref:'attachID'}),c('React').createElement('input',{type:'hidden',name:'images_only',value:this.props.imagesOnly}),c('React').createElement(c('InlineBlock.react'),{onClick:this._bootloadChatAutoSendPhotoUploader,className:c('joinClasses')(this.props.className,"_m _4q60 _3rzn")},c('React').createElement('input',{disabled:this.props.disabled,type:'file',className:c('joinClasses')(this.props.inputClassname,"_n _2__f"),name:'attachment[]',multiple:'true',accept:this.props.imagesOnly?'image/*':'*',ref:'input',title:m}),c('React').createElement(c('Link.react'),{className:n,tabIndex:-1},c('React').createElement('i',{className:this.props.imageClassName,alt:i._("Camera")})))));},_handleSubmit:function l(m,n){this.props.onSubmit&&this.props.onSubmit(m,n);},_handleAllUploadsCompleted:function l(m,n){this.props.onAllUploadsComplete&&this.props.onAllUploadsComplete(m,n);if(!this.isMounted())this._cleanup();},_handleLastUploadFailed:function l(m,n){this.props.onLastUploadFail&&this.props.onLastUploadFail(m,n);if(!this.isMounted())this._cleanup();},_handleLastUploadCanceled:function l(m,n){this.props.onLastUploadCancel&&this.props.onLastUploadCancel(m,n);if(!this.isMounted())this._cleanup();},_handleUploadError:function l(m,n){this.props.onUploadError&&this.props.onUploadError(n);if(!this.isMounted())this._cleanup();},isUploading:function l(){return (this._uploader&&this._uploader.isUploading()||this._uploaderPromiseIsResolving);},_bootloadChatAutoSendPhotoUploader:function l(){if(!this._uploaderPromise){this._uploaderPromiseIsResolving=true;this._uploaderPromise=new (c('Promise'))(function(m){c('Bootloader').loadModules(["ChatAutoSendPhotoUploader"],function(n){this._uploaderPromiseIsResolving=false;var o=new n(c('ReactDOM').findDOMNode(this.refs.form),c('ReactDOM').findDOMNode(this.refs.input),c('ReactDOM').findDOMNode(this.refs.attachID),c('MercuryConfig').msgr_region);o.setAllowCrossPage(this.props.allowCrossPage);var p=new (c('SubscriptionsHandler'))();p.addSubscriptions(o.subscribe('submit',this._handleSubmit),o.subscribe('all-uploads-completed',this._handleAllUploadsCompleted),o.subscribe('last-upload-failed',this._handleLastUploadFailed),o.subscribe('last-upload-canceled',this._handleLastUploadCanceled),o.subscribe('file-upload-error',this._handleUploadError));this._subscriptions=p;this._uploader=o;m(this._uploader);}.bind(this),'ChatPhotoUploader.react');}.bind(this));}return this._uploaderPromise;},uploadFiles:function l(m){this._bootloadChatAutoSendPhotoUploader().then(function(n){n.uploadFiles(m);});},uploadURL:function l(m){this._bootloadChatAutoSendPhotoUploader().then(function(n){n.uploadURL(m);});},_cleanup:function l(){this._subscriptions&&this._subscriptions.release();this._uploader&&this._uploader.destroy();}});f.exports=k;}),null);
__d('StickerContextualDialog.react',['cx','ContextualLayerAutoFlipHorizontal','MercuryConfig','ReactAbstractContextualDialog','ReactLayer'],(function a(b,c,d,e,f,g,h){'use strict';var i=7,j=c('ReactLayer').createClass(c('ReactAbstractContextualDialog').createSpec({addedBehaviors:[c('ContextualLayerAutoFlipHorizontal')],displayName:'StickerXUIContextualDialog',theme:{wrapperClassName:"_53ii",arrowDimensions:{offset:i,length:16}}}));j.WIDTH={NORMAL:312,WIDE:400};f.exports=j;}),null);
__d('ChatStickerButton.react',['cx','fbt','BootloadedComponent.react','JSResource','Link.react','React','StickerContextualDialog.react','StickersActions','StickersStateStore','XUISpinner.react','emptyFunction','joinClasses'],(function a(b,c,d,e,f,g,h,i){'use strict';var j,k,l=c('React').PropTypes,m=278;j=babelHelpers.inherits(n,c('React').PureComponent);k=j&&j.prototype;function n(o){k.constructor.call(this,o);this.$ChatStickerButton1=false;this.$ChatStickerButton2=undefined;this.renderLayers=function(){if(!this.state.shown)return null;var p=this.props.ContextualDialogClass;return (c('React').createElement(p,{alignment:this.props.flyoutAlignment,className:"_5e-r",contextRef:function(){return this.refs.link;}.bind(this),onBeforeHide:this.$ChatStickerButton5,onBlur:this.$ChatStickerButton3,position:'above',shown:this.state.shown,width:this.props.flyoutWidth,key:'contextualDialog'},c('React').createElement(c('BootloadedComponent.react'),{bootloadPlaceholder:c('React').createElement('div',{style:{padding:'30px',textAlign:'center'}},c('React').createElement(c('XUISpinner.react'),{size:'large'})),bootloadLoader:c('JSResource')('StickersFlyout.react').__setRef('ChatStickerButton.react'),className:this.props.flyoutClassName,onShown:function(q){if(this.props.onFlyoutShown)this.props.onFlyoutShown(q);}.bind(this),onHidden:function(){if(this.props.onFlyoutHidden)this.props.onFlyoutHidden();}.bind(this),onEscKeyDown:this.$ChatStickerButton3,onStickerSelect:this.$ChatStickerButton6,onEmoticonSelect:this.$ChatStickerButton7,shown:this.state.shown})));}.bind(this);this.$ChatStickerButton4=function(){this.$ChatStickerButton1=this.state.shown;}.bind(this);this.showFlyout=function(p){p&&p.stopPropagation();if(this.$ChatStickerButton1||this.props.disabled){this.$ChatStickerButton1=false;return;}c('StickersActions').showStickerFlyout(this.props.threadID);}.bind(this);this.$ChatStickerButton5=function(){if(this.state.shown)this.$ChatStickerButton3();}.bind(this);this.$ChatStickerButton3=function(){c('StickersActions').hideStickerFlyout();};this.$ChatStickerButton6=function(p){this.props.onStickerSelect(p);}.bind(this);this.$ChatStickerButton7=function(p){this.$ChatStickerButton3();this.props.onEmoticonSelect(p);}.bind(this);this.state={shown:!!o.clicked};}n.prototype.componentDidMount=function(){this.props.onLoad&&this.props.onLoad(this);this.$ChatStickerButton2=c('StickersStateStore').addListener(function(){var o=c('StickersStateStore').getState();if(o.get('showFlyout')&&o.get('threadID')===this.props.threadID){if(this.$ChatStickerButton1||this.props.disabled){this.$ChatStickerButton1=false;return;}this.setState({shown:true});}else{var p=this.props.getInput&&this.props.getInput();p&&p.focus&&p.focus();this.setState({shown:false});}}.bind(this));};n.prototype.componentWillUnmount=function(){if(this.state.shown)this.$ChatStickerButton3();this.$ChatStickerButton2&&this.$ChatStickerButton2.remove();};n.prototype.render=function(){return c('React').createElement('span',null,c('React').createElement(c('Link.react'),{className:c('joinClasses')(this.props.className,this.state.shown?"open":''),href:'#',onClick:this.showFlyout,onMouseDown:this.$ChatStickerButton4,role:'button',title:i._("Choose a sticker"),ref:'link'}),this.renderLayers());};n.propTypes={className:l.string,clicked:l.bool,ContextualDialogClass:l.func.isRequired,disabled:l.bool,flyoutClassName:l.string,flyoutWidth:l.number,getInput:l.func,onLoad:l.func,onStickerSelect:l.func.isRequired,onEmoticonSelect:l.func.isRequired,onFlyoutShown:l.func,onFlyoutHidden:l.func,threadID:l.string};n.defaultProps={clicked:false,ContextualDialogClass:c('StickerContextualDialog.react'),disabled:false,flyoutWidth:m,onStickerSelect:c('emptyFunction'),onEmoticonSelect:c('emptyFunction')};f.exports=n;}),null);
__d('MessengerBotsMenuActions',['MessengerDispatcher','MNCommerceActionTypes'],(function a(b,c,d,e,f,g){'use strict';var h={showMenu:function i(j){c('MessengerDispatcher').dispatch({type:c('MNCommerceActionTypes').BOTS_MENU.SHOW,pageID:j});},hideMenu:function i(j){c('MessengerDispatcher').dispatch({type:c('MNCommerceActionTypes').BOTS_MENU.HIDE,pageID:j});},stateLoaded:function i(j,k){c('MessengerDispatcher').dispatch({type:c('MNCommerceActionTypes').BOTS_MENU.LOADED,pageID:j,ctas:k});},stateLoadError:function i(j){c('MessengerDispatcher').dispatch({type:c('MNCommerceActionTypes').BOTS_MENU.LOAD_ERROR,pageID:j});},stateReload:function i(j){c('MessengerDispatcher').dispatch({type:c('MNCommerceActionTypes').BOTS_MENU.RELOAD,pageID:j});}};f.exports=h;}),null);
__d("XMessengerBotsMenuController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messenger\/commerce\/bots\/menu\/",{page_id:{type:"String",required:true}});}),null);
__d('MNCommerceBotMenuDataManager',['AsyncRequest','MessengerBotsMenuActions','XMessengerBotsMenuController'],(function a(b,c,d,e,f,g){'use strict';h.prototype.fetchMenu=function(i){var j=c('XMessengerBotsMenuController').getURIBuilder().setString('page_id',i).getURI();new (c('AsyncRequest'))().setURI(j).setHandler(this.$MNCommerceBotMenuDataManager1.bind(this,i)).setErrorHandler(this.$MNCommerceBotMenuDataManager2.bind(this,i)).send();};h.prototype.$MNCommerceBotMenuDataManager1=function(i,j){c('MessengerBotsMenuActions').stateLoaded(i,j.payload);};h.prototype.$MNCommerceBotMenuDataManager2=function(i,j){c('MessengerBotsMenuActions').stateLoadError(i);};function h(){}f.exports=new h();}),null);
__d('MessengerBotsMenuVisibilityActions',['MessengerDispatcher','MNCommerceActionTypes'],(function a(b,c,d,e,f,g){'use strict';var h={visibilityLoaded:function i(j,k){c('MessengerDispatcher').dispatch({type:c('MNCommerceActionTypes').BOTS_MENU.VISIBILITY_LOADED,pageID:j,isVisible:k});}};f.exports=h;}),null);
__d("XMNCommerceShowStructuredMenuController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messenger\/commerce\/menu\/show\/",{});}),null);
__d('MNCommerceBotMenuVisibilityDataManager',['AsyncRequest','MessengerBotsMenuVisibilityActions','XMNCommerceShowStructuredMenuController'],(function a(b,c,d,e,f,g){'use strict';h.prototype.fetchVisibility=function(i){var j=c('XMNCommerceShowStructuredMenuController').getURIBuilder().getURI();new (c('AsyncRequest'))().setURI(j).setMethod('post').setData({page_id:i}).setHandler(this.$MNCommerceBotMenuVisibilityDataManager1.bind(this,i)).setErrorHandler(this.$MNCommerceBotMenuVisibilityDataManager2.bind(this,i)).send();};h.prototype.$MNCommerceBotMenuVisibilityDataManager1=function(i,j){c('MessengerBotsMenuVisibilityActions').visibilityLoaded(i,!!(j&&j.payload));};h.prototype.$MNCommerceBotMenuVisibilityDataManager2=function(i,j){c('MessengerBotsMenuVisibilityActions').visibilityLoaded(i,false);};function h(){}f.exports=new h();}),null);
__d('MessengerBotsMenuStore',['Cache','FluxStore','LoadObject','MessengerDispatcher','MNCommerceActionTypes','MNCommerceCacheTimeoutLimits','MNCommerceBotMenuDataManager','MNCommerceBotMenuVisibilityDataManager'],(function a(b,c,d,e,f,g){'use strict';var h,i;h=babelHelpers.inherits(j,c('FluxStore'));i=h&&h.prototype;function j(){i.constructor.call(this,c('MessengerDispatcher'));this.$MessengerBotsMenuStore1=new (c('Cache'))();this.$MessengerBotsMenuStore2=new (c('Cache'))();this.$MessengerBotsMenuStore3=null;this.$MessengerBotsMenuStore4=false;}j.prototype.__onDispatch=function(k){var l=k.type,m=k.pageID;switch(l){case c('MNCommerceActionTypes').BOTS_MENU.SHOW:this.$MessengerBotsMenuStore4=true;this.$MessengerBotsMenuStore3=m;break;case c('MNCommerceActionTypes').BOTS_MENU.HIDE:this.$MessengerBotsMenuStore4=false;this.$MessengerBotsMenuStore3=null;break;case c('MNCommerceActionTypes').BOTS_MENU.VISIBILITY_LOADED:this.$MessengerBotsMenuStore2.set(m,k.isVisible);break;case c('MNCommerceActionTypes').BOTS_MENU.LOADED:var n=k.ctas.menu;this.$MessengerBotsMenuStore1.set(m,c('LoadObject').empty().setValue(n),null,c('MNCommerceCacheTimeoutLimits').SUCCESS_TIMEOUT);break;case c('MNCommerceActionTypes').BOTS_MENU.LOAD_ERROR:this.$MessengerBotsMenuStore1.set(m,c('LoadObject').empty().setError(new Error('Unable to load structured menu for: '+m)),null,c('MNCommerceCacheTimeoutLimits').ERROR_TIMEOUT);break;}this.__emitChange();};j.prototype.getState=function(){return {pageID:this.$MessengerBotsMenuStore3,showTray:this.$MessengerBotsMenuStore4};};j.prototype.getMenu=function(k){if(k&&!this.$MessengerBotsMenuStore1.has(k)){this.$MessengerBotsMenuStore1.set(k,c('LoadObject').loading().setValue({pageID:k}));c('MNCommerceBotMenuDataManager').fetchMenu(k);}return this.$MessengerBotsMenuStore1.get(k)||c('LoadObject').empty();};j.prototype.getMenuButtonVisibility=function(k){if(!this.$MessengerBotsMenuStore2.has(k))c('MNCommerceBotMenuVisibilityDataManager').fetchVisibility(k);return !!this.$MessengerBotsMenuStore2.get(k,false);};f.exports=new j();}),null);
__d('MessengerContextualDialog.react',['cx','AccessibleLayer','ContextualLayerAutoFlipHorizontal','LayerHideOnEscape','ReactAbstractContextualDialog','ReactLayer'],(function a(b,c,d,e,f,g,h){'use strict';var i=12,j=c('ReactLayer').createClass(c('ReactAbstractContextualDialog').createSpec({addedBehaviors:[c('ContextualLayerAutoFlipHorizontal'),c('LayerHideOnEscape'),c('AccessibleLayer')],displayName:'MessengerContextualDialog',shouldSetARIAProperties:false,theme:{wrapperClassName:"_1r_9",arrowDimensions:{offset:i,length:16}}}));f.exports=j;}),null);
__d('MessengerBotsMenuButton.react',['BootloadOnRender.react','ChatFlyoutPlaceholder.react','MessengerEnvironment','JSResource','LazyComponent.react','Link.react','MessengerBotsMenuActions','MessengerBotsMenuStore','MessengerBotsWebTypedLogger','MessengerContextualDialog.react','MNBotsLoggerEvents','React','StoreAndPropBasedStateMixin','XUIContextualDialog.react'],(function a(b,c,d,e,f,g){'use strict';var h=c('React').PropTypes,i=302,j=280,k=c('React').createClass({displayName:'MessengerBotsMenuButton',_clickGuard:false,mixins:[c('StoreAndPropBasedStateMixin')(c('MessengerBotsMenuStore'))],propTypes:{className:h.string,threadID:h.string.isRequired,pageID:h.string.isRequired},statics:{calculateState:function l(m){var n=c('MessengerBotsMenuStore').getState();return {shown:n.showTray&&m.pageID===n.pageID};}},componentWillUnmount:function l(){if(this.state.shown)this._hideFlyout();},shouldComponentUpdate:function l(m,n){return this.state.shown!==n.shown;},render:function l(){new (c('MessengerBotsWebTypedLogger'))().setEvent(c('MNBotsLoggerEvents').BOT_COMPOSER_MENU_ICON_DISPLAYED).setPageID(this.props.pageID).log();return (c('React').createElement('span',null,c('React').createElement(c('Link.react'),{className:this.props.className,href:'#',onClick:this.showFlyout,onMouseDown:this._prepareForClick,role:'button',ref:'link'}),this.renderLayers()));},_hideFlyout:function l(){c('MessengerBotsMenuActions').hideMenu(this.props.pageID);},_handleBeforeHide:function l(){if(this.state.shown)this._hideFlyout();},_prepareForClick:function l(){this._clickGuard=this.state.shown;},showFlyout:function l(event){event&&event.stopPropagation();if(this._clickGuard){this._clickGuard=false;return;}c('MessengerBotsMenuActions').showMenu(this.props.pageID);},renderLayers:function l(){if(!this.state.shown)return null;var m=c('MessengerEnvironment').messengerui,n=m?i:j,o=m?c('MessengerContextualDialog.react'):c('XUIContextualDialog.react');return (c('React').createElement(o,babelHelpers['extends']({alignment:this.props.flyoutAlignment?this.props.flyoutAlignment:m?'right':'left',width:n,position:'above',contextRef:function(){return this.refs.link;}.bind(this),onBeforeHide:this._handleBeforeHide,onBlur:this._hideFlyout,shown:this.state.shown},this.props,{key:'contextualDialog'}),c('React').createElement(c('BootloadOnRender.react'),{component:c('React').createElement(c('LazyComponent.react'),{onEscKeyDown:this._hideFlyout,shown:this.state.shown,pageID:this.props.pageID,threadID:this.props.threadID,onClick:this._hideFlyout}),loader:c('JSResource')('MessengerPlatformPersistMenuDialog.react').__setRef('MessengerBotsMenuButton.react'),placeholder:c('React').createElement(c('ChatFlyoutPlaceholder.react'),null)})));}});f.exports=k;}),null);
__d('MessengerGamesButton.react',['cx','fbt','JSResource','MessengerEnvironment','Link.react','React','MessengerContextualDialog.react','MessengerSpinner.react','BootloadOnRender.react','LazyComponent.react','joinClasses'],(function a(b,c,d,e,f,g,h,i){'use strict';var j,k,l=c('React').PropTypes,m=c('React').createElement('div',{style:{padding:'30px',textAlign:'center'}},c('React').createElement(c('MessengerSpinner.react'),{color:'grey'}));j=babelHelpers.inherits(n,c('React').Component);k=j&&j.prototype;function n(){var o,p;for(var q=arguments.length,r=Array(q),s=0;s<q;s++)r[s]=arguments[s];return p=(o=k.constructor).call.apply(o,[this].concat(r)),this.state={flyoutOpen:false},this.$MessengerGamesButton1=false,this.$MessengerGamesButton2=function(t){this.setState({flyoutOpen:t});}.bind(this),this.$MessengerGamesButton3=function(){this.setState({flyoutOpen:false});}.bind(this),this.$MessengerGamesButton5=function(t){this.$MessengerGamesButton1=this.state.flyoutOpen;}.bind(this),this.$MessengerGamesButton4=function(t){t.stopPropagation();if(this.state.flyoutOpen||this.$MessengerGamesButton1)return;this.setState({flyoutOpen:!this.state.flyoutOpen});}.bind(this),p;}n.prototype.render=function(){var o=c('MessengerEnvironment').messengerui,p=(o?"_4ce_":'')+(o&&this.state.flyoutOpen?' '+"_5jhb":'')+(o?' '+"_39bk":'')+(o?' '+"_30yy":'')+(!o?' '+"_6gb":'')+(!o?' '+"_4cf0":''),q=null;if(this.state.flyoutOpen)q=c('React').createElement(c('MessengerContextualDialog.react'),{alignment:o?'right':'left',contextRef:function(){return this.refs.gamesButton;}.bind(this),shown:this.state.flyoutOpen,onToggle:this.$MessengerGamesButton2,onBlur:this.$MessengerGamesButton3},c('React').createElement(c('BootloadOnRender.react'),{component:c('React').createElement(c('LazyComponent.react'),{placeholder:m,threadFBID:this.props.threadFBID}),loader:c('JSResource')('MessengerGamesFlyout.react').__setRef('MessengerGamesButton.react'),placeholder:m}));return c('React').createElement(c('Link.react'),{className:c('joinClasses')(this.props.className,p),onClick:this.$MessengerGamesButton4,onMouseDown:this.$MessengerGamesButton5,ref:'gamesButton',role:'button',title:i._("Play a Game")},q);};n.propTypes={className:l.string,threadFBID:l.string.isRequired};f.exports=n;}),null);
__d('MessengerGroupPollingButton.react',['cx','fbt','BootloadOnRender.react','JSResource','LazyComponent.react','Link.react','MessengerContextualDialog.react','MessengerEnvironment','MessengerSpinner.react','React'],(function a(b,c,d,e,f,g,h,i){'use strict';var j,k,l=c('React').PropTypes;j=babelHelpers.inherits(m,c('React').Component);k=j&&j.prototype;function m(){var n,o;for(var p=arguments.length,q=Array(p),r=0;r<p;r++)q[r]=arguments[r];return o=(n=k.constructor).call.apply(n,[this].concat(q)),this.state={flyoutOpen:false},this.$MessengerGroupPollingButton1=false,this.$MessengerGroupPollingButton2=function(s){this.setState({flyoutOpen:s});}.bind(this),this.$MessengerGroupPollingButton3=function(){this.setState({flyoutOpen:false});}.bind(this),this.$MessengerGroupPollingButton5=function(s){this.$MessengerGroupPollingButton1=this.state.flyoutOpen;}.bind(this),this.$MessengerGroupPollingButton4=function(s){s.stopPropagation();if(this.state.flyoutOpen||this.$MessengerGroupPollingButton1)return;this.setState({flyoutOpen:!this.state.flyoutOpen});}.bind(this),o;}m.prototype.render=function(){var n=c('MessengerEnvironment').messengerui,o=null;if(this.state.flyoutOpen)o=c('React').createElement(c('MessengerContextualDialog.react'),{contextRef:function(){return this.refs.groupPollingButton;}.bind(this),shown:this.state.flyoutOpen,onToggle:this.$MessengerGroupPollingButton2,onBlur:this.$MessengerGroupPollingButton3},c('React').createElement(c('BootloadOnRender.react'),{component:c('React').createElement(c('LazyComponent.react'),{threadFBID:this.props.threadFBID,onSubmitHandler:this.$MessengerGroupPollingButton3}),loader:c('JSResource')('MessengerGroupPollingCreatePollFlyout.react').__setRef('MessengerGroupPollingButton.react'),placeholder:c('React').createElement('div',{style:{padding:'20px',textAlign:'center',width:'250px'}},c('React').createElement(c('MessengerSpinner.react'),{color:'grey'}))}));return c('React').createElement(c('Link.react'),{className:(n?"_39bk":'')+(n?' '+"_2o-b":'')+(n&&this.state.flyoutOpen?' '+"_5jhb":'')+(n?' '+"_30yy":'')+(!n?' '+"_6gb":'')+(!n?' '+"_4tjk":''),onClick:this.$MessengerGroupPollingButton4,onMouseDown:this.$MessengerGroupPollingButton5,ref:'groupPollingButton',role:'button',title:i._("Create a poll")},o);};m.propTypes={threadFBID:l.string.isRequired};f.exports=m;}),null);
__d('MessengerHotLikeOutlineSVG.react',['cssVar','fbt','React','MercuryShareAttachmentRenderLocations','uniqueID','UserAgent'],(function a(b,c,d,e,f,g,h,i){'use strict';var j,k,l=c('React').PropTypes,m='transparent',n=i._("Thumbs-up sign");j=babelHelpers.inherits(o,c('React').Component);k=j&&j.prototype;function o(){var p,q;for(var r=arguments.length,s=Array(r),t=0;t<r;t++)s[t]=arguments[t];return q=(p=k.constructor).call.apply(p,[this].concat(s)),this.state={titleId:c('uniqueID')()},q;}o.prototype.render=function(){var p=this.props.color||"#0084ff",q=c('UserAgent').isBrowser('Safari')?'0 0 40.16 42.24':'-1 -1 40.16 42.24',r={height:this.props.height||'85%'};if(this.props.location!==c('MercuryShareAttachmentRenderLocations').CHAT&&this.props.location!==c('MercuryShareAttachmentRenderLocations').PAGES_INBOX)r.width='66%';return (c('React').createElement('svg',{'aria-labelledby':this.state.titleId,version:'1.1',viewBox:q,preserveAspectRatio:'xMinYMax meet',style:r},c('React').createElement('title',{id:this.state.titleId},n),c('React').createElement('path',{d:'M935.36,1582.44a0,0,0,0,0,0,.06,3.59,3.59,0,0,1-.72,6.53,0,0,0,0,0,0,0,3.56,3.56,0,0,1,.71,2.13,3.6,3.6,0,0,1-3,3.54, 0,0,0,0,0,0,.05,3.56,3.56,0,0,1,.38,1.61,3.61,3.61,0,0,1-3.42,3.6H910v-19.6l5.27-7.9a4,4,0,0,0,.66-2.31l-0.1-4c-0.22-2.4-.09-2.06, 1.13-2.37,2-.51,7.16,1.59,5.13,12.17h11.06A3.59,3.59,0,0,1,935.36,1582.44ZM899,1581h7v22h-7v-22Z',transform:'translate(-898.5 -1563.26)',fill:m,fillRule:'evenodd',stroke:p,strokeLinecap:'round',strokeWidth:'5%'})));};o.propTypes={color:l.string,height:l.string,location:l.string};f.exports=o;}),null);
__d('MessengerHotLikeButton.react',['cx','fbt','EmojiLikeConstants','EmojiLikeCxData','Image.react','ImmutableObject','Keys','KeyStatus','Link.react','MercuryConfig','MercuryMessageObject','MercurySourceType','MessengerEnvironment','MessengerHotLikePreviewEvents','MessengerHotLikeOutlineSVG.react','MessengerHotLikeUtils','React','StickerConstants','clearTimeout','ifRequired','joinClasses','setIntervalAcrossTransitions','setTimeoutAcrossTransitions'],(function a(b,c,d,e,f,g,h,i){'use strict';var j,k,l=c('MercuryMessageObject').get(),m=c('React').PropTypes;j=babelHelpers.inherits(n,c('React').PureComponent);k=j&&j.prototype;function n(){var o,p;for(var q=arguments.length,r=Array(q),s=0;s<q;s++)r[s]=arguments[s];return p=(o=k.constructor).call.apply(o,[this].concat(r)),this.$MessengerHotLikeButton1=null,this.$MessengerHotLikeButton2=null,this.$MessengerHotLikeButton3=null,this.$MessengerHotLikeButton4=null,this.$MessengerHotLikeButton6=function(t){if(this.props.disabled||this.$MessengerHotLikeButton3){t.preventDefault();t.stopPropagation();}if(this.props.disabled||t.button!==0)return;this.props.onMouseDown&&this.props.onMouseDown();this.$MessengerHotLikeButton3=Date.now();this.$MessengerHotLikeButton9();this.$MessengerHotLikeButton10();}.bind(this),this.$MessengerHotLikeButton8=function(){if(!(this.props.threadID&&this.$MessengerHotLikeButton3))return;this.$MessengerHotLikeButton3=0;this.$MessengerHotLikeButton11();this.$MessengerHotLikeButton12();}.bind(this),this.$MessengerHotLikeButton14=function(){if(!this.props.threadID)return;c('MessengerHotLikePreviewEvents').emit(c('MessengerHotLikePreviewEvents').POP,this.props.threadID);}.bind(this),this.$MessengerHotLikeButton10=function(){this.$MessengerHotLikeButton11();this.$MessengerHotLikeButton2=c('setTimeoutAcrossTransitions')(this.$MessengerHotLikeButton14,c('MessengerHotLikeUtils').SizeTimes.large);}.bind(this),this.$MessengerHotLikeButton7=function(){if(this.$MessengerHotLikeButton3){this.$MessengerHotLikeButton3=0;this.$MessengerHotLikeButton11();this.$MessengerHotLikeButton14();}}.bind(this),this.$MessengerHotLikeButton11=function(){c('clearTimeout')(this.$MessengerHotLikeButton2);}.bind(this),this.$MessengerHotLikeButton5=function(t){t.stopPropagation();if(this.props.disabled)return;if(c('KeyStatus').getKeyDownCode()===c('Keys').RETURN||!this.props.threadID){var u=this.props.sendCustomLike;if(this.props.customLike&&u){u(this.props.customLike,c('MessengerHotLikeUtils').getEmojiSizeForTime(1));}else this.props.sendSticker(c('MessengerHotLikeUtils').getStickerIDForTime(1));}}.bind(this),p;}n.prototype.componentDidMount=function(){this.$MessengerHotLikeButton4=c('MessengerHotLikePreviewEvents').addListener(c('MessengerHotLikePreviewEvents').FINISH_ANIMATION,function(o,p,q){if(o===this.props.threadID)if(q&&this.props.customLike&&this.props.sendCustomLike){this.props.sendCustomLike(this.props.customLike,q,c('EmojiLikeConstants').source.HOT_LIKE);}else this.props.sendSticker(p);}.bind(this));};n.prototype.componentWillUnmount=function(){this.$MessengerHotLikeButton4&&this.$MessengerHotLikeButton4.remove();};n.prototype.render=function(){var o=null,p={};if(this.props.customLike&&this.props.customLike.emoji){if(c('MercuryConfig').MessengerNewEmojiGK){var q=this.props.customLike.emoji,r=c('EmojiLikeCxData').getNewEmojiData(q,c('EmojiLikeConstants').size.SMALL),s=this.props.renderSize?this.props.renderSize:16;p.background='none';o=c('React').createElement(c('Image.react'),{src:r.url,style:{padding:s==16?0:3,display:'block',height:s,width:s}});}else{q=this.props.customLike.medium;if(q){p.background='none';o=c('React').createElement(c('Image.react'),{src:q,style:{display:'block',height:16,width:16}});}}}else if(this.props.CustomRenderer){var t=this.props.CustomRenderer;o=c('React').createElement(t,{color:this.props.customColor,location:this.props.location});}else if(this.props.customColor)o=c('React').createElement(c('MessengerHotLikeOutlineSVG.react'),{color:this.props.customColor,location:this.props.location});var u=i._("Send a Like");return c('React').createElement(c('Link.react'),{'aria-label':u,className:c('joinClasses')(this.props.customColor||this.props.CustomRenderer?"_5j_u":'',this.props.className),disabled:this.props.disabled,href:'#',onClick:this.$MessengerHotLikeButton5,onDragStart:function v(w){return w.preventDefault();},onMouseDown:this.$MessengerHotLikeButton6,onMouseLeave:this.$MessengerHotLikeButton7,onMouseUp:this.$MessengerHotLikeButton8,role:'button',style:p,title:u},o);};n.prototype.$MessengerHotLikeButton9=function(){if(!this.props.threadID)return;c('MessengerHotLikePreviewEvents').emit(c('MessengerHotLikePreviewEvents').START,this.$MessengerHotLikeButton13(),this.props.threadID);};n.prototype.$MessengerHotLikeButton12=function(){if(!this.props.threadID)return;if(c('MessengerEnvironment').messengerui){c('ifRequired')('MessengerHotLikePreview.react',function(){c('MessengerHotLikePreviewEvents').emit(c('MessengerHotLikePreviewEvents').STOP,this.props.threadID);}.bind(this),function(){if(this.$MessengerHotLikeButton1!==null)return;this.$MessengerHotLikeButton1=c('setIntervalAcrossTransitions')(function(){c('ifRequired')('MessengerHotLikePreview.react',function(){if(this.$MessengerHotLikeButton1!==null){clearInterval(this.$MessengerHotLikeButton1);this.$MessengerHotLikeButton1=null;}c('MessengerHotLikePreviewEvents').emit(c('MessengerHotLikePreviewEvents').STOP,this.props.threadID);}.bind(this));}.bind(this),100);}.bind(this));}else c('MessengerHotLikePreviewEvents').emit(c('MessengerHotLikePreviewEvents').STOP,this.props.threadID);};n.prototype.$MessengerHotLikeButton13=function(){if(!this.props.threadID)return null;var o=l.constructStickerMessageObject(c('StickerConstants').HOT_LIKE_SMALL_STICKER_ID,c('MercurySourceType').MESSENGER_WEB,this.props.threadID);l.normalizeNewMessage(o);o.is_like_preview=true;o.like_preview_since=this.$MessengerHotLikeButton3;o.customLike=this.props.customLike&&this.props.customLike.emoji?this.props.customLike:null;o.body='';return new (c('ImmutableObject'))(o);};n.propTypes={CustomRenderer:m.func,onMouseDown:m.func,customLike:m.object,customColor:m.string,location:m.string,sendSticker:m.func.isRequired,sendCustomLike:m.func,threadID:m.string,disabled:m.bool,renderSize:m.number};f.exports=n;}),null);
__d('MessengerHotLikeChatSVGIcon.react',['cssVar','fbt','React','uniqueID'],(function a(b,c,d,e,f,g,h,i){'use strict';var j,k,l=c('React').PropTypes,m='transparent',n=i._("Thumbs-up sign");j=babelHelpers.inherits(o,c('React').Component);k=j&&j.prototype;function o(){var p,q;for(var r=arguments.length,s=Array(r),t=0;t<r;t++)s[t]=arguments[t];return q=(p=k.constructor).call.apply(p,[this].concat(s)),this.state={titleId:c('uniqueID')()},q;}o.prototype.render=function(){var p=this.props.color||"#0084ff",q='0 0 32 32',r={fill:p,opacity:.2};return (c('React').createElement('svg',{'aria-labelledby':this.state.titleId,preserveAspectRatio:'xMinYMax meet',version:'1.1',viewBox:q,xmlns:'http://www.w3.org/2000/svg'},c('React').createElement('title',{id:this.state.titleId},n),c('React').createElement('g',null,c('React').createElement('rect',{id:'bounds',fill:m,width:'32',height:'32'}),c('React').createElement('g',{style:r},c('React').createElement('path',{d:'M670.93,460a0.08,0.08,0,0,0,0,.15,1.75,1.75,0,0,1,1.29,1.66c0,1.45-1.2,1.66-2,1.75a0.06,0.06,0,0,0,0,.12,1.54,1.54,0,0,1,.88,1.68C671,467,669.17,467,668,467H658a5.63,5.63,0,0,1-5-2.5V455l2.19-1.59a4.39,4.39,0,0,0,1.21-1.75l1.48-5.59v-0.43l-0.41-3.81a0.45,0.45,0,0,1,.16-0.41c1.34-1,3.07-.23,4,2.6a12.83,12.83,0,0,1,0,6.33,0.55,0.55,0,0,0,.54.66c1.77,0,6.77,0,6.77,0,2,0,3.31.62,3.54,2.5a2.39,2.39,0,0,1-1.23,2.4,0.08,0.08,0,0,0,0,.14,1.87,1.87,0,0,1,1.71,2A2,2,0,0,1,670.93,460Zm-20.13-7h-5.6a0.2,0.2,0,0,0-.2.2v15.6a0.2,0.2,0,0,0,.2.2h5.6a0.2,0.2,0,0,0,.2-0.2V453.2A0.2,0.2,0,0,0,650.8,453Z',transform:'translate(-643 -439)'})),c('React').createElement('g',{style:r},c('React').createElement('rect',{x:'2',y:'14',width:'6',height:'16',rx:'0.2',ry:'0.2'})),c('React').createElement('path',{fill:p,d:'M650.8,453a0.2,0.2,0,0,1,.2.2v15.6a0.2,0.2,0,0,1-.2.2h-5.6a0.2,0.2,0,0,1-.2-0.2V453.2a0.2,0.2,0,0,1,.2-0.2h5.6m0-2h-5.6a2.2,2.2,0,0,0-2.2,2.2v15.6a2.2,2.2,0,0,0,2.2,2.2h5.6a2.2,2.2,0,0,0,2.2-2.2V453.2a2.2,2.2,0,0,0-2.2-2.2h0Z',transform:'translate(-643 -439)'}),c('React').createElement('path',{fill:p,'data-name':'stroke',d:'M658.83,441c1.06,0,2.16,1,2.83,3a12.83,12.83,0,0,1,0,6.33,0.55,0.55,0,0,0,.54.66h1.18l5.59,0c2,0,3.31.62,3.54,2.5a2.39,2.39,0,0,1-1.23,2.4,0.08,0.08,0,0,0,0,.14,1.87,1.87,0,0,1,1.71,2,2,2,0,0,1-2.07,1.91,0.08,0.08,0,0,0,0,.15,1.75,1.75,0,0,1,1.29,1.66c0,1.45-1.2,1.66-2,1.75a0.06,0.06,0,0,0,0,.12,1.54,1.54,0,0,1,.88,1.68C671,467,669.24,467,668.07,467H658a5.63,5.63,0,0,1-5-2.5V455l2.19-1.59a4.39,4.39,0,0,0,1.21-1.75l1.48-5.59v-0.43l-0.41-3.81a0.45,0.45,0,0,1,.16-0.41,2,2,0,0,1,1.17-.41m0-2h0a4,4,0,0,0-2.36.8,2.45,2.45,0,0,0-1,2.23l0.39,3.67h0v0.05l-1.41,5.32a3.64,3.64,0,0,1-.47.69l-2.19,1.59L651,454v11.15l0.36,0.52A7.58,7.58,0,0,0,658,469h10.07c3.25,0,4.95-1.21,5-3.59a4.54,4.54,0,0,0-.05-0.93,3.59,3.59,0,0,0,1.14-2.71,3.77,3.77,0,0,0-.18-1.15,3.85,3.85,0,0,0,1-2.57,4,4,0,0,0-.82-2.55,4.38,4.38,0,0,0,.31-2.25c-0.2-1.59-1.18-4.25-5.53-4.25l-5,0a12.65,12.65,0,0,0-.35-5.63c-0.91-2.75-2.67-4.38-4.73-4.38h0Z',transform:'translate(-643 -439)'}))));};o.propTypes={color:l.string,location:l.string};f.exports=o;}),null);
__d("XSetNUXSeenController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/chat\/nux_seen\/",{setting_name:{type:"String"}});}),null);
__d('MessagingShowNUX.react',['AsyncRequest','ChatConfig','React','XSetNUXSeenController','XUIAmbientNUX.react'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=c('React').PropTypes;h=babelHelpers.inherits(k,c('React').PureComponent);i=h&&h.prototype;function k(){var l,m;for(var n=arguments.length,o=Array(n),p=0;p<n;p++)o[p]=arguments[p];return m=(l=i.constructor).call.apply(l,[this].concat(o)),this.state={showNUX:!c('ChatConfig').get(this.props.settingName)},this.$MessagingShowNUX1=function(){if(!this.state.showNUX)return;c('ChatConfig').set(this.props.settingName,true);new (c('AsyncRequest'))(c('XSetNUXSeenController').getURIBuilder().getURI()).setData({setting_name:this.props.settingName}).send();this.setState({showNUX:false});this.props.onHidden();}.bind(this),m;}k.prototype.render=function(){return c('React').createElement(c('XUIAmbientNUX.react'),{contextRef:this.props.contextRef,onCloseButtonClick:this.$MessagingShowNUX1,position:'left',width:'auto',shown:this.state.showNUX&&this.props.shown},this.props.children);};k.propTypes={children:j.any,contextRef:j.func.isRequired,onHidden:j.func.isRequired,settingName:j.string.isRequired,shown:j.bool.isRequired};f.exports=k;}),null);
__d("XMessagingQuickCamController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messages\/quick-cam\/",{thread_id:{type:"String",required:true},__asyncDialog:{type:"Int"}});}),null);
__d('MessengerQuickCamButton.react',['fbt','AsyncRequest','ChatConfig','Link.react','React','MessagingShowNUX.react','XMessagingQuickCamController'],(function a(b,c,d,e,f,g,h){'use strict';var i,j,k=c('React').PropTypes,l='seen_cam_button_nux';i=babelHelpers.inherits(m,c('React').Component);j=i&&i.prototype;function m(n){j.constructor.call(this,n);this.$MessengerQuickCamButton2=function(){this.setState({nuxShown:true,nuxOpen:false},function(){return this.$MessengerQuickCamButton3();}.bind(this));}.bind(this);this.$MessengerQuickCamButton1=function(){if(!this.state.nuxShown){this.setState({nuxOpen:true});}else this.$MessengerQuickCamButton3();}.bind(this);this.state={nuxOpen:false,nuxShown:!!c('ChatConfig').get(l)};}m.prototype.render=function(){return c('React').createElement('div',null,c('React').createElement(c('Link.react'),{className:this.props.className,onClick:this.$MessengerQuickCamButton1,ref:'photoButton',role:'button',title:h._("Take a picture using quick cam")}),c('React').createElement(c('MessagingShowNUX.react'),{contextRef:function(){return this.refs.photoButton;}.bind(this),settingName:l,shown:this.state.nuxOpen,onHidden:this.$MessengerQuickCamButton2,ref:'camNUX'},h._("Send photos from your computer's camera.")));};m.prototype.$MessengerQuickCamButton3=function(){var n=c('XMessagingQuickCamController').getURIBuilder().setString('thread_id',this.props.threadID).getURI();new (c('AsyncRequest'))().setMethod('GET').setURI(n).setRelativeTo(this).setReadOnly(true).send();};m.propTypes={className:k.string.isRequired,threadID:k.string.isRequired};f.exports=m;}),null);
__d('MessengerQuickCamDispatcher',['ExplicitRegistrationReactDispatcher'],(function a(b,c,d,e,f,g){'use strict';var h,i;h=babelHelpers.inherits(j,c('ExplicitRegistrationReactDispatcher'));i=h&&h.prototype;function j(){h.apply(this,arguments);}f.exports=new j({strict:false});}),null);
__d('MessengerQuickCamActions',['MessengerQuickCamDispatcher','keyMirror'],(function a(b,c,d,e,f,g){'use strict';var h=c('keyMirror')({CLOSE:null,COUNT_DOWN_TIMER:null,COUNT_DOWN_TIMER_START:null,PROCESS_RECORDING:null,REGISTER_QUICKCAM:null,REMOVE_ALL_LISTENERS:null,REQUEST_USER_MEDIA:null,RETAKE:null,SEND_PHOTO:null,SEND_VIDEO:null,SET_MEDIA:null,SHUTTER_OFF:null,STOP_VIDEO:null,TAKE_VIDEO:null,UPDATE_PROGRESS:null,UPLOAD_COMPLETE:null,UPLOAD_ERROR:null,USER_MEDIA_ERROR:null}),i={Types:h,close:function j(){c('MessengerQuickCamDispatcher').dispatch({type:h.CLOSE});},countDownTimer:function j(){c('MessengerQuickCamDispatcher').dispatch({type:h.COUNT_DOWN_TIMER});},countDownTimerStart:function j(){c('MessengerQuickCamDispatcher').dispatch({type:h.COUNT_DOWN_TIMER_START});},processRecording:function j(k){c('MessengerQuickCamDispatcher').dispatch({type:h.PROCESS_RECORDING,videoBlob:k});},registerQuickCam:function j(k,l){c('MessengerQuickCamDispatcher').dispatch({type:h.REGISTER_QUICKCAM,source:k,quickcam:l});},requestUserMedia:function j(k,l){c('MessengerQuickCamDispatcher').dispatch({type:h.REQUEST_USER_MEDIA,viewer:k,threadID:l});},retake:function j(){c('MessengerQuickCamDispatcher').dispatch({type:h.RETAKE});},sendPhoto:function j(){c('MessengerQuickCamDispatcher').dispatch({type:h.SEND_PHOTO});},sendVideo:function j(){c('MessengerQuickCamDispatcher').dispatch({type:h.SEND_VIDEO});},setMedia:function j(k,l){c('MessengerQuickCamDispatcher').dispatch({type:h.SET_MEDIA,videoSrc:k,videoStream:l});},stopVideo:function j(){c('MessengerQuickCamDispatcher').dispatch({type:h.STOP_VIDEO});},shutterOff:function j(){c('MessengerQuickCamDispatcher').dispatch({type:h.SHUTTER_OFF});},takeVideo:function j(){c('MessengerQuickCamDispatcher').dispatch({type:h.TAKE_VIDEO});},updateProgress:function j(){c('MessengerQuickCamDispatcher').dispatch({type:h.UPDATE_PROGRESS});},uploadError:function j(k){c('MessengerQuickCamDispatcher').dispatch({type:h.UPLOAD_ERROR,error:k});},uploadComplete:function j(k){c('MessengerQuickCamDispatcher').dispatch({type:h.UPLOAD_COMPLETE,data:k});},userMediaError:function j(){c('MessengerQuickCamDispatcher').dispatch({type:h.USER_MEDIA_ERROR});}};f.exports=i;}),null);
__d('MessengerQuickCamButtonHTML5.react',['cx','fbt','BootloadedComponent.react','ChatConfig','JSResource','Link.react','MessagingShowNUX.react','MessengerDialog.react','MessengerQuickCamActions','MessengerQuickCamOrigins','MessengerSpinner.react','React','XUIDialog.react','XUISpinner.react','joinClasses'],(function a(b,c,d,e,f,g,h,i){'use strict';var j,k,l=c('React').PropTypes,m='seen_cam_button_nux';j=babelHelpers.inherits(n,c('React').Component);k=j&&j.prototype;function n(o){k.constructor.call(this,o);this.$MessengerQuickCamButtonHTML53=function(){this.setState({nuxOpen:false,nuxShown:true,dialogOpen:true});}.bind(this);this.$MessengerQuickCamButtonHTML56=function(){if(this.state.dialogOpen)this.setState({dialogOpen:false});}.bind(this);this.$MessengerQuickCamButtonHTML57=function(p){if(!p){this.$MessengerQuickCamButtonHTML56();}else c('MessengerQuickCamActions').requestUserMedia(this.props.viewer,this.props.threadID);}.bind(this);this.$MessengerQuickCamButtonHTML51=function(p){if(!this.state.nuxShown){this.setState({nuxOpen:true});return;}if(this.state.dialogOpen)return;p.stopPropagation();this.setState({dialogOpen:!this.state.dialogOpen});}.bind(this);this.state={dialogOpen:false,nuxShown:!!c('ChatConfig').get(m),nuxOpen:false};}n.prototype.render=function(){var o=this.props.textChild;return c('React').createElement(c('Link.react'),{className:c('joinClasses')(this.props.className,"_30yy"),onClick:this.$MessengerQuickCamButtonHTML51,ref:'photoButton',role:'button',title:i._("Take a picture using quick cam")},!!o&&o,this.$MessengerQuickCamButtonHTML52());};n.prototype.$MessengerQuickCamButtonHTML52=function(){if(!this.state.nuxShown)return c('React').createElement(c('MessagingShowNUX.react'),{contextRef:function(){return this.refs.photoButton;}.bind(this),settingName:m,shown:this.state.nuxOpen,onHidden:this.$MessengerQuickCamButtonHTML53,ref:'camNUX'},i._("Send photos and videos from your computer's camera."));return this.props.location===c('MessengerQuickCamOrigins').MESSENGER?this.$MessengerQuickCamButtonHTML54():this.$MessengerQuickCamButtonHTML55();};n.prototype.$MessengerQuickCamButtonHTML54=function(){var o=window.innerWidth/3;return c('React').createElement(c('MessengerDialog.react'),{overflow:'hidden',contextRef:function(){return this.refs.photoButton;}.bind(this),shown:this.state.dialogOpen,onBlur:this.$MessengerQuickCamButtonHTML56,onToggle:this.$MessengerQuickCamButtonHTML57,width:400>o?400:o},c('React').createElement(c('BootloadedComponent.react'),{bootloadPlaceholder:c('React').createElement('div',{style:{padding:'30px',textAlign:'center'}},c('React').createElement(c('MessengerSpinner.react'),null)),bootloadLoader:c('JSResource')('MessengerQuickCamDialog.react').__setRef('MessengerQuickCamButtonHTML5.react'),location:this.props.location,onShown:function(p){this.$MessengerQuickCamButtonHTML57(true);if(this.props.onDialogShown)this.props.onDialogShown(p);}.bind(this),onHidden:this.$MessengerQuickCamButtonHTML56,onEscKeyDown:this.$MessengerQuickCamButtonHTML56,shown:this.state.dialogOpen,threadID:this.props.threadID,viewer:this.props.viewer}));};n.prototype.$MessengerQuickCamButtonHTML55=function(){var o=window.innerWidth/3;return c('React').createElement(c('XUIDialog.react'),{overflow:'hidden',contextRef:function(){return this.refs.photoButton;}.bind(this),shown:this.state.dialogOpen,onBlur:this.$MessengerQuickCamButtonHTML56,hideOnEscape:true,onToggle:this.$MessengerQuickCamButtonHTML57,width:400>o?400:o},c('React').createElement(c('BootloadedComponent.react'),{bootloadPlaceholder:c('React').createElement('div',{style:{padding:'30px',textAlign:'center'}},c('React').createElement(c('XUISpinner.react'),null)),bootloadLoader:c('JSResource')('MessengerQuickCamDialog.react').__setRef('MessengerQuickCamButtonHTML5.react'),location:this.props.location,onShown:function(p){this.$MessengerQuickCamButtonHTML57(true);if(this.props.onDialogShown)this.props.onDialogShown(p);}.bind(this),onHidden:this.$MessengerQuickCamButtonHTML56,onEscKeyDown:this.$MessengerQuickCamButtonHTML56,shown:this.state.dialogOpen,threadID:this.props.threadID,viewer:this.props.viewer}));};n.propTypes={className:l.string.isRequired,location:l.oneOf(c('MessengerQuickCamOrigins').getValues()).isRequired,textChild:l.node,threadID:l.string.isRequired,viewer:l.string.isRequired};f.exports=n;}),null);
__d('ChatTabComposer.react',['csx','cx','fbt','ChatConfig','ChatContentSearchButton.react','ChatEmojiButton.react','ChatInput.react','ChatPhotoUploader.react','ChatStickerButton.react','CSS','FantaMessageActions','Keys','MercuryConfig','MercuryIDs','MessengerBotsMenuButton.react','MessengerConfig','MessengerGamesButton.react','MessengerGroupPollingButton.react','MessengerHotLikeButton.react','MessengerHotLikeChatSVGIcon.react','MessengerHotLikeUtils','MessengerQuickCamButton.react','MessengerQuickCamButtonHTML5.react','MessengerQuickCamOrigins','P2PSendMoneyContainerBootloader.react','React','MercuryShareAttachmentRenderLocations','StickersActions','convertMIGColorToFIGColor','getPageIDFromThreadID','requireWeak','setImmediate'],(function a(b,c,d,e,f,g,h,i,j){'use strict';var k,l,m=c('React').PropTypes,n=77,o=9,p=c('ChatConfig').get('chat_basic_input_module')||c('ChatInput.react'),q=null;c('requireWeak')('FantaAppStore',function(s){return q=s;});k=babelHelpers.inherits(r,c('React').PureComponent);l=k&&k.prototype;function r(){var s,t;for(var u=arguments.length,v=Array(u),w=0;w<u;w++)v[w]=arguments[w];return t=(s=l.constructor).call.apply(s,[this].concat(v)),this.state={inputHeight:0,stickerFlyoutShown:false},this.$ChatTabComposer1=null,this.$ChatTabComposer2=null,this.$ChatTabComposer8=function(x){var y=this.props.threadID;if(y&&c('MercuryConfig').FantaTabs)c('setImmediate')(function(){c('FantaMessageActions').composerTextUpdate(y,x);});}.bind(this),this.$ChatTabComposer6=function(x){if(x.keyCode===c('Keys').RETURN){this.refs.emojiButton&&this.refs.emojiButton.hideFlyout();this.$ChatTabComposer8('');}this.props.inputKeyDown&&this.props.inputKeyDown(x);}.bind(this),this.$ChatTabComposer3=function(x){if(c('CSS').matchesSelector(x.target,"._1d4_")||c('CSS').matchesSelector(x.target,"._552h")||c('CSS').matchesSelector(x.target,"._552n"))this.refs.input.focus();}.bind(this),this.$ChatTabComposer7=function(x){if(this.state.stickerFlyoutShown)c('StickersActions').hideStickerFlyout();this.props.onEscape&&this.props.onEscape(x);this.$ChatTabComposer8('');}.bind(this),this.$ChatTabComposer19=function(x,y){if(x.platformFBID.toString()!==c('MercuryConfig').MessengerAppID){this.uploadURL({attribution_app_id:x.platformFBID,errorDialogParams:{body:j._("There was a problem sending this GIF. Choose another one and try again."),title:j._("Couldn't Send GIF")},external_image_url:x.source.url,preview_url:x.media.preview?x.media.preview.url:x.media.thumbnail.url,source:x.source});}else this.props.stickerButtonProps&&this.props.stickerButtonProps.onStickerSelect&&this.props.stickerButtonProps.onStickerSelect(x.resultID.toString);}.bind(this),t;}r.prototype.render=function(){return c('React').createElement('div',{className:"_1d4_",onClick:this.$ChatTabComposer3},this.$ChatTabComposer4(),c('React').createElement('div',{className:"_552n"},this.$ChatTabComposer5()));};r.prototype.resetInput=function(s){this.refs.input.resetAfterSend(s);};r.prototype.uploadURL=function(s){var t=this.$ChatTabComposer1||this.$ChatTabComposer2;if(!t)return;t.uploadURL(s);};r.prototype.isUploading=function(){return !!(this.$ChatTabComposer1&&this.$ChatTabComposer1.isUploading()||this.$ChatTabComposer2&&this.$ChatTabComposer2.isUploading());};r.prototype.getInput=function(){return this.refs.input;};r.prototype.$ChatTabComposer4=function(){var s={};if(this.state.inputHeight)s.minHeight=this.state.inputHeight;var t=null;if(this.props.showStructuredMenu)t=c('React').createElement('div',{className:"_5c6-"},c('React').createElement(c('MessengerBotsMenuButton.react'),{flyoutAlignment:'left',threadID:this.props.threadID,pageID:this.props.pageID,className:"_5c6_"}));var u='',v=this.props.threadID;if(v&&c('MercuryConfig').FantaTabs&&q){var w=q.getState().mercury.tabContents.get(v);u=w&&w.composerText||'';}var x=c('MercuryConfig').Mentions&&this.props.thread&&!this.props.thread.is_canonical?j._("Type a message, \u0040name..."):j._("Type a message...");return c('React').createElement('div',{className:"_552h",style:s},t,c('React').createElement('div',{className:this.props.showStructuredMenu?"_4yzj":''},c('React').createElement(p,{defaultText:u,initializeThingsWithInputFn:this.props.initializeThingsWithInputFn,inputKeyDown:this.$ChatTabComposer6,onBeforeInput:function(){return this.refs.emojiButton&&this.refs.emojiButton.hideFlyout();}.bind(this),onBlur:this.props.onBlur,onEscape:this.$ChatTabComposer7,onFocus:this.props.onFocus,onTab:this.props.onTab,ref:'input',resizeFn:function(y){y=Math.min(y,n);this.setState({inputHeight:y});this.props.resizeFn&&this.props.resizeFn(y);}.bind(this),onTextChange:this.$ChatTabComposer8,uploadPhotoFn:function(y){this.$ChatTabComposer2&&this.$ChatTabComposer2.uploadFiles([y]);}.bind(this),participants:this.props.participants,placeholder:x,viewer:this.props.viewer})));};r.prototype.$ChatTabComposer5=function(){var s=[this.$ChatTabComposer9(),this.$ChatTabComposer10(),this.$ChatTabComposer11(),this.$ChatTabComposer12(),this.$ChatTabComposer13(),this.$ChatTabComposer14(),this.$ChatTabComposer15(),this.$ChatTabComposer16(),this.$ChatTabComposer17()],t=s.filter(function(u){return u;});if(t.length<o)t.push(this.$ChatTabComposer18());return t;};r.prototype.$ChatTabComposer9=function(){var s=this.props.photoUploaderProps||{};return c('React').createElement(c('ChatPhotoUploader.react'),babelHelpers['extends']({key:'photos',onMount:function(t){return this.$ChatTabComposer2=t;}.bind(this)},s));};r.prototype.$ChatTabComposer18=function(){if(c('MessengerConfig').ShowGroupPollingInterface&&this.props.thread&&!this.props.thread.is_canonical&&this.props.threadID)return c('React').createElement('div',{className:"_6gd",key:'group_polling'},c('React').createElement(c('MessengerGroupPollingButton.react'),{threadFBID:c('MercuryIDs').getThreadFBIDFromThreadID(this.props.threadID)}));return null;};r.prototype.$ChatTabComposer15=function(){return c('MercuryConfig').MessengerGamesGK&&this.props.threadID?c('React').createElement('div',{className:"_6gd",key:'games'},c('React').createElement(c('MessengerGamesButton.react'),{threadFBID:c('MercuryIDs').getThreadFBIDFromThreadID(this.props.threadID)})):null;};r.prototype.$ChatTabComposer14=function(){if(this.props.disableFileUploads)return null;var s=this.props.fileUploaderProps||{};return c('React').createElement(c('ChatPhotoUploader.react'),babelHelpers['extends']({key:'files',onMount:function(t){return this.$ChatTabComposer1=t;}.bind(this)},s));};r.prototype.$ChatTabComposer10=function(){var s=this.props.stickerButtonProps;if(!s)return null;return c('React').createElement('div',{className:"_6gd",key:'stickers'},c('React').createElement(c('ChatStickerButton.react'),babelHelpers['extends']({},s,{onFlyoutShown:function(){this.refs.input.focus();this.setState({stickerFlyoutShown:true});}.bind(this),onFlyoutHidden:function(){this.setState({stickerFlyoutShown:false});}.bind(this)})));};r.prototype.$ChatTabComposer11=function(){if(!c('ChatConfig').get('chat_content_search'))return null;return c('React').createElement('div',{className:"_6gd",key:'contentsearch'},c('React').createElement(c('ChatContentSearchButton.react'),{className:"_6gb _6gs",getQuery:function(){return this.refs.input.getValue();}.bind(this),onSelect:this.$ChatTabComposer19}));};r.prototype.$ChatTabComposer12=function(){if(!c('ChatConfig').get('www_messenger_emoji_picker'))return null;return c('React').createElement('div',{className:"_6gd",key:'emojipicker'},c('React').createElement(c('ChatEmojiButton.react'),{className:"_6gb _3oxr",flyoutAlignment:'right',fromChatTab:true,getInput:function(){return this.refs.input;}.bind(this),onSelect:this.props.onEmojiSelect,ref:'emojiButton',sendCustomEmoji:this.props.onCustomLikeSelect,threadID:this.props.threadID}));};r.prototype.$ChatTabComposer17=function(){if(!c('ChatConfig').get('hotlike'))return null;var s=this.props.thread,t=c('convertMIGColorToFIGColor')(s&&s.custom_color)||'',u=c('MessengerHotLikeChatSVGIcon.react'),v="_6gb";return c('React').createElement('div',{className:"_6gd _5ep3",key:'like'},c('React').createElement(c('MessengerHotLikeButton.react'),{className:v,customColor:t,customLike:c('MessengerHotLikeUtils').getCustomEmojiFromThread(s)||undefined,CustomRenderer:u,location:c('MercuryShareAttachmentRenderLocations').CHAT,sendSticker:this.props.stickerButtonProps&&this.props.stickerButtonProps.onStickerSelect,sendCustomLike:this.props.onCustomLikeSelect,threadID:this.props.threadID}));};r.prototype.$ChatTabComposer13=function(){if(!this.props.p2pProps||!this.props.showP2PButton||this.$ChatTabComposer20())return null;var s=this.props.p2pProps;s.threadID=this.props.threadID;if(this.props.participantIDs&&this.props.participantIDs.length)s.participantIDs=this.props.participantIDs;return c('React').createElement('div',{className:"_6gd",key:'p2p'},c('React').createElement(c('P2PSendMoneyContainerBootloader.react'),s));};r.prototype.$ChatTabComposer16=function(){if(c('MercuryIDs').isLocalThread(this.props.threadID)||!c('ChatConfig').get('messenger_www_quickcam'))return null;var s=c('React').createElement(c('MessengerQuickCamButton.react'),{className:"_6gb _5yhk",threadID:this.props.threadID});if(c('ChatConfig').get('messenger_www_html5_quickcam'))s=c('React').createElement(c('MessengerQuickCamButtonHTML5.react'),babelHelpers['extends']({location:c('MessengerQuickCamOrigins').CHAT_TAB,viewer:this.props.viewer},s.props));return c('React').createElement('div',{className:"_6gd",key:'quickcam'},s);};r.prototype.$ChatTabComposer20=function(){return !!this.$ChatTabComposer21();};r.prototype.$ChatTabComposer21=function(){return c('getPageIDFromThreadID')(this.props.threadID);};r.propTypes={disableFileUploads:m.bool,fileUploaderProps:m.object,initializeThingsWithInputFn:m.func,inputKeyDown:m.func,onBlur:m.func,onCustomLikeSelect:m.func,onEmojiSelect:m.func,onEscape:m.func,onFocus:m.func,onTab:m.func,p2pProps:m.object,pageID:m.string,participantIDs:m.arrayOf(m.string),photoUploaderProps:m.object,resizeFn:m.func,showP2PButton:m.bool,showStructuredMenu:m.bool,stickerButtonProps:m.object,thread:m.object,threadID:m.string,uploadPhotoFn:m.func,viewer:m.string};f.exports=r;}),null);
__d('ChatTabComposerContainer.react',['cx','fbt','ChatConfig','ChatTabComposer.react','MercuryIDs','MercuryThreads','MercuryMessageActions','MessengerBotsMenuStore','MercuryParticipants','P2PGKValues','ReactComponentWithPureRenderMixin','React','MercuryShareAttachmentRenderLocations','SimpleXUIDialog','StoreAndPropBasedStateMixin','getPageIDFromThreadID'],(function a(b,c,d,e,f,g,h,i){'use strict';var j='right',k=c('React').PropTypes,l=c('ChatConfig').get('www_messenger_platform_structure_menu'),m=c('React').createClass({displayName:'ChatTabComposerContainer',mixins:[c('ReactComponentWithPureRenderMixin'),c('StoreAndPropBasedStateMixin')(c('MercuryThreads'),c('MessengerBotsMenuStore'),c('MercuryParticipants'))],propTypes:{threadID:k.string,viewer:k.string.isRequired,onFileUploadFail:k.func,onPhotoUploadFail:k.func,onStickerSelect:k.func,onUploadCancel:k.func,onUploadComplete:k.func,onUploadSubmit:k.func},statics:{calculateState:function n(o){var p=c('MercuryThreads').getForFBID(o.viewer),q=o.threadID?p.getOrFetch(o.threadID):null,r=c('P2PGKValues').P2PVisible&&o.viewer!==c('MercuryIDs').getUserIDFromThreadID(o.threadID),s=c('getPageIDFromThreadID')(o.threadID),t=!!(l&&s&&c('MessengerBotsMenuStore').getMenuButtonVisibility(s)),u=q&&q.participants?q.participants.map(c('MercuryParticipants').getOrFetch,c('MercuryParticipants')):[];return {thread:q,participants:u,showP2PButton:r,pageID:s,showStructuredMenu:t};}},componentDidMount:function n(){this.props.onMount(this);},componentWillReceiveProps:function n(o){if(o.threadID!==this.props.threadID)this.setState({participantIDs:[],participants:[]});},render:function n(){return (c('React').createElement(c('ChatTabComposer.react'),babelHelpers['extends']({fileUploaderProps:this._getFileUploaderProps(),ref:'composer',thread:this.state.thread},this.props,{p2pProps:this._getP2PProps(),pageID:this.state.pageID,participantIDs:this.state.participantIDs,participants:this.state.participants,photoUploaderProps:this._getPhotoUploaderProps(),showP2PButton:this.state.showP2PButton,showStructuredMenu:this.state.showStructuredMenu,stickerButtonProps:this._getStickerButtonProps()})));},onSend:function n(o){this.refs.composer.resetInput(o);},setParticipantIDs:function n(o){o=o||[];this.setState({participantIDs:o});},getInput:function n(){return this.refs.composer.getInput();},isUploading:function n(){return this.refs.composer.isUploading();},_getP2PProps:function n(){if(!this.state.showP2PButton)return {};return {button:c('React').createElement('i',{className:"hidden_elem"}),className:"_6ga _6gb",flyoutAlignment:j,referrer:c('MercuryShareAttachmentRenderLocations').CHAT,threadID:this.props.threadID,onTrigger:this.props.onP2PTrigger};},_getStickerButtonProps:function n(){var o={className:"_6gb _6gf",flyoutAlignment:j,threadID:this.props.threadID,onStickerSelect:this.props.onStickerSelect};return o;},_getPhotoUploaderProps:function n(){var o={className:"_6gd",customUI:true,imageClassName:"hidden_elem",linkClassName:"_6gb _6ge",onLastUploadCancel:this._handleUploadCancel,onAllUploadsComplete:this._handleUploadComplete,onLastUploadFail:this._handlePhotoUploadFail,onUploadError:this._handleUploadError,onSubmit:this._handleUploadSubmit};return o;},_getFileUploaderProps:function n(){var o=this._getPhotoUploaderProps();o.linkClassName="_6gb _6gg";o.imagesOnly=false;o.onLastUploadFail=this._handleFileUploadFail;return o;},_handleUploadComplete:function n(o,p){c('MercuryMessageActions').getForFBID(this.props.viewer).confirmAttachmentPlaceholder(p.upload_id,p);this.props.onUploadComplete&&this.props.onUploadComplete(p);},_handleUploadError:function n(o){var p=void 0,q=void 0;switch(o.error){case 'size-exceeded':p=i._("The file you have selected is too large");q=i._("The file you have selected is too large. The maximum size is 25MB.");break;default:p=i._("File Upload Failed");q=i._("Please try again. There was a problem uploading the file.");}this._showErrorDialog(p,q);this.props.onFileUploadFail&&this.props.onFileUploadFail(o);},_handleUploadCancel:function n(o,p){c('MercuryMessageActions').getForFBID(this.props.viewer).cancelAttachmentPlaceholder(p.upload_id,p);this.props.onUploadCancel&&this.props.onUploadCancel(p);},_handleFileUploadFail:function n(o,p){c('MercuryMessageActions').getForFBID(this.props.viewer).cancelAttachmentPlaceholder(p.upload_id,p);var q=i._("File Upload Failed"),r=i._("Please try again. There was a problem uploading the file.");if(p.errorDialogParams){q=p.errorDialogParams.title||q;r=p.errorDialogParams.body||r;}this._showErrorDialog(q,r);this.props.onFileUploadFail&&this.props.onFileUploadFail(p);},_handlePhotoUploadFail:function n(o,p){c('MercuryMessageActions').getForFBID(this.props.viewer).cancelAttachmentPlaceholder(p.upload_id,p);var q=i._("Photo Upload Failed"),r=i._("Please try again. Make sure you are uploading a valid photo.");if(p.errorDialogParams){q=p.errorDialogParams.title||q;r=p.errorDialogParams.body||r;}this._showErrorDialog(q,r);this.props.onPhotoUploadFail&&this.props.onPhotoUploadFail(p);},_handleUploadSubmit:function n(o,p){this.props.onUploadSubmit&&this.props.onUploadSubmit(p);},_showErrorDialog:function n(o,p){c('SimpleXUIDialog').show(p,o);}});f.exports=m;}),null);
__d('AutoFocusableLink.react',['Link.react','ReactDOM'],(function a(b,c,d,e,f,g){'use strict';var h,i;h=babelHelpers.inherits(j,c('Link.react'));i=h&&h.prototype;j.prototype.componentDidMount=function(){if(this.props.autoFocus)c('ReactDOM').findDOMNode(this).focus();};function j(){h.apply(this,arguments);}f.exports=j;}),null);
__d('ChatCloseButton.react',['fbt','Link.react','React','TrackingNodes','joinClasses'],(function a(b,c,d,e,f,g,h){'use strict';var i,j,k=c('React').PropTypes;i=babelHelpers.inherits(l,c('React').PureComponent);j=i&&i.prototype;l.prototype.render=function(){var m=c('TrackingNodes').getTrackingInfo(c('TrackingNodes').types.CLOSE_BUTTON),n=h._("Press Esc to close"),o=h._("Close tab");return (c('React').createElement(c('Link.react'),{'aria-label':this.props.active?n:o,className:c('joinClasses')(this.props.className,'close','button'),'data-ft':m,'data-hover':'tooltip','data-tooltip-content':this.props.active?n:o,'data-tooltip-position':'above',onClick:this.props.onClick,onKeyUp:this.props.onKeyUp,onMouseDown:this.props.onMouseDown}));};function l(){i.apply(this,arguments);}l.propTypes={onClick:k.func,onKeyUp:k.func,onMouseDown:k.func,active:k.bool};l.defaultProps={active:false};f.exports=l;}),null);
__d('ChatTitleLink.react',['cx','ChatEditParticipantsUtils','Link.react','MercuryThreads','MercuryThreadTitle.react','MessengerAdminGroupUtils','React','TrackingNodes','UserAgent'],(function a(b,c,d,e,f,g,h){'use strict';var i=c('MercuryThreads').get(),j=c('React').PropTypes,k=c('React').createClass({displayName:'ChatTitleLink',propTypes:{href:j.string,thread:j.object,viewer:j.string},getDefaultProps:function m(){return {href:null};},getTitle:function m(){return this.refs.threadTitle.getTitle();},render:function m(){if(!this.props.thread)return null;var n=this.props,o=n.href,p=n.thread,q=n.viewer,r=babelHelpers.objectWithoutProperties(n,['href','thread','viewer']);return (c('React').createElement(l,babelHelpers['extends']({'aria-level':'3',className:"titlebarText"+(c('UserAgent').isBrowser('Chrome')&&!c('UserAgent').isPlatform('Windows')?' '+"fixemoji":'')+(o===null?' '+"noLink":''),'data-ft':c('TrackingNodes').getTrackingInfo(c('TrackingNodes').types.TITLE),'data-hover':'tooltip',onClick:function(s){return this._handleClick(s);}.bind(this),href:o},r),c('React').createElement(c('MercuryThreadTitle.react'),{ref:'threadTitle',isNewThread:i.isNewEmptyLocalThread(p.thread_id),thread:p,useAndSeparator:true,useShortName:!p.is_canonical,viewer:q})));},_handleClick:function m(n){if(!this.props.href)return;if(c('MessengerAdminGroupUtils').showParticipantsModal(this.props.thread.is_canonical,i.isEmptyLocalThread(this.props.thread.thread_id),this.props.thread)){c('ChatEditParticipantsUtils').showParticipantsModal(this.props.thread.thread_id);n.preventDefault();}}}),l=function m(n){return (n.href?c('React').createElement(c('Link.react'),n):c('React').createElement('span',n));};f.exports=k;}),null);
__d('MercuryBootloadOnInteraction.react',['BootloadOnRender.react','React'],(function a(b,c,d,e,f,g){'use strict';var h,i;h=babelHelpers.inherits(j,c('React').PureComponent);i=h&&h.prototype;function j(k){i.constructor.call(this,k);this.$MercuryBootloadOnInteraction1=function(l){this.setState({hadUserInteraction:true,interactionType:l.type});}.bind(this);this.$MercuryBootloadOnInteraction2=function(l){this.setState({interactionType:undefined});}.bind(this);this.state={hadUserInteraction:false};}j.prototype.render=function(){if(!this.state.hadUserInteraction)return c('React').cloneElement(this.props.placeholder,{onFocus:this.$MercuryBootloadOnInteraction1,onMouseOver:this.$MercuryBootloadOnInteraction1,onClick:this.$MercuryBootloadOnInteraction1,onBlur:this.$MercuryBootloadOnInteraction2});var k=this.props,l=k.loader,m=k.component,n=k.placeholder,o={};switch(this.state.interactionType){case 'focus':o.autoFocus=true;break;case 'click':o.clicked=true;break;}m=c('React').cloneElement(m,o);n=c('React').cloneElement(n,o);return (c('React').createElement(c('BootloadOnRender.react'),{placeholder:n,loader:l,component:m}));};f.exports=j;}),null);
__d('ChatTabHeader.react',['cx','fbt','Promise','AutoFocusableLink.react','BootloadOnRender.react','MercuryBootloadOnInteraction.react','ChatCloseButton.react','ChatConfig','ChatTitleLink.react','JSResource','LazyComponent.react','Link.react','MessengerAdminGroupUtils','MessengerJoinableModeType','MercuryThreadInfo','MercuryTypingAnimation.react','React','TooltipData','requireWeak'],(function a(b,c,d,e,f,g,h,i){'use strict';var j,k,l=c('React').PropTypes;j=babelHelpers.inherits(m,c('React').PureComponent);k=j&&j.prototype;function m(n){k.constructor.call(this,n);this.componentDidMount=function(){c('requireWeak')('ChatVideoCallButton.react',function(o){this.setState({RTCComponent:o});}.bind(this));if(this.props.isMuted)this.getMenu();}.bind(this);this.focus=function(){this.refs.root&&this.refs.root.focus();}.bind(this);this.$ChatTabHeader6=function(){if(!this.props.isRaised)return null;var o=[this.$ChatTabHeader7(),this.$ChatTabHeader8(),this.$ChatTabHeader9(),this.$ChatTabHeader10(),this.$ChatTabHeader11()];return o.filter(function(p){return !!p;});}.bind(this);this.$ChatTabHeader10=function(){return this.$ChatTabHeader12({isAudio:true});}.bind(this);this.$ChatTabHeader9=function(){return this.$ChatTabHeader12({isAudio:false});}.bind(this);this.$ChatTabHeader5=function(){return (c('React').createElement(c('ChatTitleLink.react'),babelHelpers['extends']({href:this.props.isRaised?this.props.href:undefined,thread:this.props.thread,viewer:this.props.viewer},c('TooltipData').propsFor(this.props.tooltip,'above'))));}.bind(this);this.state={};this.$ChatTabHeader1=new (c('Promise'))(function(o,p){this.$ChatTabHeader2=o;}.bind(this));this.$ChatTabHeader3=c('JSResource')('ChatTabMenu.react').__setRef('ChatTabHeader.react');}m.prototype.render=function(){var n=this.$ChatTabHeader4(),o=this.props.isRaised;return c('React').createElement('div',{className:"_15p4"+(!this.props.isRaised?' '+"_15p5":'')+(o||!n?' '+"_2pis":''),ref:'root',onClick:this.props.onClick,onKeyDown:this.props.onKeyDown,tabIndex:'0'},c('React').createElement('div',{className:"titlebarTextWrapper _15p6"},n,this.$ChatTabHeader5()),this.props.isTyping&&!this.props.isRaised?c('React').createElement(c('MercuryTypingAnimation.react'),{className:"_15p8",color:'dark'}):null,this.$ChatTabHeader6(),c('React').createElement('div',{className:"_15p9"},c('React').createElement(c('ChatCloseButton.react'),{active:this.props.isActive,className:"_3olu _3olv",onClick:this.props.onCloseClick,onKeyUp:this.props.onCloseKeyUp,onMouseDown:this.props.onCloseMouseDown})));};m.prototype.getMenu=function(){this.$ChatTabHeader3.load().done(function(n){return this.setState({MenuComponent:n});}.bind(this));return this.$ChatTabHeader1;};m.prototype.$ChatTabHeader12=function(n){if(this.props.isEmptyChat)return null;var o=this.props,p=o.isGroupChat,q=o.onRTCNuxCloseButtonClick,r=o.rtcNuxShown,s=o.thread,t=o.threadID,u=o.viewer;if(p){if(!s||s.participants.length<=1||!c('MercuryThreadInfo').canReply(s))return null;if(s.joinable_mode&&s.joinable_mode.mode===c('MessengerJoinableModeType').JOINABLE)return null;if(n.isAudio){if(!c('ChatConfig').get('rtc_conferencing_www'))return null;}else if(!c('ChatConfig').get('rtc_conferencing_www_video'))return null;}var v=babelHelpers['extends']({isGroupChat:p,onRTCNuxCloseButtonClick:q,rtcNuxShown:r&&n.isAudio,threadID:t,viewer:u},n);v.className="_3olv"+(v.isAudio?' '+"_2fpc":'')+(!v.isAudio?' '+"_2fpd":'');var w=this.state.RTCComponent;return c('React').createElement('div',{className:"_3a61",key:'rtc'+(v.isAudio?'audio':'video')},w?c('React').createElement(w,v):c('React').createElement(c('MercuryBootloadOnInteraction.react'),{component:c('React').createElement(c('LazyComponent.react'),v),loader:c('JSResource')('ChatVideoCallButton.react').__setRef('ChatTabHeader.react'),placeholder:c('React').createElement(c('AutoFocusableLink.react'),{className:v.className,role:'button'})}));};m.prototype.$ChatTabHeader11=function(){if(this.props.isEmptyChat)return null;var n=babelHelpers['extends']({attachmentsShelf:this.props.attachmentsShelf,isGroupChat:this.props.isGroupChat,isEmptyChat:this.props.isEmptyChat,isMuted:this.props.isMuted,nameConversationFunc:this.props.nameConversationFunc,otherUserID:this.props.otherUserID,showAddFriend:this.props.showAddFriend,sheetController:this.props.sheetController,threadID:this.props.threadID,onSubmit:this.props.onFileUploaderSubmit,onFileUploaderMounted:this.props.onFileUploaderMounted,onMount:this.$ChatTabHeader2,onUpdateAttachmentsShelf:this.props.onUpdateAttachmentsShelf,onUploadFinished:this.props.onUploadFinished},this.props.additionalMenuProps);n.className="_3olv _1ll-";var o=i._("Options"),p=this.state.MenuComponent;return c('React').createElement('div',{className:"_3a61",key:'menu'},p?c('React').createElement(p,n):c('React').createElement(c('MercuryBootloadOnInteraction.react'),{component:c('React').createElement(c('LazyComponent.react'),n),loader:c('JSResource')('ChatTabMenu.react').__setRef('ChatTabHeader.react'),placeholder:c('React').createElement(c('AutoFocusableLink.react'),{className:n.className,'aria-label':o,role:'button'})}));};m.prototype.$ChatTabHeader8=function(){if(this.props.isPageChat||this.props.isEmptyChat)return null;var n={className:"_3olv _3jyj",isFBAtWork:this.props.isWorkUser,shouldAddToApprovalQueue:c('MessengerAdminGroupUtils').shouldAddToApprovalQueue(this.props.thread,this.props.viewer),shown:true,onClick:function(){return this.props.sheetController.openAddFriendsSheet();}.bind(this)},o=i._("Add");return c('React').createElement('div',{className:"_3a61",key:'add'},c('React').createElement(c('MercuryBootloadOnInteraction.react'),{component:c('React').createElement(c('LazyComponent.react'),n),loader:c('JSResource')('ChatAddToThreadButton.react').__setRef('ChatTabHeader.react'),placeholder:c('React').createElement(c('AutoFocusableLink.react'),{'aria-label':o,className:n.className,role:'button'})}));};m.prototype.$ChatTabHeader7=function(){if(!this.props.isViewerEmployee)return null;var n=this.props.participants,o=n?n.every(function(q){return !!(q&&q.employee);}):false;if(!o)return null;var p={isFBAtWork:this.props.isWorkUser,shown:true,useCSS:true};return c('React').createElement(c('BootloadOnRender.react'),{component:c('React').createElement(c('LazyComponent.react'),p),key:'archiveWarning',loader:c('JSResource')('ArchiveWarning.react').__setRef('ChatTabHeader.react'),placeholder:c('React').createElement('div',null)});};m.prototype.$ChatTabHeader13=function(){return c('React').createElement('span',{className:"_3a61"+(!this.props.isRaised?' '+"_3-99":'')},c('React').createElement('span',{className:"_3olv _2nlt"}));};m.prototype.$ChatTabHeader4=function(){var n=this.props,o=n.isRaised,p=n.thread;if(!o&&p&&p.unread_count>0)return (c('React').createElement(c('BootloadOnRender.react'),{component:c('React').createElement(c('LazyComponent.react'),{className:"_3-8_",count:p.unread_count,type:'special'}),loader:c('JSResource')('XUIBadge.react').__setRef('ChatTabHeader.react'),placeholder:c('React').createElement('span',null)}));return this.$ChatTabHeader13();};m.propTypes={additionalMenuProps:l.object,attachmentsShelf:l.object.isRequired,href:l.string,isActive:l.bool.isRequired,isEmptyChat:l.bool,isGroupChat:l.bool,isMuted:l.bool,isPageChat:l.bool,isRaised:l.bool,isTyping:l.bool,isViewerEmployee:l.bool,isWorkUser:l.bool,nameConversationFunc:l.func.isRequired,otherUserID:l.string,participants:l.arrayOf(l.object),rtcNuxShown:l.bool.isRequired,sheetController:l.object.isRequired,showAddFriend:l.func.isRequired,thread:l.object,threadID:l.string,tooltip:l.string,viewer:l.string.isRequired,onClick:l.func.isRequired,onCloseClick:l.func.isRequired,onCloseKeyUp:l.func.isRequired,onCloseMouseDown:l.func.isRequired,onFileUploaderMounted:l.func.isRequired,onFileUploaderSubmit:l.func.isRequired,onKeyDown:l.func.isRequired,onRTCNuxCloseButtonClick:l.func.isRequired,onUpdateAttachmentsShelf:l.func.isRequired,onUploadFinished:l.func.isRequired};f.exports=m;}),null);
__d('getGroupNameTooltipFromParticipantIDs',['fbt','MercuryParticipants','MercuryViewer'],(function a(b,c,d,e,f,g,h){'use strict';var i=10,j='\n';function k(m,n){var o=[],p=c('MercuryViewer').getID();m=m&&m.filter(function(s){return s!==p;});if(!m||!m.length){n(null);return;}var q=m.length,r=q-i;if(r>1)m=m.slice(0,i);c('MercuryParticipants').getMulti(m,function(s){for(var t in s){var u=s[t];o.push(u.name);}if(r>1){var v=h._("and {number of hidden chat participants} more.",[h.param('number of hidden chat participants',r)]);o.push(v);}n(o.join(j));});}function l(m){var n=[],o=c('MercuryViewer').getID();m=m&&m.filter(function(r){return r!==o;});if(!m||!m.length)return null;n=m.map(function(r){var s=c('MercuryParticipants').getOrFetch(r);return s&&s.name;}).filter(function(r){return !!r;});var p=m.length-(m.length-n.length)-i;if(p>1){n=n.slice(0,i);var q=h._("and {number of hidden chat participants} more.",[h.param('number of hidden chat participants',p)]);n.push(q);}return n.join(j);}f.exports={getGroupNameTooltipFromParticipantIDs:l,getGroupNameTooltipFromParticipantIDsAsync:k};}),null);
__d('getTitleHrefFromThreadID',['MercuryIDs','MercuryParticipants','WebMessengerThreadPermalinks'],(function a(b,c,d,e,f,g){'use strict';function h(i,j){var k=c('MercuryIDs').getUserIDFromThreadID(i);if(k){c('MercuryParticipants').get(c('MercuryIDs').getParticipantIDFromUserID(k),function(l){if(l.href){j(l.href);}else j(c('WebMessengerThreadPermalinks').getThreadURIFromUserID(k));});}else c('WebMessengerThreadPermalinks').getThreadURI(i,j);}f.exports=h;}),null);
__d('ChatTabHeaderContainer.react',['ChatTabHeader.react','CurrentUser','MercuryIDs','MercuryParticipants','MercuryThreads','MercuryThreadInfo','React','SubscriptionsHandler','WorkModeConfig','getPageIDFromThreadID','getGroupNameTooltipFromParticipantIDs','getTitleHrefFromThreadID'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=c('getGroupNameTooltipFromParticipantIDs').getGroupNameTooltipFromParticipantIDs,k=c('React').PropTypes;h=babelHelpers.inherits(l,c('React').PureComponent);i=h&&h.prototype;function l(m){i.constructor.call(this,m);this.$ChatTabHeaderContainer1=new (c('SubscriptionsHandler'))();this.state=this.calculateState(m);}l.prototype.calculateState=function(m){var n=false,o=true,p=false,q=void 0,r=void 0,s=void 0,t=void 0,u=void 0;if(m.threadID){var v=c('MercuryThreads').getForFBID(m.viewer);t=v.getOrFetch(m.threadID);n=c('MercuryIDs').isGroupChat(m.threadID);o=v.isNewEmptyLocalThread(m.threadID);p=!!t&&c('MercuryThreadInfo').isMuted(t);q=c('MercuryIDs').getUserIDFromThreadID(m.threadID);r=c('getPageIDFromThreadID')(m.threadID);if(t){s=t.participants.map(c('MercuryParticipants').getOrFetch,c('MercuryParticipants'));u=j(t.participants);}}var w=this.state&&this.state.additionalMenuProps||{};if(m)w=babelHelpers['extends']({},w,m.additionalMenuProps);return {additionalMenuProps:w,isEmptyChat:o,isGroupChat:n,isMuted:p,otherUserID:q,pageID:r,participants:s,thread:t,tooltip:u};};l.prototype.componentWillMount=function(){this.$ChatTabHeaderContainer1.addSubscriptions(c('MercuryThreads').addListener('change',function(){this.setState(this.calculateState(this.props));}.bind(this)),c('MercuryParticipants').addListener('change',function(){this.setState(this.calculateState(this.props));}.bind(this)));};l.prototype.componentDidMount=function(){this.$ChatTabHeaderContainer2();};l.prototype.componentWillReceiveProps=function(m){if(m.threadID!==this.props.threadID)this.$ChatTabHeaderContainer2();this.setState(this.calculateState(m));};l.prototype.componentWillUnmount=function(){this.$ChatTabHeaderContainer1.release();};l.prototype.render=function(){return (c('React').createElement(c('ChatTabHeader.react'),{additionalMenuProps:this.state.additionalMenuProps,attachmentsShelf:this.props.attachmentsShelf,href:this.state.href,isActive:this.props.isActive,isEmptyChat:this.state.isEmptyChat,isGroupChat:this.state.isGroupChat,isMuted:this.state.isMuted,isPageChat:!!this.state.pageID,isRaised:this.props.isRaised,isTyping:this.props.isTyping,isViewerEmployee:c('CurrentUser').isEmployee(),isWorkUser:c('WorkModeConfig').is_work_user,nameConversationFunc:this.props.nameConversationFunc,otherUserID:this.state.otherUserID,participants:this.state.participants,rtcNuxShown:this.props.rtcNuxShown,sheetController:this.props.sheetController,showAddFriend:this.props.showAddFriend,ref:'header',thread:this.state.thread,threadID:this.props.threadID,tooltip:this.state.tooltip,viewer:this.props.viewer,onClick:this.props.onClick,onCloseClick:this.props.onCloseClick,onCloseKeyUp:this.props.onCloseKeyUp,onCloseMouseDown:this.props.onCloseMouseDown,onFileUploaderMounted:this.props.onFileUploaderMounted,onFileUploaderSubmit:this.props.onFileUploaderSubmit,onKeyDown:this.props.onKeyDown,onRTCNuxCloseButtonClick:this.props.onRTCNuxCloseButtonClick,onUpdateAttachmentsShelf:this.props.onUpdateAttachmentsShelf,onUploadFinished:this.props.onUploadFinished}));};l.prototype.focus=function(){this.refs.header.focus();};l.prototype.setAdditionalMenuProps=function(m){var n=babelHelpers['extends']({},this.state.additionalMenuProps,m);this.setState({additionalMenuProps:n});};l.prototype.getMenu=function(){return this.refs.header.getMenu();};l.prototype.$ChatTabHeaderContainer2=function(){c('getTitleHrefFromThreadID')(this.props.threadID,function(m){return this.setState({href:m});}.bind(this));};l.propTypes={additionalMenuProps:k.object,attachmentsShelf:k.object.isRequired,isActive:k.bool.isRequired,isRaised:k.bool,isTyping:k.bool,nameConversationFunc:k.func.isRequired,rtcNuxShown:k.bool.isRequired,sheetController:k.object.isRequired,showAddFriend:k.func.isRequired,threadID:k.string,viewer:k.string.isRequired,onClick:k.func.isRequired,onCloseClick:k.func.isRequired,onCloseKeyUp:k.func.isRequired,onCloseMouseDown:k.func.isRequired,onFileUploaderMounted:k.func.isRequired,onFileUploaderSubmit:k.func.isRequired,onKeyDown:k.func.isRequired,onRTCNuxCloseButtonClick:k.func.isRequired,onUpdateAttachmentsShelf:k.func.isRequired,onUploadFinished:k.func.isRequired};f.exports=l;}),null);
__d('ChatTabSheetListener',['invariant','ChatPrivacyActionController','MercuryIDs','MercuryParticipants','MercuryThreadInformer','MercuryThreads','MercuryViewer'],(function a(b,c,d,e,f,g,h){'use strict';function i(j,k){this.$ChatTabSheetListener1=k;this.$ChatTabSheetListener3=j;this.$ChatTabSheetListener4=c('MercuryIDs').getUserIDFromThreadID(this.$ChatTabSheetListener3);c('MercuryThreadInformer').get().subscribe('threads-updated',function(){return this.$ChatTabSheetListener5();}.bind(this));if(this.$ChatTabSheetListener4)this.$ChatTabSheetListener2=new (c('ChatPrivacyActionController'))(this.$ChatTabSheetListener4,function(l){return this.$ChatTabSheetListener6(l);}.bind(this));}i.prototype.destroy=function(){this.$ChatTabSheetListener2&&this.$ChatTabSheetListener2.destroy();};i.prototype.$ChatTabSheetListener5=function(){var j=c('MercuryThreads').get();j.getThreadMeta(this.$ChatTabSheetListener3,function(k){var l=c('MercuryViewer').getID(),m=k.participants.filter(function(n){return n!==l;});m.length<1&&!j.isNewEmptyLocalThread(this.$ChatTabSheetListener3)?this.$ChatTabSheetListener1.openNoRecipientsSheet():this.$ChatTabSheetListener1.closeNoRecipientsSheet();}.bind(this));};i.prototype.$ChatTabSheetListener6=function(j){switch(j){case c('ChatPrivacyActionController').OFFLINE:this.$ChatTabSheetListener1.closeUserBlockedSheet();this.$ChatTabSheetListener1.openOfflineSheet();break;case c('ChatPrivacyActionController').NORMAL:this.$ChatTabSheetListener1.closeUserBlockedSheet();this.$ChatTabSheetListener1.closeOfflineSheet();break;case c('ChatPrivacyActionController').BLOCKED:this.$ChatTabSheetListener1.closeOfflineSheet();!!this.$ChatTabSheetListener4||h(0);c('MercuryParticipants').get(c('MercuryIDs').getParticipantIDFromUserID(this.$ChatTabSheetListener4),function(k){k.is_friend?this.$ChatTabSheetListener1.openUserBlockedSheet():this.$ChatTabSheetListener1.closeUserBlockedSheet();}.bind(this));break;}};f.exports=i;}),null);
__d('ChatTabSheetController',['Bootloader','ChatTabSheetListener','Deferred','MercurySheetPolicy'],(function a(b,c,d,e,f,g){var h=function i(j,k,l,m){this._threadID=j;this._rootElement=k;this._tabElement=l;this._view=m;this._deferred=new (c('Deferred'))();this._isLoading=false;this._listener=new (c('ChatTabSheetListener'))(this._threadID,this);};Object.assign(h.prototype,{openAddFriendsSheet:function i(){this._load(function(){this._addFriendsTabSheet.open();}.bind(this));},openAppointmentBannerSheet:function i(j,k,l,m,n){this._load(function(){this._sheetView.open(c('MercurySheetPolicy').sheets.ChatAppointmentBanner,{pageID:j,userID:k,count:l,messageList:m,appointmentBannerDidUpdate:n});}.bind(this));},openMessageBlockedTabSheet:function i(){this._load(function(){this._sheetView.open(c('MercurySheetPolicy').sheets.ChatThreadIsMessageBlockedSheet);}.bind(this));},getAddFriendsParticipants:function i(){return this._addFriendsTabSheet?this._addFriendsTabSheet.getParticipants():[];},openNameConversationSheet:function i(j){this._load(function(){this._sheetView.open(c('MercurySheetPolicy').sheets.ChatNameConversationTabSheet,{automatic:j});}.bind(this));},openReadOnlySheet:function i(){this._load(function(){this._sheetView.open(c('MercurySheetPolicy').sheets.ChatReadOnlyTabSheet);}.bind(this));},openPermanentReadOnlySheet:function i(){this._load(function(){this._sheetView.open(c('MercurySheetPolicy').sheets.ChatReadOnlyPermanentTabSheet);}.bind(this));},openNewMessagesSheet:function i(){this._load(function(){this._sheetView.open(c('MercurySheetPolicy').sheets.ChatNewMessagesTabSheet);}.bind(this));},openUploadWarningTabSheet:function i(){this._load(function(){this._sheetView.open(c('MercurySheetPolicy').sheets.ChatUploadWarningTabSheet);}.bind(this));},openThreadIsMutedTabSheet:function i(){this._load(function(){this._sheetView.open(c('MercurySheetPolicy').sheets.ChatThreadIsMutedTabSheet);}.bind(this));},openEmployeeAwaySheet:function i(){this._load(function(){this._sheetView.open(c('MercurySheetPolicy').sheets.ChatEmployeeAwaySheet);}.bind(this));},openBypassFocusSheet:function i(){this._load(function(){this._sheetView.open(c('MercurySheetPolicy').sheets.ChatUserFocusBypassSheet);}.bind(this));},openUserFocusSheet:function i(){this._load(function(){this._sheetView.open(c('MercurySheetPolicy').sheets.ChatUserFocusSheet);}.bind(this));},openMontageSheet:function i(){this._load(function(){this._sheetView.open(c('MercurySheetPolicy').sheets.ChatMontageSheet);}.bind(this));},openUserTimezoneSheet:function i(j){this._load(function(){this._sheetView.open(c('MercurySheetPolicy').sheets.ChatUserTimezoneSheet,j);}.bind(this));},openUserIsPersonalUserSheet:function i(j,k){this._load(function(){this._sheetView.open(c('MercurySheetPolicy').sheets.ChatUserIsPersonalUserSheet,{myself:j,participant:k});}.bind(this));},openUserIsWorkUserSheet:function i(j,k){this._load(function(){this._sheetView.open(c('MercurySheetPolicy').sheets.ChatUserIsWorkUserSheet,{myself:j,participant:k});}.bind(this));},openOfflineSheet:function i(){this._load(function(){this._sheetView.open(c('MercurySheetPolicy').sheets.ChatOfflineTabSheet);}.bind(this));},openUserBlockedSheet:function i(){this._load(function(){this._sheetView.open(c('MercurySheetPolicy').sheets.ChatUserBlockedTabSheet);}.bind(this));},openNoRecipientsSheet:function i(){this._load(function(){this._sheetView.open(c('MercurySheetPolicy').sheets.ChatNoRecipientsTabSheet);}.bind(this));},openPageResponsivenessSheet:function i(j){this._load(function(){this._sheetView.open(c('MercurySheetPolicy').sheets.ChatPageResponsivenessIndicator,{description:j});}.bind(this));},openChatEventReminderTabSheet:function i(){this._load(function(){this._sheetView.open(c('MercurySheetPolicy').sheets.ChatEventReminderTabSheet);}.bind(this));},closeAddFriendsSheet:function i(){this._lazy(function(){this._addFriendsTabSheet.close();}.bind(this));},closeAppointmentBannerSheet:function i(){this._lazy(function(){this._sheetView.close(c('MercurySheetPolicy').sheets.ChatAppointmentBanner);}.bind(this));},closeThreadIsMutedTabSheet:function i(){this._lazy(function(){this._sheetView.close(c('MercurySheetPolicy').sheets.ChatThreadIsMutedTabSheet);}.bind(this));},closeUserBlockedSheet:function i(){this._lazy(function(){this._sheetView.close(c('MercurySheetPolicy').sheets.ChatUserBlockedTabSheet);}.bind(this));},closeUserFocusSheet:function i(){this._lazy(function(){this._sheetView.close(c('MercurySheetPolicy').sheets.ChatUserFocusSheet);}.bind(this));},closeMontageSheet:function i(){this._lazy(function(){this._sheetView.close(c('MercurySheetPolicy').sheets.ChatMontageSheet);}.bind(this));},closeUploadWarningTabSheet:function i(){this._lazy(function(){this._sheetView.close(c('MercurySheetPolicy').sheets.ChatUploadWarningTabSheet);}.bind(this));},closeMessageBlockedTabSheet:function i(){this._lazy(function(){this._sheetView.close(c('MercurySheetPolicy').sheets.ChatThreadIsMessageBlockedSheet);}.bind(this));},closeOfflineSheet:function i(){this._lazy(function(){this._sheetView.close(c('MercurySheetPolicy').sheets.ChatOfflineTabSheet);}.bind(this));},closeNoRecipientsSheet:function i(){this._lazy(function(){this._sheetView.close(c('MercurySheetPolicy').sheets.ChatNoRecipientsTabSheet);}.bind(this));},closeNewMessagesSheet:function i(){this._lazy(function(){this._sheetView.close(c('MercurySheetPolicy').sheets.ChatNewMessagesTabSheet);}.bind(this));},closeAutomaticNameConversationSheet:function i(){this._lazy(function(){this._sheetView.close(c('MercurySheetPolicy').sheets.ChatNameConversationTabSheet);}.bind(this));},closePageResponsivenessSheet:function i(){this._lazy(function(){this._sheetView.close(c('MercurySheetPolicy').sheets.ChatPageResponsivenessIndicator);}.bind(this));},closeChatEventReminderTabSheet:function i(){this._lazy(function(){this._sheetView.close(c('MercurySheetPolicy').sheets.ChatEventReminderTabSheet);}.bind(this));},closePermanentReadOnlySheet:function i(){this._load(function(){this._sheetView.close(c('MercurySheetPolicy').sheets.ChatReadOnlyPermanentTabSheet);}.bind(this));},onResize:function i(j){this._lazy(function(){this._sheetView.subscribe('resize',j);}.bind(this));},onTokensChanged:function i(j){this._lazy(function(){this._addFriendsTabSheet.subscribe('chat/tokens-changed',j);}.bind(this));},onEscape:function i(j){this._lazy(function(){this._addFriendsTabSheet.subscribe('esc-pressed',j);}.bind(this));},destroy:function i(){this._listener&&this._listener.destroy();this._sheetView&&this._sheetView.destroy();},_load:function i(j){this._bootload();this._deferred.done(j);},_lazy:function i(j){this._deferred.done(j);},_bootload:function i(){if(this._isLoading)return;this._isLoading=true;c('Bootloader').loadModules(["ChatAddFriendsTabSheet","MercurySheetView"],function(j,k){this._sheetView=new k(this._threadID,this._rootElement,this._tabElement,this._view);this._addFriendsTabSheet=new j(this._threadID,this._rootElement,this._sheetView,this._view);this._deferred.resolve();}.bind(this),'ChatTabSheetController');}});f.exports=h;}),null);
__d("XMNCommercePostbackCTAController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messages\/commerce\/postback\/",{cta_id:{type:"String",required:true},ref:{type:"String"},ref_source:{type:"Enum",enumType:1},ref_type:{type:"Enum",enumType:1}});}),null);
__d('MNCommercePostbackCTADataManager',['AsyncRequest','BanzaiODS','CurrentUser','MercuryConfig','MercuryMessageActions','MercuryMessageObject','MercurySourceType','XMNCommercePostbackCTAController'],(function a(b,c,d,e,f,g){'use strict';var h=c('MercuryMessageActions').get();i.prototype.send=function(j){var k=arguments.length<=1||arguments[1]===undefined?null:arguments[1],l=arguments.length<=2||arguments[2]===undefined?null:arguments[2],m=c('XMNCommercePostbackCTAController').getURIBuilder().setString('cta_id',j).setString('ref',l).getURI();if(k!==null){new (c('AsyncRequest'))().setURI(m).setMethod('post').setErrorHandler(k).send();}else new (c('AsyncRequest'))().setURI(m).setMethod('post').send();};i.prototype.sendAndConfirm=function(j,k,l,m){this.send(j);if(!c('MercuryConfig').WWWMessengerSendMessageOnPostbackGK)return;if(!l){c('BanzaiODS').bumpEntityKey('messenger_commerce','confirm_message_failed.empty_threadID');}else{var n=new (c('MercuryMessageObject'))(c('CurrentUser').getID());h.send(n.constructCTAConfirmationMessageObject(k,c('MercurySourceType').TITAN_WEB,l,m));}};function i(){}f.exports=new i();}),null);
__d('MercuryCanonicalGroupThreadManager',['Bootloader','KeyedCallbackManager','MercuryIDs','MercuryServerPayloadPreprocessor','MercurySingletonProvider','MercuryThreads','MercuryServerDispatcher','SubscriptionsHandler'],(function a(b,c,d,e,f,g){'use strict';function h(j){this.$MercuryCanonicalGroupThreadManager1=j;this.$MercuryCanonicalGroupThreadManager2=new (c('KeyedCallbackManager'))();this.$MercuryCanonicalGroupThreadManager3=c('MercuryServerPayloadPreprocessor').getForFBID(this.$MercuryCanonicalGroupThreadManager1);this.$MercuryCanonicalGroupThreadManager6=c('MercuryThreads').getForFBID(this.$MercuryCanonicalGroupThreadManager1);this.$MercuryCanonicalGroupThreadManager4={};this.$MercuryCanonicalGroupThreadManager7();this.$MercuryCanonicalGroupThreadManager8();}h.getForFBID=function(j){return i.getForFBID(j);};h.get=function(){return i.get();};h.prototype.getCanonicalGroupThreadIDForParticipants=function(j,k){j=this.$MercuryCanonicalGroupThreadManager9(j);var l=this.$MercuryCanonicalGroupThreadManager10(j),m=this.$MercuryCanonicalGroupThreadManager2.executeOrEnqueue(l,k);this.$MercuryCanonicalGroupThreadManager11(j);return m;};h.prototype.unsubscribe=function(j){if(j)this.$MercuryCanonicalGroupThreadManager2.unsubscribe(j);};h.prototype.$MercuryCanonicalGroupThreadManager10=function(j){return j.sort().join(',');};h.prototype.$MercuryCanonicalGroupThreadManager12=function(j,k){var l=c('MercuryIDs').getThreadIDFromThreadFBID(k);this.$MercuryCanonicalGroupThreadManager2.setResource(j,l);this.$MercuryCanonicalGroupThreadManager4[l]=j;};h.prototype.$MercuryCanonicalGroupThreadManager11=function(j){var k={canonical_group_key:this.$MercuryCanonicalGroupThreadManager10(j),participants:j};c('MercuryServerDispatcher').trySend('/ajax/mercury/search_canonical_groups.php',k,null,this.$MercuryCanonicalGroupThreadManager1);};h.prototype.$MercuryCanonicalGroupThreadManager7=function(){c('MercuryServerDispatcher').registerEndpoints({'/ajax/mercury/search_canonical_groups.php':{request_user_id:this.$MercuryCanonicalGroupThreadManager1,mode:c('MercuryServerDispatcher').IMMEDIATE,handler:function(j){this.handleUpdate(j);}.bind(this)}});};h.prototype.$MercuryCanonicalGroupThreadManager9=function(j){if(j.indexOf(this.$MercuryCanonicalGroupThreadManager1)===-1)j.push(this.$MercuryCanonicalGroupThreadManager1);return j;};h.prototype.handleUpdate=function(j){if(j.mercury_payload)this.$MercuryCanonicalGroupThreadManager3.handleUpdate(j.mercury_payload);var k=j.canonical_group;if(k)for(var l in k)this.$MercuryCanonicalGroupThreadManager12(l,k[l]);};h.prototype.getNow=function(j){var k=this.$MercuryCanonicalGroupThreadManager10(this.$MercuryCanonicalGroupThreadManager9(j));return this.$MercuryCanonicalGroupThreadManager2.getResource(k);};h.prototype.$MercuryCanonicalGroupThreadManager8=function(){c('Bootloader').loadModules(["MercuryThreadInformer"],function(j){var k=j.getForFBID(this.$MercuryCanonicalGroupThreadManager1),l=new (c('SubscriptionsHandler'))();l.addSubscriptions(k.subscribe('threads-deleted',function(m,n){for(var o in n)if(this.$MercuryCanonicalGroupThreadManager4[o]){this.$MercuryCanonicalGroupThreadManager2.setResource(this.$MercuryCanonicalGroupThreadManager4[o],undefined);delete this.$MercuryCanonicalGroupThreadManager4[o];}}.bind(this)));this.$MercuryCanonicalGroupThreadManager5=l;}.bind(this),'MercuryCanonicalGroupThreadManager');};var i=new (c('MercurySingletonProvider'))(h);f.exports=h;}),null);
__d('MessengerEmojiUsageUtils',['MessengerSupportedEmojiUtils','Utf16'],(function a(b,c,d,e,f,g){'use strict';var h=65039,i={findAllEmojis:function j(k){var l=[],m=c('MessengerSupportedEmojiUtils').parse(k);m.forEach(function(n){var o=n.emoji.map(function(p){return c('Utf16').decode(p);});o[o.length-1]===h&&o.pop();l.push(o);});return l;}};f.exports=i;}),null);
__d("XPagesMercuryIndicatorController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/pages\/messaging\/mercury\/indicator\/",{});}),null);
__d('PagesMercuryChatTabIndicatorHandler',['AsyncRequest','AvailableListConstants','ChatPrivacyActionController','ChatVisibility','DOM','FBID','MercuryIDs','PresencePrivacy','XPagesMercuryIndicatorController'],(function a(b,c,d,e,f,g){'use strict';h.tryCreateHandler=function(i,j,k,l){var m=c('MercuryIDs').getUserIDFromThreadID(i);if(!m||c('FBID').isUser(m))return null;return new h(m,j,k,l);};function h(i,j,k,l){this.$PagesMercuryChatTabIndicatorHandler2=false;this.$PagesMercuryChatTabIndicatorHandler3=false;this.$PagesMercuryChatTabIndicatorHandler4=false;this.$PagesMercuryChatTabIndicatorHandler5=j;this.$PagesMercuryChatTabIndicatorHandler6=false;this.$PagesMercuryChatTabIndicatorHandler7=i;this.$PagesMercuryChatTabIndicatorHandler10=k;this.$PagesMercuryChatTabIndicatorHandler9=l;this.$PagesMercuryChatTabIndicatorHandler8=new (c('ChatPrivacyActionController'))(i,function(m){return this.$PagesMercuryChatTabIndicatorHandler11(m);}.bind(this));}h.prototype.__getEnableTimeSwitch=function(){return this.$PagesMercuryChatTabIndicatorHandler2;};h.prototype.__getIsShown=function(){return this.$PagesMercuryChatTabIndicatorHandler4;};h.prototype.__getPageOnlineStatus=function(){return this.$PagesMercuryChatTabIndicatorHandler5;};h.prototype.__getShouldPreventFutureShown=function(){return this.$PagesMercuryChatTabIndicatorHandler6;};h.prototype.__getTargetID=function(){return this.$PagesMercuryChatTabIndicatorHandler7;};h.prototype.__getIsChecking=function(){return this.$PagesMercuryChatTabIndicatorHandler3;};h.prototype.__getResponsivenessDescription=function(){return this.$PagesMercuryChatTabIndicatorHandler1;};h.prototype.checkResponsiveness=function(){if(this.$PagesMercuryChatTabIndicatorHandler3)return;var i=c('XPagesMercuryIndicatorController').getURIBuilder().getURI();this.$PagesMercuryChatTabIndicatorHandler3=true;new (c('AsyncRequest'))().setURI(i).setMethod('POST').setData({page_id:this.$PagesMercuryChatTabIndicatorHandler7}).setHandler(function(j){this.$PagesMercuryChatTabIndicatorHandler3=false;var k=j.payload;if(k.responsiveness)this.$PagesMercuryChatTabIndicatorHandler12(k.responsiveness,k.enableTimeSwitch);}.bind(this)).send();};h.prototype.hideIndicator=function(){this.$PagesMercuryChatTabIndicatorHandler13(false);};h.prototype.hideIndicatorAndPreventFutureShow=function(){this.$PagesMercuryChatTabIndicatorHandler13(true);};h.prototype.$PagesMercuryChatTabIndicatorHandler13=function(i){this.$PagesMercuryChatTabIndicatorHandler6=this.$PagesMercuryChatTabIndicatorHandler6||i;if(this.$PagesMercuryChatTabIndicatorHandler4){this.$PagesMercuryChatTabIndicatorHandler4=false;this.$PagesMercuryChatTabIndicatorHandler9();}};h.prototype.showIndicator=function(){if(this.$PagesMercuryChatTabIndicatorHandler4||this.$PagesMercuryChatTabIndicatorHandler5!==c('AvailableListConstants').OFFLINE||!this.$PagesMercuryChatTabIndicatorHandler1||!c('ChatVisibility').isOnline()||!c('PresencePrivacy').allows(this.$PagesMercuryChatTabIndicatorHandler7)||this.$PagesMercuryChatTabIndicatorHandler6)return;this.$PagesMercuryChatTabIndicatorHandler4=true;this.$PagesMercuryChatTabIndicatorHandler10(this.$PagesMercuryChatTabIndicatorHandler1);};h.prototype.notifyPageOnlineStatusChanged=function(i){if(this.$PagesMercuryChatTabIndicatorHandler5===i)return;this.$PagesMercuryChatTabIndicatorHandler5=i;if(!this.$PagesMercuryChatTabIndicatorHandler2)return;switch(i){case c('AvailableListConstants').ACTIVE:this.hideIndicator();break;default:this.showIndicator();break;}};h.prototype.$PagesMercuryChatTabIndicatorHandler12=function(i,j){this.$PagesMercuryChatTabIndicatorHandler1=i;this.$PagesMercuryChatTabIndicatorHandler2=j;this.showIndicator();};h.prototype.$PagesMercuryChatTabIndicatorHandler11=function(i){switch(i){case c('ChatPrivacyActionController').OFFLINE:case c('ChatPrivacyActionController').BLOCKED:this.$PagesMercuryChatTabIndicatorHandler13(true);break;}};f.exports=h;}),null);
__d("XGroupCallNuxController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/groupcall\/nux\/",{action:{type:"String",required:true}});}),null);
__d("XMNCommercePageNullStateCTAController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messages\/commerce\/page\/nullstate\/",{});}),null);
__d("XNativeComponentFlowBookingRequestCountController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/pages\/platform\/native-component-flow\/booking_request_count\/",{page_id:{type:"FBID",required:true},user_id:{type:"FBID",required:true}});}),null);
__d('ChatTabView',['csx','cx','fbt','Promise','AsyncRequest','AsyncSignal','AvailableListConstants','BootloadedComponent.react','Bootloader','ChatBehavior','ChatConfig','ChatNubLogger','ChatOpenTab','ChatPerfInstrumentation','ChatTabActions','ChatTabBlinking','ChatTabComposerContainer.react','ChatTabHeaderContainer.react','ChatTabLazyFocus','ChatTabMessagesView','ChatTabSheetController','ChatTabViewEvents','ChatTabViewInstances','ChatTitleLink.react','ChatVisibility','CSS','CurrentUser','Dock','DOM','DOMQuery','DragDropTarget','EmojiLikeUtils','EmojiState','Event','FantaDispatcher','FantaTabActions','FBID','JSResource','Keys','LogHistory','MercuryBlockedParticipants','MercuryCanonicalGroupThreadManager','MercuryConfig','MercuryIDs','MercuryParticipants','MercuryShareAttachmentRenderLocations','MercurySourceType','MercuryThreadInfo','MercuryThreadTitle.react','MercuryTypingAnimation.react','MercuryTypingReceiver','MercuryViewer','MessageRequestUtils','MessagingTag','MessengerAdminGroupUtils','MessengerEmojiUsageUtils','MessengerJoinableModeType','MNCommercePostbackCTADataManager','MoveToWorkUtils','NubController','PagesMercuryChatTabIndicatorHandler','Parent','PhotosUploadWaterfall','PresenceStatus','React','ReactComponentRenderer','ReactDOM','Run','Scroll','ShortProfiles','SimpleXUIDialog','SiteData','Style','SubscriptionsHandler','SyntheticEvent','ChatTabTemplates','TooltipData','TypingDetectorController','WaterfallIDGenerator','WorkFileUploadsGating','WorkFocusModeController','WorkModeConfig','XGroupCallNuxController','createCancelableFunction','convertMIGColorToFIGColor','emptyFunction','getActiveElement','getGroupNameTooltipFromParticipantIDs','getTitleHrefFromThreadID','getVendorPrefixedEventName','ifRequired','isEmpty','isInFocusMode','requireWeak','MercuryMessageObject','MercuryMessages','MercuryServerRequests','MercuryThreadActions','MercuryThreadIDMap','MercuryThreadInformer','MercuryThreads','MercuryMessageActions','XMNCommercePageNullStateCTAController','XNativeComponentFlowBookingRequestCountController'],(function a(b,c,d,e,f,g,h,i,j){'use strict';var k=c('MercuryTypingReceiver').get(),l=c('getGroupNameTooltipFromParticipantIDs').getGroupNameTooltipFromParticipantIDsAsync,m=c('MercuryMessageObject').get(),n=c('MercuryMessages').get(),o=c('MercuryServerRequests').get(),p=c('MercuryThreadActions').get(),q=c('MercuryThreadIDMap').get(),r=c('MercuryThreadInformer').get(),s=c('MercuryThreads').get(),t=c('MercuryMessageActions').get(),u=/^\s*$/,v=c('WorkFocusModeController').WorkFocusMode,w=c('ChatTabViewInstances'),x=960,y=/\D+/g,z=c('ChatConfig').get('web_messenger_thread_null_state_cta'),aa=c('ChatConfig').get('always_enable_cta_instead_of_composer'),ba=c('ChatConfig').get('chat_send_link_without_share'),ca=c('ChatConfig').get('chat_full_react_header'),da=c('LogHistory').getInstance('chat_tab_view');c('requireWeak')('AvailableList',function(ta){ta.subscribe(c('AvailableListConstants').ON_AVAILABILITY_CHANGED,qa);});function ea(ta,ua){l(ua,function(va){if(!va){c('TooltipData').remove(ta);}else c('TooltipData').set(ta,va,'above');});}function fa(ta){var ua=c('MercuryIDs').tokenize(ta);switch(ua.type){case 'user':return c('ChatTabTemplates')[':fb:mercury:chat:user-tab'].build();}return c('ChatTabTemplates')[':fb:mercury:chat:multichat-tab'].build();}function ga(ta){var ua=ta._getInputValue();c('EmojiState').updateRecentlyUsed(c('MessengerEmojiUsageUtils').findAllEmojis(ua));var va=ta._filesUploader,wa=va?va.getAttachments():[];if(la(ta))ia(ta,ua,wa,function(xa){xa=sa(xa,va);t.send(xa,function(ya){var za=s.getThreadMetaNow(ya);if(za&&c('MessageRequestUtils').isMessageRequest(za))p.movePendingToInbox(ya);if(za&&za.other_user_fbid&&!c('FBID').isUser(za.other_user_fbid))c('ChatTabViewEvents').inform('chat-send-to-page',{pageID:za.other_user_fbid});});va&&va.removeAttachments();if(ta._sharePreview)ta._sharePreview.setProps({share:null,uri:null});if(ba&&ta._urlScraperData)delete ta._urlScraperData;ta._composer&&ta._composer.onSend(xa);ta._typingDetector&&ta._typingDetector.resetState();if(ta._messagesView){ta._messagesView.messageSent();ta.tryMarkAsRead();}});}function ha(ta,ua){if(ua===0)return;na(ta,c('PhotosUploadWaterfall').POST_PUBLISHED,{count:ua});ta._waterfallID=c('WaterfallIDGenerator').generate();}function ia(ta,ua,va,wa){s.getThreadMeta(ta._threadID,function(xa){var ya;if(xa&&xa.is_canonical&&!c('MercuryThreadInfo').canReply(xa)){ta._showMessageBlockedDialog(xa);return;}var za=c('MercurySourceType').CHAT_WEB,ab=m.constructUserGeneratedMessageObject(ua,za,ta._threadID),bb=ta._getMentions();if(bb&&bb.length)ab.profile_ranges=ab.profile_xmd=bb;if(va.length>0){ab.has_attachment=true;ab.raw_attachments=va;}if(!ta.is_emoji_like&&ta._sharePreview&&ta._sharePreview.component){var cb=ta._sharePreview.component.getShareData();if(cb){ab.has_attachment=true;ab.shareable_attachment=cb;}}if(s.isNewEmptyLocalThread(ta._threadID)){var db=ta._sheetController.getAddFriendsParticipants();ta._sheetController.closeAddFriendsSheet();if(db===null||db.length===0)return;db=db.filter(function(gb){return gb!=c('MercuryViewer').getID();});if(db.length===0){ab.thread_id=c('MercuryIDs').getThreadIDFromUserID(c('CurrentUser').getID());}else if(db.length===1){ab.thread_id=c('MercuryIDs').getThreadIDFromParticipantID(db[0]);}else{var eb=ta.getMessagesView().getThreadID();if(eb!=ta._threadID)ab.thread_id=eb;p.addParticipants(ta._threadID,db);}}if(s.isEmptyLocalThread(ta._threadID)){ab.offline_threading_id=c('MercuryIDs').tokenize(ta._threadID).value;var fb=s.getThreadMetaNow(xa.thread_id);ab.specific_to_list=Array.from(fb.participants);}if(ab!=undefined)ab.signatureID=ta._signatureID;ab.ui_push_phase=c('SiteData').push_phase;wa(ab);if(ta._threadID!==ab.thread_id&&!ta.isUploading())(function(){var gb=ta._getInputValue();if(v&&c('isInFocusMode')()&&!c('isInFocusMode')(ta._threadID))v.addBypassFocusModeForThread(ab.thread_id);if(c('MercuryConfig').FantaTabs){c('FantaTabActions').replaceTab(ta._threadID,ab.thread_id);}else{c('ChatTabActions').closeTab(ta._threadID);c('ChatOpenTab').openThread(ab.thread_id,'ChatTabView',null,ua?c('emptyFunction'):function(hb){return hb.appendTextToInput(gb);});}})();});}function ja(ta){ta._blocked=true;ta._sheetController.openUploadWarningTabSheet();}function ka(ta){return ta.isUploading();}function la(ta){var ua=ta._getInputValue();if(!u.test(ua))return true;var va=ta._filesUploader;if(va&&(va.getAttachments().length>0||va.getImageFiles().length>0||va.getAnimatedImageFiles().length>0||va.getVideoFiles().length>0||va.getAudioFiles().length>0||va.getFiles().length>0))return true;if(ta._sharePreview&&ta._sharePreview.component.getShareData())return true;return false;}function ma(ta){ta._nubController.flyoutContentChanged();var ua=ta._getNode('attachmentShelf');c('Scroll').setTop(ua,ua.scrollHeight);}function na(ta,ua,va){c('PhotosUploadWaterfall').sendSignal(babelHelpers['extends']({qn:ta._waterfallID,step:ua,uploader:c('PhotosUploadWaterfall').APP_CHAT},va||{}));}function oa(ta,ua,va,wa,xa,ya){if(ua)o.ensureThreadIsFetched(ua);this._threadID=ta;this._signatureID=va;this._isLastTab=ya;this._rtcNuxShown=false;this._eventListeners=[];this._onlineStatus=c('AvailableListConstants').OFFLINE;this._tabTemplate=fa(ta);this._tabElem=this._tabTemplate.getRoot();if(xa&&xa.getTabElem()){this.insertBefore(xa);}else this.appendTo(wa);this._messagesView=null;this._customColor=null;this._titlebar=this._getNode('nubFlyoutTitlebar');this._nubButton=c('DOMQuery').scry(this._tabElem,".fbNubButton")[0];this._originalBodyHeight=0;this._waterfallID=c('WaterfallIDGenerator').generate();this._subscriptionsHandler=new (c('SubscriptionsHandler'))();this._canonicalGroupSearchSubscriptionID=null;this._initializeSheetController();var za=[c('emptyFunction'),this._initializeDockUIListeners.bind(this),this.updateAvailableStatus.bind(this),this.updateTab.bind(this),this._initializeP2PChatThreadBannerContainer.bind(this)],ab=this._initializeHeader.bind(this);this._flyoutInitializers=[this._initializeUIListeners.bind(this),this._initializeTitleHREF.bind(this),this._initializeInput.bind(this),this._initializeDragDropTarget.bind(this),this._initializeUnloadListeners.bind(this),this._initializePageMessagingIndicator.bind(this),this._initializePagesGreeting.bind(this)];if(ca){za.push(ab);}else this._flyoutInitializers.unshift(ab);for(var bb=za,cb=Array.isArray(bb),db=0,bb=cb?bb:bb[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var eb;if(cb){if(db>=bb.length)break;eb=bb[db++];}else{db=bb.next();if(db.done)break;eb=db.value;}var fb=eb;fb();}w.set(ta,this);this._logOpenTab();}function pa(ta){if(ta._photoUploader&&ta._photoUploader.isUploading())na(ta,c('PhotosUploadWaterfall').CANCEL_DURING_UPLOAD);}function qa(){for(var ta=w.values(),ua=Array.isArray(ta),va=0,ta=ua?ta:ta[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var wa;if(ua){if(va>=ta.length)break;wa=ta[va++];}else{va=ta.next();if(va.done)break;wa=va.value;}var xa=wa;xa.updateAvailableStatus();xa.updateTitlebarTooltip();}}c('ChatBehavior').subscribe(c('ChatBehavior').ON_CHANGED,function(){for(var ta=w.keys(),ua=Array.isArray(ta),va=0,ta=ua?ta:ta[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var wa;if(ua){if(va>=ta.length)break;wa=ta[va++];}else{va=ta.next();if(va.done)break;wa=va.value;}var xa=wa;s.getThreadMeta(xa,function(ya){w.get(xa)._updateUnreadCount(ya);});}});k.addRetroactiveListener('state-changed',function(ta){for(var ua in ta){var va=ta[ua]&&ta[ua].length,wa=w.get(ua);wa&&wa.showTypingIndicator(va);}});r.subscribe('threads-updated',function(ta,ua){for(var va=w.keys(),wa=Array.isArray(va),xa=0,va=wa?va:va[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var ya;if(wa){if(xa>=va.length)break;ya=va[xa++];}else{xa=va.next();if(xa.done)break;ya=xa.value;}var za=ya,ab=w.get(za);ua[za]&&ab.updateTab();if(ab._newThreadIDFromPhotoUpload&&!ab.isUploading()&&ua[ab._newThreadIDFromPhotoUpload]){if(c('MercuryConfig').FantaTabs){c('FantaTabActions').replaceTab(ab._threadID,ab._newThreadIDFromPhotoUpload);}else{c('ChatTabActions').closeTab(ab._threadID);c('ChatOpenTab').openThread(ab._newThreadIDFromPhotoUpload,'ChatTabView');}ab._newThreadIDFromPhotoUpload=null;}}});r.subscribe('threads-deleted',function(ta,ua){for(var va=w.keys(),wa=Array.isArray(va),xa=0,va=wa?va:va[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var ya;if(wa){if(xa>=va.length)break;ya=va[xa++];}else{xa=va.next();if(xa.done)break;ya=xa.value;}var za=ya;if(ua[za])if(c('MercuryConfig').FantaTabs){c('FantaTabActions').closeTab(za);}else c('ChatTabActions').closeTab(za,'thread_deleted');if(s.isNewEmptyLocalThread(za)){var ab=w.get(za);ab.ensureValidCanonicalGroup(ua);}}});Object.assign(oa.prototype,{getThreadID:function ta(){return this._threadID;},getTabElem:function ta(){return this._tabElem;},showAddFriend:function ta(){setTimeout(function(){this._sheetController.openAddFriendsSheet();}.bind(this),0);},showNameConversation:function ta(ua){setTimeout(function(){this._sheetController.openNameConversationSheet(ua);}.bind(this),0);},hideAutomaticNameConversation:function ta(){setTimeout(function(){this._sheetController.closeAutomaticNameConversationSheet();}.bind(this),0);},isVisible:function ta(){return this._isVisible===undefined?c('CSS').shown(this._tabElem):this._isVisible;},isUploading:function ta(){return !!(this._composer&&this._composer.isUploading()||this._filesUploader&&this._filesUploader.isUploading()||!ba&&this._sharePreview&&this._sharePreview.component.isLoading());},setVisibleState:function ta(ua,va){this._isVisible=ua;this._isRaised=va;if(va)this._initFlyout();this._setHeaderProps({isRaised:va});if(ua&&!va)c('ChatPerfInstrumentation').logDisplayDone();var wa=c('CSS').shown(this._tabElem),xa=c('CSS').hasClass(this._tabElem,'opened');c('CSS').conditionShow(this._tabElem,ua);c('CSS').conditionClass(this._tabElem,'minimized',!va&&ua);c('CSS').conditionClass(this._tabElem,'opened',va);if(!(wa&&xa)&&ua&&va){if(!this._messagesView)this._propagateUpdatedThreadID(this._threadID);this._nubController.flyoutContentChanged();this._messagesView.trackBottomIfRequired();this.setP2PChatThreadBannerContainerVisibility();}},newMessageClicked:function ta(){this._messagesView&&this._messagesView.scrollToBottom();this.focus();this.tryMarkAsRead();},_propagateUpdatedThreadID:function ta(ua){if(this._messagesView&&this._messagesView.getThreadID()===ua)return;var va=c('MercuryIDs').tokenize(ua);this._messagesView&&this._messagesView.destroy();this._messagesView=new (c('ChatTabMessagesView'))(ua,this._sheetController,this._getNode('scrollingArea'),this._getNode('conversation'),this._getNode('loadingIndicator'),this._getNode('lastMessageIndicator'),this._getNode('typingIndicator'),this,c('MercuryConfig').ShowContextBanner&&va.type==='user',this._getNode('quickReply'),this._getNode('camQuickReply'));this._composerContainer.setProps({threadID:ua});},focus:function ta(){this._focusComposerIfPossible();if(c('MercuryConfig').FantaTabs)c('FantaTabActions').focusTab(this._threadID);},_focusComposerIfPossible:function ta(){if(this.isChatViewable()){try{this._focusInput();}catch(ua){}}else if(ca){this._nubTitle&&this._nubTitle.component.focus();}else this._getNode('dockButton').focus();},isFocused:function ta(){var ua=c('getActiveElement')();return c('Parent').bySelector(ua,"._50mz")===this._tabElem;},hover:function ta(){c('CSS').addClass(this._tabElem,'hovered');},resetHover:function ta(){c('CSS').removeClass(this._tabElem,'hovered');},isHovered:function ta(){return c('CSS').hasClass(this._tabElem,'hovered');},hasEmptyInput:function ta(){return u.test(this._getInputValue());},getInputElem:function ta(){return this._composer&&c('ReactDOM').findDOMNode(this._composer.getInput());},getMessagesView:function ta(){return this._messagesView;},loadShareFromParams:function ta(ua,va){this._getSharePreview().done(function(wa){wa.setProps({share:{params:va,type:ua},uri:null});});},_linkDropped:function ta(ua){this._getSharePreview().done(function(va){va.setProps({share:null,uri:ua});});},_filesDropped:function ta(ua){this._loadReactMenu().then(function(va){var wa=ca?va.getFileUploaderPromise():va.component.getFileUploaderPromise();if(wa)wa.done(function(xa){setTimeout(function(){xa.addDroppedFiles(ua);},0);});});},insertBefore:function ta(ua){c('DOM').insertBefore(ua.getTabElem(),this._tabElem);},appendTo:function ta(ua){c('DOM').appendContent(ua,this._tabElem);},nextTabIs:function ta(ua){var va=ua&&ua.getTabElem();return this._tabElem.nextSibling==va;},getScrollTop:function ta(){return c('Scroll').getTop(c('DOM').find(this._tabElem,'.fbNubFlyoutBody.scrollable'));},setScrollTop:function ta(ua){c('Scroll').setTop(c('DOM').find(this._tabElem,'.fbNubFlyoutBody.scrollable'),ua);},destroy:function ta(){this._selectionPosition&&this._selectionPosition.disable();while(this._eventListeners.length)this._eventListeners.pop().remove();if(this._dropTarget)this._dropTarget.disable();this._checkUnsentMessages&&this._checkUnsentMessages.cancel();this._logUnsentPhotos&&this._logUnsentPhotos.cancel();this._messagesView&&this._messagesView.destroy();this._sheetController&&this._sheetController.destroy();c('ReactDOM').unmountComponentAtNode(this._getNode('animationContainer'));c('ReactDOM').unmountComponentAtNode(this._getNode('menuContainer'));if(this._addToThreadButton){this._addToThreadButton.unmount();this._addToThreadButton=null;}if(this._archiveWarning){this._archiveWarning.unmount();this._archiveWarning=null;}if(this._videoCallButton){this._videoCallButton.unmount();this._videoCallButton=null;}if(this._voiceCallButton){this._voiceCallButton.unmount();this._voiceCallButton=null;}if(this._closeButton){this._closeButton.unmount();this._closeButton=null;}if(this._title){this._title.unmount();this._title=null;}if(this._sharePreview){this._sharePreview.unmount();this._sharePreview=null;}this._subscriptionsHandler&&this._subscriptionsHandler.release();c('ReactDOM').unmountComponentAtNode(this._getNode('name'));c('ReactDOM').unmountComponentAtNode(this._getNode('footer'));c('DOM').remove(this._tabElem);w['delete'](this._threadID);c('Dock').unregisterNubController(this._nubController);},updateAvailableStatus:function ta(){s.getThreadMeta(this._threadID,function(ua){var va=c('AvailableListConstants').OFFLINE,wa=this._getCanonicalUserID(),xa=null;if(wa){va=c('PresenceStatus').get(wa);xa=c('ShortProfiles').getNow(wa);}else{var ya=ua.participants.map(function(ab){return c('MercuryIDs').getUserIDFromParticipantID(ab);});va=c('PresenceStatus').getGroup(ya);}if(!c('ChatVisibility').isOnline())va=c('AvailableListConstants').OFFLINE;c('CSS').conditionClass(this._tabElem,"_4-0b",va===c('AvailableListConstants').ACTIVE&&(xa===undefined||xa===null||!xa.is_messenger_only));var za=this._getNode('presenceIndicator');this._onlineStatus=va;this._pagesMessageIndicatorHandler&&this._pagesMessageIndicatorHandler.notifyPageOnlineStatusChanged(va);}.bind(this));},updateTab:function ta(){s.getThreadMeta(this._threadID,function(ua){this.updateTitlebar(ua);this._updateControls(ua);this._updateMessageBlockSettings(ua);this._updateMessageManageSettings(ua);this._updateMutingSettings(ua);this._updateUnreadCount(ua);this._updateArchiveWarning(ua);this._updateEmployeeAwayWarning(ua);this._updateUserInFocusWarning(ua);this._updateOfficeStatus(ua);this._updateUserTimezoneWarning(ua);this._updatePersonalUserWarning(ua);this._updateWorkUserWarning(ua);this._updateNewThread(ua);this._updateNameConversationSheet(ua);this._updateEventReminderSheet(ua);this._updateReadOnlySheet(ua);this._updateSwitchToWork(ua);this._updateAppointmentBanner(ua);this._updateNullState(ua);}.bind(this));},_updateNullState:function ta(ua){if(ua.message_count>0)if(this._composerNullState){c('DOM').remove(this._composerNullState);delete this._composerNullState;}},_updateEventReminderSheet:function ta(ua){c('Bootloader').loadModules(["EventReminderStateStore","EventReminderActions"],function(va,wa){var event=ua.lightweight_events;if(!event){this._sheetController.closeChatEventReminderTabSheet();return;}var xa=va.getEvent(event.message_thread_id.toString());if(!xa){var ya={eventName:event.title,eventDate:event.event_time,eventID:event.oid.toString(),threadID:event.message_thread_id.toString()};wa.updateEventReminder(ya);this._sheetController.openChatEventReminderTabSheet();return;}if(!xa.exists){this._sheetController.closeChatEventReminderTabSheet();return;}this._sheetController.openChatEventReminderTabSheet();return;}.bind(this),'ChatTabView');},_updateNameConversationSheet:function ta(ua){this.hideAutomaticNameConversation();},_updateReadOnlySheet:function ta(ua){var va=c('MercuryThreadInfo').showComposer(ua),wa=c('MercuryThreadInfo').canReply(ua),xa=s.isEmptyLocalThread(ua.thread_id);if(c('MercuryConfig').ColdOpenBlock&&c('MercuryThreadInfo').isColdOpen(ua)){this._sheetController.openPermanentReadOnlySheet();}else this._sheetController.closePermanentReadOnlySheet();if(c('MercuryConfig').ViewerIsReadOnly){this._sheetController.openPermanentReadOnlySheet();}else if(!wa&&!va&&!xa)this._sheetController.openReadOnlySheet();},_updateMessageManageSettings:function ta(ua){var va=c('MercuryIDs').getParticipantIDFromFromThreadID(ua.thread_id),wa=va?c('MercuryParticipants').getNow(va):null;this._updateMenuPropsSafe({isBusinessEnabled:wa&&wa.is_business_enabled});},updateSignatureID:function ta(ua){this._signatureID=ua;},updateIsLastTab:function ta(ua){this._isLastTab=ua;this._rtcNuxShown=ua&&this._rtcNuxShown;this._voiceCallButton&&this._voiceCallButton.setProps({rtcNuxShown:this._rtcNuxShown});this._header&&this._header.setProps({rtcNuxShown:this._rtcNuxShown});},_updateMessageBlockSettings:function ta(ua){this._updateMenuPropsSafe({hasMessageBlocked:c('MercuryBlockedParticipants').get().isMessageBlocked(ua),isEmptyConversation:ua&&ua.message_count==0});},_updateMutingSettings:function ta(ua){var va=!!ua&&c('MercuryThreadInfo').isMuted(ua);va&&!this._reactChatTabMenu&&this._loadReactMenu();this._updateMenuPropsSafe({isMuted:va});},_updateMenuPropsSafe:function ta(ua){if(ca){this._header&&this._header.component.setAdditionalMenuProps(ua);return;}if(this._menuPromise)this._menuPromise.then(function(va){va&&va.component&&va.component.isMounted()&&va.setProps(ua);});},_updateArchiveWarning:function ta(ua){if(c('CurrentUser').isEmployee())c('MercuryParticipants').getMulti(ua.participants,this._showArchiveWarningIfAllParticipantsAreEmployees.bind(this));},_updateEmployeeAwayWarning:function ta(ua){if(!c('CurrentUser').isEmployee())return;c('Run').onAfterLoad(function(){c('Bootloader').loadModules(["ChatEmployeeAwayWarning"],function(va){va.updateEmployeeAwayWarning(ua,function(){this._sheetController.openEmployeeAwaySheet();}.bind(this),c('emptyFunction'));}.bind(this),'ChatTabView');}.bind(this));},_getFocusWarning:function ta(){if(!this._focusModulePromise)this._focusModulePromise=new (c('Promise'))(function(ua){c('requireWeak')('ChatUserFocusWarning',function(va){return ua(va);});});return this._focusModulePromise;},_updateUserInFocusWarning:function ta(ua){this._getFocusWarning().done(function(va){va.updateUserFocusWarning(ua,function(wa){wa?this._sheetController.openBypassFocusSheet():this._sheetController.openUserFocusSheet();}.bind(this),function(){this._sheetController.closeUserFocusSheet();}.bind(this));}.bind(this));},_getTimezoneWarning:function ta(){if(!this._timezoneModulePromise)this._timezoneModulePromise=new (c('Promise'))(function(ua){c('requireWeak')('ChatTimezoneWarning',ua);});return this._timezoneModulePromise;},_updateUserTimezoneWarning:function ta(ua){this._getTimezoneWarning().done(function(va){va.updateUserTimezoneWarning(ua,function(wa){this._sheetController.openUserTimezoneSheet(wa);}.bind(this),c('emptyFunction'));}.bind(this));},_getPersonalUserWarning:function ta(){if(!this._personalUserWarningModulePromise)this._personalUserWarningModulePromise=new (c('Promise'))(function(ua){c('requireWeak')('ChatUserPersonalUserWarning',ua);});return this._personalUserWarningModulePromise;},_updatePersonalUserWarning:function ta(ua){this._getPersonalUserWarning().done(function(va){va.updateEmployeePersonalUserWarning(ua,function(wa,xa){this._sheetController.openUserIsPersonalUserSheet(wa,xa);}.bind(this),c('emptyFunction'));}.bind(this));},_getWorkUserWarning:function ta(){if(!this._workUserWarningModulePromise)this._workUserWarningModulePromise=new (c('Promise'))(function(ua){c('requireWeak')('ChatUserWorkUserWarning',ua);});return this._workUserWarningModulePromise;},_updateWorkUserWarning:function ta(ua){this._getWorkUserWarning().done(function(va){va.updateEmployeeWorkUserWarning(ua,function(wa,xa){this._sheetController.openUserIsWorkUserSheet(wa,xa);}.bind(this),c('emptyFunction'));}.bind(this));},_updateOfficeStatus:function ta(ua){var va=this._getNode('officeStatus');if(!va||c('MercuryIDs').isGroupChat(ua.thread_id))return;c('Run').onAfterLoad(function(){c('Bootloader').loadModules(["ChatTabOfficeStatus"],function(wa){var xa=c('MercuryIDs').getParticipantIDFromUserID(ua.other_user_fbid);c('MercuryParticipants').get(xa,function(ya){wa.update(va,ya);});},'ChatTabView');});},_updateSwitchToWork:function ta(ua){if(c('MoveToWorkUtils').isViewerEligible()&&c('MercuryIDs').isGroupChat(ua.thread_id)){c('MercuryParticipants').getMulti(ua.participants,function(va){var wa=this._isEmployeesOnly(va);this._updateMenuPropsSafe({hasSwitchToWork:wa});}.bind(this));}else this._updateMenuPropsSafe({hasSwitchToWork:false});},_updateControls:function ta(ua,va,wa){var xa=this._isPageChat(),ya=c('MercuryThreadInfo').showComposer(ua)&&(!c('isEmpty')(ua.participants)||!!va)&&!this._composerNullState&&!c('MercuryConfig').ViewerIsReadOnly&&!(c('MercuryConfig').ColdOpenBlock&&(c('MercuryThreadInfo').isColdOpen(ua)||c('MercuryThreadInfo').isEmptyLocalThread(ua))),za=this._getNode('footer');c('CSS').conditionShow(za,ya);c('CSS').conditionShow(this._getNode('menuContainer'),ya);var ab={isEmptyChat:s.isNewEmptyLocalThread(ua.thread_id),show:ya};if(xa)ab.showAddFriend=null;this._updateMenuPropsSafe(ab);var bb=ya&&!xa;this._addToThreadButton&&this._addToThreadButton.setProps({shown:bb});var cb=ua.joinable_mode&&ua.joinable_mode.mode===c('MessengerJoinableModeType').JOINABLE,db=ua.participants.length>1&&!cb&&c('MercuryThreadInfo').canReply(ua)&&!s.isNewEmptyLocalThread(this._threadID);this._voiceCallButton&&this._voiceCallButton.setProps({shown:db});this._videoCallButton&&this._videoCallButton.setProps({shown:db});if(c('MercuryIDs').isGroupChat(this._threadID)&&ua.rtc_call_data){this._voiceCallButton&&this._voiceCallButton.setProps({rtcCallData:ua.rtc_call_data});this._videoCallButton&&this._videoCallButton.setProps({rtcCallData:ua.rtc_call_data});}if(wa&&wa.length===1&&c('MercuryConfig').ShowContextBanner){this._messagesView&&this._messagesView.renderContextBanner(null,wa[0].info&&wa[0].info.uid);}else this._messagesView&&this._messagesView.unmountContextBanner();},_updateNewThread:function ta(ua){if(s.isNewEmptyLocalThread(ua.thread_id))this.showAddFriend();},_isEmployeesOnly:function ta(ua){for(var va in ua)if(!ua[va].employee)return false;return true;},_showArchiveWarningIfAllParticipantsAreEmployees:function ta(ua){var va=this._isEmployeesOnly(ua)&&Object.keys(ua).length>1,wa=this._getNode('archiveContainer');if(wa){if(this._titlebarTooltipAnchor)c('CSS').conditionClass(this._titlebarTooltipAnchor,'narrowTitleBar',va);c('CSS').conditionShow(wa,va);this._archiveWarning&&this._archiveWarning.setProps({shown:va});}},updateTitlebarTooltip:function ta(){if(!this._title)return;s.getThreadMeta(this._threadID,function(ua){var va=c('ReactDOM').findDOMNode(this._title.component);if(!va)return;ea(va,ua.participants);}.bind(this));},_getNode:function ta(ua){return this._tabTemplate.getNode(ua);},_getCanonicalUserID:function ta(){return c('MercuryIDs').getUserIDFromThreadID(this._threadID);},_listen:function ta(ua,event,va,wa){var xa=this._getNode(ua);if(xa){this._eventListeners.push(c('Event').listen(xa,event,va.bind(this)));}else if(!wa)throw new Error('Could not find node "'+ua+'"');},_closePreClicked:function ta(ua){this._closeMouseDown=true;},_closeClicked:function ta(ua){this._dismissRTCNux();pa(this);var va=c('MercuryConfig').FantaTabs?function(){c('FantaTabActions').closeTab(this._threadID);v&&v.removeBypassFocusModeForThread(this._threadID);}.bind(this):function(){return c('ChatTabActions').closeTab(this._threadID,'close_click');}.bind(this);this.animateClose(va);if(ua instanceof c('SyntheticEvent')){ua.preventDefault();}else ua.kill();},animateClose:function ta(ua){this._animationendFailsafeTimeout=setTimeout(ua,1.2*c('ifRequired')('cssVar',function(wa){return "200ms".replace(y,'');},function(){return 200;}));var va=c('Event').listen(this._tabElem,c('getVendorPrefixedEventName')('animationend'),function(wa){if(wa.animationName==='closeChatTab'){ua();clearTimeout(this._animationendFailsafeTimeout);}}.bind(this));this._subscriptionsHandler&&this._subscriptionsHandler.addSubscriptions(va);c('CSS').addClass(this._tabElem,"_2suj");},_closeEnter:function ta(ua){if(ua.keyCode===c('Keys').RETURN)this._closeClicked(ua);},_nubClicked:function ta(ua){if(this._isRaised)return;if(this._closeMouseDown)return;if(ua instanceof c('SyntheticEvent')){ua.preventDefault();}else ua.kill();this._isRaised=true;this._initFlyout();this.resetHover();if(c('MercuryConfig').FantaTabs){c('FantaTabActions').unminimizeTab(this._threadID);this.focusTab();}else return c('ChatTabViewEvents').inform('nub-activated',this._threadID);},_nubHovered:function ta(){var ua=c('CSS').hasClass(this._tabElem,'highlightTab');if(ua)this.hover();},_dockKeyDown:function ta(ua){if(ua.keyCode===c('Keys').RETURN||ua.keyCode===c('Keys').SPACE){if(c('MercuryConfig').FantaTabs){c('FantaTabActions').unminimizeTab(this._threadID);}else c('ChatTabViewEvents').inform('nub-activated',this._threadID);if(ua instanceof c('SyntheticEvent')){ua.preventDefault();}else ua.kill();}else this._handleHotkeyPressed(ua);},_handleHotkeyPressed:function ta(ua){if(ua.keyCode===c('Keys').ESC){this._handleEscape();if(ua instanceof c('SyntheticEvent')){ua.preventDefault();}else ua.kill();}else if(ua.keyCode===c('Keys').TAB)this._handleTabPressed(ua);},_handleTabPressed:function ta(event){if(c('MercuryConfig').FantaTabs){if(!event.ctrlKey)if(event.shiftKey){c('FantaTabActions').focusPreviousTab(event);}else c('FantaTabActions').focusNextTab(event);}else if(!event.ctrlKey){var ua=c('ChatTabViewEvents').inform('tab-pressed',{id:this._threadID,shiftPressed:event.shiftKey});!ua&&event.preventDefault();}},_handleEscape:function ta(){this._dismissRTCNux();pa(this);var ua=c('MercuryConfig').FantaTabs?function(){c('FantaTabActions').closeAndTabNext(this._threadID);}.bind(this):function(){return c('ChatTabViewEvents').inform('esc-pressed',this._threadID);}.bind(this);if(this.hasEmptyInput()){this.animateClose(ua);}else{var va=j._("Are you sure you want to close this chat window?"),wa=j._("You haven't sent your message.");c('SimpleXUIDialog').showConfirm(va,wa,function(xa){if(xa){ua();}else this.focus();}.bind(this),{autofocusConfirm:true,useReactFocusBehavior:true});}},_titleClicked:function ta(event){this._dismissRTCNux();var ua=event.getTarget();if(!c('Parent').byClass(ua,'titlebarText')&&!c('Parent').byClass(ua,'uiSelector')&&(!c('Parent').bySelector(ua,"._3olv")||c('Parent').bySelector(ua,"._14lt"))&&!c('Parent').byClass(ua,'close')){event.kill();this._isRaised=false;if(c('MercuryConfig').FantaTabs){c('FantaTabActions').minimizeTab(this._threadID);}else c('ChatTabActions').lowerTab(this._threadID);this.focus();this.resetHover();}},_titleHovered:function ta(){var ua=c('CSS').hasClass(this._tabElem,'highlightTab');if(ua)this.hover();},_addFriendLinkClicked:function ta(){this.showAddFriend();},_focusInput:function ta(){c('ChatNubLogger').processEvent('focus');this._composer?this._composer.getInput().focus():this._focusOnComposerMount=true;},_focusTab:function ta(){if(c('MercuryConfig').FantaTabs&&!c('FantaDispatcher').isDispatching()){c('FantaTabActions').focusTab(this._threadID);}else c('ChatTabViewEvents').inform('focus-tab',this._threadID);this.focusTab();},focusTab:function ta(){c('CSS').addClass(this._tabElem,'focusedTab');if(this._isRaised)this.tryMarkAsRead();this._closeMouseDown=false;if(ca){this._setHeaderProps({isActive:true});}else this._setCloseTooltip(true);this._focusComposerIfPossible();},blurTab:function ta(){c('ChatNubLogger').processEvent('blur');c('CSS').removeClass(this._tabElem,'focusedTab');if(ca){!this._closeMouseDown&&this._setHeaderProps({isActive:false});}else !this._closeMouseDown&&this._setCloseTooltip(false);},_setCloseTooltip:function ta(ua){if(this._closeButton){this._closeButton.setProps({active:ua});return;}var va=this._getNode('titlebarCloseButton');if(!va)return;var wa=ua?j._("Press Esc to close"):j._("Close tab");c('TooltipData').set(va,wa,'above');},_initFlyout:function ta(event){this._initFlyout=c('emptyFunction');for(var ua=this._flyoutInitializers,va=Array.isArray(ua),wa=0,ua=va?ua:ua[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var xa;if(va){if(wa>=ua.length)break;xa=ua[wa++];}else{wa=ua.next();if(wa.done)break;xa=wa.value;}var ya=xa;ya();}},_inputKeyDown:function ta(event){this.tryMarkAsRead();if(event.keyCode===c('Keys').RETURN&&!event.shiftKey){if(ka(this)){ja(this);event.kill&&event.kill();return;}ga(this);event.kill?event.kill():event.preventDefault();return;}if(event.keyCode===c('Keys').DOWN&&event.shiftKey&&this.hasEmptyInput()){event.kill&&event.kill();if(c('MercuryConfig').FantaTabs){c('FantaTabActions').minimizeTab(this._threadID);}else c('ChatTabActions').lowerTab(this._threadID);this.focus();return;}this._handleHotkeyPressed(event);},_showMessageBlockedDialog:function ta(ua){var va=this._getCanonicalUserID();if(!va)return;var wa='fbid:'+va;c('MercuryParticipants').get(wa,function(xa){c('Bootloader').loadModules(["MessageBlockedDialog"],function(ya){ya.show(ua.thread_id,ua.can_reply,c('MercuryBlockedParticipants').get().isMessageBlocked(ua),xa.short_name);},'ChatTabView');});},_initializeInput:function ta(){this._composerContainer=new (c('ReactComponentRenderer'))(c('ChatTabComposerContainer.react'),this._getNode('footer'));this._composerContainer.setProps({disableFileUploads:!c('WorkFileUploadsGating').canUploadFiles,initializeThingsWithInputFn:this._initializeThingsWithInputFn.bind(this),inputKeyDown:this._inputKeyDown.bind(this),onMount:function(ua){this._composer=ua;var va=false;if(this._focusOnComposerMount){va=true;this._focusOnComposerMount=false;}if(c('ChatTabLazyFocus').get()===this._threadID){va=true;c('ChatTabLazyFocus').clear();}if(va)setTimeout(function(){this._composer.getInput().focus();}.bind(this),0);}.bind(this),onBlur:this.blurTab.bind(this),onEscape:this._handleEscape.bind(this),onFocus:this._focusTab.bind(this),onTab:this._handleTabPressed.bind(this),resizeFn:function(){this._nubController.flyoutContentChanged();}.bind(this),onCustomLikeSelect:this._customLikeSelected.bind(this),onEmojiSelect:this._emojiSelected.bind(this),onFileUploadFail:this._handleFileLastUploadFailed.bind(this),onP2PTrigger:this._p2pTriggered.bind(this),onPhotoUploadFail:this._handlePULastUploadFailed.bind(this),onStickerSelect:this._stickerSelected.bind(this),onUploadCancel:this._handlePULastUploadCanceled.bind(this),onUploadComplete:this._handlePUAllUploadsCompleted.bind(this),onUploadSubmit:this._handleUploadSubmit.bind(this),threadID:this._threadID,viewer:c('CurrentUser').getID()});},_initializeSharePreview:function ta(ua,va){c('Event').listen(ua,'keyup',function(){var wa=va?va():ua.value;if(!wa.length)if(this._urlScraper){this._urlScraper.reset();delete this._urlScraperData;}}.bind(this));c('Run').onAfterLoad(function(){c('Bootloader').loadModules(["URLScraper"],function(wa){this._urlScraper=new wa(ua,va);this._urlScraper.subscribe('match',function(xa,ya){this._urlScraperData=ya;this._getSharePreview().done(function(za){var ab=this._urlScraperData;za.setProps({share:null,uri:ab&&ab.url});}.bind(this));}.bind(this));}.bind(this),'ChatTabView');}.bind(this));},_getSharePreview:function ta(){if(!this._sharePreview&&!this._sharePreviewPromise)this._sharePreviewPromise=new (c('Promise'))(function(ua){c('Bootloader').loadModules(["MercurySharePreview.react"],function(va){this._sharePreview=new (c('ReactComponentRenderer'))(va,this._getNode('shareAttachmentShelf'));this._sharePreview.setProps({imageSize:{width:x,height:x},location:c('MercuryShareAttachmentRenderLocations').CHAT_PREVIEW,onClose:this._focusInput.bind(this),onUpdate:function(){ma(this);this._unblockSend();}.bind(this)});ua(this._sharePreview);}.bind(this),'ChatTabView');}.bind(this));return this._sharePreviewPromise;},_initializeThingsWithInputFn:function ta(ua,va){this._getValueFromReactComposer=va;this._initializeSharePreview(ua,va);s.getThreadMeta(this._threadID,function(wa){var xa,ya=this;if(wa){if(c('MessageRequestUtils').isMessageRequest(wa))(function(){var db=c('DOM').create('div');c('DOM').appendContent(ya._getNode('chatConv'),db);ya._composerNullState=db;var eb=c('MessageRequestUtils').isFiltered(wa);c('ReactDOM').render(c('React').createElement(c('BootloadedComponent.react'),{bootloadPlaceholder:c('React').createElement('div',{style:{height:27}}),bootloadLoader:c('JSResource')('ChatPendingActions.react').__setRef('ChatTabView'),isFiltered:eb,onDeleteClick:function(fb){if(eb){c('Bootloader').loadModules(["WebMessengerDeleteThreadDialog"],function(gb){gb.show(this._threadID);}.bind(this),'ChatTabView');}else{p.changeFolder(this._threadID,c('MessagingTag').OTHER);if(c('MercuryConfig').FantaTabs){c('FantaTabActions').closeTab(this._threadID);}else c('ChatTabActions').closeTab(this._threadID);}}.bind(ya),onReplyClick:function(fb){p.changeFolder(this._threadID,c('MessagingTag').INBOX);c('DOM').remove(db);delete this._composerNullState;this._updateControls(wa);this._nubController.flyoutContentChanged();}.bind(ya)}),db);})();var za=z&&wa.message_count===0,ab=aa;if(this._isPageChat()&&(za||ab)){var bb=this._getPageID(),cb=c('XMNCommercePageNullStateCTAController').getURIBuilder();new (c('AsyncRequest'))().setURI(cb.getURI()).setMethod('POST').setData({page_id:bb}).setHandler(function(db){var eb,fb=this;if(db&&db.payload)(function(){var gb=c('DOM').create('div');fb._composerNullState=gb;var hb=db.payload;c('DOM').appendContent(fb._getNode('chatConv'),gb);fb._composerNullState=gb;c('ReactDOM').render(c('React').createElement(c('BootloadedComponent.react'),{bootloadPlaceholder:c('React').createElement('div',{style:{height:27}}),bootloadLoader:c('JSResource')('ChatPageComposerNullState.react').__setRef('ChatTabView'),title:hb.title,onClick:function(ib){c('MNCommercePostbackCTADataManager').send(hb.id);c('DOM').remove(gb);delete this._composerNullState;this._updateControls(wa);this._nubController.flyoutContentChanged();}.bind(fb)}),gb);fb._updateControls(wa);fb._nubController.flyoutContentChanged();})();}.bind(this)).send();}}q.getServerIDFromClientID(this._threadID,function(db){this._typingDetector=new (c('TypingDetectorController'))(this._getCanonicalUserID(),ua,'mercury-chat',null,db,va);}.bind(this));}.bind(this));},_getInputValue:function ta(){if(this._getValueFromReactComposer)return this._getValueFromReactComposer();if(!this._chatInput||!this._chatInput.component.isMounted())return '';return this._chatInput.component.getValue()||'';},_getMentions:function ta(){if(!c('MercuryConfig').Mentions||!this._composer)return null;return this._composer.getInput().getMentions();},appendTextToInput:function ta(ua){this._composer&&this._composer.getInput().appendText(ua);},_hasUnfinishedPost:function ta(){return la(this)||this.isUploading();},tryMarkAsRead:function ta(){if(!this._messagesView||this._messagesView.isScrolledToBottom()){p.markRead(this._threadID);p.markSeen(this._threadID);return true;}return false;},_chatConvClicked:function ta(ua){this.tryMarkAsRead();if(c('Parent').byTag(ua.getTarget(),'a')||c('DOM').getSelection())return;this.focus();},_inputContainerClicked:function ta(ua){this.tryMarkAsRead();this.focus();},_initializePageMessagingIndicator:function ta(){this._pagesMessageIndicatorHandler=c('PagesMercuryChatTabIndicatorHandler').tryCreateHandler(this._threadID,this._onlineStatus,this._sheetController.openPageResponsivenessSheet.bind(this._sheetController),this._sheetController.closePageResponsivenessSheet.bind(this._sheetController));this._pagesMessageIndicatorHandler&&this._pagesMessageIndicatorHandler.checkResponsiveness();},_initializePagesGreeting:function ta(){var ua=c('DOMQuery').scry(this._tabElem,"._av1"),va=this._threadID,wa=c('MercuryIDs').getUserIDFromThreadID(va);if(!ua||ua.length===0)return;if(c('FBID').isUser(wa)){c('CSS').hide(ua[0]);return;}var xa=c('React').createElement(c('BootloadedComponent.react'),{bootloadPlaceholder:c('React').createElement('div',null),bootloadLoader:c('JSResource')('MercuryChatTabPagesGreetingContainer.react').__setRef('ChatTabView'),threadID:va});c('ReactDOM').render(xa,ua[0]);},showTypingIndicator:function ta(ua){if(ca){this._setHeaderProps({isTyping:!!ua});return;}this._renderTypingIndicator();c('CSS').conditionClass(this._tabElem,"_54m8",ua);},_renderTypingIndicator:function ta(){var ua=c('CSS').hasClass(this._tabElem,'highlightTab')?'light':'dark';c('ReactDOM').render(c('React').createElement(c('MercuryTypingAnimation.react'),{color:ua}),this._getNode('animationContainer'));},_updateUnreadCount:function ta(ua){var va=ua.unread_count;if(v&&v.currentViewerInFocusMode(ua.id))return;if(va!=undefined){var wa=!!va&&(!c('ChatBehavior').showsTabUnreadUI||c('ChatBehavior').showsTabUnreadUI()),xa=this._getNode('numMessages');c('CSS').conditionShow(xa,wa);c('CSS').conditionClass(this._tabElem,'highlightTab',wa);this._renderTypingIndicator();if(wa){c('ChatTabBlinking').blinkTab(this._threadID,this);}else c('ChatTabBlinking').unblinkTab(this._threadID);c('DOM').setContent(xa,va);}},ensureValidCanonicalGroup:function ta(ua){if(this._messagesView&&this._messagesView.getThreadID()===this._threadID)return;if(ua[this._messagesView.getThreadID()])this._propagateUpdatedThreadID(this._threadID);},_initializeSheetController:function ta(){this._sheetController=new (c('ChatTabSheetController'))(this._threadID,this._getNode('sheet'),this._tabElem,this);this._sheetController.onTokensChanged(function(ua,va){this._handleSheetControllerTokensChanged(va);}.bind(this));this._nubController=new (c('NubController'))().init(this._tabElem);this._sheetController.onResize(function(){this._nubController.flyoutContentChanged();}.bind(this));},_handleSheetControllerTokensChanged:function ta(ua){this._updateComposerParticipants(ua.tokens);s.getThreadMeta(this._threadID,function(va){this._updateControls(va,ua.token_count,ua.tokens);}.bind(this));this._updateMessagesViewIfNecessary(ua);},_updateMessagesViewIfNecessary:function ta(ua){if(!s.isEmptyLocalThread(this._threadID))return;var va=c('MercuryCanonicalGroupThreadManager').get();va.unsubscribe(this._canonicalGroupSearchSubscriptionID);if(ua.token_count===1){var wa=ua.tokens[0].info&&ua.tokens[0].info.uid;this._updateMercuryMessagesViewCanonical(c('MercuryIDs').getThreadIDFromUserID(wa));return;}this._updateMercuryMessagesViewCanonical(this._threadID);if(ua.token_count>1){var xa=ua.tokens.map(function(ya){return ya.info.uid;});this._canonicalGroupSearchSubscriptionID=va.getCanonicalGroupThreadIDForParticipants(Array.from(xa),this._updateMercuryMessagesViewCanonical.bind(this));}},_updateMercuryMessagesViewCanonical:function ta(ua){if(ua){this._propagateUpdatedThreadID(ua);this._messagesView.trackBottomIfRequired();}},_updateComposerParticipants:function ta(ua){var va=void 0;if(ua&&ua.length===1&&ua[0].info&&ua[0].info.uid)va=[c('MercuryIDs').getParticipantIDFromUserID(ua[0].info.uid)];this._composer&&this._composer.setParticipantIDs(va);},_initializeHeader:function ta(){if(ca){if(this._nubButton.nodeName.toLowerCase()==='a'){var ua=document.createElement('div');ua.className="fbNubButton";var va=this._nubButton.parentNode;va.insertBefore(ua,this._nubButton);va.removeChild(this._nubButton);this._nubButton=ua;}this._header=new (c('ReactComponentRenderer'))(c('ChatTabHeaderContainer.react'),this._getNode('nubFlyoutTitlebar'));this._nubTitle=new (c('ReactComponentRenderer'))(c('ChatTabHeaderContainer.react'),this._nubButton);this._setHeaderProps({attachmentsShelf:this._getNode('fileAttachmentShelf'),isActive:false,nameConversationFunc:this.showNameConversation.bind(this),raised:this._isRaised,rtcNuxShown:false,sheetController:this._sheetController,showAddFriend:this._sheetController.openAddFriendsSheet.bind(this._sheetController),threadID:this._threadID,viewer:c('CurrentUser').getID(),onClick:this._isRaised?this._titleClicked.bind(this):this._nubClicked.bind(this),onCloseClick:this._closeClicked.bind(this),onCloseKeyUp:this._closeEnter.bind(this),onCloseMouseDown:this._closePreClicked.bind(this),onFileUploaderMounted:this.setFilesUploader.bind(this),onFileUploaderSubmit:this._focusInput.bind(this),onKeyDown:this._dockKeyDown.bind(this),onRTCNuxCloseButtonClick:this._dismissRTCNux.bind(this),onUpdateAttachmentsShelf:ma.bind(null,this),onUploadFinished:this._unblockSend.bind(this)});this._shouldShowRTCNux(function(wa){var xa=wa.payload.shouldShow,ya=c('MercuryIDs').isGroupChat(this._threadID);this._rtcNuxShown=this._isLastTab&&ya&&xa;this._header.setProps({rtcNuxShown:this._rtcNuxShown});}.bind(this));return;}this._initializeTitle();this._initializeCloseButton();this._initializeReactMenu();this._initializeAddToThreadButton();this._initializeRTC();this._initializeArchiveWarning();this._setCloseTooltip(false);},_setHeaderProps:function ta(ua){this._header&&this._header.setProps(ua);this._nubTitle&&this._nubTitle.setProps(ua);},_loadReactMenu:function ta(){if(ca)return this._header&&this._header.component.getMenu();var ua=c('MercuryIDs').isGroupChat(this._threadID),va=s.isNewEmptyLocalThread(this._threadID),wa=this._sheetController.openAddFriendsSheet.bind(this._sheetController);if(!this._menuPromise)this._initializeReactMenu();c('JSResource')('ChatTabMenu.react').__setRef('ChatTabView').load().done(function(xa){this._reactChatTabMenu=new (c('ReactComponentRenderer'))(xa,this._getNode('menuContainer'));this._reactChatTabMenu.setProps({sheetController:this._sheetController,onFileUploaderMounted:this.setFilesUploader.bind(this),nameConversationFunc:function(){return this.showNameConversation();}.bind(this),isGroupChat:ua,isEmptyChat:va,showAddFriend:wa,threadID:this._threadID,otherUserID:this._getCanonicalUserID(),attachmentsShelf:this._getNode('fileAttachmentShelf'),onUploadFinished:this._unblockSend.bind(this),onUpdateAttachmentsShelf:function(){return ma(this);}.bind(this),onSubmit:this._focusInput.bind(this)},function(){this._menuPromiseResolve&&this._menuPromiseResolve(this._reactChatTabMenu);}.bind(this));}.bind(this));return this._menuPromise;},_initializeReactMenu:function ta(){this._menuPromise=new (c('Promise'))(function(ua){this._menuPromiseResolve=ua;}.bind(this));this._listen('menuButton','click',function(ua){ua.preventDefault();this._loadReactMenu().then(function(va){va.component.open();});}.bind(this));},_initializeArchiveWarning:function ta(){var ua=this._getNode('archiveContainer');if(!ua)return;c('Run').onAfterLoad(function(){c('Bootloader').loadModules(["ArchiveWarning.react"],function(va){this._archiveWarning=new (c('ReactComponentRenderer'))(va,ua);this._archiveWarning.setProps({isFBAtWork:c('WorkModeConfig').is_work_user,shown:false,useCSS:true});var wa=s.getThreadMetaNow(this._threadID);if(wa)this._updateArchiveWarning(wa);}.bind(this),'ChatTabView');}.bind(this));},_initializeAddToThreadButton:function ta(){if(ca)return null;c('Run').onAfterLoad(function(){c('Bootloader').loadModules(["ChatAddToThreadButton.react"],function(ua){this._addToThreadButton=new (c('ReactComponentRenderer'))(ua,this._getNode('addToThreadContainer'));var va=s.getThreadMetaNow(this._threadID);this._addToThreadButton.setProps({isFBAtWork:c('WorkModeConfig').is_work_user,onClick:this._addFriendLinkClicked.bind(this),shown:false,isMessengerRoom:c('MessengerAdminGroupUtils').isJoinableThread(va)});if(va)this._updateControls(va);}.bind(this),'ChatTabView');}.bind(this));},_initializeRTC:function ta(){if(ca)return;var ua=c('MercuryIDs').isGroupChat(this._threadID);if(ua&&!c('ChatConfig').get('rtc_conferencing_www'))return;c('Run').onAfterLoad(function(){c('Bootloader').loadModules(["ChatVideoCallButton.react"],function(va){var wa=c('CurrentUser').getID();if(!ua||c('ChatConfig').get('rtc_conferencing_www_video')){this._videoCallButton=new (c('ReactComponentRenderer'))(va,this._getNode('videoCallButtonContainer'));this._videoCallButton.setProps({isAudio:false,isGroupChat:ua,onRTCNuxCloseButtonClick:function(){return this._dismissRTCNux();}.bind(this),rtcNuxShown:false,threadID:this._threadID,viewer:wa,shown:false});}this._voiceCallButton=new (c('ReactComponentRenderer'))(va,this._getNode('voiceCallButtonContainer'));this._voiceCallButton.setProps({isAudio:true,isGroupChat:ua,onRTCNuxCloseButtonClick:function(){return this._dismissRTCNux();}.bind(this),rtcNuxShown:false,threadID:this._threadID,viewer:wa,shown:false});s.getThreadMeta(this._threadID,function(xa){return this._updateControls(xa);}.bind(this));this._shouldShowRTCNux(function(xa){var ya=xa.payload.shouldShow;this._rtcNuxShown=this._isLastTab&&ua&&ya;this._voiceCallButton.setProps({rtcNuxShown:this._rtcNuxShown});}.bind(this));}.bind(this),'ChatTabView');}.bind(this));},_initializeCloseButton:function ta(){this._listen('titlebarCloseButton','click',this._closeClicked);this._listen('titlebarCloseButton','keyup',this._closeEnter);this._listen('titlebarCloseButton','mousedown',this._closePreClicked);c('Run').onAfterLoad(function(){c('Bootloader').loadModules(["ChatCloseButton.react"],function(ua){this._closeButton=new (c('ReactComponentRenderer'))(ua,this._getNode('titlebarCloseButtonContainer'));this._closeButton.setProps({active:this.isFocused(),className:"_3olu _3olv",onClick:this._closeClicked.bind(this),onKeyUp:this._closeEnter.bind(this),onMouseDown:this._closePreClicked.bind(this)});}.bind(this),'ChatTabView');}.bind(this));},_initializeTitle:function ta(){var ua=s.getThreadMetaNow(this._threadID);this._title=new (c('ReactComponentRenderer'))(c('ChatTitleLink.react'),this._getNode('titleContainer'));this._title.setProps({thread:ua,viewer:c('CurrentUser').getID()});},_initializeTitleHREF:function ta(){c('getTitleHrefFromThreadID')(this._threadID,this._setTitleHref.bind(this));this._titlebarTooltipAnchor=this._getNode('titlebarText');},_dismissRTCNux:function ta(){if(this._rtcNuxShown){this._rtcNuxShown=false;this._voiceCallButton&&this._voiceCallButton.setProps({rtcNuxShown:false});this._header&&this._header.setProps({rtcNuxShown:false});var ua=c('XGroupCallNuxController').getURIBuilder().setString('action','dismiss').getURI();new (c('AsyncRequest'))(ua).send();}},_shouldShowRTCNux:function ta(ua){var va=c('XGroupCallNuxController').getURIBuilder().setString('action','should_show').getURI();new (c('AsyncRequest'))(va).setHandler(ua).send();},_updateAppointmentBanner:function ta(ua){var va=this,wa=ua.thread_id,xa=ua.other_user_fbid,ya=n.getCurrentlyLoadedMessages(wa);if(xa&&!c('FBID').isUser(xa)&&c('MercuryConfig').ShowAppointmentBanner){var za=c('XNativeComponentFlowBookingRequestCountController').getURIBuilder().setFBID('page_id',xa).setFBID('user_id',c('CurrentUser').getID()).getURI();new (c('AsyncRequest'))().setURI(za).setHandler(function(ab){var bb=ab&&ab.getPayload();if(!this._hasBookingRequest(bb))return;this._sheetController.openAppointmentBannerSheet(xa,c('CurrentUser').getID(),100,ya,function(){va._nubController.flyoutContentChanged();});}.bind(this)).setErrorHandler(function(){this._sheetController.closeAppointmentBannerSheet();}.bind(this)).send();}else this._sheetController.closeAppointmentBannerSheet();},_hasBookingRequest:function ta(ua){if(!ua)return false;return ua.confirmed+ua.pending>0;},_initializeDockUIListeners:function ta(){if(ca)return;this._listen('dockButton','click',this._nubClicked);this._listen('dockButton','mouseenter',this._nubHovered);this._listen('dockButton','keydown',this._dockKeyDown);this._listen('closeButton','click',this._closeClicked);},_initializeUIListeners:function ta(){this._listen('nubFlyoutTitlebar','click',this._titleClicked);this._listen('nubFlyoutTitlebar','mouseenter',this._titleHovered);this._listen('chatConv','click',this._chatConvClicked);if(this._getNode('inputContainer'))this._listen('inputContainer','click',this._inputContainerClicked);this._listen('sheet','keydown',function(event){if(!event.getModifiers().any&&event.keyCode===c('Keys').TAB){this._focusInput();event.kill();}if(event.keyCode===c('Keys').ESC)this._handleEscape();}.bind(this));if(this._getNode('officeStatus'))this._listen('officeStatus','click',function(){return false;},true);},setFilesUploader:function ta(ua){this._filesUploader=ua;},_initializeDragDropTarget:function ta(){if(c('WorkFileUploadsGating').canUploadFiles){var ua=c('DOMQuery').scry(this._tabElem,"._1ia");if(ua&&ua.length>0){this._dropTarget=new (c('DragDropTarget'))(ua[0]);this._dropTarget.setOnFilesDropCallback(this._filesDropped.bind(this));this._dropTarget.setOnURLDropCallback(this._linkDropped.bind(this));this._dropTarget.enable();}}},_initializeP2PChatThreadBannerContainer:function ta(){var ua=c('DOMQuery').scry(this._tabElem,"._2hc2");if(ua&&ua.length>0){this._p2pChatThreadBannerContainerEl=ua[0];c('Run').onAfterLoad(function(){c('Bootloader').loadModules(["P2PChatThreadBannerContainer.react"],function(va){this._p2pChatThreadBannerContainer=new (c('ReactComponentRenderer'))(va,this._p2pChatThreadBannerContainerEl);this._p2pChatThreadBannerContainer.setProps({isVisible:this.isChatViewable(),otherUserID:c('MercuryIDs').getUserIDFromThreadID(this._threadID),threadID:this._threadID});}.bind(this),'ChatTabView');}.bind(this));}},setP2PChatThreadBannerContainerVisibility:function ta(){if(this._p2pChatThreadBannerContainer)this._p2pChatThreadBannerContainer.setProps({isVisible:this.isChatViewable()});},isChatViewable:function ta(){return !!(this._tabElem&&this._isVisible&&this._isRaised);},_initializeUnloadListeners:function ta(){this._checkUnsentMessages=c('createCancelableFunction')(function(){if(this._hasUnfinishedPost())return j._("You haven't sent your message yet. Do you want to leave without sending?");if(n.getNumberLocalMessages(this._threadID))return j._("Your message is still being sent. Are you sure you want to leave?");return null;}.bind(this));c('Run').onBeforeUnload(this._checkUnsentMessages,false);this._logUnsentPhotos=c('createCancelableFunction')(pa.bind(null,this));c('Run').onUnload(this._logUnsentPhotos);},_handleUploadSubmit:function ta(ua){na(this,c('PhotosUploadWaterfall').UPLOAD_START,ua);ia(this,'',[],function(va){if(this._threadID!==va.thread_id){this._newThreadIDFromPhotoUpload=va.thread_id;if(this._messagesView)this._messagesView.setNewThreadID(va.thread_id);}va.content_attachment=null;t.addAttachmentPlaceholder(va,ua.upload_id,ua);}.bind(this));ra('submit',ua);this._focusInput();},_handleFileLastUploadFailed:function ta(ua){na(this,c('PhotosUploadWaterfall').CLIENT_ERROR,ua);ra('failed',ua);},_handlePULastUploadFailed:function ta(ua){na(this,c('PhotosUploadWaterfall').CLIENT_ERROR,ua);ra('failed',ua);},_handlePULastUploadCanceled:function ta(ua){na(this,c('PhotosUploadWaterfall').CANCEL_DURING_UPLOAD,ua);ra('canceled',ua);},_handlePUAllUploadsCompleted:function ta(ua){na(this,c('PhotosUploadWaterfall').ALL_UPLOADS_DONE,ua);ra('completed',ua);var va=ua.image_ids.length||ua.attachments.length;ha(this,va);},_stickerSelected:function ta(ua){ia(this,'',[],function(va){va.has_attachment=true;va.sticker_id=ua;t.send(va);this.focus();}.bind(this));this._messagesView&&this._messagesView.scrollToBottom();},_emojiSelected:function ta(ua){this._composer&&this._composer.getInput().insertEmoji(ua);},_customLikeSelected:function ta(ua,va,wa){this.is_emoji_like=true;ia(this,ua.emoji,[],function(xa){xa.has_attachment=false;t.send(function(){c('EmojiLikeUtils').setEmojiSize(xa,va);return c('EmojiLikeUtils').setEmojiSource(xa,wa);}());this.focus();}.bind(this));this._messagesView&&this._messagesView.scrollToBottom();},_p2pTriggered:function ta(){ia(this,'',[],function(ua){this.focus();}.bind(this));this._messagesView&&this._messagesView.scrollToBottom();},_setTitleHref:function ta(ua){this._title&&this._title.setProps({href:ua});},_unblockSend:function ta(){if(!this._blocked||ka(this))return;this._blocked=false;ga(this);this._sheetController.closeUploadWarningTabSheet();},_logOpenTab:function ta(){new (c('AsyncSignal'))('/ajax/chat/opentab_tracking.php',{threadID:this._threadID,userID:this._getCanonicalUserID(),signatureID:this._signatureID}).send();},_setCustomColor:function ta(ua,va){if(!ua)return;if(va){c('Style').apply(ua,{color:va});}else if(ua.style)ua.style.color='';c('CSS').conditionClass(ua,"_1m34",!!va);},_isPageChat:function ta(){if(this._threadID){var ua=c('MercuryIDs').tokenize(this._threadID);if(ua.type==='user')return !c('FBID').isUser(ua.value);}return false;},_getPageID:function ta(){if(this._threadID){var ua=c('MercuryIDs').tokenize(this._threadID);if(ua.type==='user'&&!c('FBID').isUser(ua.value))return ua.value;}return null;},getCustomColor:function ta(){return this._customColor;},updateTitlebar:function ta(ua){if(!ua)return;this._customColor=c('convertMIGColorToFIGColor')(ua.custom_color);if(this._titlebar&&!ua.ephemeral_ttl_mode)this._setCustomColor(this._titlebar,this._customColor);if(this._title)this._title.setProps({thread:ua},function(){this._getNode('chatWrapper').setAttribute('aria-label',this._title.component.getTitle());}.bind(this));if(!ca)c('ReactDOM').render(c('React').createElement(c('MercuryThreadTitle.react'),{isNewThread:s.isNewEmptyLocalThread(this._threadID),thread:ua,useAndSeparator:true,useShortName:!ua.is_canonical,viewer:c('CurrentUser').getID()}),this._getNode('name'));this.updateTitlebarTooltip();}});function ra(ta,ua){da.debug('photo_uploader:'+ta,'{}');}function sa(ta,ua){if(!ua)return ta;var va=ua.getImageFiles();if(va.length>0){ta.image_ids=va;ta.has_attachment=true;}var wa=ua.getAnimatedImageFiles();if(wa.length>0){ta.gif_ids=wa;ta.has_attachment=true;}var xa=ua.getVideoFiles();if(xa.length>0){ta.video_ids=xa;ta.has_attachment=true;}var ya=ua.getAudioFiles();if(ya.length>0){ta.audio_ids=ya;ta.has_attachment=true;}var za=ua.getFiles();if(za.length>0){ta.file_ids=za;ta.has_attachment=true;}return ta;}f.exports=oa;}),null);
__d('FantaReducersDockCalculator',['Arbiter','FantaTabActions','FantaMessageActions','setImmediate'],(function a(b,c,d,e,f,g){'use strict';var h=c('FantaTabActions').Types,i=c('FantaMessageActions').Types,j=null;function k(n){j=n;c('setImmediate')(function(){c('Arbiter').inform('FantaReducersDockCalculator/shouldRecalculate');});}function l(n){if(!j||n.size!==j.size){k(n);}else{var o=false;n.forEach(function(p){var q=j&&j.get(p.id);if(!q||p.isMinimized!==q.isMinimized)o=true;});if(o)k(n);}}function m(n,o){var p=n.tabGroup.tabs;switch(o.type){case h.CLOSE_ALL_TABS:case h.CLOSE_AND_TAB_NEXT:case h.CLOSE_TAB:case h.MINIMIZE_ALL_TABS:case h.MINIMIZE_TAB:case h.OPEN_TAB:case h.UNMINIMIZE_TAB:k(p);break;case h.LOAD_FROM_DATA:case i.RECEIVED_NEW_MESSAGE:l(p);break;}return n;}f.exports={recalculateDock:m};}),null);
__d('FantaTypeTabContents',['immutable','MercuryMessageStore'],(function a(b,c,d,e,f,g){'use strict';var h,i,j={composerText:'',hasFetchedAll:false,id:'',isUploading:false,messages:c('immutable').List(),messageStore:null,openSheet:null,showContextBanner:false,signatureID:null,thread:null};h=babelHelpers.inherits(k,c('immutable').Record(j));i=h&&h.prototype;function k(){h.apply(this,arguments);}f.exports=k;}),null);
__d('FantaTypeMercuryState',['FantaTypeTabContents','immutable'],(function a(b,c,d,e,f,g){'use strict';var h,i,j={focusCallbacks:c('immutable').Map({}),blurCallbacks:c('immutable').Map({}),tabContents:c('immutable').Map({})};h=babelHelpers.inherits(k,c('immutable').Record(j));i=h&&h.prototype;function k(){h.apply(this,arguments);}f.exports=k;}),null);
__d('FantaTypeAppState',['FantaTypeMercuryState','FantaTypeTabGroup','immutable'],(function a(b,c,d,e,f,g){'use strict';var h,i,j={tabGroup:new (c('FantaTypeTabGroup'))(),mercury:new (c('FantaTypeMercuryState'))()};h=babelHelpers.inherits(k,c('immutable').Record(j));i=h&&h.prototype;function k(){h.apply(this,arguments);}f.exports=k;}),null);
__d('WorkFocusMode',['WorkModeConfig','WorkUserAvailabilityStatusType','emptyFunction','ifRequired'],(function a(b,c,d,e,f,g){'use strict';var h={},i={status:'AVAILABLE',end_date:0};if(c('WorkModeConfig').availability){i.status=c('WorkModeConfig').availability.status;i.end_date=c('WorkModeConfig').availability.end_date;}f.exports={updateAvailability:function j(k,l){k=Object.keys(c('WorkUserAvailabilityStatusType')).find(function(m){return c('WorkUserAvailabilityStatusType')[m]===k;});i.status=k;i.end_date=l;},currentViewerInFocusMode:function j(k){if(!c('WorkModeConfig').focus_messaging_enabled)return false;if(k){if(h[k])return false;var l=null;c('ifRequired')('MercuryThreads',function(n){l=n.get().getThreadMetaNow(k);},c('emptyFunction'));if(l&&l.bypass_focus_mode_until&&l.bypass_focus_mode_until>Date.now()/1000)return false;}var m=c('WorkUserAvailabilityStatusType')[i.status];if(m===c('WorkUserAvailabilityStatusType').FOCUS&&i.end_date*1000>Date.now())return true;return false;},addBypassFocusModeForThread:function j(k){h[k]=true;},removeBypassFocusModeForThread:function j(k){h[k]=false;}};}),null);
__d('FantaReducersMercury',['Arbiter','Bootloader','FantaTabActions','FantaTypeAppState','FantaTypeTabContents','JSLogger','MercuryIDs','MercuryThreadIDMap','WorkFocusMode','ifRequired','setImmediate'],(function a(b,c,d,e,f,g){'use strict';var h=c('MercuryThreadIDMap').get(),i=c('JSLogger').create('FantaReducersMercury'),j=c('FantaTabActions').Types;function k(){return Math.floor(Math.random()*2147483648).toString(16);}function l(aa,ba){switch(ba.type){case j.OPEN_TAB:var ca=ba.tabID;c('ifRequired')('FantaTabsApp',function(ea){if(!c('MercuryIDs').isValidThreadID(ca)){aa=aa.deleteIn(['tabGroup','tabs',ca]);o(ca);}else y(ca);},function(){c('ifRequired')('FantaTabsSlimApp',function(ea){if(!c('MercuryIDs').isValidThreadID(ba.tabID)){aa=aa.deleteIn(['tabGroup','tabs',ba.tabID]);o(ba.tabID);}else y(ba.tabID);},function(){y(ba.tabID);});});aa=m(aa,ca);var da=k();aa=aa.mergeIn(['mercury','tabContents',ca],{signatureID:da});c('Arbiter').inform('jewel/hide');return aa;}return aa;}function m(aa,ba){var ca=aa.mercury.tabContents.get(ba);if(!ca)return aa.setIn(['mercury','tabContents',ba],new (c('FantaTypeTabContents'))({id:ba}));return aa;}function n(aa,ba){switch(ba.type){case j.REPLACE_TAB:c('ifRequired')('FantaTabsApp',function(ca){if(!c('MercuryIDs').isValidThreadID(ba.newTabID)){aa=aa.deleteIn(['tabGroup','tabs',ba.newTabID]);o(ba.newTabID);}},function(){c('ifRequired')('FantaTabsSlimApp',function(ca){if(!c('MercuryIDs').isValidThreadID(ba.newTabID)){aa=aa.deleteIn(['tabGroup','tabs',ba.newTabID]);o(ba.newTabID);}});});aa=m(aa,ba.newTabID);return aa;}return aa;}function o(aa){h.getClientIDFromServerID(aa,function(ba){return c('setImmediate')(function(){if(c('MercuryIDs').isValidThreadID(ba)){c('FantaTabActions').openTab(ba);}else i.error('invalid id',aa);});});}function p(aa,ba){switch(ba.type){case j.MERCURY_REGISTER_TAB_FOCUS_DEPRECATED:aa=s(aa,ba);aa=t(aa,ba);var ca=aa.tabGroup.tabs.get(ba.tabID);if(ca&&ca.focusOnMountDEPRECATED)return r(aa,ba.tabID);}return aa;}function q(aa,ba){switch(ba.type){case j.FOCUS_TAB:return r(aa,ba.tabID);}return aa;}function r(aa,ba){var ca=aa.mercury.get('focusCallbacks'),da=aa.mercury.get('blurCallbacks'),ea=ca.get(ba);for(var fa=da.values(),ga=Array.isArray(fa),ha=0,fa=ga?fa:fa[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var ia;if(ga){if(ha>=fa.length)break;ia=fa[ha++];}else{ha=fa.next();if(ha.done)break;ia=ha.value;}var ja=ia;ja();}if(ea)ea();aa=aa.mergeIn(['tabGroup','tabs',ba],{focusOnMountDEPRECATED:false});return aa;}function s(aa,ba){var ca=ba.tabID,da=ba.focusCallback;return aa.setIn(['mercury','focusCallbacks',ca],da);}function t(aa,ba){var ca=ba.tabID,da=ba.blurCallback;return aa.setIn(['mercury','blurCallbacks',ca],da);}function u(aa,ba){switch(ba.type){case j.CLOSE_TAB:var ca=ba.tabID;c('ifRequired')('MessengerVideoAutoplayActions',function(da){da.deleteThread(ca);});c('WorkFocusMode')&&c('WorkFocusMode').removeBypassFocusModeForThread(ca);return aa.deleteIn(['mercury','focusCallbacks',ca]).deleteIn(['mercury','blurCallbacks',ca]);}return aa;}function v(aa,ba){switch(ba.type){case j.CLOSE_ALL_TABS:var ca=aa.mercury.get('focusCallbacks'),da=aa.mercury.get('blurCallbacks');c('ifRequired')('MessengerVideoAutoplayActions',function(ea){ea.deleteAllThreads();});return aa.setIn(['mercury','focusCallbacks'],ca.clear()).setIn(['mercury','blurCallbacks'],da.clear());}return aa;}function w(aa,ba){switch(ba.type){case j.FOCUS_NEXT_TAB:case j.FOCUS_PREVIOUS_TAB:case j.CLOSE_AND_TAB_NEXT:var ca=aa.tabGroup.focusedTabID;if(ca)r(aa,ca);}return aa;}function x(aa,ba){switch(ba.type){case j.CLOSE_AND_TAB_NEXT:var ca=ba.tabID;c('WorkFocusMode')&&c('WorkFocusMode').removeBypassFocusModeForThread(ca);}return aa;}function y(aa){if(!c('MercuryIDs').isValidThreadID(aa))return;c('Bootloader').loadModules(["GroupChatMessageBlockAlert","MercuryBlockedParticipants","MercuryThreadActions","MercuryThreads"],function(ba,ca,da,ea){var fa=da.get(),ga=ea.get(),ha=ca.get();ga.getThreadMeta(aa,function(ia){if(ha.isPresentInGroupThread(ia))ba.show(ha.inGroupThread(ia),function(){c('FantaTabActions').focusTab(aa);},function(){c('FantaTabActions').closeTab(aa);fa.leaveGroup(aa);});});},'FantaReducersMercury');}function z(aa,ba){switch(ba.type){case j.LOAD_FROM_DATA:for(var ca=aa.tabGroup.tabs.keys(),da=Array.isArray(ca),ea=0,ca=da?ca:ca[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var fa;if(da){if(ea>=ca.length)break;fa=ca[ea++];}else{ea=ca.next();if(ea.done)break;fa=ea.value;}var ga=fa;aa=m(aa,ga);}}return aa;}f.exports={closeAllTabs:v,closeAndTabNext:x,closeTab:u,focusTab:q,focusTabEvents:w,loadFromData:z,openTab:l,registerTabFocusDeprecated:p,replaceTab:n};}),null);
__d('FantaReducersMessages',['ChatMentionsNotifications','FantaMessageActions','FantaTabActions','FantaTypeAppState','MercuryBrowserAlerts','MercuryConfig'],(function a(b,c,d,e,f,g){'use strict';var h=c('FantaMessageActions').Types,i=c('FantaTabActions').Types;function j(n,o){switch(o.type){case h.RECEIVED_NEW_MESSAGE:var p=o.message;if(c('MercuryConfig').DesktopNotificationsGK)c('ChatMentionsNotifications').notifyIfMessageToMe(p);c('MercuryBrowserAlerts').messageReceived(p);return n;}return n;}function k(n,o){switch(o.type){case h.COMPOSER_TEXT_UPDATE:var p=o.message,q=o.threadID;return n.mergeIn(['mercury','tabContents',q],{composerText:p});}return n;}function l(n,o){switch(o.type){case i.CLOSE_TAB:return n.mergeIn(['mercury','tabContents',o.tabID],{composerText:''});}return n;}function m(n,o){switch(o.type){case i.CLOSE_ALL_TABS:var p=n.mercury.tabContents;p.forEach(function(q){var r=q.id;n=n.setIn(['mercury','tabContents',r],q.set('composerText',''));});return n;}return n;}f.exports={closeAllTabs:m,closeTab:l,composerTextUpdate:k,receivedNewMessage:j};}),null);
__d('FantaTabSheetActions',['FantaDispatcher','keyMirror'],(function a(b,c,d,e,f,g){'use strict';var h=c('keyMirror')({CLOSE_NAME_CONVERSATION_TAB_SHEET:null,CLOSE_OFFLINE_TAB_SHEET:null,CLOSE_READ_ONLY_PERMANENT_SHEET:null,CLOSE_READ_ONLY_SHEET:null,CLOSE_THREAD_IS_MUTED_TAB_SHEET:null,OPEN_NAME_CONVERSATION_TAB_SHEET:null,OPEN_OFFLINE_TAB_SHEET:null,OPEN_READ_ONLY_PERMANENT_SHEET:null,OPEN_READ_ONLY_SHEET:null,OPEN_THREAD_IS_MUTED_TAB_SHEET:null}),i={Types:h,openThreadIsMutedTabSheet:function j(k){c('FantaDispatcher').dispatch({type:h.OPEN_THREAD_IS_MUTED_TAB_SHEET,tabID:k});},closeThreadIsMutedTabSheet:function j(k){c('FantaDispatcher').dispatch({type:h.CLOSE_THREAD_IS_MUTED_TAB_SHEET,tabID:k});},openNameConversationSheet:function j(k){c('FantaDispatcher').dispatch({type:h.OPEN_NAME_CONVERSATION_TAB_SHEET,tabID:k});},closeNameConversationSheet:function j(k){c('FantaDispatcher').dispatch({type:h.CLOSE_NAME_CONVERSATION_TAB_SHEET,tabID:k});},openOfflineSheet:function j(k){c('FantaDispatcher').dispatch({type:h.OPEN_OFFLINE_TAB_SHEET,tabID:k});},closeOfflineSheet:function j(k){c('FantaDispatcher').dispatch({type:h.CLOSE_OFFLINE_TAB_SHEET,tabID:k});},openReadOnlySheet:function j(k){c('FantaDispatcher').dispatch({type:h.OPEN_READ_ONLY_SHEET,tabID:k});},closeReadOnlySheet:function j(k){c('FantaDispatcher').dispatch({type:h.CLOSE_READ_ONLY_SHEET,tabID:k});},openReadOnlyPermanentSheet:function j(k){c('FantaDispatcher').dispatch({type:h.OPEN_READ_ONLY_PERMANENT_SHEET,tabID:k});},closeReadOnlyPermanentSheet:function j(k){c('FantaDispatcher').dispatch({type:h.CLOSE_READ_ONLY_PERMANENT_SHEET,tabID:k});}};f.exports=i;}),null);
__d('FantaReducersTabSheets',['FantaTabActions','FantaTabSheetActions','FantaTypeAppState','MercurySheetPolicy'],(function a(b,c,d,e,f,g){'use strict';var h=c('FantaTabActions').Types,i=c('FantaTabSheetActions').Types;function j(ka,la){switch(la.type){case h.CLOSE_TAB:var ma=la.tabID;return k(ka,ma);}return ka;}function k(ka,la,ma){var na=ka.mercury.tabContents.get(la);if(!na)return ka;if(ma&&na.openSheet!==ma)return ka;return ka.mergeIn(['mercury','tabContents',la],{openSheet:null});}function l(ka,la){switch(la.type){case h.CLOSE_ALL_TABS:for(var ma=ka.mercury.tabContents.keys(),na=Array.isArray(ma),oa=0,ma=na?ma:ma[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var pa;if(na){if(oa>=ma.length)break;pa=ma[oa++];}else{oa=ma.next();if(oa.done)break;pa=oa.value;}var qa=pa;ka=k(ka,qa);}}return ka;}function m(ka,la,ma){var na=ka.mercury.tabContents.get(la),oa=ka.tabGroup.tabs.get(la);if(!oa)return ka;var pa=na.openSheet;if(pa&&!c('MercurySheetPolicy').canReplaceOpenSheet(pa,ma))return ka;ka=ka.mergeIn(['mercury','tabContents',la],{openSheet:ma});return ka;}function n(ka,la){return ka;}function o(ka,la){return ka;}function p(ka,la){return ka;}function q(ka,la){return ka;}function r(ka,la){return ka;}function s(ka,la){return ka;}function t(ka,la){switch(la.type){case i.OPEN_NAME_CONVERSATION_TAB_SHEET:return m(ka,la.tabID,c('MercurySheetPolicy').sheets.ChatNameConversationTabSheet);}return ka;}function u(ka,la){switch(la.type){case i.CLOSE_NAME_CONVERSATION_TAB_SHEET:return k(ka,la.tabID,c('MercurySheetPolicy').sheets.ChatNameConversationTabSheet);}return ka;}function v(ka,la){return ka;}function w(ka,la){return ka;}function x(ka,la){switch(la.type){case i.OPEN_OFFLINE_TAB_SHEET:return m(ka,la.tabID,c('MercurySheetPolicy').sheets.ChatOfflineTabSheet);}return ka;}function y(ka,la){switch(la.type){case i.CLOSE_OFFLINE_TAB_SHEET:return k(ka,la.tabID,c('MercurySheetPolicy').sheets.ChatOfflineTabSheet);}return ka;}function z(ka,la){switch(la.type){case i.OPEN_READ_ONLY_PERMANENT_SHEET:return m(ka,la.tabID,c('MercurySheetPolicy').sheets.ChatReadOnlyPermanentTabSheet);}return ka;}function aa(ka,la){switch(la.type){case i.CLOSE_READ_ONLY_PERMANENT_SHEET:return k(ka,la.tabID,c('MercurySheetPolicy').sheets.ChatReadOnlyPermanentTabSheet);}return ka;}function ba(ka,la){switch(la.type){case i.OPEN_READ_ONLY_SHEET:return m(ka,la.tabID,c('MercurySheetPolicy').sheets.ChatReadOnlyTabSheet);}return ka;}function ca(ka,la){switch(la.type){case i.CLOSE_READ_ONLY_SHEET:return k(ka,la.tabID,c('MercurySheetPolicy').sheets.ChatReadOnlyTabSheet);}return ka;}function da(ka,la){switch(la.type){case i.OPEN_THREAD_IS_MUTED_TAB_SHEET:return m(ka,la.tabID,c('MercurySheetPolicy').sheets.ChatThreadIsMutedTabSheet);}return ka;}function ea(ka,la){switch(la.type){case i.CLOSE_THREAD_IS_MUTED_TAB_SHEET:return k(ka,la.tabID,c('MercurySheetPolicy').sheets.ChatThreadIsMutedTabSheet);}return ka;}function fa(ka,la){return ka;}function ga(ka,la){return ka;}function ha(ka,la){return ka;}function ia(ka,la){return ka;}function ja(ka,la){return ka;}f.exports={closeAllTabs:l,closeNameConversationSheet:u,closeOfflineSheet:y,closePermanentReadOnlySheet:aa,closeReadOnlySheet:ca,closeTab:j,closeThreadIsMutedTabSheet:ea,openAddFriendsSheet:n,openAppointmentBannerSheet:o,openBypassFocusSheet:p,openEmployeeAwaySheet:q,openMessageBlockedTabSheet:r,openMontageSheet:s,openNameConversationSheet:t,openNewMessagesSheet:v,openNoRecipientsSheet:w,openOfflineSheet:x,openPermanentReadOnlySheet:z,openReadOnlySheet:ba,openThreadIsMutedTabSheet:da,openUploadWarningTabSheet:fa,openUserBlockedSheet:ga,openUserFocusSheet:ha,openUserIsPersonalUserSheet:ia,openUserTimezoneSheet:ja};}),null);
__d('FantaReducersTabs',['FantaConst','FantaTabActions','FantaMessageActions','FantaTypeAppState','FantaTypeTab','FantaTypeTabGroup','URI','isWebMessengerURI'],(function a(b,c,d,e,f,g){'use strict';var h=c('FantaTabActions').Types,i=c('FantaMessageActions').Types,j='tab_',k=1,l=1,m=1;function n(ka,la){switch(la.type){case h.OPEN_TAB:ka=u(ka);return v(ka,la.tabID||j+m++,true);}return ka;}function o(ka,la){switch(la.type){case h.REPLACE_TAB:var ma=la.tabID,na=la.newTabID;ka=u(ka);var oa=ka.tabGroup,pa=oa.tabs,qa=pa.get(ma);if(qa)ka=ka.setIn(['tabGroup','tabs',na],qa.merge({id:na})).deleteIn(['tabGroup','tabs',ma]);return v(ka,na);}return ka;}function p(ka,la){switch(la.type){case h.MINIMIZE_TAB:ka=u(ka);return w(ka,la.tabID,true);}return ka;}function q(ka,la){switch(la.type){case h.UNMINIMIZE_TAB:ka=u(ka);return w(ka,la.tabID,false);}return ka;}function r(ka,la){switch(la.type){case h.FOCUS_TAB:ka=u(ka);return ca(ka,la.tabID);}return ka;}function s(ka,la){switch(la.type){case h.BLUR_TAB:ka=u(ka);return da(ka,la.tabID);}return ka;}function t(ka,la){switch(la.type){case i.RECEIVED_NEW_MESSAGE:var ma=la.tabID,na=ka.tabGroup.tabs.get(ma);ka=u(ka);if(!na){var oa=ka.tabGroup.focusedTabID;ka=v(ka,ma,false);var pa=c('URI').getNextURI();if(c('isWebMessengerURI')(pa)){return ka=w(ka,ma,true);}else if(oa)return ca(ka,oa);}}return ka;}function u(ka){return ka.mergeIn(['tabGroup'],{updatedTime:Date.now()});}function v(ka,la,ma){var na=ka.tabGroup,oa=na.tabs,pa=oa.get(la);if(!pa){pa=new (c('FantaTypeTab'))({id:la,focusCounter:k,openCounter:l++,focusOnMountDEPRECATED:ma});ka=ka.setIn(['tabGroup','tabs',la],pa);}else if(pa.isMinimized&&ma)ka=w(ka,la,false);if(ma)return ca(ka,la);return ka;}function w(ka,la,ma){var na=ka.tabGroup,oa=na.tabs.get(la);if(oa)ka=ka.mergeIn(['tabGroup','tabs',la],{isMinimized:ma});return ka;}function x(ka,la){switch(la.type){case h.MINIMIZE_ALL_TABS:ka=u(ka);for(var ma=ka.tabGroup.tabs.keys(),na=Array.isArray(ma),oa=0,ma=na?ma:ma[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var pa;if(na){if(oa>=ma.length)break;pa=ma[oa++];}else{oa=ma.next();if(oa.done)break;pa=oa.value;}var qa=pa;ka=w(ka,qa,true);}return ka;}return ka;}function y(ka,la){switch(la.type){case h.CLOSE_TAB:var ma=la.tabID;ka=u(ka);return z(ka,ma);}return ka;}function z(ka,la){ka=da(ka,la);return ka.deleteIn(['tabGroup','tabs',la]);}function aa(ka,la){switch(la.type){case h.CLOSE_ALL_TABS:ka=u(ka);ka=da(ka,ka.tabGroup.focusedTabID);return ka.setIn(['tabGroup','tabs'],ka.tabGroup.tabs.clear());}return ka;}function ba(ka,la){switch(la.type){case h.CLOSE_AND_TAB_NEXT:ka=u(ka);ka=z(ka,la.tabID);return ia(ka);}return ka;}function ca(ka,la){var ma=ka.tabGroup,na=ma.tabs.get(la);if(na)ka=ka.mergeIn(['tabGroup','tabs',la],{focusCounter:k++});ka=ka.mergeIn(['tabGroup'],{focusedTabID:la});return ka;}function da(ka,la){if(ka.tabGroup.focusedTabID===la)return ka.mergeIn(['tabGroup'],{focusedTabID:null});return ka;}function ea(ka,la){switch(la.type){case h.SET_ALLOWED_RAISED_TABS:return fa(ka,la.allowedRaisedTabs);}return ka;}function fa(ka){var la=arguments.length<=1||arguments[1]===undefined?c('FantaConst').DEFAULT_ALLOWED_RAISED_TABS:arguments[1];if(la===ka.tabGroup.allowedRaisedTabs)return ka;return ka.mergeIn(['tabGroup'],{allowedRaisedTabs:Math.max(1,la)});}function ga(ka,la){switch(la.type){case h.LOAD_FROM_DATA:var ma=ka.tabGroup,na=la.tabData;if(ma.updatedTime>=na.updatedTime||na.updatedTime===undefined)return ka;ka=fa(ka.set('tabGroup',new (c('FantaTypeTabGroup'))()),ma.allowedRaisedTabs);na.tabs.sort(function(oa,pa){return oa.openCounter-pa.openCounter;}).forEach(function(oa){ka=v(ka,oa.id,false);if(oa.isMinimized)ka=w(ka,oa.id,oa.isMinimized);});na.tabs.sort(function(oa,pa){return oa.focusCounter-pa.focusCounter;}).forEach(function(oa){ka=ca(ka,oa.id,true);});ka=na.focusedTabID?ca(ka,na.focusedTabID,true):da(ka);return ka.mergeIn(['tabGroup'],{updatedTime:na.updatedTime});}return ka;}function ha(ka,la){switch(la.type){case h.FOCUS_NEXT_TAB:ka=u(ka);return ia(ka,la.event);}return ka;}function ia(ka,event){var la=ka.tabGroup.focusedTabID,ma=ka.tabGroup.getRaisedandUnraisedTabs(),na=ma.raisedTabs,oa=na.count();if(oa===0){return ka;}else if(na.count()===1)return ca(ka,na.first().id);if(event)event.preventDefault();var pa=na.skipUntil(function(qa){return qa.id===la;}).rest();if(pa.count()===0){return ca(ka,na.first().id);}else return ca(ka,pa.first().id);}function ja(ka,la){switch(la.type){case h.FOCUS_PREVIOUS_TAB:var ma=ka.tabGroup.focusedTabID,na=ka.tabGroup.getRaisedandUnraisedTabs(),oa=na.raisedTabs;if(oa.count()<2)return ka;var event=la.event;if(event)event.preventDefault();ka=u(ka);var pa=oa.reverse().skipUntil(function(qa){return qa.id===ma;}).rest();if(pa.count()===0){return ca(ka,oa.last().id);}else return ca(ka,pa.first().id);}return ka;}f.exports={blurTab:s,closeAllTabs:aa,closeAndTabNext:ba,closeTab:y,focusNextTab:ha,focusPreviousTab:ja,focusTab:r,loadFromData:ga,minimizAllTabs:x,minimizeTab:p,openTab:n,receivedNewMessage:t,replaceTab:o,setAllowedRaisedTabs:ea,unminimizeTab:q};}),null);
__d('FantaAppStore',['FantaDispatcher','FantaReducersDockCalculator','FantaReducersMercury','FantaReducersMessages','FantaReducersTabs','FantaReducersTabSheets','FantaTypeAppState','FluxReduceStore'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=[].concat(Object.values(c('FantaReducersTabs')),Object.values(c('FantaReducersMercury')),Object.values(c('FantaReducersTabSheets')),Object.values(c('FantaReducersMessages')),Object.values(c('FantaReducersDockCalculator')));h=babelHelpers.inherits(k,c('FluxReduceStore'));i=h&&h.prototype;k.prototype.getInitialState=function(){return new (c('FantaTypeAppState'))();};k.prototype.ignoreReducer=function(l){var m;};k.prototype.addReducers=function(l){j=j.concat(Object.values(l));};k.prototype.reduce=function(l,m){return j.reduce(function(n,o){return o(n,m);},l);};function k(){h.apply(this,arguments);}f.exports=new k(c('FantaDispatcher'));}),null);
__d('FantaMercuryTabBody.react',['Bootloader','FantaTabActions','FantaTypeTab','FantaTypeTabContents','React','ReactDOM','setImmediate'],(function a(b,c,d,e,f,g){'use strict';var h,i;h=babelHelpers.inherits(j,c('React').Component);i=h&&h.prototype;j.prototype.componentDidMount=function(){var k=this.props,l=k.isLastTab,m=k.tab,n=k.tabContent,o='',p=n&&n.signatureID,q=c('ReactDOM').findDOMNode(this.refs.root),r=m.id,s=m.focusOnMountDEPRECATED;c('Bootloader').loadModules(["ChatTabView"],function(t){this.$FantaMercuryTabBody1=new t(r,o,p,q,null,l);this.$FantaMercuryTabBody1.setVisibleState(true,!m.isMinimized);c('setImmediate')(function(){c('FantaTabActions').registerTabFocusDeprecated(r,function(){return this.$FantaMercuryTabBody1.focusTab();}.bind(this),function(){return this.$FantaMercuryTabBody1.blurTab();}.bind(this),s);}.bind(this));}.bind(this),'FantaMercuryTabBody.react');};j.prototype.componentWillReceiveProps=function(k){var l=k.isLastTab;if(this.$FantaMercuryTabBody1)this.$FantaMercuryTabBody1.updateIsLastTab(l);};j.prototype.render=function(){return c('React').createElement('div',{ref:'root'});};j.prototype.componentWillUnmount=function(){if(this.$FantaMercuryTabBody1)this.$FantaMercuryTabBody1.destroy();};function j(){h.apply(this,arguments);}f.exports=j;}),null);
__d('FantaMercuryTabOverflowBootloader.react',['BootloadOnRender.react','FantaTypeTab','immutable','JSResource','LazyComponent.react','React'],(function a(b,c,d,e,f,g){'use strict';var h,i;h=babelHelpers.inherits(j,c('React').Component);i=h&&h.prototype;j.prototype.render=function(){return (c('React').createElement(c('BootloadOnRender.react'),{component:c('React').createElement(c('LazyComponent.react'),{items:this.props.items}),loader:c('JSResource')('FantaMercuryTabOverflow.react').__setRef('FantaMercuryTabOverflowBootloader.react'),placeholder:c('React').createElement('div',null)}));};function j(){h.apply(this,arguments);}f.exports=j;}),null);
__d('FantaTab.react',['cx','FantaTypeTab','FantaTypeTabContents','React'],(function a(b,c,d,e,f,g,h){'use strict';var i,j;i=babelHelpers.inherits(k,c('React').Component);j=i&&i.prototype;k.prototype.render=function(){var l=this.props,m=l.MainComponent,n=l.MinimizedComponent,o=l.isFocused,p=l.isLastTab,q=l.isLastTabOfType,r=l.tab,s=l.tabContent,t=r.isMinimized?n:m,u=r.id+(r.isMinimized?'-minimized':'-maximized');return (c('React').createElement('div',{className:"_5qi9"+(' '+"_5qib")+(this.props.isFocused?' '+"_5qic":'')+(r.isMinimized?' '+"_3001":'')},c('React').createElement(t,{key:u,tab:r,tabContent:s,isFocused:o,isLastTab:p,isLastTabOfType:q})));};function k(){i.apply(this,arguments);}f.exports=k;}),null);
__d('FantaTabGroup.react',['cx','FantaTab.react','FantaTypeTab','FantaTypeTabContents','FantaTypeTabGroup','immutable','React'],(function a(b,c,d,e,f,g,h){'use strict';var i,j,k=c('immutable').OrderedMap;i=babelHelpers.inherits(l,c('React').Component);j=i&&i.prototype;l.prototype.shouldComponentUpdate=function(m){return !this.props.tabGroup.equals(m.tabGroup);};l.prototype.render=function(){var m=this.props,n=m.isLastOfTypeChecker,o=m.MainComponent,p=m.MinimizedComponent,q=m.OverflowComponent,r=m.tabContents,s=m.tabGroup,t=s.focusedTabID,u=s.getRaisedandUnraisedTabs(),v=u.raisedTabs,w=u.unraisedTabs,x=void 0;if(n)x=v.findLastKey(function(y){return n(y)&&y.id;});return (c('React').createElement('div',{className:"_59v1"},this.$FantaTabGroup1(w,q),v.map(function(y){return (c('React').createElement(c('FantaTab.react'),{key:y.id,tab:y,isFocused:y.id===t,isLastTab:y===v.last(),isLastTabOfType:y.id===x,MainComponent:o,MinimizedComponent:p,tabContent:r&&r.get(y.id)}));}).toArray()));};l.prototype.$FantaTabGroup1=function(m,n){if(!m.isEmpty())return (c('React').createElement('div',{className:"_1kws"},c('React').createElement(n,{items:m})));return null;};function l(){i.apply(this,arguments);}f.exports=l;}),null);
__d('FantaMercuryTabs.react',['FantaAppStore','FantaCookieUtil','FantaMercuryTabBody.react','FantaMercuryTabOverflowBootloader.react','FantaTabActions','FantaTabGroup.react','FantaTypeTabContents','FantaTypeTabGroup','FluxContainer','PresenceState','React'],(function a(b,c,d,e,f,g){'use strict';var h,i;h=babelHelpers.inherits(j,c('React').Component);i=h&&h.prototype;j.getStores=function(){return [c('FantaAppStore')];};j.calculateState=function(){return {tabContents:c('FantaAppStore').getState().mercury.tabContents,tabGroup:c('FantaAppStore').getState().tabGroup};};j.prototype.componentWillMount=function(){if(this.props.loadDataOnMount)c('FantaTabActions').loadFromData(c('FantaCookieUtil').convertCookieData(c('PresenceState').get()));};j.prototype.render=function(){return (c('React').createElement(c('FantaTabGroup.react'),{MainComponent:c('FantaMercuryTabBody.react'),MinimizedComponent:c('FantaMercuryTabBody.react'),OverflowComponent:c('FantaMercuryTabOverflowBootloader.react'),tabContents:this.state.tabContents,tabGroup:this.state.tabGroup}));};function j(){h.apply(this,arguments);}f.exports=c('FluxContainer').create(j);}),null);
__d('FantaTabsApp',['BootloadOnRender.react','ChatPerfInstrumentation','FantaMercuryTabs.react','FantaTabsAppBase','JSResource','LazyComponent.react','MercuryConfig','React','ReactDOM'],(function a(b,c,d,e,f,g){'use strict';var h,i;h=babelHelpers.inherits(j,c('FantaTabsAppBase'));i=h&&h.prototype;j.prototype.initializeFantaData=function(k){e(['FantaAppStore','FantaCookieUtil','FantaTabActions','MercuryServerPayloadPreprocessor','PresenceState'],function(l,m,n,o,p){n.loadFromData(m.convertCookieData(p.get()));p.registerStateLoader(function(q){return n.loadFromData(m.convertCookieData(q,l.getState().tabGroup));});p.registerStateStorer(function(q){return m.createCookieData(l.getState().tabGroup,q);});l.addListener(function(){return p.doSync();});o.get().handleUpdate(k);c('ChatPerfInstrumentation').logInitData();});};j.prototype.initializeFantaUI=function(){e(['FantaAppStore','FantaMercuryThreadEventsBootloaded','FantaMessageActions','FantaTabActions','FantaTabViewportManager','FBRTCMessageHandler','MercuryBrowserAlerts'],function(k,l,m,n,o,p,q){p.init();q.init();c('ReactDOM').render(this.getViewComponent(),this.tabsElem);l.onMessagesReceived(function(s,t){m.receivedNewMessage(s,t);});o.init(this.tabsElem);c('ChatPerfInstrumentation').logInitUI();var r=k.getState().tabGroup.tabs;if(r.toArray().length===0)c('ChatPerfInstrumentation').logDisplayDone();}.bind(this));};j.prototype.getViewComponent=function(){if(c('MercuryConfig').FantaTabView)return (c('React').createElement(c('BootloadOnRender.react'),{component:c('React').createElement(c('LazyComponent.react'),null),loadDataOnMount:false,loader:c('JSResource')('FantaMercuryTabsWithMain.react').__setRef('FantaTabsApp'),placeholder:c('React').createElement('div',null)}));return c('React').createElement(c('FantaMercuryTabs.react'),{loadDataOnMount:false});};function j(){h.apply(this,arguments);}f.exports=new j();}),null);