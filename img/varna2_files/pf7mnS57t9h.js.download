if (self.CavalryLogger) { CavalryLogger.start_js(["WZnDb"]); }

__d("CollabCallMessengerBrowserEventEnum",[],(function a(b,c,d,e,f,g){f.exports={CALL_START_TRY:"call: try",CALL_PROCESS_STARTED:"call: start process",CALL_CONNECTED:"call: connected",CALL_ENDED:"call: ended",CONNECTION_INFO:"connection info",TURN_CREDENTIALS_RECEIVED:"TURN credentials received",HANGUP_CALL_ID_MISSMATCH:"hangup callID missmatch",OFFER_ACCEPTED:"offer accepted",OFFER_IGNORED:"offer ignored",RENEGOTIATION:"offer renegotiation",LOCAL_STREAM_SET:"local stream: set",LOCAL_STREAM_READY:"local stream: ready",LOCAL_STREAM_STARTED:"local stream: started",LOCAL_STREAM_TRACKS_CHANGED:"local stream: tracks changed",SCREEN_SHARING_TOGGLED:"screen sharing toggled",REMOTE_STREAM_SET:"remote stream: set",REMOTE_STREAM_STARTED:"remote stream: started",REMOTE_STREAM_TRACKS_CHANGED:"remote stream: tracks changed",REMOTE_STREAM_ADDED:"remote stream: added",REMOTE_STREAM_MUTE_TOGGLED:"remote steam: mute toggled",REMOTE_STREAM_REMOVED:"remote stream: removed",FAIL_BROWSER_NOT_SUPPORTED:"browser not supported",CALL_CONTROLLER_INIT:"call controller init",REQUEST_USER_MEDIA:"request user media",USER_SETTINGS_CHANGED:"user settings change",RTC_ERROR:"RTC error",MESSAGE_SENT:"message sent",MESSAGE_RECEIVED:"message received",SDP_UPDATE:"SDP update"};}),null);
__d("FBRTCCallConstants",[],(function a(b,c,d,e,f,g){f.exports={FBRTCCallConnectionType:{MISSED_CALL:4,CONNECTED_CALL:5},FBRTCCallType:{VOICE_CALL:1,VIDEO_CALL:2}};}),null);
__d("LinkshimCallsites",[],(function a(b,c,d,e,f,g){f.exports={INTERNAL_WIKI:1,MZERO_UPSELL:2,EVENTS_TICKET:3,UNIT_TEST:4,WEB_RESULT:5,OG_COMMENT_NOTIF:6,M_DATA_UPSELL:7,FBURL:8,M_URI:9,THIRD_PARTY_URL:10,UI_LINK:11,LANDING_CAMPAIGN:12,STREAM_CONTENT_TICKER:13,SOCIAL_WIFI_DEPRECATED:14,TIMELINE_APP_COLLECTION:15,SAVED_LATER_VIEW_ITEM:16,REQUESTS_CONTROLLER:17,LOGIN_BUTTON:18,COMMENT_PLUGIN_REDIRECT_ENTAPP:19,COMMENT_PLUGIN_REDIRECT_APPOWNED:20,M_DEEPLINK:21,M_DEEPLINK_INVALID:22,EVENT_BUY_TICKET:23,PAGE_TYPEAHEAD:24,EGO_ACTION:25,INTERN_SURVEY:26,RETIRED_ENDPOINT:27,OG_COMMENT_FEEDBACK_TARGET:28,LIKE_COMMON_RENDERER:29,NOTIFICATIONS_LINK:30,COUPON_OFFSITE_LINK:31,MZERO_MAILTO:32,MZERO:33,MERCURY_SHARE_ATTACHMENT:34,EXTERNAL_TOKEN_SURVEY:35,FBURL_INTERN:36,LANDING_PAGE_EXPERIMENT:37,OG_FEEDBACK_TARGET:38,GAMEDAY:39,ENTISH:40,JS_ENV:41,LINKSHIM_AUTOMATION:42,HEADER_FLUSHER:43,PLUGIN_HEADER_FLUSHER:44,TASKS_APP:45,FEEDBACK_MODEL:46,JP_EMAIL_LINK:47,NOTIFICATION_REWRITE:48,OG_ACTION_PERMALINK:49,MALWARE_SCAN:50,EMAIL_LINK:51,EMAIL_ATTACHMENT:52,RENDER_EMAIL_LEGACY:53,TAGGED_WITH_STORY_EMAIL_NOTIF:54,MSG_INTRO_NOTIF:55,GROUP_COMMENT_NOTIF:56,EVENT_INVITE_LOCATION_EMAIL:57,EVENT_INVITE_MESSAGE_EMAIL:58,CLOSE_FRIEND_ACTIVITY:59,GROUP_DOC_CREATED_URL:60,GROUP_DOC_CREATED_NAME:61,MALL_POST_EMAIL_NOTIF:62,MALL_POST_SOCIAL_MSG:63,NOTIFICATION_REWRITE_RSS:64,WALL_POST_SOCIAL_MSG:65,TITAN_MSG_BODY_EMAIL:66,TITAN_MSG_BODY_SUBJECT:67,GROUP_POST_EMAIL:68,GROUP_POST_URL_EMAIL:69,GROUP_POST_PERMALINK_EMAIL:70,GROUP_POST_OPTOUT_EMAIL:71,GROUP_POST_TEXT_NOTIF:72,CLOSE_FRIEND_EMAIL_SHARE:73,PLACE_TAGGED_IN_CHECKIN:74,QUESTIONS_ANSWER_EMAIL:75,SUPPORT_TASK_COMMENT:76,INVITE_MESSAGE_EMAIL:77,GROUP_REQUEST_TO_JOIN_EMAIL:78,GROUP_POST_COMMENT_PERMALINK:79,GROUP_POST_COMMENT_OPTOUT:80,GROUP_POST_COMMENT_TEXT:81,EVENT_NAME_CHANGE_NOTIF:82,EVENT_NAME_CHANGE_OLD_NAME_NOTIF:83,EVENT_NAME_CHANGE_NEW_NAME_NOTIF:84,EVENT_CANCEL_NOTIFICATION:85,BASE_COMMENT_NOTIF:86,FBPAGE_FAN_INVITE_NAME:87,FBPAGE_FAN_INVITE_MSG:88,MESSAGING_HTML_EMAIL:89,ROLLOUT_TEXT_EMAIL:90,COMMENT_EMAIL_TEXT:91,SHARE_CONTENT_LEGACY_EMAIL:92,MZERO_UPSELL_NOTIF:93,INTERN_DEBUG:94,CALL_TO_ACTION:95,QUICK_PROMOTION_ACTION:96,COMPOSED_TEXT:97,GIF_SEARCH:98,OFFERS:99,MZERO_ATTACHMENTS:100,MZERO_UPLOADS:101,CCTA_LINK:102,M_CCTA_LINK:103,SAVED_ITEM_REDIRECT:104,ADS_PROMOTED_OBJECT:105,EMBEDS_MTOUCH_SELECT:106,IORG_BOOKMARK:107,PAYPAL_INIT:108,FUNDRAISER_NOTIF:109,COMMENTS_PLUGIN_NOTIF:110,INSTANT_SHOPPING_ACTION:111,LINK_MENU:112,TALENT_SEARCH:113,COMET:114,INTERVIEW_STATS:115,SCHEDULR:116,BULK_SCHEDULR:117,CIRCA_LINK:118,MZERO_CHANGE_DESTINATION:119,LINK_REACT:120,LYNX_EXTRA_REDIRECT:121,UI_LINK_EXPERIMENTAL:122,COORD_DASHBOARD:123,WHITEHAT:124,INSTAGRAM_PROFILE_URL:125,INSTAGRAM_DIRECT_MESSAGE:126,SNAPTU:127,RHC_CLICK_TRACKING:128,NOTIFICATIONS_TARGET:129,INSTANT_WORKFLOWS_PAYMENT_RECEIPT:130,INTEGRITY_CRAWLER:131,KILL_LINKSHIM_SECURE_REDIRECT:132,INSTAGRAM_STORY_URL:133,INSTAGRAM_LINKSHIM_URL:134};}),null);
__d("RTCCallActionTypes",[],(function a(b,c,d,e,f,g){f.exports={REMOTE_VIDEO_UNMUTED:"REMOTE_VIDEO_UNMUTED",REMOTE_VIDEO_MUTED:"REMOTE_VIDEO_MUTED"};}),null);
__d("RTCGroupCallActionTypes",[],(function a(b,c,d,e,f,g){f.exports={CALL:"CALL",CALL_SUCCESS:"CALL_SUCCESS",CALL_ERROR:"CALL_ERROR",INIT:"INIT",WAIT_FOR_USER_INPUT:"WAIT_FOR_USER_INPUT",JOIN:"JOIN",JOIN_SUCCESS:"JOIN_SUCCESS",JOIN_ERROR:"JOIN_ERROR",HANGUP:"HANGUP",HANGUP_SUCCESS:"HANGUP_SUCCESS",HANGUP_ERROR:"HANGUP_ERROR",ADD_PARTICIPANTS:"ADD_PARTICIPANTS",ON_CONFERENCE_STATE:"ON_CONFERENCE_STATE",DISMISS:"DISMISS",END_CALL:"END_CALL",ON_JOIN_RESPONSE:"ON_JOIN_RESPONSE",ON_CLIENT_MEDIA_UPDATE_RESPONSE:"ON_CLIENT_MEDIA_UPDATE_RESPONSE",INIT_LOCAL_USER:"INIT_LOCAL_USER",INIT_REMOTE_USERS:"INIT_REMOTE_USERS",ADD_REMOTE_STREAM:"ADD_REMOTE_STREAM",REMOVE_REMOTE_STREAM:"REMOVE_REMOTE_STREAM",REMOVE_ALL_REMOTE_STREAMS:"REMOVE_ALL_REMOTE_STREAMS",ADD_REMOTE_TRACK:"ADD_REMOTE_TRACK",REMOVE_REMOTE_TRACK:"REMOVE_REMOTE_TRACK",AUDIO_MUTED:"AUDIO_MUTED",AUDIO_UNMUTED:"AUDIO_UNMUTED",VIDEO_MUTED:"VIDEO_MUTED",VIDEO_UNMUTED:"VIDEO_UNMUTED",SELF_VIEW_COLLAPSED:"SELF_VIEW_COLLAPSED",SELF_VIEW_UNCOLLAPSED:"SELF_VIEW_UNCOLLAPSED",ADD_LOCAL_STREAM:"ADD_LOCAL_STREAM",REMOVE_LOCAL_STREAM:"REMOVE_LOCAL_STREAM",REMOVE_ALL_LOCAL_STREAMS:"REMOVE_ALL_LOCAL_STREAMS",ADD_LOCAL_SCREEN_STREAM:"ADD_LOCAL_SCREEN_STREAM",REMOVE_LOCAL_SCREEN_STREAM:"REMOVE_LOCAL_SCREEN_STREAM",REMOVE_ALL_LOCAL_SCREEN_STREAMS:"REMOVE_ALL_LOCAL_SCREEN_STREAMS",ADD_REMOTE_SCREEN_STREAM:"ADD_REMOTE_SCREEN_STREAM",REMOVE_REMOTE_SCREEN_STREAM:"REMOVE_REMOTE_SCREEN_STREAM",TOGGLE_REMOTE_STREAM:"TOGGLE_REMOTE_STREAM",SUBMIT_RATING:"SUBMIT_RATING",SUBMIT_FEEDBACK:"SUBMIT_FEEDBACK",RATING_SHOWN:"RATING_SHOWN",FEEDBACK_SHOWN:"FEEDBACK_SHOWN"};}),null);
__d("RTCP2PCallActionTypes",[],(function a(b,c,d,e,f,g){f.exports={SET_CALL_TYPE:"SET_CALL_TYPE",SET_CONNECTION_STATUS:"SET_CONNECTION_STATUS",SET_END_CALL_REASON:"SET_END_CALL_REASON",SET_REMOTE_SIGNALING_EXPERIMENTS:"SET_REMOTE_SIGNALING_EXPERIMENTS"};}),null);
__d("ScreenSharingWebDriverIDs",[],(function a(b,c,d,e,f,g){f.exports={SHARE_SCREEN_BUTTON:"shareScreenButton",INSTALL_EXT_DIALOG:"install_extension_dialog"};}),null);
__d("VideoCallWebDriverIDs",[],(function a(b,c,d,e,f,g){f.exports={END_CALL_BUTTON:"endCallButton",FULL_SCREEN_BUTTON:"fullScreenButton",STAR_RATING_VIEW:"starRatingView"};}),null);
__d("XLinkshimLinkAsyncController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/linkshim\/ajax\/link\/",{href:{type:"String",required:true},callsite:{type:"Enum",required:true,enumType:0}});}),null);
__d('LinkshimURI',['AsyncRequest','XLinkshimLinkAsyncController','isFacebookURI'],(function a(b,c,d,e,f,g){'use strict';var h={asyncGet:function i(j,k,l){if(c('isFacebookURI')(j)){l(j);return;}var m=c('XLinkshimLinkAsyncController').getURIBuilder().setString('href',j.toString()).setEnum('callsite',k).getURI();new (c('AsyncRequest'))(m).setHandler(function(n){var o=n.getPayload();l(o.uri);}).send();}};f.exports=h;}),null);
__d('LinkshimLink.react',['Link.react','LinkshimURI','React','URI','areEqual'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=c('React').PropTypes;h=babelHelpers.inherits(k,c('React').Component);i=h&&h.prototype;function k(){var l,m;for(var n=arguments.length,o=Array(n),p=0;p<n;p++)o[p]=arguments[p];return m=(l=i.constructor).call.apply(l,[this].concat(o)),this.state={shimURI:undefined},this.$LinkshimLink1=function(q){c('LinkshimURI').asyncGet(q.uri,q.callsite,function(r){return this.setState({shimURI:r});}.bind(this));}.bind(this),m;}k.prototype.componentWillMount=function(){this.$LinkshimLink1(this.props);};k.prototype.componentWillReceiveProps=function(l){if(!c('areEqual')(this.props,l))this.$LinkshimLink1(l);};k.prototype.render=function(){if(!this.state.shimURI)return this.props.loadingPlaceholder?this.props.loadingPlaceholder:null;var l=this.props,m=l.children,n=babelHelpers.objectWithoutProperties(l,['children']);return (c('React').createElement(c('Link.react'),babelHelpers['extends']({href:this.state.shimURI},n),m));};k.propTypes={uri:j.instanceOf(c('URI')).isRequired,callsite:j.number.isRequired,loadingPlaceholder:j.element};f.exports=k;}),null);
__d('MessengerRTCGroupCallContactListItem.react',['cx','fbt','ix','Image.react','ImmutableObject','Link.react','MessengerContactImage.react','React','MultiwayTypes'],(function a(b,c,d,e,f,g,h,i,j){'use strict';var k,l=c('MultiwayTypes').ParticipantCallState,m=c('React').PropTypes,n=(k={},k[l.DISCONNECTED]=i._("Disconnected"),k[l.NO_ANSWER]=i._("No answer"),k[l.REJECTED]=i._("Rejected"),k[l.UNREACHABLE]=i._("Unreachable"),k[l.CONNECTION_DROPPED]=i._("Connection dropped"),k[l.PARTICIPANT_LIMIT_REACHED]=i._("Participant limit reached"),k),o=32,p=function s(t){var u=t.participant,v=t.participantState,w=t.isSelected,x=t.onClick;return (c('React').createElement('div',{className:"_4nvn",onClick:x},c('React').createElement(c('Link.react'),{className:"_4nvq"},c('React').createElement(c('MessengerContactImage.react'),{className:"_4nvr",isMessengerUser:u.is_messenger_user,size:o,src:u.image_src}),c('React').createElement('div',{className:"_4nvs"},c('React').createElement('div',{className:"_4nvt"},c('React').createElement('div',{className:"_4nv_"},u.name),c('React').createElement(q,{participant:u,participantState:v})),c('React').createElement(r,{isSelected:w})))));},q=function s(t){var u=t.participant.vanity,v=t.participantState;if(!v){if(!u)return null;return (c('React').createElement('div',{className:"_4nw0"},'@',u));}var w=n[v.state]||i._("Unknown");return (c('React').createElement('div',{className:"_4nw0"},w));},r=function s(t){var u=t.isSelected;if(!u)return null;return (c('React').createElement('div',{className:"_5jdo"},c('React').createElement(c('Image.react'),{src:j('/images/mercury/clients/messenger/core/Checkmark.png')})));};p.propTypes={participant:m.instanceOf(c('ImmutableObject')).isRequired,participantState:m.object,isSelected:m.bool.isRequired,onClick:m.func.isRequired};f.exports=p;}),null);
__d('MessengerRTCGroupCallContactList.react',['cx','immutable','ImmutableObject','React','MessengerScrollableArea.react','MessengerRTCGroupCallContactListItem.react'],(function a(b,c,d,e,f,g,h){'use strict';var i=c('React').PropTypes,j=function k(l){var m=l.participants,n=l.participantStates,o=n===undefined?c('immutable').Map():n,p=l.isParticipantSelected,q=l.onClick,r=m.map(function(s){return (c('React').createElement(c('MessengerRTCGroupCallContactListItem.react'),{key:s.id,participant:s,participantState:o.get(s.fbid||''),isSelected:p.get(s.id),onClick:function(t){function u(){return t.apply(this,arguments);}u.toString=function(){return t.toString();};return u;}(function(){return q(s.id);})}));});return (c('React').createElement('div',{className:"_12zw"},c('React').createElement(c('MessengerScrollableArea.react'),null,r)));};j.propTypes={participants:i.arrayOf(i.instanceOf(c('ImmutableObject'))).isRequired,participantStates:i.instanceOf(c('immutable').Map),isParticipantSelected:i.instanceOf(c('immutable').Map).isRequired,onClick:i.func.isRequired};f.exports=j;}),null);
__d('MessengerRTCGroupCallRingParticipantsRow.react',['cx','fbt','React'],(function a(b,c,d,e,f,g,h,i){'use strict';var j=c('React').PropTypes,k=function l(m){var n=m.names;return (c('React').createElement('div',{className:"_1wsd"},c('React').createElement('div',{className:"_1wse"},i._("Ring:")),c('React').createElement('div',{className:"_1wsg"},n.join(', '))));};k.propTypes={names:j.arrayOf(j.string).isRequired};f.exports=k;}),null);
__d('MessengerRTCGroupCallThreadRow.react',['cx','fbt','immutable','ImmutableObject','MercuryThreadTitle.react','MessengerThreadImage.react','React'],(function a(b,c,d,e,f,g,h,i){'use strict';var j=c('React').PropTypes,k=function l(m){var n=m.displayAddMemberWarning,o=m.participants,p=m.thread,q=m.viewerID;return (c('React').createElement('div',{className:"_5y31"},c('React').createElement(c('MessengerThreadImage.react'),{className:"_5y32",participants:o,thread:p,viewer:q}),c('React').createElement('div',{className:"_5y34"},c('React').createElement(c('MercuryThreadTitle.react'),{className:"_5y37",thread:p,viewer:q}),n?c('React').createElement('div',{className:"_1apf"},i._("People you add to this group video will see previous messages in this conversation.")):null)));};k.propTypes={displayAddMemberWarning:j.bool,participants:j.instanceOf(c('immutable').Map).isRequired,thread:j.instanceOf(c('ImmutableObject')).isRequired,viewerID:j.string.isRequired};f.exports=k;}),null);
__d("XVideoCallAdminMessageController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/videocall\/admin_msg\/",{});}),null);
__d('FBRTCAdminMessage',['FBRTCConstants','FBRTCCallConstants','FBRTCLogger','FBRTCUtils','XVideoCallAdminMessageController','emptyFunction','performanceNow'],(function a(b,c,d,e,f,g){function h(i,j){'use strict';this.$FBRTCAdminMessage1=i;this.$FBRTCAdminMessage2=j;this.$FBRTCAdminMessage3=Date.now();this.$FBRTCAdminMessage4=null;this.$FBRTCAdminMessage5=null;}h.prototype.onCallConnected=function(){'use strict';if(!this.$FBRTCAdminMessage4)this.$FBRTCAdminMessage4=c('performanceNow')();};h.prototype.onCallEnded=function(){'use strict';if(!this.$FBRTCAdminMessage5)this.$FBRTCAdminMessage5=c('performanceNow')();};h.prototype.submit=function(i,j){'use strict';if(!this.$FBRTCAdminMessage5)this.onCallEnded();var k=0,l=c('FBRTCCallConstants').FBRTCCallConnectionType.MISSED_CALL;if(this.$FBRTCAdminMessage4){k=Math.ceil(this.$FBRTCAdminMessage5-this.$FBRTCAdminMessage4);l=c('FBRTCCallConstants').FBRTCCallConnectionType.CONNECTED_CALL;}var m=l===c('FBRTCCallConstants').FBRTCCallConnectionType.CONNECTED_CALL||j===c('FBRTCConstants').CallEndReason.IGNORE_CALL;this.$FBRTCAdminMessage6({peer_id:this.$FBRTCAdminMessage1,call_id:this.$FBRTCAdminMessage2,start_time:this.$FBRTCAdminMessage3,call_duration:k,message_type:l,call_category:i,call_acknowledged:m});};h.prototype.$FBRTCAdminMessage6=function(i){'use strict';var j=c('XVideoCallAdminMessageController').getURIBuilder().getURI();c('FBRTCUtils').sendServerRequest(j,c('emptyFunction'),this.$FBRTCAdminMessage7.bind(this,i.peer_id,i.call_id),false,null,i);};h.prototype.$FBRTCAdminMessage7=function(i,j,k){'use strict';var l;if(k){l='Fail to log admin message, error '+k.error;}else l='Server timed out on logging admin message';c('FBRTCLogger').getInstance().logError(i,j,l);};f.exports=h;}),null);
__d('FBRTCPCConfig',['FBRTCConfig','FBRTCVersionDetection','RTCConfig'],(function a(b,c,d,e,f,g){var h="stun:stun.fbsbx.com:3478",i=function k(l,m,n){if(c('FBRTCVersionDetection').isChrome()&&c('FBRTCVersionDetection').webrtcVersion()>=34){var o={urls:l};if(m&&n){o.username=m;o.credential=n;}return [o];}var p=[];for(var q=0;q<l.length;q++)if(m&&n){p.push({url:l[q],username:m,credential:n});}else p.push({url:l[q]});return p;},j={setTurnCredentials:function k(l){this.turnIP=l.ip;this.udpPort=l.udp_port;this.tcpPort=l.tcp_port;this.sslPort=l.ssl_tcp_port;this.turnUsername=l.username;this.turnPassword=l.password;},getConfig:function k(){if(c('FBRTCConfig').isVCEndpointCall()&&c('RTCConfig').CollabDisableBrowserTurnDiscoveryGK)return {iceServers:[]};var l=i([h]).concat(i(this._turnUrls(),this.turnUsername,this.turnPassword));return {iceServers:l};},getConstraints:function k(){return {mandatory:{},optional:[{DtlsSrtpKeyAgreement:true},{googHighBitrate:true},{googVeryHighBitrate:true}]};},_turnUrls:function k(){if(c('FBRTCVersionDetection').isFirefox()&&c('FBRTCVersionDetection').webrtcVersion()<27){return ['turn:'+this.turnIP+':'+this.udpPort];}else return ['turn:'+this.turnIP+':'+this.udpPort+'?transport=udp','turn:'+this.turnIP+':'+this.tcpPort+'?transport=tcp','turn:'+this.turnIP+':'+this.sslPort+'?transport=tcp'];}};f.exports=j;}),null);
__d('FBRTCSdpUtils',['UserAgent'],(function a(b,c,d,e,f,g){var h='m=video 0',i=function m(n){return n.match(/^a=rtpmap:(\d+)\s/)[1];},j=function m(n,o,p){var q=i(n[o]),r=n[p].split('RTP/SAVPF'),s=r[1].split(/\s+/),t=s.indexOf(q);s.splice(t,1);r[1]=s.join(' ');n[p]=r.join('RTP/SAVPF');n.splice(o,1);},k=function m(n,o,p){var q=i(n[o]);j(n,o,p);var r=new RegExp('^a=(rtcp-fb|fmtp):'+q+' ');n=n.filter(function(v){return !r.test(v);});var s=new RegExp('^a=fmtp:(\\d+)\\s+apt='+q+'($|;)'),t=n.reduce(function(v,w,x){var y=w.match(s);return y?[].concat(v,[y[1]]):v;},[]).join('|'),u=new RegExp('^a=rtpmap:('+t+')\\s+rtx/|^a=fmtp:('+t+')\\s+apt=');return n.filter(function(v){return !u.test(v);});},l={replaceRTPSAVPFProfile:function m(n){var o='UDP/TLS/RTP/SAVPF',p='RTP/SAVPF';while(n.indexOf(o)>=0)n=n.replace(o,p);return n;},addIceOptionToSdp:function m(n,o){"use strict";var p="a=ice-options:",q=n.indexOf(p);if(q>=0){var r=n.indexOf("\r",q);return [n.slice(0,r)," ",o,n.slice(r)].join('');}var s=p+o,t=n.split("\r\n"),u=false,v=-1;for(var w=0;w<t.length;w++){var x=t[w].slice(0,2);if(x=="s="){u=true;continue;}if(u&&x=="a="){v=w;break;}}if(v>=0){t.splice(v,0,s);return t.join("\r\n");}return [n,s,"\r\n"].join('');},preferIsac:function m(n){var o=n.split("\r\n"),p=-1,q=-1,r=-1;for(var s=0;s<o.length;s++){var t=o[s];if(t.match(/m=audio\s+\d+\s+RTP\/SAVPF(\s+\d+)+/))p=s;if(r===-1&&p>-1&&t.match(/^a=rtpmap:/))r=s;if(t.match(/^a=rtpmap:\d+\s+ISAC\/16000/))q=s;}if(p===-1||q===-1||r===-1)return o.join("\r\n");var u=o[q];j(o,q,p);o.splice(r,0,u);o[p]=o[p].replace('RTP/SAVPF','RTP/SAVPF '+i(u));return o.join("\r\n");},disableVideo:function m(n){var o=/m=video\s+\S+/;n=n.replace(o,h);if(c('UserAgent').isBrowser('Firefox <= 37'))n=this._makeDisabledVideoReceiveOnly(n);return n;},_makeDisabledVideoReceiveOnly:function m(n){if(n.indexOf(h)>-1){var o=n.split(h);o[1]=o[1].replace(/send(recv|only)/,'recvonly');n=o.join(h);}return n;},fixMobileIceSdp:function m(n){n=n.replace(/^a=/,'');n=n.split(/\s+username\s+.+password.+/)[0];var o=n.match(/\s+relay\s+|\s+srflx\s+/),p=n.match(/raddr.+rport.+/);if(o&&!p){o=o[0];var q=n.split(o),r=q[1].match(/^(\d+\.\d+\.\d+\.\d+)\s+(\d+)\s+/),s=void 0,t=void 0;if(r){s=r[1];t=r[2];q[1]=q[1].replace(r[0],'');}else{r=q[0].split(/\s+/);s=r[4];t=r[5];}n=''+q[0]+o+'raddr '+s+' rport '+t+' '+q[1];}return n;},addAudioNack:function m(n){var o=[];n=n.split('\r\n').map(function(p){var q='';if(o.length>0&&(/^a=rtpmap:(\d+)/.test(p)||/^a=ssrc/.test(p)||/^m=/.test(p))){q+=this._getrtcpFeedbackLinesFromAudioFMTs(o)+'\r\n';o=[];}if(/^m=audio/.test(p))o=p.match(/^m=audio\s+[\d\/]+\s+[\w\/]+([\s+\d+]+)/)[1].trim().split(' ');return q+p;}.bind(this)).join('\r\n');if(o.length>0)n+='\r\n'+this._getrtcpFeedbackLinesFromAudioFMTs(o);return n;},_getrtcpFeedbackLinesFromAudioFMTs:function m(n){return n.map(function(o){return 'a=rtcp-fb:'+o+' nack';}).join('\r\n');},removeFEC:function m(n){var o=n.split('\r\n'),p=void 0,q=void 0;for(var r=0;r<o.length;r++){if(o[r].match(/^a=rtpmap:\d+\s+red\//))p=r;if(o[r].match(/^m=video/))q=r;}if(p&&q)j(o,p,q);return o.join('\r\n');},removeH264:function m(n){var o=n.split('\r\n'),p=/^a=rtpmap:\d+\s+H264\//,q=o.findIndex(function(t){return p.test(t);}),r=/^m=video/,s=o.findIndex(function(t){return r.test(t);});return q!==-1&&s!==-1?k(o,q,s).join('\r\n'):n;},isVideoSupported:function m(n){return (n&&n.indexOf('m=video')>-1&&n.indexOf(h)===-1);},setDtlsRole:function m(n,o){if(!n.match(/setup:(active|passive|actpass)/)){return n.replace(/(a=fingerprint:.+)/g,'$1\r\na=setup:'+o);}else return n.replace(/setup:actpass/g,'setup:'+o);},setVideoBitrateConstraint:function m(n){var o=720;if(n.match(/^b=AS:/m))return n;n=n.replace(/^a=mid:video\r\n/m,'a=mid:video\r\nb=AS:'+o+'\r\n');return n;},removeSdparta:function m(n){var o=n.split('\r\n'),p='audio',q=false,r=-1;for(var s=0;s<o.length;s++){var t=o[s];if(t.indexOf('m=audio')===0)p='audio';if(t.indexOf('m=video')===0){q=true;p='video';}if(t.indexOf('a=mid:sdparta_')===0)o[s]='a=mid:'+p;if(t.indexOf('a=group:BUNDLE sdparta_')===0)r=s;}if(r>-1)if(q){o[r]='a=group:BUNDLE audio video';}else o[r]='a=group:BUNDLE audio';return o.join('\r\n');}};f.exports=l;}),null);
__d('FBRTCStatsHelpers',['FBRTCLogger'],(function a(b,c,d,e,f,g){var h=function j(k){if(k==='host'||k==='local')return 'local';if(k==='serverreflexive')return 'srflx';if(k==='peerreflexive')return 'prflx';if(k==='relayed'||k==='relay')return 'relay';return 'unknown';},i={connectionType:function j(k,l,m,n){return ['l:',h(k),'-',l,';','r:',h(m),'-',n].join('');},logReport:function j(k){var l=c('FBRTCLogger').getInstance(),m=['connectionType','audioCodec','videoCodec','audioRtt','videoRtt','audioPacketsLost','videoPacketsLost','audioBytesSent','videoBytesSent','audioPacketsSent','videoPacketsSent'];for(var n=0;n<m.length;n++){var o=k[m[n]].call(k);l.logToConsole(m[n]+' => '+o);}}};f.exports=i;}),null);
__d('FBRTCChromeStatsReport',['FBRTCStatsHelpers'],(function a(b,c,d,e,f,g){var h=function j(k,l){return parseInt(k.stat(l),10);};function i(){'use strict';this.$FBRTCChromeStatsReport1=[];this.$FBRTCChromeStatsReport2=null;this.$FBRTCChromeStatsReport3=null;this.$FBRTCChromeStatsReport4=null;this.$FBRTCChromeStatsReport5=null;this.$FBRTCChromeStatsReport6=null;}i.prototype.parseReport=function(j){'use strict';j.result().forEach(function(k){if(k.type==="googCandidatePair"&&k.stat('googActiveConnection')==='true')this.$FBRTCChromeStatsReport1.push(k);if(this.$FBRTCChromeStatsReport7(k))this.$FBRTCChromeStatsReport2=k;if(this.$FBRTCChromeStatsReport8(k))this.$FBRTCChromeStatsReport3=k;if(this.$FBRTCChromeStatsReport9(k))this.$FBRTCChromeStatsReport4=k;if(this.$FBRTCChromeStatsReport10(k))this.$FBRTCChromeStatsReport5=k;if(k.type==='VideoBwe')this.$FBRTCChromeStatsReport6=k;}.bind(this));};i.prototype.isConnected=function(){'use strict';return true;};i.prototype.audioRtt=function(){'use strict';if(!this.$FBRTCChromeStatsReport2)return 0;return h(this.$FBRTCChromeStatsReport2,'googRtt');};i.prototype.videoRtt=function(){'use strict';if(!this.$FBRTCChromeStatsReport3)return 0;return h(this.$FBRTCChromeStatsReport3,'googRtt');};i.prototype.audioCodec=function(){'use strict';if(!this.$FBRTCChromeStatsReport2)return 'unknown';return this.$FBRTCChromeStatsReport2.stat('googCodecName');};i.prototype.videoCodec=function(){'use strict';if(!this.$FBRTCChromeStatsReport3)return 'unknown';return this.$FBRTCChromeStatsReport3.stat('googCodecName');};i.prototype.audioPacketsLost=function(){'use strict';if(!this.$FBRTCChromeStatsReport2)return 0;return h(this.$FBRTCChromeStatsReport2,'packetsLost');};i.prototype.setVideoPacketsLost=function(j){'use strict';this.$FBRTCChromeStatsReport11=j;};i.prototype.videoPacketsLost=function(){'use strict';if(!this.$FBRTCChromeStatsReport3)return 0;if(this.$FBRTCChromeStatsReport11)return this.$FBRTCChromeStatsReport11;return h(this.$FBRTCChromeStatsReport3,'packetsLost');};i.prototype.audioBytesSent=function(){'use strict';if(!this.$FBRTCChromeStatsReport2)return 0;return h(this.$FBRTCChromeStatsReport2,'bytesSent');};i.prototype.videoBytesSent=function(){'use strict';if(!this.$FBRTCChromeStatsReport3)return 0;return h(this.$FBRTCChromeStatsReport3,'bytesSent');};i.prototype.audioPacketsSent=function(){'use strict';if(!this.$FBRTCChromeStatsReport2)return 0;return h(this.$FBRTCChromeStatsReport2,'packetsSent');};i.prototype.videoPacketsSent=function(){'use strict';if(!this.$FBRTCChromeStatsReport3)return 0;return h(this.$FBRTCChromeStatsReport3,'packetsSent');};i.prototype.videoFrameRateSent=function(){'use strict';if(!this.$FBRTCChromeStatsReport3)return 0;return h(this.$FBRTCChromeStatsReport3,'googFrameRateSent');};i.prototype.videoFrameRateCaptured=function(){'use strict';if(!this.$FBRTCChromeStatsReport3)return 0;return h(this.$FBRTCChromeStatsReport3,'googFrameRateInput');};i.prototype.connectionType=function(){'use strict';var j='unknown',k='unknown',l='unknown';for(var m=0;m<this.$FBRTCChromeStatsReport1.length;m++){var n=this.$FBRTCChromeStatsReport1[m];k=n.stat('googLocalCandidateType');l=n.stat('googRemoteCandidateType');j=n.stat('googTransportType');}return c('FBRTCStatsHelpers').connectionType(k,j,l,j);};i.prototype.$FBRTCChromeStatsReport7=function(j){'use strict';return j.type==='ssrc'&&j.names().indexOf('audioInputLevel')>-1;};i.prototype.$FBRTCChromeStatsReport8=function(j){'use strict';return j.type==='ssrc'&&j.names().indexOf('googFrameHeightInput')>-1;};i.prototype.$FBRTCChromeStatsReport9=function(j){'use strict';return j.type==='ssrc'&&j.names().indexOf('audioOutputLevel')>-1;};i.prototype.$FBRTCChromeStatsReport10=function(j){'use strict';return j.type==='ssrc'&&j.names().indexOf('googFrameHeightReceived')>-1;};f.exports=i;}),null);
__d('FBRTCMozStatsReport',['Map','FBRTCLogger','FBRTCStatsHelpers'],(function a(b,c,d,e,f,g){function h(){'use strict';this.$FBRTCMozStatsReport1=null;this.$FBRTCMozStatsReport2=null;this.$FBRTCMozStatsReport3=null;this.$FBRTCMozStatsReport4=null;this.candidates=new (c('Map'))();this.candidatePairs=new (c('Map'))();this.$FBRTCMozStatsReport5=c('FBRTCLogger').getInstance();}h.prototype.parseReport=function(i){'use strict';i.forEach(function(j){switch(j.type){case 'inboundrtp':if(!j.remoteId)break;var k={inbound:j,outbound:i[j.remoteId]};if(j.isRemote){if(k.outbound.hasOwnProperty('framerateMean')){this.$FBRTCMozStatsReport2=k;}else this.$FBRTCMozStatsReport1=k;}else if(k.outbound.hasOwnProperty('framerateMean')){this.$FBRTCMozStatsReport4=k;}else this.$FBRTCMozStatsReport3=k;break;case 'outboundrtp':break;case 'candidatepair':if(j.state==='succeeded')this.candidatePairs.set(j.id,j);break;case 'localcandidate':this.candidates.set(j.id,j);break;case 'remotecandidate':this.candidates.set(j.id,j);break;default:this.$FBRTCMozStatsReport5.logToConsole('unrecognized webrtc stats type '+j.type);break;}}.bind(this));};h.prototype.isConnected=function(){'use strict';return !!this.$FBRTCMozStatsReport1;};h.prototype.audioRtt=function(){'use strict';if(!this.$FBRTCMozStatsReport1)return 0;return this.$FBRTCMozStatsReport1.inbound.mozRtt;};h.prototype.videoRtt=function(){'use strict';if(!this.$FBRTCMozStatsReport2)return 0;return this.$FBRTCMozStatsReport2.inbound.mozRtt;};h.prototype.audioCodec=function(){'use strict';return 'opus';};h.prototype.videoCodec=function(){'use strict';return 'VP8';};h.prototype.audioPacketsLost=function(){'use strict';if(!this.$FBRTCMozStatsReport1)return 0;return this.$FBRTCMozStatsReport1.inbound.packetsLost;};h.prototype.setVideoPacketsLost=function(i){'use strict';};h.prototype.videoPacketsLost=function(){'use strict';if(!this.$FBRTCMozStatsReport2)return 0;return this.$FBRTCMozStatsReport2.inbound.packetsLost;};h.prototype.audioBytesSent=function(){'use strict';if(!this.$FBRTCMozStatsReport1)return 0;return this.$FBRTCMozStatsReport1.outbound.bytesSent;};h.prototype.videoBytesSent=function(){'use strict';if(!this.$FBRTCMozStatsReport2)return 0;return this.$FBRTCMozStatsReport2.outbound.bytesSent;};h.prototype.audioPacketsSent=function(){'use strict';if(!this.$FBRTCMozStatsReport1)return 0;return this.$FBRTCMozStatsReport1.outbound.packetsSent;};h.prototype.videoPacketsSent=function(){'use strict';if(!this.$FBRTCMozStatsReport2)return 0;return this.$FBRTCMozStatsReport2.outbound.packetsSent;};h.prototype.videoFrameRateSent=function(){'use strict';if(!this.$FBRTCMozStatsReport2)return 0;return this.$FBRTCMozStatsReport2.outbound.framerateMean;};h.prototype.videoFrameRateCaptured=function(){'use strict';if(!this.$FBRTCMozStatsReport2)return 0;return 30;};h.prototype.connectionType=function(){'use strict';var i='unknown',j='unknown',k='unknown',l='unknown';this.candidatePairs.forEach(function(m){var n=this.candidates.get(m.localCandidateId),o=this.candidates.get(m.remoteCandidateId);i=n.transport;k=o.transport;j=n.candidateType;l=o.candidateType;}.bind(this));return c('FBRTCStatsHelpers').connectionType(j,i,l,k);};f.exports=h;}),null);
__d('FBRTCStatsReportFactory',['FBRTCMozStatsReport','FBRTCChromeStatsReport','FBRTCLogger','FBRTCVersionDetection'],(function a(b,c,d,e,f,g){var h=function k(l,m){l.getStats(null,function(n){var o=new (c('FBRTCMozStatsReport'))();o.parseReport(n);m(o);},function(){c('FBRTCLogger').getInstance().logToConsole('Firefox stats collection failed');});},i=function k(l,m){l.getStats(function(n){var o=new (c('FBRTCChromeStatsReport'))();o.parseReport(n);m(o);});},j={getStats:function k(l,m){if(c('FBRTCVersionDetection').isFirefox())h(l,m);if(c('FBRTCVersionDetection').isChrome())i(l,m);}};f.exports=j;}),null);
__d('FBRTCCallConnection',['invariant','Promise','Base64','FBRTCConfig','FBRTCLogger','FBRTCPCConfig','FBRTCConstants','FBRTCSdpUtils','FBRTCUtils','FBRTCStatsReportFactory','Queue','RTCConfig','UserAgent','mixInEventEmitter'],(function a(b,c,d,e,f,g,h){var i=300000,j=12000,k=10000,l='data',m=1000,n=100;function o(){'use strict';this.$FBRTCCallConnection1=c('FBRTCLogger').getInstance();this.$FBRTCCallConnection2();this.$FBRTCCallConnection3=null;this.$FBRTCCallConnection4=null;this.$FBRTCCallConnection5=new (c('Queue'))({interval:1,processor:this.$FBRTCCallConnection6.bind(this)});this.$FBRTCCallConnection7=null;this.$FBRTCCallConnection8=null;this.$FBRTCCallConnection9=false;this.$FBRTCCallConnection10=0;this.$FBRTCCallConnection11=[];this.$FBRTCCallConnection12=false;this.$FBRTCCallConnection13='passive';this.$FBRTCCallConnection14=true;this.$FBRTCCallConnection15=0;this.$FBRTCCallConnection16={};this.$FBRTCCallConnection17=null;}o.prototype.init=function(p){'use strict';this.$FBRTCCallConnection1.logToConsole('Creating a new peer connection with: '+JSON.stringify(c('FBRTCPCConfig').getConfig())+', '+JSON.stringify(c('FBRTCPCConfig').getConstraints()));this.$FBRTCCallConnection18=p;};o.prototype.setStream=function(p){'use strict';this.$FBRTCCallConnection18=p;};o.prototype.addScreenStream=function(p){'use strict';if(p&&p.getStream()){this.$FBRTCCallConnection1.logToConsole('Screen stream added');this.$FBRTCCallConnection19=p;}else this.$FBRTCCallConnection1.logToConsole('Trying to add invalid stream');};o.prototype.removeScreenStream=function(p){'use strict';if(p&&p.getStream()){this.$FBRTCCallConnection1.logToConsole('Screen stream removed');try{this.$FBRTCCallConnection3.removeStream(p.getStream());}catch(q){this.$FBRTCCallConnection1.logToConsole('Missing connection to remove stream from');}}else this.$FBRTCCallConnection1.logToConsole('Trying to remove an invalid stream');this.$FBRTCCallConnection19=null;};o.prototype.setPeerSupportsVideo=function(p){'use strict';this.$FBRTCCallConnection14=p;};o.prototype.$FBRTCCallConnection20=function(){'use strict';var p={};if(this.$FBRTCCallConnection18&&this.$FBRTCCallConnection18.hasStream()){var q=this.$FBRTCCallConnection18.hasVideoTracks()?c('FBRTCConstants').StreamType.AUDIO_VIDEO:c('FBRTCConstants').StreamType.AUDIO_ONLY;p[this.$FBRTCCallConnection18.getStreamId()]={type:q};}if(this.$FBRTCCallConnection19&&this.$FBRTCCallConnection19.hasStream())p[this.$FBRTCCallConnection19.getStreamId()]={type:c('FBRTCConstants').StreamType.SCREEN_CONTENT};return {streams:p};};o.prototype.$FBRTCCallConnection21=function(p){'use strict';this.$FBRTCCallConnection1.logToConsole('Setting new remote attributes: '+JSON.stringify(p));this.$FBRTCCallConnection17=p;};o.prototype.getRemoteAttributesForStream=function(p){'use strict';var q=p&&this.$FBRTCCallConnection17&&this.$FBRTCCallConnection17.streams;return q&&q[p.id];};o.prototype.isScreenStream=function(p){'use strict';var q=this.getRemoteAttributesForStream(p);if(q){this.$FBRTCCallConnection1.logToConsole('Stream '+p.id+' type attribute is: '+q.type);return q.type===c('FBRTCConstants').StreamType.SCREEN_CONTENT;}else{this.$FBRTCCallConnection1.logToConsole('No attributes found for stream '+p.id);return false;}};o.prototype.getRemoteStreamsCount=function(){'use strict';return this.$FBRTCCallConnection3.getRemoteStreams().length;};o.prototype.$FBRTCCallConnection22=function(p,q){'use strict';this.$FBRTCCallConnection23(null);p.onaddstream=null;p.onremovestream=null;p.onicecandidate=null;p.oniceconnectionstatechange=null;this.$FBRTCCallConnection11=[];var r=q?5000:1;setTimeout(function(){if(p.iceConnectionState!=='closed')p.close();},r);};o.prototype.$FBRTCCallConnection24=function(){'use strict';if(this.$FBRTCCallConnection3)this.$FBRTCCallConnection22(this.$FBRTCCallConnection3,true);var p=new this.nativePeerConnection(c('FBRTCPCConfig').getConfig(),c('FBRTCPCConfig').getConstraints());this.$FBRTCCallConnection13='passive';p.onaddstream=this.$FBRTCCallConnection25.bind(this);p.onremovestream=this.$FBRTCCallConnection26.bind(this);p.onicecandidate=this.$FBRTCCallConnection27.bind(this);p.oniceconnectionstatechange=this.$FBRTCCallConnection28.bind(this);p.addStream(this.$FBRTCCallConnection29());return p;};o.prototype.$FBRTCCallConnection23=function(p){'use strict';this.$FBRTCCallConnection5.stop(true);if(this.isDataChannelOpen())this.$FBRTCCallConnection4.close();this.$FBRTCCallConnection4=p;if(!p)return;this.$FBRTCCallConnection4.onopen=this.$FBRTCCallConnection30.bind(this);this.$FBRTCCallConnection4.onclose=this.$FBRTCCallConnection31.bind(this);this.$FBRTCCallConnection4.onerror=this.$FBRTCCallConnection32.bind(this);this.$FBRTCCallConnection4.onmessage=this.$FBRTCCallConnection33.bind(this);};o.prototype.$FBRTCCallConnection30=function(event){'use strict';this.$FBRTCCallConnection5.start();this.emit('data_opened',event);};o.prototype.$FBRTCCallConnection31=function(event){'use strict';this.$FBRTCCallConnection23(null);this.emit('data_closed',event);};o.prototype.$FBRTCCallConnection32=function(event){'use strict';this.$FBRTCCallConnection23(null);this.emit('data_error',event);};o.prototype.$FBRTCCallConnection33=function(event){'use strict';var p=JSON.parse(event.data);if(p.batchID===undefined){this.emit('data_message',p.data);return;}if(this.$FBRTCCallConnection16[p.batchID]===undefined)this.$FBRTCCallConnection16[p.batchID]=[];var q=this.$FBRTCCallConnection16[p.batchID];q.push(p.data);if(!p.isLast)return;var r=c('Base64').decodeObject(q.join(''));delete this.$FBRTCCallConnection16[p.batchID];this.emit('data_message',r.data);};o.prototype.isDataChannelOpen=function(){'use strict';return !!this.$FBRTCCallConnection4&&this.$FBRTCCallConnection4.readyState==='open';};o.prototype.sendData=function(p){'use strict';this.$FBRTCCallConnection5.enqueue({data:p});};o.prototype.$FBRTCCallConnection6=function(p){'use strict';if(!this.isDataChannelOpen()){h(0);return;}if(p.batchID!==undefined){this.$FBRTCCallConnection34(p);return;}var q=JSON.stringify(p);try{this.$FBRTCCallConnection4.send(q);return;}catch(r){}if(q.length<m){setTimeout(function(){this.$FBRTCCallConnection5.enqueue(p);}.bind(this),n);return;}var s={batchID:this.$FBRTCCallConnection15.toString(),dataStr:c('Base64').encode(q)};this.$FBRTCCallConnection15++;this.$FBRTCCallConnection34(s);};o.prototype.$FBRTCCallConnection34=function(p){'use strict';while(this.isDataChannelOpen()&&p.dataStr.length>0){var q={batchID:p.batchID,data:p.dataStr.slice(0,m)},r=p.dataStr.slice(m);if(r.length<=0)q.isLast=true;try{this.$FBRTCCallConnection4.send(JSON.stringify(q));}catch(s){setTimeout(function(){this.$FBRTCCallConnection5.enqueue(p);}.bind(this),n);return;}p.dataStr=r;}};o.prototype.createOffer=function(){'use strict';this.$FBRTCCallConnection3=this.$FBRTCCallConnection24();if(c('FBRTCConfig').shouldCreateDataChannel())this.$FBRTCCallConnection23(this.$FBRTCCallConnection3.createDataChannel(l));this.$FBRTCCallConnection35('offer');this.$FBRTCCallConnection13='active';};o.prototype.createSdpUpdate=function(p){'use strict';if(p){var q=this.$FBRTCCallConnection3.getLocalStreams();for(var r=0;r<q.length;r++)this.$FBRTCCallConnection3.removeStream(q[r]);this.$FBRTCCallConnection3.addStream(this.$FBRTCCallConnection18.getStream());if(this.$FBRTCCallConnection19)this.$FBRTCCallConnection3.addStream(this.$FBRTCCallConnection19.getStream());}else this.$FBRTCCallConnection29();this.$FBRTCCallConnection35('sdp_update');};o.prototype.$FBRTCCallConnection29=function(){'use strict';var p=this.$FBRTCCallConnection18.getStream();if(!this.$FBRTCCallConnection19){if(this.$FBRTCCallConnection36){this.$FBRTCCallConnection37(this.$FBRTCCallConnection36);this.$FBRTCCallConnection36=null;}}else{this.$FBRTCCallConnection36=p.getVideoTracks()[0];var q=this.$FBRTCCallConnection19.getStream().getVideoTracks(),r=q[0];this.$FBRTCCallConnection37(r);}return p;};o.prototype.$FBRTCCallConnection37=function(p){'use strict';var q=this.$FBRTCCallConnection18.getStream(),r=q.getVideoTracks(),s=r.length;while(s--)q.removeTrack(r[s]);q.addTrack(p);};o.prototype.$FBRTCCallConnection35=function(p){'use strict';this.$FBRTCCallConnection12=true;this.$FBRTCCallConnection3.createOffer(this.$FBRTCCallConnection38.bind(this,p),this.$FBRTCCallConnection39.bind(this,'CreateOfferFailed'),this.$FBRTCCallConnection40());};o.prototype.$FBRTCCallConnection40=function(){'use strict';if(c('UserAgent').isBrowser('Chrome <= 37')||c('UserAgent').isBrowser('Opera <= 25'))return {mandatory:{OfferToReceiveAudio:true,OfferToReceiveVideo:this.$FBRTCCallConnection14}};return {offerToReceiveAudio:true,offerToReceiveVideo:this.$FBRTCCallConnection14};};o.prototype.end=function(){'use strict';this.$FBRTCCallConnection1.logToConsole('Ending connection...');if(this.$FBRTCCallConnection3){this.emit('isEnding');this.$FBRTCCallConnection22(this.$FBRTCCallConnection3,false);this.$FBRTCCallConnection3=null;}};o.prototype.onReceivedOfferSDP=function(p,q){'use strict';this.$FBRTCCallConnection3=this.$FBRTCCallConnection24();if(c('FBRTCConfig').shouldCreateDataChannel())this.$FBRTCCallConnection3.ondatachannel=function(event){this.$FBRTCCallConnection23(event.channel);}.bind(this);var r=new this.nativeSessionDescription({type:'offer',sdp:p});this.$FBRTCCallConnection21(q);this.$FBRTCCallConnection3.setRemoteDescription(r,this.$FBRTCCallConnection41.bind(this,r),this.$FBRTCCallConnection39.bind(this,'SetRemoteOfferFailed'));};o.prototype.onReceivedAnswerSDP=function(p,q){'use strict';var r=new this.nativeSessionDescription({type:'answer',sdp:p});this.$FBRTCCallConnection21(q);this.$FBRTCCallConnection3.setRemoteDescription(r,this.$FBRTCCallConnection41.bind(this,r),this.$FBRTCCallConnection39.bind(this,'SetRemoteAnswerFailed'));};o.prototype.onReceivedSdpUpdate=function(p,q){'use strict';if(this.$FBRTCCallConnection12)setTimeout(function(){this.onReceivedSdpUpdate(p,q);}.bind(this),200);switch(this.$FBRTCCallConnection3.signalingState){case 'stable':this.$FBRTCCallConnection42(p,'offer',q);break;case 'have-local-offer':p=c('FBRTCSdpUtils').setDtlsRole(p,this.$FBRTCCallConnection13);this.$FBRTCCallConnection42(p,'answer',q);break;case 'have-remote-offer':setTimeout(function(){this.onReceivedSdpUpdate(p,q);}.bind(this),1000);break;case 'have-local-pranswer':case 'have-remote-pranswer':break;case 'closed':break;}};o.prototype.$FBRTCCallConnection42=function(p,q,r){'use strict';var s=new this.nativeSessionDescription({type:q,sdp:p});this.$FBRTCCallConnection12=true;this.$FBRTCCallConnection21(r);this.$FBRTCCallConnection3.setRemoteDescription(s,function(){this.$FBRTCCallConnection1.logToConsole('sdp update '+s.type+' set');if(this.$FBRTCCallConnection3&&s.type==='offer'){this.$FBRTCCallConnection3.createAnswer(this.$FBRTCCallConnection38.bind(this,'sdp_update'),this.$FBRTCCallConnection39.bind(this,'CreateSdpUpdateFailed'));}else this.$FBRTCCallConnection12=false;}.bind(this),this.$FBRTCCallConnection39.bind(this,'SetRemoteSdpUpdateFailed'));};o.prototype.onReceivedRemoteIceCandidate=function(p){'use strict';p.sdp=c('FBRTCSdpUtils').fixMobileIceSdp(p.sdp);var q=new this.nativeIceCandidate({sdpMLineIndex:p.label,candidate:p.sdp,sdpMid:p.sdp_mid});this.$FBRTCCallConnection3.addIceCandidate(q);};o.prototype.getStats=function(p){'use strict';c('FBRTCStatsReportFactory').getStats(this.$FBRTCCallConnection3,p);};o.prototype.getStatsNative=function(p){'use strict';if(c('UserAgent').isBrowser('Firefox'))return new (c('Promise'))(function(q){return q(this.$FBRTCCallConnection3.getStats(p));}.bind(this));if(c('UserAgent').isBrowser('Chrome'))return new (c('Promise'))(function(q,r){this.$FBRTCCallConnection3.getStats(function(s){var t={};s.result().forEach(function(u){var v={id:u.id,type:u.type};u.names().forEach(function(w){return v[w]=u.stat(w);});t[v.id]=v;});q(t);},p,r);}.bind(this));return c('Promise').reject(new Error('browser not supported'));};o.prototype.getCreatedIceCandidates=function(){'use strict';return this.$FBRTCCallConnection11;};o.prototype.$FBRTCCallConnection38=function(p,q){'use strict';this.$FBRTCCallConnection1.logToConsole('Created '+p+' sdp');if(!this.$FBRTCCallConnection3){this.$FBRTCCallConnection1.logToConsole('_onSDPCreated: pc has been deallocated');return;}if(!this.$FBRTCCallConnection14&&p==='sdp_update')q.sdp=c('FBRTCSdpUtils').disableVideo(q.sdp);q.sdp=c('FBRTCSdpUtils').addIceOptionToSdp(q.sdp,"fb-force-5245");q.sdp=c('FBRTCSdpUtils').replaceRTPSAVPFProfile(q.sdp);q.sdp=c('FBRTCSdpUtils').preferIsac(q.sdp);q.sdp=c('FBRTCSdpUtils').removeSdparta(q.sdp);if(c('FBRTCUtils').isVCEndpointCallable(c('FBRTCConfig').getPeerID())&&c('RTCConfig').DeclareAudioNackCapabilityInSDPOffer&&c('UserAgent').isBrowser('Chrome >= 29'))q.sdp=c('FBRTCSdpUtils').addAudioNack(q.sdp);this.$FBRTCCallConnection3.setLocalDescription(q,function(){this.$FBRTCCallConnection12=false;this.$FBRTCCallConnection1.logToConsole('Local '+p+' set');this.emit('sdpCreated',{type:p,sdp:q.sdp,attributes:this.$FBRTCCallConnection20()});}.bind(this),this.$FBRTCCallConnection39.bind(this,'SetLocalDescriptionFailed:'+p));};o.prototype.$FBRTCCallConnection41=function(p){'use strict';this.$FBRTCCallConnection1.logToConsole('Remote '+p.type+' set');if(!this.$FBRTCCallConnection3){this.$FBRTCCallConnection1.logToConsole('_onRemoteDescriptionSet: pc has been deallocated');return;}if(p.type==='offer')this.$FBRTCCallConnection3.createAnswer(this.$FBRTCCallConnection38.bind(this,'answer'),this.$FBRTCCallConnection39.bind(this,'CreateAnswerFailed'));this.emit('remoteDescriptionSet');};o.prototype.$FBRTCCallConnection25=function(event){'use strict';this.$FBRTCCallConnection1.logToConsole('Remote stream added');this.emit('remoteStreamAdded',{stream:event.stream});};o.prototype.$FBRTCCallConnection26=function(event){'use strict';this.$FBRTCCallConnection1.logToConsole('Remote stream removed');this.emit('remoteStreamRemoved',{stream:event.stream});};o.prototype.$FBRTCCallConnection27=function(event){'use strict';if(event.candidate){this.$FBRTCCallConnection11.push(event.candidate);this.emit('localIceCandidateCreated',event.candidate);}};o.prototype.$FBRTCCallConnection28=function(event){'use strict';var p=event.target.iceConnectionState;this.$FBRTCCallConnection1.logToConsole('Ice candidate state changed from '+this.$FBRTCCallConnection7+' to '+p);if(p===this.$FBRTCCallConnection7)return;this.$FBRTCCallConnection43();if(this.$FBRTCCallConnection44(p)){if(!this.$FBRTCCallConnection9){this.emit('connected');this.$FBRTCCallConnection9=true;}}else if(p==='disconnected'){this.$FBRTCCallConnection45();}else if(p==='failed')this.$FBRTCCallConnection46();this.$FBRTCCallConnection7=p;};o.prototype.$FBRTCCallConnection44=function(p){'use strict';return p==='completed'||p==='connected';};o.prototype.$FBRTCCallConnection45=function(){'use strict';if(this.$FBRTCCallConnection44(this.$FBRTCCallConnection7)){var p=Date.now();if(this.$FBRTCCallConnection47-p>=i)this.$FBRTCCallConnection10=0;this.$FBRTCCallConnection10=this.$FBRTCCallConnection10+1;this.$FBRTCCallConnection47=p;if(this.$FBRTCCallConnection10>=2)this.emit('connectionUnstable');}var q=this;this.$FBRTCCallConnection8=setTimeout(function(){q.emit('disconnected');},j);};o.prototype.$FBRTCCallConnection46=function(){'use strict';var p=this;this.$FBRTCCallConnection8=setTimeout(function(){var q={details:'Ice candidate state failed',endCallSubreason:'IceFailed'};p.emit('connectionError',q);},k);};o.prototype.$FBRTCCallConnection43=function(){'use strict';if(this.$FBRTCCallConnection8)clearTimeout(this.$FBRTCCallConnection8);this.$FBRTCCallConnection8=null;};o.prototype.$FBRTCCallConnection39=function(p,q){'use strict';var r={details:q,endCallSubreason:p};this.emit('connectionError',r);};o.prototype.$FBRTCCallConnection2=function(){'use strict';if(window.webkitRTCPeerConnection){this.$FBRTCCallConnection1.logToConsole('Using Chrome WebRTC APIs...');this.nativePeerConnection=window.webkitRTCPeerConnection;this.nativeIceCandidate=window.RTCIceCandidate;this.nativeSessionDescription=window.RTCSessionDescription;}else{this.$FBRTCCallConnection1.logToConsole('Using Firefox WebRTC APIs...');this.nativePeerConnection=window.mozRTCPeerConnection;this.nativeIceCandidate=window.mozRTCIceCandidate;this.nativeSessionDescription=window.mozRTCSessionDescription;}};c('mixInEventEmitter')(o,{remoteStreamAdded:true,remoteStreamRemoved:true,sdpCreated:true,localIceCandidateCreated:true,remoteDescriptionSet:true,connected:true,disconnected:true,connectionUnstable:true,connectionError:true,isEnding:true,data_opened:true,data_closed:true,data_error:true,data_message:true});f.exports=o;}),null);
__d('FBRTCRttAggregator',[],(function a(b,c,d,e,f,g){function h(){'use strict';this.$FBRTCRttAggregator1=[{count:0,ave:0},{count:0,ave:0},{count:0,ave:0},{count:0,ave:0}];}h.prototype.addRtt=function(i){'use strict';var j=this.$FBRTCRttAggregator1[this.$FBRTCRttAggregator2(i)];j.ave=this.$FBRTCRttAggregator3(j.ave,j.count,i);j.count+=1;};h.prototype.toString=function(){'use strict';return [this.$FBRTCRttAggregator4('50',this.$FBRTCRttAggregator1[0]),this.$FBRTCRttAggregator4('100',this.$FBRTCRttAggregator1[1]),this.$FBRTCRttAggregator4('200',this.$FBRTCRttAggregator1[2]),this.$FBRTCRttAggregator4('0',this.$FBRTCRttAggregator1[3])].join('|');};h.prototype.$FBRTCRttAggregator4=function(i,j){'use strict';return i+'='+j.count+','+Math.round(j.ave);};h.prototype.$FBRTCRttAggregator2=function(i){'use strict';if(i<50)return 0;if(i<100)return 1;if(i<200)return 2;return 3;};h.prototype.$FBRTCRttAggregator3=function(i,j,k){'use strict';return (i*j+k)/(j+1);};f.exports=h;}),null);
__d('FBRTCStatsInterpreter',['FBRTCLogger'],(function a(b,c,d,e,f,g){var h={rtt_weight:2,frr_weight:800,plr_weight:500,score_threshold:1000,bad_score_count:3};function i(j){'use strict';this.$FBRTCStatsInterpreter1=babelHelpers['extends']({},h,j);this.$FBRTCStatsInterpreter2=c('FBRTCLogger').getInstance();this.$FBRTCStatsInterpreter3=0;}i.prototype.interpretStats=function(j,k){'use strict';var l=j.videoRtt(),m=this.$FBRTCStatsInterpreter4(j),n=this.$FBRTCStatsInterpreter5(j,k),o=this.$FBRTCStatsInterpreter6(l,m,n);if(o>=this.$FBRTCStatsInterpreter1.score_threshold&&!this.isNetworkPoor())this.$FBRTCStatsInterpreter3+=1;if(o<this.$FBRTCStatsInterpreter1.score_threshold&&this.$FBRTCStatsInterpreter3>0)this.$FBRTCStatsInterpreter3-=1;};i.prototype.isNetworkPoor=function(){'use strict';return this.$FBRTCStatsInterpreter3>=this.$FBRTCStatsInterpreter1.bad_score_count;};i.prototype.$FBRTCStatsInterpreter6=function(j,k,l){'use strict';return j*this.$FBRTCStatsInterpreter1.rtt_weight+k*this.$FBRTCStatsInterpreter1.frr_weight+l*this.$FBRTCStatsInterpreter1.plr_weight;};i.prototype.$FBRTCStatsInterpreter5=function(j,k){'use strict';var l,m;if(k){l=j.videoPacketsLost()-k.videoPacketsLost();m=j.videoPacketsSent()-k.videoPacketsSent();}else{l=j.videoPacketsLost();m=j.videoPacketsSent();}if(l<0||m===0)return 0;return l/m;};i.prototype.$FBRTCStatsInterpreter4=function(j){'use strict';if(j.videoFrameRateCaptured()===0)return 0;return 1-j.videoFrameRateSent()/j.videoFrameRateCaptured();};f.exports=i;}),null);
__d("RingBuffer",[],(function a(b,c,d,e,f,g){function h(i){"use strict";this.$RingBuffer1=i;this.$RingBuffer2=-1;this.$RingBuffer3=[];}h.prototype.add=function(i){"use strict";this.$RingBuffer2=(this.$RingBuffer2+1)%this.$RingBuffer1;this.$RingBuffer3[this.$RingBuffer2]=i;};h.prototype.size=function(){"use strict";return this.$RingBuffer3.length;};h.prototype.head=function(){"use strict";if(this.$RingBuffer2===-1)return null;return this.$RingBuffer3[this.$RingBuffer2];};h.prototype.tail=function(){"use strict";if(this.$RingBuffer2===-1)return null;return this.$RingBuffer3[this.$RingBuffer4()];};h.prototype.forEach=function(i){"use strict";for(var j=0;j<this.$RingBuffer3.length;j++){var k=(this.$RingBuffer2+1+j)%this.$RingBuffer3.length;i(this.$RingBuffer3[k]);}};h.prototype.$RingBuffer4=function(){"use strict";return (this.$RingBuffer2+1)%this.$RingBuffer3.length;};f.exports=h;}),null);
__d('FBRTCCallConnectionMonitor',['RingBuffer','FBRTCRttAggregator','FBRTCStatsInterpreter','FBRTCConfig','mixInEventEmitter'],(function a(b,c,d,e,f,g){var h=3000,i=1,j=0,k=3;function l(m,n){'use strict';this.$FBRTCCallConnectionMonitor1=new (c('FBRTCStatsInterpreter'))(c('FBRTCConfig').statsInterpreterConfig());this.$FBRTCCallConnectionMonitor2=new (c('FBRTCRttAggregator'))();this.$FBRTCCallConnectionMonitor3=new (c('FBRTCRttAggregator'))();this.$FBRTCCallConnectionMonitor4=m;this.$FBRTCCallConnectionMonitor5=n;this.$FBRTCCallConnectionMonitor6=null;this.$FBRTCCallConnectionMonitor7=[];this.$FBRTCCallConnectionMonitor8=new (c('RingBuffer'))(i);this.$FBRTCCallConnectionMonitor9=0;this.$FBRTCCallConnectionMonitor4.addListener('connected',this.$FBRTCCallConnectionMonitor10,this);this.$FBRTCCallConnectionMonitor4.addListener('isEnding',this.$FBRTCCallConnectionMonitor11,this);}l.prototype.$FBRTCCallConnectionMonitor10=function(){'use strict';var m=this.$FBRTCCallConnectionMonitor12.bind(this);this.$FBRTCCallConnectionMonitor6=setInterval(m,h);this.$FBRTCCallConnectionMonitor12();};l.prototype.$FBRTCCallConnectionMonitor11=function(){'use strict';if(this.$FBRTCCallConnectionMonitor6!==null){this.$FBRTCCallConnectionMonitor12();clearInterval(this.$FBRTCCallConnectionMonitor6);this.$FBRTCCallConnectionMonitor6=null;}};l.prototype.$FBRTCCallConnectionMonitor12=function(){'use strict';this.$FBRTCCallConnectionMonitor4.getStats(function(m){var n;if(this.$FBRTCCallConnectionMonitor8.size()>0){n=this.$FBRTCCallConnectionMonitor8.head();this.$FBRTCCallConnectionMonitor13(m,n);}if(this.$FBRTCCallConnectionMonitor7.length<j)this.$FBRTCCallConnectionMonitor7.push(m);if(n&&n.isConnected()&&!m.isConnected())this.$FBRTCCallConnectionMonitor9+=1;this.$FBRTCCallConnectionMonitor9>=k;if(m.isConnected()){this.$FBRTCCallConnectionMonitor9=0;this.$FBRTCCallConnectionMonitor8.add(m);this.$FBRTCCallConnectionMonitor2.addRtt(m.audioRtt());this.$FBRTCCallConnectionMonitor3.addRtt(m.videoRtt());this.$FBRTCCallConnectionMonitor5.setPcStats(this.$FBRTCCallConnectionMonitor14());this.$FBRTCCallConnectionMonitor15(m,n);}}.bind(this));};l.prototype.$FBRTCCallConnectionMonitor14=function(){'use strict';var m=this.$FBRTCCallConnectionMonitor8.head();return {end:{conn_type:m.connectionType()},sender:{bytes:m.audioBytesSent(),codec:{'0':m.audioCodec()},plost:m.audioPacketsLost(),psent:m.audioPacketsSent(),rtt:this.$FBRTCCallConnectionMonitor2.toString()},video:{sender:{bytes:m.videoBytesSent(),codec:{'0':m.videoCodec()},plost:m.videoPacketsLost(),psent:m.videoPacketsSent(),rtt:this.$FBRTCCallConnectionMonitor3.toString()}}};};l.prototype.$FBRTCCallConnectionMonitor13=function(m,n){'use strict';if(n.videoPacketsLost()>m.videoPacketsLost())m.setVideoPacketsLost(n.videoPacketsLost());};l.prototype.$FBRTCCallConnectionMonitor15=function(m,n){'use strict';this.$FBRTCCallConnectionMonitor1.interpretStats(m,n);if(this.$FBRTCCallConnectionMonitor1.isNetworkPoor())this.emit('connectionPoor');};c('mixInEventEmitter')(l,{connectionPoor:true});f.exports=l;}),null);
__d('FBRTCFullScreenController',['FBRTCCallControlActions','FBRTCStore'],(function a(b,c,d,e,f,g){var h,i,j,k,l=document.documentElement;if(l.requestFullscreen){j=l.requestFullscreen.bind(l);k='fullscreenchange';}else if(l.msRequestFullscreen){j=l.msRequestFullscreen.bind(l);k='msfullscreenchange';}else if(l.mozRequestFullScreen){j=l.mozRequestFullScreen.bind(l);k='mozfullscreenchange';}else if(l.webkitRequestFullscreen){j=l.webkitRequestFullscreen.bind(l,Element.ALLOW_KEYBOARD_INPUT);k='webkitfullscreenchange';}var m;if(document.exitFullscreen){m=document.exitFullscreen.bind(document);}else if(document.msExitFullscreen){m=document.msExitFullscreen.bind(document);}else if(document.mozCancelFullScreen){m=document.mozCancelFullScreen.bind(document);}else if(document.webkitExitFullscreen)m=document.webkitExitFullscreen.bind(document);h=babelHelpers.inherits(n,c('FBRTCStore'));i=h&&h.prototype;function n(){'use strict';i.constructor.call(this);this.$FBRTCFullScreenController1=this.$FBRTCFullScreenController2.bind(this);document.addEventListener(k,this.$FBRTCFullScreenController1);}n.prototype.destroy=function(){'use strict';document.removeEventListener(k,this.$FBRTCFullScreenController1);i.destroy.call(this);};n.prototype.$FBRTCFullScreenController2=function(){'use strict';this.__emitChange();};n.prototype.supportsFullScreen=function(){'use strict';return j&&m;};n.prototype.isFullScreen=function(){'use strict';return !!(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement);};n.prototype.$FBRTCFullScreenController3=function(){'use strict';if(this.isFullScreen()){m();}else j();};n.prototype.__onDispatch=function(o){'use strict';switch(o.type){case c('FBRTCCallControlActions').Types.TOGGLE_FULL_SCREEN:this.$FBRTCFullScreenController3();break;}};f.exports=new n();}),null);
__d("XVideoCallUserInfoController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/videocall\/userinfo\/",{user_id:{type:"Int",required:true}});}),null);
__d('FBRTCPeerInfo',['ix','XVideoCallUserInfoController','FBRTCUtils'],(function a(b,c,d,e,f,g,h){function i(j){'use strict';this.peerID=j;this.peerPicUrl=null;this.selfPicUrl=h('/images/chat/webrtc/no_profile_pic.png');this.backgroundUrl=null;this.peerName='';this.peerShortName=null;}i.prototype.fetch=function(j,k){'use strict';var l=c('XVideoCallUserInfoController').getURIBuilder().setInt('user_id',this.peerID).getURI(),m=this;c('FBRTCUtils').sendServerRequest(l,function(n){m.peerPicUrl=n.payload.profile_pic_url;m.backgroundUrl=n.payload.cover_pic_url;m.peerName=n.payload.name;m.peerShortName=n.payload.peer_short_name;if(n.payload.self_profile_pic_url)m.selfPicUrl=n.payload.self_profile_pic_url;if(j)j();},k);};f.exports=i;}),null);
__d('FBRTCScreenSharingConstants',['keyMirror'],(function a(b,c,d,e,f,g){'use strict';var h=c('keyMirror')({DIRECT_SENDER:null,DIRECT_RECIPIENT:null,FROM_VIDEO_CALL:null}),i={UITypes:h};f.exports=i;}),null);
__d('FBRTCScreenSharingActions',['FBRTCDispatcher','keyMirror'],(function a(b,c,d,e,f,g){'use strict';var h=c('keyMirror')({END_SESSION:null,SWITCH_SCREEN:null}),i=c('keyMirror')({SDP_CREATED:null,REMOTE_DESCRIPTION_SET:null,LOCAL_ICE_CANDIDATE_CREATED:null,REMOTE_STREAM_ADDED:null,OFFER_ACK:null}),j={ConnectionEventTypes:i,ControlEventTypes:h,endSession:function k(){c('FBRTCDispatcher').dispatch({type:h.END_SESSION});},switchScreen:function k(){c('FBRTCDispatcher').dispatch({type:h.SWITCH_SCREEN});},sdpCreated:function k(l){c('FBRTCDispatcher').dispatch({type:i.SDP_CREATED,description:l});},remoteDescriptionSet:function k(){c('FBRTCDispatcher').dispatch({type:i.REMOTE_DESCRIPTION_SET});},localIceCandidateCreated:function k(l){c('FBRTCDispatcher').dispatch({type:i.LOCAL_ICE_CANDIDATE_CREATED,candidate:l});},remoteStreamAdded:function k(l){c('FBRTCDispatcher').dispatch({type:i.REMOTE_STREAM_ADDED,stream:l});},offerAckReceived:function k(){c('FBRTCDispatcher').dispatch({type:i.OFFER_ACK_RECEIVED});}};f.exports=j;}),null);
__d('FBRTCActiveMouseMixin',[],(function a(b,c,d,e,f,g){'use strict';var h=3000,i=[],j=null,k=false;function l(o){m(true);if(j!==null)clearTimeout(j);j=setTimeout(function(){j=null;m(false);},h);}function m(o){if(o===k)return;k=o;i.map(function(p){p(k);});}var n={componentWillMount:function o(){if(this.activeMouseCallback){if(i.length==0)window.addEventListener('mousemove',l);i.push(this.activeMouseCallback);}},componentWillUnmount:function o(){if(this.activeMouseCallback){var p=i.indexOf(this.activeMouseCallback);if(p>-1)i.splice(p,1);if(i.length==0){if(j!==null)clearTimeout(j);window.removeEventListener('mousemove',l);}}}};f.exports=n;}),null);
__d('FBRTCCallControlButton.react',['cx','React','emptyFunction'],(function a(b,c,d,e,f,g,h){'use strict';var i,j,k=c('React').PropTypes,l={END:0,FULL_SCREEN:1,MUTE:2,SETTINGS:3,SHARE_SCREEN:4,VIDEO:5};i=babelHelpers.inherits(m,c('React').PureComponent);j=i&&i.prototype;m.prototype.defaultProps=function(){return {active:false,disabled:false,endButton:false,highlighted:false};};m.prototype.render=function(){var n="_5lms"+(this.props.highlighted?' '+"_5lmy":'')+(this.props.endButton?' '+"_5lmz":''),o=this.props,p=o.iconType,q=o.active,r=o.disabled;return (c('React').createElement('button',{onClick:this.props.disabled?c('emptyFunction'):this.props.onClick,className:n,ref:this.props.ref,'data-testid':this.props['data-testid'],tabIndex:'0',role:'button','aria-label':this.props.title,'data-hover':r?undefined:'tooltip','data-tooltip-alignh':'center','data-tooltip-content':this.props.title},this.$FBRTCCallControlButton1(p,!!q,!!r)));};m.prototype.$FBRTCCallControlButton1=function(n,o,p){if(o)return (c('React').createElement('i',{className:"_5ln2"+(n===l.END?' '+"_5ln3":'')+(n===l.FULL_SCREEN?' '+"_5lng":'')+(n===l.MUTE?' '+"_5lnh":'')+(n===l.SETTINGS?' '+"_5lni":'')+(n===l.SHARE_SCREEN?' '+"_5lnj":'')+(n===l.VIDEO?' '+"_5lnk":'')}));return (c('React').createElement('i',{className:"_5ln2"+(p?' '+"_5h3-":'')+(n===l.END?' '+"_5ln3":'')+(n===l.FULL_SCREEN?' '+"_5lnl":'')+(n===l.MUTE?' '+"_5lnm":'')+(n===l.SETTINGS?' '+"_5lni":'')+(n===l.SHARE_SCREEN?' '+"_5lnn":'')+(n===l.VIDEO?' '+"_5lnp":'')}));};function m(){i.apply(this,arguments);}m.IconTypes=l;m.propTypes={active:k.bool,disabled:k.bool,endButton:k.bool,highlighted:k.bool,iconType:k.number.isRequired,onClick:k.func.isRequired,ref:k.string,title:k.node};f.exports=m;}),null);
__d('FBRTCScreenSharingControls.react',['cx','fbt','FBRTCActiveMouseMixin','FBRTCCallControlButton.react','FBRTCScreenSharingActions','FBRTCScreenSharingConstants','React'],(function a(b,c,d,e,f,g,h,i){'use strict';var j=c('React').PropTypes,k=c('React').createClass({displayName:'FBRTCScreenSharingControls',mixins:[c('FBRTCActiveMouseMixin')],propTypes:{uiType:j.string,canSwitchScreens:j.bool.isRequired},activeMouseCallback:function l(m){this.setState({mouseActive:m});},getDefaultProps:function l(){return {uiType:c('FBRTCScreenSharingConstants').UITypes.DIRECT_SENDER};},getInitialState:function l(){return {mouseActive:true};},_endSession:function l(){c('FBRTCScreenSharingActions').endSession();},_switchScreen:function l(){c('FBRTCScreenSharingActions').switchScreen();},render:function l(){return (c('React').createElement('div',{className:"_4bbt"},c('React').createElement('div',{className:this._wrapperClasses()},this._endSessionButton(),this._switchScreenButton())));},_endSessionButton:function l(){var m=i._("End screen share");return (c('React').createElement(c('FBRTCCallControlButton.react'),{endButton:true,title:m,iconType:c('FBRTCCallControlButton.react').IconTypes.END,onClick:this._endSession}));},_switchScreenButton:function l(){if(this.props.canSwitchScreens){var m=i._("Share new screen");return (c('React').createElement(c('FBRTCCallControlButton.react'),{iconType:c('FBRTCCallControlButton.react').IconTypes.SHARE_SCREEN,title:m,onClick:this._switchScreen}));}},_wrapperClasses:function l(){var m=this._isSender()?true:this.state.mouseActive;return "_4bbx"+(m?' '+"_4bbz":'');},_isSender:function l(){return this.props.uiType===c('FBRTCScreenSharingConstants').UITypes.DIRECT_SENDER;}});f.exports=k;}),null);
__d('FBRTCStreamWrapper',['mixInEventEmitter','FBRTCUtils'],(function a(b,c,d,e,f,g){var h=100,i=window.AudioContext||window.webkitAudioContext||window.mozAudioContext,j;function k(){'use strict';this.$FBRTCStreamWrapper1=true;this.$FBRTCStreamWrapper2=true;this.$FBRTCStreamWrapper3=null;this.$FBRTCStreamWrapper4=null;this.aspectRatio=k.aspectRatios.other;this.videoWidth=0;this.videoHeight=0;}k.prototype.setStream=function(l){var m=arguments.length<=1||arguments[1]===undefined?true:arguments[1];'use strict';var n=this.hasStream();this.stop();this.$FBRTCStreamWrapper3=l;this.$FBRTCStreamWrapper5();this.$FBRTCStreamWrapper6();if(m){this.$FBRTCStreamWrapper3.onaddtrack=this.$FBRTCStreamWrapper7.bind(this);this.$FBRTCStreamWrapper3.onremovetrack=this.$FBRTCStreamWrapper7.bind(this);this.$FBRTCStreamWrapper3.onended=this.$FBRTCStreamWrapper8.bind(this);if(n)this.emit('tracksChanged');}};k.prototype.getStreamId=function(){'use strict';return this.$FBRTCStreamWrapper3&&this.$FBRTCStreamWrapper3.id;};k.prototype.getStream=function(){'use strict';return this.$FBRTCStreamWrapper3;};k.prototype.hasStream=function(){'use strict';return !!this.$FBRTCStreamWrapper3;};k.prototype.stop=function(){'use strict';if(this.$FBRTCStreamWrapper3){k.stopStream(this.$FBRTCStreamWrapper3);this.$FBRTCStreamWrapper3=null;}};k.prototype.hasVideoTracks=function(){'use strict';if(this.$FBRTCStreamWrapper3&&this.$FBRTCStreamWrapper3.getVideoTracks)return this.$FBRTCStreamWrapper3.getVideoTracks().length>0;return true;};k.prototype.hasVideo=function(){'use strict';return this.$FBRTCStreamWrapper2&&this.hasVideoTracks();};k.prototype.hasAudioTracks=function(){'use strict';if(this.$FBRTCStreamWrapper3&&this.$FBRTCStreamWrapper3.getAudioTracks)return this.$FBRTCStreamWrapper3.getAudioTracks().length>0;return true;};k.prototype.hasAudio=function(){'use strict';return this.$FBRTCStreamWrapper1&&this.hasAudioTracks();};k.prototype.attachToVideoTag=function(l){'use strict';if(this.$FBRTCStreamWrapper3){this.$FBRTCStreamWrapper4=l;c('FBRTCUtils').attachMediaStream(l,this.$FBRTCStreamWrapper3);this.$FBRTCStreamWrapper9(l);}};k.prototype.getAudioAnalyser=function(){'use strict';if(this.$FBRTCStreamWrapper3){var l=this.$FBRTCStreamWrapper10(),m=l.createMediaStreamSource(this.$FBRTCStreamWrapper3),n=l.createAnalyser();n.fftSize=2048;m.connect(n);return n;}};k.prototype.$FBRTCStreamWrapper10=function(){'use strict';if(!j)j=new i();return j;};k.prototype.toggleMuteAudio=function(){'use strict';if(!this.hasAudioTracks())return;this.$FBRTCStreamWrapper1=!this.$FBRTCStreamWrapper1;this.$FBRTCStreamWrapper5();};k.prototype.$FBRTCStreamWrapper5=function(){'use strict';if(this.$FBRTCStreamWrapper3){var l=this.$FBRTCStreamWrapper3.getAudioTracks();for(var m=0;m<l.length;m++)l[m].enabled=this.$FBRTCStreamWrapper1;}};k.prototype.toggleMuteVideo=function(){'use strict';this.$FBRTCStreamWrapper2=!this.$FBRTCStreamWrapper2;if(this.$FBRTCStreamWrapper2){this.$FBRTCStreamWrapper6();}else setTimeout(this.$FBRTCStreamWrapper6.bind(this),500);this.$FBRTCStreamWrapper7();};k.prototype.$FBRTCStreamWrapper6=function(){'use strict';if(this.$FBRTCStreamWrapper3){var l=this.$FBRTCStreamWrapper3.getVideoTracks();for(var m=0;m<l.length;m++)l[m].enabled=this.$FBRTCStreamWrapper2;}};k.prototype.setVideoEnabled=function(l){'use strict';this.$FBRTCStreamWrapper2=l;this.$FBRTCStreamWrapper6();this.$FBRTCStreamWrapper7();};k.prototype.$FBRTCStreamWrapper9=function(l){'use strict';if(!this.hasVideo()||l.currentTime>0){this.$FBRTCStreamWrapper11(l);}else setTimeout(this.$FBRTCStreamWrapper9.bind(this,l),h);};k.prototype.$FBRTCStreamWrapper12=function(l){'use strict';this.videoWidth=l.videoWidth;this.videoHeight=l.videoHeight;var m=l.videoWidth/l.videoHeight;if(c('FBRTCUtils').aboutEqual(m,16/9))return k.aspectRatios['16:9'];if(c('FBRTCUtils').aboutEqual(m,4/3))return k.aspectRatios['4:3'];return k.aspectRatios.other;};k.prototype.$FBRTCStreamWrapper11=function(l){'use strict';if(this.hasVideo()){this.aspectRatio=this.$FBRTCStreamWrapper12(l);}else this.aspectRatio=k.aspectRatios.other;this.emit('streamStarted');};k.prototype.$FBRTCStreamWrapper8=function(){'use strict';this.emit('streamEnded');};k.prototype.$FBRTCStreamWrapper7=function(event){'use strict';if(this.$FBRTCStreamWrapper13(event))this.attachToVideoTag(this.$FBRTCStreamWrapper4);this.emit('tracksChanged');};k.prototype.$FBRTCStreamWrapper13=function(l){'use strict';return this.$FBRTCStreamWrapper4&&l&&l.type==='addtrack'&&l.track.kind==='video';};k.aspectRatios={'16:9':1,'4:3':2,other:3};c('mixInEventEmitter')(k,{streamStarted:true,streamEnded:true,tracksChanged:true});k.stopStream=function(l){if('active' in l){if(l.active)l.getTracks().forEach(function(m){m.stop();});}else if('stop' in l)l.stop();};f.exports=k;}),null);
__d('FBRTCScreenStreamWrapper',['FBRTCStreamWrapper'],(function a(b,c,d,e,f,g){'use strict';var h,i;h=babelHelpers.inherits(j,c('FBRTCStreamWrapper'));i=h&&h.prototype;j.prototype.toggleMuteAudio=function(){return;};j.prototype.toggleMuteVideo=function(){return;};function j(){h.apply(this,arguments);}f.exports=j;}),null);
__d('FBRTCVideo.react',['cx','EmitterSubscription','FBRTCStreamWrapper','FBRTCUtils','React','ReactDOM','joinClasses','shallowEqual'],(function a(b,c,d,e,f,g,h){'use strict';var i,j,k=c('React').PropTypes,l=c('React').Component;i=babelHelpers.inherits(m,l);j=i&&i.prototype;function m(){var n,o;for(var p=arguments.length,q=Array(p),r=0;r<p;r++)q[r]=arguments[r];return o=(n=j.constructor).call.apply(n,[this].concat(q)),this.state={currentStream:null},this.streamListener=null,o;}m.prototype.componentWillReceiveProps=function(n){var o=n.stream;if(o!==this.props.stream){if(this.streamListener)this.streamListener.remove();this.streamListener=o?o.addListener('streamStarted',function(){return this.$FBRTCVideo1();}.bind(this)):null;}};m.prototype.shouldComponentUpdate=function(n){return !c('shallowEqual')(this.props,n)||this.$FBRTCVideo2(n);};m.prototype.$FBRTCVideo2=function(n){var o=n.stream,p=o?o.getStream():null;return p!==this.state.currentStream;};m.prototype.render=function(){return (c('React').createElement('video',{className:c('joinClasses')(this.props.className,"_1yvx"),autoPlay:true,muted:this.props.muted,onContextMenu:function n(o){return o.preventDefault();}}));};m.prototype.componentDidMount=function(){this.$FBRTCVideo3();this.$FBRTCVideo1();};m.prototype.componentDidUpdate=function(n){if(this.$FBRTCVideo2(n)||n.mediaStream!==this.props.mediaStream)this.$FBRTCVideo3();if(n.audioSinkID!==this.props.audioSinkID)this.$FBRTCVideo1();};m.prototype.$FBRTCVideo3=function(){var n=this.props,o=n.stream,p=n.mediaStream,q=c('ReactDOM').findDOMNode(this);if(q)if(o){o.attachToVideoTag(q);this.setState({currentStream:o.getStream()});}else if(p)c('FBRTCUtils').attachMediaStream(q,p);};m.prototype.$FBRTCVideo1=function(){var n=this.props.audioSinkID,o=c('ReactDOM').findDOMNode(this);if(n&&o&&o.setSinkId)o.setSinkId(n);};m.defaultProps={muted:false};m.propTypes={audioSinkID:k.string,className:k.string,mediaStream:k.any,muted:k.bool,stream:k.instanceOf(c('FBRTCStreamWrapper'))};f.exports=m;}),null);
__d('FBRTCScreenSharingView.react',['cx','FBRTCCallControlActions','FBRTCScreenSharingConstants','FBRTCScreenStreamWrapper','FBRTCScreenSharingControls.react','FBRTCVideo.react','React'],(function a(b,c,d,e,f,g,h){'use strict';var i,j,k=c('React').PropTypes;i=babelHelpers.inherits(l,c('React').Component);j=i&&i.prototype;function l(){var m,n;for(var o=arguments.length,p=Array(o),q=0;q<o;q++)p[q]=arguments[q];return n=(m=j.constructor).call.apply(m,[this].concat(p)),this.$FBRTCScreenSharingView1=function(){return "_2uqm"+(this.props.isStandalone?' '+"_2uqn":'');}.bind(this),this.$FBRTCScreenSharingView6=function(){return "_2uqo";},this.$FBRTCScreenSharingView7=function(){return "_2uqp";},this.$FBRTCScreenSharingView4=function(){return "_2uqq"+(this.props.showOverlay?' '+"_1k3o":'');}.bind(this),this.$FBRTCScreenSharingView2=function(){if(!this.props.isStandalone)return (c('React').createElement('button',{className:this.$FBRTCScreenSharingView6(),onClick:c('FBRTCCallControlActions').openScreenInNewWindow},c('React').createElement('i',{className:this.$FBRTCScreenSharingView7()})));}.bind(this),this.$FBRTCScreenSharingView3=function(){if(this.$FBRTCScreenSharingView8())return (c('React').createElement(c('FBRTCScreenSharingControls.react'),{canSwitchScreens:this.props.canSwitchScreens,uiType:this.props.uiType}));}.bind(this),this.$FBRTCScreenSharingView9=function(){return this.props.uiType===c('FBRTCScreenSharingConstants').UITypes.DIRECT_SENDER;}.bind(this),this.$FBRTCScreenSharingView10=function(){return this.props.uiType===c('FBRTCScreenSharingConstants').UITypes.DIRECT_RECIPIENT;}.bind(this),this.$FBRTCScreenSharingView8=function(){return this.$FBRTCScreenSharingView9()||this.$FBRTCScreenSharingView10();}.bind(this),n;}l.prototype.render=function(){var m=this.props.isStandalone,n=this.props.screenStream,o=this.props.screenSrc;if(n&&n.hasStream()){return c('React').createElement('div',{className:this.$FBRTCScreenSharingView1()},this.$FBRTCScreenSharingView2(),this.$FBRTCScreenSharingView3(),c('React').createElement('div',{className:this.$FBRTCScreenSharingView4()},c('React').createElement(c('FBRTCVideo.react'),{className:"_3pb5 _1yvx",stream:n})));}else if(m&&o){return this.$FBRTCScreenSharingView5(o);}else return c('React').createElement('div',{className:"_2uql"});};l.prototype.$FBRTCScreenSharingView5=function(m){return (c('React').createElement('div',{className:this.$FBRTCScreenSharingView1()},c('React').createElement('div',{className:this.$FBRTCScreenSharingView4()},c('React').createElement('video',{className:"_3pb5 _1yvx",autoPlay:'true',muted:false,onContextMenu:function n(o){o.preventDefault();},src:decodeURIComponent(m)}))));};l.propTypes={canSwitchScreens:k.bool.isRequired,isStandalone:k.bool,screenStream:k.instanceOf(c('FBRTCScreenStreamWrapper')),screenSrc:k.string,uiType:k.string};l.defaultProps={isStandalone:false,uiType:c('FBRTCScreenSharingConstants').UITypes.FROM_VIDEO_CALL,showOverlay:false};f.exports=l;}),null);
__d("XScreenSharingController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/videocall\/screen_sharing\/",{peer_id:{type:"Int",required:true}});}),null);
__d('FBRTCScreenSharingUI',['FBRTCCallControlActions','FBRTCDispatcher','FBRTCScreenSharingActions','FBRTCScreenSharingConstants','FBRTCScreenSharingView.react','FBRTCScreenStreamWrapper','FBRTCUtils','React','ReactDOM','XScreenSharingController'],(function a(b,c,d,e,f,g){var h=false,i=null,j=null,k=false,l='FBRTCScreenSharingView/container',m={open:function n(o,p,q){k=false;var r=this._getUnsignedUri(q),s=o===c('FBRTCScreenSharingConstants').UITypes.DIRECT_SENDER;if(i){i.location.href=r.toString();}else i=this._openWindow(r.toString(),s);if(s)h=!c('FBRTCUtils').isCollabCallable(q);if(i)this._renderView(p,5,o,s);},close:function n(){if(i){var o=null;if(i.opener&&!i.opener.closed)o=i.opener;i.close();i=null;if(o)o.postMessage({recipient:'SC_CONTENT_SCRIPT',type:'SC_RESET_PORT',text:'reset comm port'},'*');}},switchScreen:function n(o,p){this._renderView(p,5,o);},hideRingingOverlay:function n(){if(!j)return;j=c('ReactDOM').render(c('React').createElement(c('FBRTCScreenSharingView.react'),babelHelpers['extends']({},j.props,{showOverlay:false})),m._getContainerNode());},isOpen:function n(){return i!==null;},openTempWindow:function n(){i=this._openWindow('',true);},_openWindow:function n(o,p){var q=this._windowPosition(p),r=['menubar=no','location=no','scrollbars=no','status=no','personalbar=no',q.height,q.width,q.top,q.left].join(','),s=window.open(o,'Screen Sharing',r);if(window.focus)s.focus();return s;},_onUnload:function n(o,p){if(this._isDirect(o)){c('FBRTCScreenSharingActions').endSession();}else{m.close();c('FBRTCDispatcher').dispatch({type:c('FBRTCCallControlActions').Types.CLOSE_STANDALONE_SCREEN});}},_getContainerNode:function n(){if(!i)return null;return i.document.getElementById(l);},_renderView:function n(o,p,q){var r=arguments.length<=3||arguments[3]===undefined?false:arguments[3];setTimeout(function(){setTimeout(function(){if(i!==null){var s=m._getContainerNode();if(s){j=c('ReactDOM').render(c('React').createElement(c('FBRTCScreenSharingView.react'),{isStandalone:true,uiType:q,screenStream:o,canSwitchScreens:h,showOverlay:r}),s);k=true;i.onunload=this._onUnload.bind(this,q);}}}.bind(this),1);if(p>1&&!k){this._renderView(o,p-1,q,r);}else k=false;}.bind(this),500);},_isDirect:function n(o){return o===c('FBRTCScreenSharingConstants').UITypes.DIRECT_RECIPIENT||o===c('FBRTCScreenSharingConstants').UITypes.DIRECT_SENDER;},_windowPosition:function n(o){var p=screen.availLeft,q=screen.availTop,r=o?448:960,s=o?252:540,t=Math.min(r,screen.width-p),u=Math.min(s,screen.height-q);return {height:'height='+u.toString(),width:'width='+t.toString(),top:'top='+q.toString(),left:'left='+p.toString()};},_getUnsignedUri:function n(o){return c('XScreenSharingController').getURIBuilder().setInt('peer_id',o).getURI();}};f.exports=m;}),null);
__d('FBRTCVideoDurationTracker',['performanceNow'],(function a(b,c,d,e,f,g){'use strict';var h=0;function i(j){this.$FBRTCVideoDurationTracker2=j;this.$FBRTCVideoDurationTracker1=0;this.$FBRTCVideoDurationTracker4=h;}i.prototype.startTracking=function(){if(this.$FBRTCVideoDurationTracker2.hasVideo())this.$FBRTCVideoDurationTracker4=this.$FBRTCVideoDurationTracker5();this.$FBRTCVideoDurationTracker3=this.$FBRTCVideoDurationTracker2.addListener('tracksChanged',function(){if(this.$FBRTCVideoDurationTracker2.hasVideo()&&!this.$FBRTCVideoDurationTracker4){this.$FBRTCVideoDurationTracker4=this.$FBRTCVideoDurationTracker5();}else if(!this.$FBRTCVideoDurationTracker2.hasVideo()){this.$FBRTCVideoDurationTracker1=this.getDuration();this.$FBRTCVideoDurationTracker4=h;}}.bind(this));};i.prototype.stopTracking=function(){this.$FBRTCVideoDurationTracker1=this.getDuration();this.$FBRTCVideoDurationTracker4=h;if(this.$FBRTCVideoDurationTracker3){this.$FBRTCVideoDurationTracker3.remove();this.$FBRTCVideoDurationTracker3=null;}};i.prototype.getDuration=function(){if(this.$FBRTCVideoDurationTracker4!==h){var j=this.$FBRTCVideoDurationTracker5()-this.$FBRTCVideoDurationTracker4;return this.$FBRTCVideoDurationTracker1+j;}return this.$FBRTCVideoDurationTracker1;};i.prototype.$FBRTCVideoDurationTracker5=function(){return c('performanceNow')();};f.exports=i;}),null);
__d('FBRTCCallModel',['Bootloader','CollabCallMessengerBrowserEventEnum','FBRTCAdminMessage','FBRTCCallConstants','FBRTCCallControlActions','FBRTCConfig','FBRTCFullScreenController','FBRTCLogger','FBRTCPCConfig','FBRTCPeerInfo','FBRTCScreenSharingConstants','FBRTCScreenSharingUI','FBRTCStore','FBRTCStreamWrapper','FBRTCStruct','FBRTCUtils','FBRTCVideoDurationTracker','RTCConfig'],(function a(b,c,d,e,f,g){var h,i;h=babelHelpers.inherits(j,c('FBRTCStore'));i=h&&h.prototype;function j(k){'use strict';i.constructor.call(this);this.$FBRTCCallModel1=c('FBRTCLogger').getInstance();this.isCaller=k.isCaller;this.peerID=k.peerID;this.$FBRTCCallModel2=k.isAudioOnly;this.$FBRTCCallModel3=new (c('FBRTCPeerInfo'))(k.peerID);this.$FBRTCCallModel4=false;this.resetCallInfo(k.callID);this.$FBRTCCallModel5();this.$FBRTCCallModel6(true);}j.prototype.resetForReconnect=function(k){'use strict';this.isCaller=false;this.resetCallInfo(k);this.$FBRTCCallModel6(false);};j.prototype.fetchPeerInfo=function(){'use strict';if(c('FBRTCUtils').isGroupCallable(this.peerID))return;var k=this,l=function n(){k.__emitChange();},m=function n(){k.$FBRTCCallModel1.logError(k.peerID,k.callID,'Failed to get remote photos');};this.$FBRTCCallModel3.fetch(l,m);};j.prototype.setSignalingExperiments=function(k){'use strict';if(k||k===[])this.$FBRTCCallModel7=k;};j.prototype.supportsSdpUpdate=function(){'use strict';var k='sdp_update';return this.$FBRTCCallModel7.indexOf(k)!==-1&&c('FBRTCConfig').supportedSignalingExperiments().indexOf(k)!==-1;};j.prototype.supportsMultipleStreamsPlanB=function(){'use strict';var k='multiple_streams_plan_b';return this.$FBRTCCallModel7.indexOf(k)!==-1&&c('FBRTCConfig').supportedSignalingExperiments().indexOf(k)!==-1;};j.prototype.canPeerReceiveScreenSharing=function(){'use strict';return this.$FBRTCCallModel7.indexOf('screen_sharing')!==-1||c('FBRTCConfig').isVCEndpointCall();};j.prototype.onSDPMessageFromPeer=function(k){'use strict';this.isRemoteVideoSupported=k.isRemoteVideoSupported();this.isPeerOnMobile=k.isFromMobile();if(!this.isRemoteVideoSupported)this.localStream.setVideoEnabled(false);};j.prototype.$FBRTCCallModel5=function(){'use strict';this.remoteStream=new (c('FBRTCStreamWrapper'))();this.localStream=new (c('FBRTCStreamWrapper'))();this.localStream.addListener('tracksChanged',function(){if(!this.$FBRTCCallModel8&&this.localStream.hasVideo())this.$FBRTCCallModel9=true;this.$FBRTCCallModel10(c('CollabCallMessengerBrowserEventEnum').LOCAL_STREAM_TRACKS_CHANGED,this.localStream.getStream());this.__emitChange();}.bind(this));this.$FBRTCCallModel11=new (c('FBRTCVideoDurationTracker'))(this.remoteStream);this.$FBRTCCallModel12=new (c('FBRTCVideoDurationTracker'))(this.localStream);};j.prototype.resetCallInfo=function(k){'use strict';this.callID=k;this.$FBRTCCallModel13=new (c('FBRTCAdminMessage'))(this.peerID,k);this.startTime=new Date();this.endCallReason=null;this.endCallSubreason=null;this.isRemoteEnded=null;this.wasConnected=false;this.receivedNack=false;this.isRemoteVideoSupported=true;this.isPeerOnMobile=false;this.$FBRTCCallModel14=null;this.$FBRTCCallModel8=true;this.$FBRTCCallModel9=false;this.$FBRTCCallModel7=[];this.$FBRTCCallModel15=null;};j.prototype.$FBRTCCallModel6=function(k){'use strict';this.selfViewOpen=true;this.uiState=j.UIState.INIT;this.__emitChange();};j.prototype.getLocalVideoDuration=function(){'use strict';return this.$FBRTCCallModel12.getDuration();};j.prototype.getRemoteVideoDuration=function(){'use strict';return this.$FBRTCCallModel11.getDuration();};j.prototype.setLocalStream=function(k){'use strict';this.localStream.setStream(k);this.$FBRTCCallModel10(c('CollabCallMessengerBrowserEventEnum').LOCAL_STREAM_SET,k);};j.prototype.setLocalScreenStream=function(k){'use strict';this.$FBRTCCallModel4=k!==null;this.selfViewOpen=true;this.$FBRTCCallModel14=k;this.__emitChange();};j.prototype.getLocalScreenStream=function(){'use strict';return this.$FBRTCCallModel14;};j.prototype.setRemoteStream=function(k){'use strict';this.remoteStream.setStream(k);this.remoteStream.once('streamStarted',function(){this.setStateFrom(j.UIState.CALL_CONNECTING,j.UIState.CALL_CONNECTED);this.$FBRTCCallModel10(c('CollabCallMessengerBrowserEventEnum').REMOTE_STREAM_STARTED,this.remoteStream.getStream());}.bind(this));this.remoteStream.addListener('tracksChanged',function(){this.$FBRTCCallModel10(c('CollabCallMessengerBrowserEventEnum').REMOTE_STREAM_TRACKS_CHANGED,this.remoteStream.getStream());this.__emitChange();}.bind(this));this.$FBRTCCallModel10(c('CollabCallMessengerBrowserEventEnum').REMOTE_STREAM_SET,k);this.__emitChange();};j.prototype.setRemoteScreenStream=function(k){'use strict';this.$FBRTCCallModel15=k;this.__emitChange();};j.prototype.getRemoteScreenStream=function(){'use strict';return this.$FBRTCCallModel15;};j.prototype.canStartCall=function(k){'use strict';return this.localStream.hasStream()&&(c('FBRTCPCConfig').turnIP||c('FBRTCConfig').isVCEndpointCall()&&c('RTCConfig').CollabDisableBrowserTurnDiscoveryGK);};j.prototype.isAwaitingUserStart=function(){'use strict';return this.uiState===j.UIState.AWAITING_USER_START;};j.prototype.canBeStartedByParentWindow=function(){'use strict';return this.uiState===j.UIState.INIT;};j.prototype.isInProgress=function(){'use strict';return this.uiState>=j.UIState.CONTACTING&&this.uiState<j.UIState.CALL_ENDED;};j.prototype.isUserMediaPending=function(){'use strict';return this.uiState===j.UIState.PENDING_LOCAL_MEDIA;};j.prototype.isUserMediaDenied=function(){'use strict';return this.uiState===j.UIState.USER_MEDIA_DENIED;};j.prototype.isConnected=function(){'use strict';return this.uiState===j.UIState.CALL_CONNECTED;};j.prototype.isRemoteVideoActive=function(){'use strict';return this.uiState===j.UIState.CALL_CONNECTED&&this.remoteStream.hasVideo();};j.prototype.isEnded=function(){'use strict';return this.uiState>=j.UIState.CALL_ENDED;};j.prototype.isAwaitingAnswer=function(){'use strict';return this.uiState==j.UIState.CONTACTING||this.uiState==j.UIState.RINGING;};j.prototype.isFullScreen=function(){'use strict';return c('FBRTCFullScreenController').isFullScreen();};j.prototype.isScreenSharingEnabled=function(){'use strict';return this.$FBRTCCallModel4;};j.prototype.peerPicUrl=function(){'use strict';return this.$FBRTCCallModel3.peerPicUrl;};j.prototype.selfPicUrl=function(){'use strict';return this.$FBRTCCallModel3.selfPicUrl;};j.prototype.backgroundUrl=function(){'use strict';return this.$FBRTCCallModel3.backgroundUrl;};j.prototype.peerName=function(){'use strict';return this.$FBRTCCallModel3.peerName;};j.prototype.peerShortName=function(){'use strict';if(this.$FBRTCCallModel3.peerShortName)return this.$FBRTCCallModel3.peerShortName;return this.$FBRTCCallModel3.peerName;};j.prototype.autoDisableVideo=function(){'use strict';if(this.$FBRTCCallModel8){this.$FBRTCCallModel8=false;this.$FBRTCCallModel1.logCallAction(this.peerID,this.callID,c('FBRTCLogger').CallAction.AUTO_DISABLE_VIDEO);this.localStream.setVideoEnabled(false);}};j.prototype.videoIsAutoDisabled=function(){'use strict';return !this.$FBRTCCallModel8&&!this.$FBRTCCallModel9&&!this.localStream.hasVideo();};j.prototype.$FBRTCCallModel16=function(){'use strict';this.localStream.toggleMuteAudio();this.$FBRTCCallModel1.logCallAction(this.peerID,this.callID,c('FBRTCLogger').CallAction.SET_MUTE,!this.localStream.hasAudio()?'true':'false');this.__emitChange();};j.prototype.$FBRTCCallModel17=function(k){'use strict';this.localStream.toggleMuteVideo();this.$FBRTCCallModel1.logCallAction(this.peerID,this.callID,c('FBRTCLogger').CallAction.SET_VIDEO_ON,this.localStream.hasVideo());this.__emitChange();};j.prototype.toggleSelfView=function(){'use strict';this.selfViewOpen=!this.selfViewOpen;this.$FBRTCCallModel1.logCallAction(this.peerID,this.callID,c('FBRTCLogger').CallAction.SET_SELF_VIEW_ON,!this.selfViewOpen?'true':'false');this.__emitChange();};j.prototype.setState=function(k){'use strict';if(k===this.uiState)return;var l=this.uiState;this.uiState=k;switch(k){case j.UIState.CALL_CONNECTED:this.wasConnected=true;this.$FBRTCCallModel13.onCallConnected();this.$FBRTCCallModel11.startTracking();this.$FBRTCCallModel12.startTracking();break;case j.UIState.CALL_ENDED:this.$FBRTCCallModel13.onCallEnded();this.$FBRTCCallModel11.stopTracking();this.$FBRTCCallModel12.stopTracking();if(this.isCaller&&l>j.UIState.MORE_INIT)this.$FBRTCCallModel13.submit(this.$FBRTCCallModel18(),this.endCallReason);break;}this.$FBRTCCallModel1.logInfo(this.peerID,this.callID,'UI: state change - "'+j.UIState.strNames[l]+'" to "'+j.UIState.strNames[k]+'"');this.__emitChange();};j.prototype.$FBRTCCallModel18=function(){'use strict';return !this.$FBRTCCallModel2||this.getLocalVideoDuration()>0&&this.getRemoteVideoDuration()>0?c('FBRTCCallConstants').FBRTCCallType.VIDEO_CALL:c('FBRTCCallConstants').FBRTCCallType.VOICE_CALL;};j.prototype.setStateFrom=function(k,l){'use strict';if(this.uiState===k){this.setState(l);}else this.$FBRTCCallModel1.logInfo(this.peerID,this.callID,'UI: Not at "'+j.UIState.strNames[k]+'", not moving to "'+j.UIState.strNames[l]+'"');};j.prototype.$FBRTCCallModel10=function(event,k){'use strict';if(!c('FBRTCConfig').isVCEndpointCall())return;c('Bootloader').loadModules(["CollabMessengerLogger"],function(l){return l.log(event,{peerID:this.peerID,callID:this.callID,eventDetails:k});}.bind(this),'FBRTCCallModel');};j.prototype.__onDispatch=function(k){'use strict';switch(k.type){case c('FBRTCCallControlActions').Types.TOGGLE_MUTE_AUDIO:this.$FBRTCCallModel16();break;case c('FBRTCCallControlActions').Types.TOGGLE_MUTE_VIDEO:this.$FBRTCCallModel17();break;case c('FBRTCCallControlActions').Types.CLOSE_STANDALONE_SCREEN:this.__emitChange();break;case c('FBRTCCallControlActions').Types.TOGGLE_SELF_VIEW:this.toggleSelfView();break;case c('FBRTCCallControlActions').Types.OPEN_SCREEN_IN_NEW:c('FBRTCScreenSharingUI').open(c('FBRTCScreenSharingConstants').UITypes.FROM_VIDEO_CALL,this.$FBRTCCallModel15,this.peerID);this.__emitChange();break;}};j.UIState=new (c('FBRTCStruct'))(['INIT','AWAITING_USER_START','PENDING_LOCAL_MEDIA','USER_MEDIA_DENIED','MORE_INIT','CONTACTING','RINGING','CALL_CONNECTING','CALL_CONNECTED','CALL_ENDED','COLLECT_RATING']);f.exports=j;}),null);
__d('FBRTCDialog.react',['MessengerDialog.react','XUIDialog.react','FBRTCConfig'],(function a(b,c,d,e,f,g){f.exports=c('FBRTCConfig').isMessengerDotCom()?c('MessengerDialog.react'):c('XUIDialog.react');}),null);
__d('FBRTCDialogBody.react',['MessengerDialogBody.react','XUIDialogBody.react','FBRTCConfig'],(function a(b,c,d,e,f,g){f.exports=c('FBRTCConfig').isMessengerDotCom()?c('MessengerDialogBody.react'):c('XUIDialogBody.react');}),null);
__d('FBRTCDialogFooter.react',['MessengerDialogFooter.react','XUIDialogFooter.react','FBRTCConfig'],(function a(b,c,d,e,f,g){f.exports=c('FBRTCConfig').isMessengerDotCom()?c('MessengerDialogFooter.react'):c('XUIDialogFooter.react');}),null);
__d('FBRTCDialogTitle.react',['FBRTCConfig','MessengerDialogTitle.react','MessengerDialogHeader.react','React','XUIDialogTitle.react'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=c('React').PropTypes;h=babelHelpers.inherits(k,c('React').PureComponent);i=h&&h.prototype;k.prototype.render=function(){var l=this.props,m=l.className,n=l.showCloseButton,o=babelHelpers.objectWithoutProperties(l,['className','showCloseButton']);if(c('FBRTCConfig').isMessengerDotCom())return (c('React').createElement(c('MessengerDialogHeader.react'),null,c('React').createElement(c('MessengerDialogTitle.react'),babelHelpers['extends']({className:m,showCloseButton:n},o),this.props.children)));return (c('React').createElement(c('XUIDialogTitle.react'),babelHelpers['extends']({className:m,showCloseButton:n},o),this.props.children));};function k(){h.apply(this,arguments);}k.propTypes={showCloseButton:j.bool.isRequired};f.exports=k;}),null);
__d('FBRTCMediaAccessErrorDialog.react',['fbt','React','Link.react','FBRTCDialog.react','FBRTCDialogBody.react','FBRTCDialogFooter.react','FBRTCDialogTitle.react','FBRTCConfig'],(function a(b,c,d,e,f,g,h){var i,j;i=babelHelpers.inherits(k,c('React').Component);j=i&&i.prototype;function k(){var l,m;'use strict';for(var n=arguments.length,o=Array(n),p=0;p<n;p++)o[p]=arguments[p];return m=(l=j.constructor).call.apply(l,[this].concat(o)),this.$FBRTCMediaAccessErrorDialog1=function(){return (c('React').createElement('p',null,h._("Connect a camera and a microphone to make a call. If they're already connected, try restarting your browser and closing any other applications that use a camera or microphone.")));},this.$FBRTCMediaAccessErrorDialog2=function(){return (c('React').createElement('span',null,h._("Still need help? See our {troubleShootingGuideLink}",[h.param('troubleShootingGuideLink',c('React').createElement(c('Link.react'),{href:c('FBRTCConfig').userMediaErrorUrl(),target:'_blank'},h._("Troubleshooting Guide")))])));},m;}k.prototype.render=function(){'use strict';return c('React').createElement(c('FBRTCDialog.react'),{shown:true,width:440,layerHideOnBlur:false},c('React').createElement(c('FBRTCDialogTitle.react'),{showCloseButton:false},c('React').createElement('span',null,h._("Can't Make Call"))),c('React').createElement(c('FBRTCDialogBody.react'),null,this.$FBRTCMediaAccessErrorDialog1()),c('React').createElement(c('FBRTCDialogFooter.react'),{leftContent:this.$FBRTCMediaAccessErrorDialog2()}));};f.exports=k;}),null);
__d('FBRTCPeerBrowserUnsupportedDialog.react',['fbt','React','Link.react','XUIDialog.react','XUIDialogBody.react','XUIDialogFooter.react','XUIDialogTitle.react','FBRTCConfig'],(function a(b,c,d,e,f,g,h){var i,j;i=babelHelpers.inherits(k,c('React').Component);j=i&&i.prototype;function k(){var l,m;'use strict';for(var n=arguments.length,o=Array(n),p=0;p<n;p++)o[p]=arguments[p];return m=(l=j.constructor).call.apply(l,[this].concat(o)),this.$FBRTCPeerBrowserUnsupportedDialog1=function(){var q=this.props.peerName;return (c('React').createElement('p',null,h._("{name} isn't using a browser that supports video calling yet.",[h.param('name',q)])));}.bind(this),this.$FBRTCPeerBrowserUnsupportedDialog2=function(){return (c('React').createElement('span',null,h._("Still need help? See our {troubleShootingGuideLink}",[h.param('troubleShootingGuideLink',c('React').createElement(c('Link.react'),{href:c('FBRTCConfig').unsupportedBrowserUrl(),target:'_blank'},h._("Troubleshooting Guide")))])));},m;}k.prototype.render=function(){'use strict';return c('React').createElement(c('XUIDialog.react'),{shown:true,width:440},c('React').createElement(c('XUIDialogTitle.react'),{showCloseButton:false},c('React').createElement('span',null,h._("Can't connect Call"))),c('React').createElement(c('XUIDialogBody.react'),null,this.$FBRTCPeerBrowserUnsupportedDialog1()),c('React').createElement(c('XUIDialogFooter.react'),{leftContent:this.$FBRTCPeerBrowserUnsupportedDialog2()}));};f.exports=k;}),null);
__d('FBRTCScreenSharingInstallExtensionDialog.react',['fbt','React','FBRTCCallControlActions','FBRTCLogger','FBRTCScreenSharingLogger','LinkshimCallsites','ScreenSharingWebDriverIDs','URI','FBRTCDialogFooter.react','LinkshimLink.react','XUIDialog.react','XUIDialogBody.react','XUIDialogButton.react','XUIDialogCancelButton.react','XUIDialogTitle.react'],(function a(b,c,d,e,f,g,h){'use strict';var i,j,k=c('React').PropTypes,l='https://chrome.google.com/webstore/detail/degmgkchmbgaognjjlhggmhbcpicdifm';i=babelHelpers.inherits(m,c('React').Component);j=i&&i.prototype;function m(){var n,o;for(var p=arguments.length,q=Array(p),r=0;r<p;r++)q[r]=arguments[r];return o=(n=j.constructor).call.apply(n,[this].concat(q)),this.$FBRTCScreenSharingInstallExtensionDialog1=function(){return (c('React').createElement('div',null,c('React').createElement('p',null,h._("To share your screen, you'll need to install an extension. Then you can return here to start your call again.")),c('React').createElement(c('LinkshimLink.react'),{uri:new (c('URI'))(l),callsite:c('LinkshimCallsites').THIRD_PARTY_URL,target:'_blank',onClick:this.$FBRTCScreenSharingInstallExtensionDialog3},h._("Install screen sharing extension"))));}.bind(this),this.$FBRTCScreenSharingInstallExtensionDialog3=function(){c('FBRTCScreenSharingLogger').getInstance().logAction(this.props.peerID,this.props.sessionID,c('FBRTCScreenSharingLogger').Action.SCREEN_SHARING_EXT_LINK,false);}.bind(this),this.$FBRTCScreenSharingInstallExtensionDialog2=function(){c('FBRTCCallControlActions').resetCall(c('FBRTCLogger').Trigger.RESET_CALL);},o;}m.prototype.componentDidMount=function(){c('FBRTCScreenSharingLogger').getInstance().logAction(this.props.peerID,this.props.sessionID,c('FBRTCScreenSharingLogger').Action.SCREEN_SHARING_EXT_DIALOG,false);};m.prototype.render=function(){return c('React').createElement(c('XUIDialog.react'),{shown:true,width:440,layerHideOnBlur:false},c('React').createElement(c('XUIDialogTitle.react'),{showCloseButton:true},c('React').createElement('span',null,h._("Please install screen sharing extension"))),c('React').createElement(c('XUIDialogBody.react'),{'data-testid':c('ScreenSharingWebDriverIDs').INSTALL_EXT_DIALOG},this.$FBRTCScreenSharingInstallExtensionDialog1()),c('React').createElement(c('FBRTCDialogFooter.react'),null,c('React').createElement(c('XUIDialogCancelButton.react'),null),c('React').createElement(c('XUIDialogButton.react'),{label:h._("Call Again"),use:'confirm',onClick:this.$FBRTCScreenSharingInstallExtensionDialog2})));};m.propTypes={onToggle:k.func.isRequired,peerID:k.number.isRequired,sessionID:k.number.isRequired};f.exports=m;}),null);
__d('FBRTCScreenSharingModel',['Event','FBRTCScreenSharingLogger','FBRTCScreenStreamWrapper','FBRTCStore'],(function a(b,c,d,e,f,g){'use strict';var h,i;h=babelHelpers.inherits(j,c('FBRTCStore'));i=h&&h.prototype;function j(k,l){i.constructor.call(this);this.$FBRTCScreenSharingModel3=null;this.$FBRTCScreenSharingModel4=new (c('FBRTCScreenStreamWrapper'))();this.$FBRTCScreenSharingModel5=c('FBRTCScreenSharingLogger').getInstance();this.$FBRTCScreenSharingModel1=k;this.$FBRTCScreenSharingModel2=l;}j.prototype.isEnabled=function(){return !!this.$FBRTCScreenSharingModel3;};j.prototype.setStream=function(k){var l=arguments.length<=1||arguments[1]===undefined?false:arguments[1],m=arguments.length<=2||arguments[2]===undefined?false:arguments[2];if(k&&(!l||m))c('Event').listen(k.getVideoTracks()[0],'ended',this.__emitChange.bind(this));if(this.$FBRTCScreenSharingModel4===null)this.$FBRTCScreenSharingModel4=new (c('FBRTCScreenStreamWrapper'))();this.$FBRTCScreenSharingModel4.setStream(k,!l);};j.prototype.getStream=function(){return this.$FBRTCScreenSharingModel4;};j.prototype.getPeerID=function(){return this.$FBRTCScreenSharingModel1;};j.prototype.getSessionID=function(){return this.$FBRTCScreenSharingModel2;};j.prototype.onStart=function(k){if(!k){this.$FBRTCScreenSharingModel5.logToConsole(null,null,'Invalid stream id');return;}this.$FBRTCScreenSharingModel5.logToConsole(null,null,'Enabling screen sharing');this.$FBRTCScreenSharingModel3=k;};j.prototype.onStop=function(){this.$FBRTCScreenSharingModel3=null;if(this.$FBRTCScreenSharingModel4)this.$FBRTCScreenSharingModel4.stop();};j.prototype.__onDispatch=function(k){};f.exports=j;}),null);
__d('FBRTCScreenSharingUnsupportedBrowserDialog.react',['cx','fbt','ix','React','Image.react','Link.react','Layout.react','XUIDialog.react','XUIDialogBody.react','XUIDialogTitle.react','XUIText.react','FBRTCVersionDetection'],(function a(b,c,d,e,f,g,h,i,j){'use strict';var k,l,m=c('Layout.react').Column;k=babelHelpers.inherits(n,c('React').Component);l=k&&k.prototype;function n(){var o,p;for(var q=arguments.length,r=Array(q),s=0;s<q;s++)r[s]=arguments[s];return p=(o=l.constructor).call.apply(o,[this].concat(r)),this.$FBRTCScreenSharingUnsupportedBrowserDialog1=function(){var t=null;if(c('FBRTCVersionDetection').isChrome()){t=i._("Update browser to share your screen");}else t=i._("Switch browsers to share your screen");return (c('React').createElement('span',null,t));},this.$FBRTCScreenSharingUnsupportedBrowserDialog2=function(){var t=null;if(c('FBRTCVersionDetection').isChrome()){t=this.$FBRTCScreenSharingUnsupportedBrowserDialog4();}else t=this.$FBRTCScreenSharingUnsupportedBrowserDialog5();return (c('React').createElement('p',null,t));}.bind(this),this.$FBRTCScreenSharingUnsupportedBrowserDialog4=function(){return i._("Screen sharing doesn't work in the older version of Google Chrome that you're using. To share your screen, please update Google Chrome.");},this.$FBRTCScreenSharingUnsupportedBrowserDialog5=function(){if(c('FBRTCVersionDetection').isFirefox()){return i._("Screen sharing doesn't work in Mozilla Firefox yet. To share your screen, please open Facebook in Google Chrome.");}else return i._("Screen sharing doesn't work in your browser yet. To share your screen, please open Facebook in Google Chrome.");},this.$FBRTCScreenSharingUnsupportedBrowserDialog3=function(){return (c('React').createElement(c('Layout.react'),null,c('React').createElement(m,{style:{width:'100%',textAlign:'center'}},c('React').createElement(c('Link.react'),{href:'https://www.google.com/chrome/index.html',target:'_blank'},c('React').createElement(c('Image.react'),{className:"_4_if",src:j('/images/chat/webrtc/chrome.png'),alt:'Chrome',width:'64'}),c('React').createElement(c('XUIText.react'),{display:'block'},'Google Chrome')))));},p;}n.prototype.render=function(){return c('React').createElement(c('XUIDialog.react'),{shown:true,width:440,layerHideOnBlur:false},c('React').createElement(c('XUIDialogTitle.react'),{showCloseButton:true},this.$FBRTCScreenSharingUnsupportedBrowserDialog1()),c('React').createElement(c('XUIDialogBody.react'),null,this.$FBRTCScreenSharingUnsupportedBrowserDialog2(),this.$FBRTCScreenSharingUnsupportedBrowserDialog3()));};f.exports=n;}),null);
__d('FBRTCAudioSpectrumAnalyser.react',['React','ReactDOM','cancelAnimationFrame','requestAnimationFrame'],(function a(b,c,d,e,f,g){var h,i,j=7,k=3,l=9,m='#3B5998',n='#CCCCCC',o=function r(s,t,u,v){var w=v?n:m;t+=k;u-=k;s.beginPath();s.arc(t,u,k,0,2*Math.PI,false);s.fillStyle=w;s.strokeStyle=w;s.fill();},p=function r(s,t,u){var v,w,x=t.width/l,y=Math.floor(t.height/j),z=new Uint8Array(2048);s.getByteFrequencyData(z);u.clearRect(0,0,t.width,t.height);var aa=Math.floor(z.length/(l*3));for(var ba=0;ba<l;ba+=1){v=0;for(var ca=0;ca<aa;ca+=1)v+=z[ba*aa+ca];w=v*j/(aa*256);if(w<1)w=.6;for(var da=0;da<Math.floor(w);da++)o(u,ba*x,t.height-da*y);if(w-Math.floor(w)>=.5)o(u,ba*x,t.height-da*y,true);}};h=babelHelpers.inherits(q,c('React').Component);i=h&&h.prototype;function q(){var r,s;'use strict';for(var t=arguments.length,u=Array(t),v=0;v<t;v++)u[v]=arguments[v];return s=(r=i.constructor).call.apply(r,[this].concat(u)),this.$FBRTCAudioSpectrumAnalyser1=false,this.$FBRTCAudioSpectrumAnalyser2=null,this.$FBRTCAudioSpectrumAnalyser5=function(){var w=this.props.stream?this.props.stream.getStream():null;return w!==this.$FBRTCAudioSpectrumAnalyser6;}.bind(this),this.$FBRTCAudioSpectrumAnalyser4=function(){this.$FBRTCAudioSpectrumAnalyser1=false;c('cancelAnimationFrame')(this.$FBRTCAudioSpectrumAnalyser2);}.bind(this),this.$FBRTCAudioSpectrumAnalyser3=function(){var w=this.props.stream.getAudioAnalyser();if(!this.$FBRTCAudioSpectrumAnalyser1&&w){this.$FBRTCAudioSpectrumAnalyser1=true;var x=c('ReactDOM').findDOMNode(this),y=x.getContext('2d');this.$FBRTCAudioSpectrumAnalyser7(w,x,y);}}.bind(this),this.$FBRTCAudioSpectrumAnalyser7=function(w,x,y){this.$FBRTCAudioSpectrumAnalyser2=c('requestAnimationFrame')(function(){if(!this.$FBRTCAudioSpectrumAnalyser1)return;p(w,x,y);this.$FBRTCAudioSpectrumAnalyser7(w,x,y);}.bind(this));}.bind(this),s;}q.prototype.componentDidMount=function(){'use strict';this.$FBRTCAudioSpectrumAnalyser3();};q.prototype.componentWillUnmount=function(){'use strict';this.$FBRTCAudioSpectrumAnalyser4();};q.prototype.shouldComponentUpdate=function(r,s){'use strict';return this.$FBRTCAudioSpectrumAnalyser5();};q.prototype.componentDidUpdate=function(r,s){'use strict';this.$FBRTCAudioSpectrumAnalyser4();this.$FBRTCAudioSpectrumAnalyser3();};q.prototype.render=function(){'use strict';return c('React').createElement('canvas',{width:'106',height:'80'});};f.exports=q;}),null);
__d('FBRTCAudioConstraints',['FBRTCConstants','FBRTCVersionDetection'],(function a(b,c,d,e,f,g){'use strict';function h(i){var j=arguments.length<=1||arguments[1]===undefined?null:arguments[1];this.streamType=i;this.audioSource=j;}h.prototype.getConstraints=function(){if(this.streamType===c('FBRTCConstants').StreamType.SCREEN_CONTENT&&c('FBRTCVersionDetection').isChrome())return false;if(!this.audioSource)return true;return {optional:[{sourceId:this.audioSource}]};};f.exports=h;}),null);
__d('FBRTCExperiment',['FBRTCExperimentsConfig','QE'],(function a(b,c,d,e,f,g){'use strict';h.gen=function(i){var j={params:{},in_experiment:false,auto_exposure:false},k=c('FBRTCExperimentsConfig')[i]||j,l=new h(i,k.params,k.in_experiment);if(k.auto_exposure)l.logExposure(i);return l;};function h(i,j,k){this.$FBRTCExperiment2=i;this.$FBRTCExperiment3=j;this.$FBRTCExperiment1=k;}h.prototype.logExposure=function(){if(this.$FBRTCExperiment1)c('QE').logExposure(this.$FBRTCExperiment2);};h.prototype.getParam=function(i,j){if(this.$FBRTCExperiment3[i])return this.$FBRTCExperiment3[i].toString();return j;};h.prototype.getInt=function(i,j){if(this.$FBRTCExperiment3[i])return parseInt(this.$FBRTCExperiment3[i],10);return j;};h.prototype.getBool=function(i,j){var k=this.$FBRTCExperiment3;if(k[i])return k[i]==='1'||k[i]===1||k[i]==='true';return j;};f.exports=h;}),null);
__d('FBRTCVideoConstraints',['UserAgent','FBRTCConstants','RTCConfig'],(function a(b,c,d,e,f,g){'use strict';var h=1080,i=720,j=180,k=480,l=1920,m=1280,n=320,o=854,p=15,q=30;function r(s,t){var u=arguments.length<=2||arguments[2]===undefined?null:arguments[2];this.streamType=s;this.videoQuality=t;this.videoSource=u;}r.prototype.getConstraints=function(){if(this.streamType===c('FBRTCConstants').StreamType.AUDIO_ONLY)return false;if(this.streamType===c('FBRTCConstants').StreamType.SCREEN_CONTENT){if(this.videoSource){var s={width:l,height:h,frameRate:q},t=this.$FBRTCVideoConstraints1(c('RTCConfig').CollaborationCallQuality.screen,s),u=t.width,v=t.height,w=t.frameRate;return {mandatory:{chromeMediaSource:'desktop',chromeMediaSourceId:this.videoSource,minHeight:v,maxHeight:v,minWidth:u,maxWidth:u,minFrameRate:p,maxFrameRate:w}};}return false;}var x=this.$FBRTCVideoConstraints1(c('RTCConfig').CollaborationCallQuality.videoToRoom),y=x.width,z=x.height,aa=x.frameRate;if(this.$FBRTCVideoConstraints2())return {height:{min:j,max:i,ideal:z},width:{min:320,max:1280,ideal:z*16/9},frameRate:{min:10,max:30,ideal:aa}};var ba={mandatory:{},optional:[{minHeight:z},{maxHeight:z},{minFrameRate:aa},{maxFrameRate:aa},{googLeakyBucket:true}]};if(this.videoSource)ba.optional=ba.optional.concat({sourceId:this.videoSource});if(this.videoQuality===c('FBRTCConstants').VideoQuality.CUSTOM_VIDEO)ba.optional=ba.optional.concat({minWidth:y},{maxWidth:y});return ba;};r.prototype.$FBRTCVideoConstraints1=function(s){var t=arguments.length<=1||arguments[1]===undefined?{width:o,height:k,frameRate:q}:arguments[1];switch(this.videoQuality){case c('FBRTCConstants').VideoQuality.HD_VIDEO:return {width:m,height:i,frameRate:q};case c('FBRTCConstants').VideoQuality.LQ_VIDEO:return {width:n,height:j,frameRate:p};case c('FBRTCConstants').VideoQuality.SD_VIDEO:return {width:o,height:k,frameRate:q};case c('FBRTCConstants').VideoQuality.CUSTOM_VIDEO:return s;default:return t;}};r.prototype.$FBRTCVideoConstraints2=function(){return !!navigator.mediaDevices&&c('UserAgent').isBrowser('Firefox >= 38');};f.exports=r;}),null);
__d('FBRTCUserMediaRequest',['Promise','FBRTCAudioConstraints','FBRTCConstants','FBRTCExperiment','FBRTCVideoConstraints'],(function a(b,c,d,e,f,g){'use strict';function h(i){var j=arguments.length<=1||arguments[1]===undefined?c('FBRTCConstants').VideoQuality.SD_VIDEO:arguments[1],k=arguments[2];this.streamType=i;this.videoQuality=j;this.isAudioOnly=k;this.audioSource=null;this.videoSource=null;}h.prototype.$FBRTCUserMediaRequest1=function(){var i=new (c('FBRTCAudioConstraints'))(this.streamType,this.audioSource),j=new (c('FBRTCVideoConstraints'))(this.streamType,this.videoQuality,this.videoSource),k={audio:i.getConstraints(),video:j.getConstraints()};if(!this.isAudioOnly||!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return c('Promise').resolve(k);return navigator.mediaDevices.enumerateDevices().then(function(l){var m=c('FBRTCExperiment').gen('rtc_web_start_call_without_camera').getParam('can_call','no');if(m==='yes')if(l.every(function(n){var o=n.kind;return o!=='videoinput';}))k.video=false;return k;});};h.prototype.request=function(){return this.$FBRTCUserMediaRequest1().then(function(i){if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)return navigator.mediaDevices.getUserMedia(i);return new (c('Promise'))(function(j,k){if(navigator.getUserMedia){navigator.getUserMedia(i,j,k);}else if(navigator.webkitGetUserMedia){navigator.webkitGetUserMedia(i,j,k);}else if(navigator.mozGetUserMedia){navigator.mozGetUserMedia(i,j,k);}else k('getUserMedia not supported');});});};f.exports=h;}),null);
__d('FBRTCUserSettings',['Promise','FBRTCConfig','mixInEventEmitter'],(function a(b,c,d,e,f,g){'use strict';var h={audioInput:'',audioOutput:'default',videoInput:'',remoteStream:null,_audioInputLabel:null,_videoInputLabel:null,isEnabled:function i(){return !!(this._isSupported()&&c('FBRTCConfig').settingsEnabled());},_isSupported:function i(){var j=navigator.mediaDevices;return j&&typeof j.enumerateDevices==='function';},selectAudioInputByLabel:function i(j){if(!this.audioInput)this.audioInput=this._selectByLabel(j,this._audioInputLabel);return this.audioInput;},selectVideoInputByLabel:function i(j){if(!this.videoInput)this.videoInput=this._selectByLabel(j,this._videoInputLabel);return this.videoInput;},_selectByLabel:function i(j,k){for(var l=j,m=Array.isArray(l),n=0,l=m?l:l[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var o;if(m){if(n>=l.length)break;o=l[n++];}else{n=l.next();if(n.done)break;o=n.value;}var p=o;if(k&&k===p.label)return p.deviceId;}return null;},previewStart:function i(){this.emit('previewStarted');},previewEnd:function i(){this.emit('previewEnded');},save:function i(j){var k=j.audioInput,l=j.audioOutput,m=j.videoInput;return new (c('Promise'))(function(n){var o=!!(k&&this.audioInput!==k||m&&this.videoInput!==m);this.audioInput=k;this.audioOutput=l;this.videoInput=m;this.emit('saved',o);n(o);}.bind(this));},updateForLocalStream:function i(j){if(j.videoMediaSourceId){this.videoInput=j.videoMediaSourceId;}else{var k=j.getVideoTracks(),l=k[0];if(l)this._videoInputLabel=l.label;}if(j.audioMediaSourceId){this.audioInput=j.audioMediaSourceId;}else{var m=j.getAudioTracks(),n=m[0];if(n)this._audioInputLabel=n.label;}},updateForRemoteStream:function i(j){this.remoteStream=j;this.emit('remoteStreamChanged');},enumerateDevices:function i(){if(navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices)return c('Promise').resolve(navigator.mediaDevices.enumerateDevices());return c('Promise').reject('enumerateDevices() not supported');},addListener:function i(){}};c('mixInEventEmitter')(h,{previewStarted:true,previewEnded:true,remoteStreamChanged:true,saved:true});f.exports=h;}),null);
__d('RTCSettingsMediaDeviceSelector.react',['fbt','React','XUISingleSelector.react'],(function a(b,c,d,e,f,g,h){'use strict';var i=c('XUISingleSelector.react').Option,j=function m(n){var o=n.devices,p=n.defaultValue,q=babelHelpers.objectWithoutProperties(n,['devices','defaultValue']);return (o.length>0?c('React').createElement(c('XUISingleSelector.react'),babelHelpers['extends']({defaultValue:p||o[0].deviceId},q),l(o)):c('React').createElement(c('XUISingleSelector.react'),babelHelpers['extends']({},q,{disabled:true}),c('React').createElement(i,{value:null},'---')));},k={videoinput:'Camera',audioinput:'Microphone',audiooutput:'Audio Output'};function l(m){var n=0;return m.map(function(o){var p=o.label?o.label:h._({"Camera":"Camera{number}","Microphone":"Microphone{number}","Audio Output":"Audio output{number}"},[h['enum'](k[o.type],{Camera:'Camera',Microphone:'Microphone','Audio Output':'Audio Output'}),h.param('number',++n)]);return (c('React').createElement(i,{value:o.deviceId,key:o.deviceId},p));});}f.exports=j;}),null);
__d('FBRTCSettingsDialog.react',['cx','fbt','Promise','FBRTCAudioSpectrumAnalyser.react','FBRTCConfig','FBRTCConstants','FBRTCDialog.react','FBRTCDialogBody.react','FBRTCDialogFooter.react','FBRTCDialogTitle.react','FBRTCStreamWrapper','FBRTCUserMediaRequest','FBRTCUserSettings','FBRTCUtils','FBRTCVideo.react','Link.react','React','ReactDOM','XUIDialogCancelButton.react','XUIDialogSaveButton.react','XUIGrayText.react','RTCSettingsMediaDeviceSelector.react'],(function a(b,c,d,e,f,g,h,i){'use strict';var j,k,l=c('React').Component;j=babelHelpers.inherits(m,l);k=j&&j.prototype;function m(r,s){k.constructor.call(this,r,s);this.$FBRTCSettingsDialog11=function(t){var u=t.value;this.$FBRTCSettingsDialog12({videoInput:u});this.$FBRTCSettingsDialog4();}.bind(this);this.$FBRTCSettingsDialog13=function(t){var u=t.value;this.$FBRTCSettingsDialog12({audioInput:u});this.$FBRTCSettingsDialog4();}.bind(this);this.$FBRTCSettingsDialog14=function(t){var u=t.value;this.$FBRTCSettingsDialog12({audioOutput:u,dirty:true});this.$FBRTCSettingsDialog15();}.bind(this);this.$FBRTCSettingsDialog7=function(){c('FBRTCUserSettings').save({audioInput:this.state.audioInput,audioOutput:this.state.audioOutput,videoInput:this.state.videoInput});}.bind(this);this.$FBRTCSettingsDialog2=function(){var t=c('ReactDOM').findDOMNode(this.refs.audioPreview),u=c('FBRTCUserSettings').remoteStream;if(u&&t)c('FBRTCUtils').attachMediaStream(t,u);this.$FBRTCSettingsDialog15();}.bind(this);this.$FBRTCSettingsDialog4=function(){return new (c('Promise'))(function(t,u){var v=this.state,w=v.audioInput,x=v.stream,y=v.videoInput;if(w&&y){q(w,y).then(function(z){x.setStream(z);return this.$FBRTCSettingsDialog3();}.bind(this)).done(t,u);}else u();}.bind(this));}.bind(this);this.state={dirty:false,stream:new (c('FBRTCStreamWrapper'))(),loading:true,audioInput:c('FBRTCUserSettings').audioInput,audioInputs:[],audioOutput:c('FBRTCUserSettings').audioOutput,audioOutputs:[],videoInput:c('FBRTCUserSettings').videoInput,videoInputs:[]};this.$FBRTCSettingsDialog1=c('FBRTCUserSettings').addListener('remoteStreamChanged',this.$FBRTCSettingsDialog2);}m.prototype.componentDidMount=function(){this.$FBRTCSettingsDialog3().then(function(r){var s=r.audioInputs,t=r.audioOutputs,u=r.videoInputs;this.setState({audioInput:c('FBRTCUserSettings').selectAudioInputByLabel(s),videoInput:c('FBRTCUserSettings').selectVideoInputByLabel(u)});}.bind(this)).then(this.$FBRTCSettingsDialog4).done(function(){if(c('FBRTCUtils').supportsSetSink()){c('FBRTCUserSettings').previewStart();this.$FBRTCSettingsDialog2();}}.bind(this));};m.prototype.render=function(){return c('React').createElement(c('FBRTCDialog.react'),{width:365,shown:true,onToggle:this.props.onToggle},c('React').createElement(c('FBRTCDialogTitle.react'),{showCloseButton:true},c('React').createElement('span',null,i._("Settings"))),c('React').createElement(c('FBRTCDialogBody.react'),null,this.$FBRTCSettingsDialog5()),c('React').createElement(c('FBRTCDialogFooter.react'),{leftContent:this.$FBRTCSettingsDialog6()},c('React').createElement(c('XUIDialogCancelButton.react'),null),c('React').createElement(c('XUIDialogSaveButton.react'),{use:'confirm',disabled:!this.state.dirty,onClick:this.$FBRTCSettingsDialog7})));};m.prototype.componentWillUnmount=function(){this.$FBRTCSettingsDialog1.remove();c('FBRTCUserSettings').previewEnd();};m.prototype.$FBRTCSettingsDialog5=function(){if(this.state.loading)return c('React').createElement('div',{className:"_48fc loading"});return c('React').createElement('div',{className:"_48fc"},this.$FBRTCSettingsDialog8(),this.$FBRTCSettingsDialog9(),this.$FBRTCSettingsDialog10(),c('React').createElement(c('XUIGrayText.react'),{shade:'light'},i._("Tip: Try restarting your browser if you're having trouble with your camera or microphone.")));};m.prototype.$FBRTCSettingsDialog8=function(){var r=this.state,s=r.stream,t=r.videoInput,u=r.videoInputs;if(u.length<1)return null;var v=!this.props.callModel.supportsSdpUpdate();return c('React').createElement('div',{className:"_48fd"},c('React').createElement(n,null,i._("Camera")),c('React').createElement(c('RTCSettingsMediaDeviceSelector.react'),{devices:u,name:'camera_selection',onChange:this.$FBRTCSettingsDialog11,defaultValue:t,disabled:v,width:'200px'}),c('React').createElement('div',{className:"_48ff"},c('React').createElement(c('FBRTCVideo.react'),{ref:'videoPreview',stream:s,muted:true,className:"_48fg"})));};m.prototype.$FBRTCSettingsDialog12=function(r){this.setState(babelHelpers['extends']({},r,{dirty:this.state.dirty||Object.keys(r).some(function(s){return this.state[s]!==r[s];}.bind(this))}));};m.prototype.$FBRTCSettingsDialog9=function(){var r=this.state,s=r.audioInput,t=r.audioInputs,u=r.stream;if(t.length<1)return null;var v=!this.props.callModel.supportsSdpUpdate();return c('React').createElement('div',{className:"_48fd"},c('React').createElement(n,null,i._("Microphone")),c('React').createElement(c('RTCSettingsMediaDeviceSelector.react'),{devices:t,name:'microphone_selection',onChange:this.$FBRTCSettingsDialog13,defaultValue:s,disabled:v,width:'200px'}),c('React').createElement('div',{className:"_48fh"},c('React').createElement(c('FBRTCAudioSpectrumAnalyser.react'),{stream:u})));};m.prototype.$FBRTCSettingsDialog10=function(){var r=this.state,s=r.audioOutput,t=r.audioOutputs;if(t.length<1)return null;return c('React').createElement('div',{className:"_48fd"},c('React').createElement(n,null,i._("Audio output")),c('React').createElement(c('RTCSettingsMediaDeviceSelector.react'),{devices:t,name:'audio_output_selection',onChange:this.$FBRTCSettingsDialog14,defaultValue:s,disabled:!c('FBRTCUtils').supportsSetSink(),width:'200px'}),c('React').createElement('div',{className:"_48fh"},c('React').createElement('audio',{autoPlay:true,ref:'audioPreview'})));};m.prototype.$FBRTCSettingsDialog6=function(){return c('React').createElement('div',null,c('React').createElement(c('XUIGrayText.react'),{shade:'light'},c('React').createElement(c('Link.react'),{href:c('FBRTCConfig').userMediaErrorUrl(),target:'_blank'},i._("Get help"))));};m.prototype.$FBRTCSettingsDialog15=function(){var r=c('ReactDOM').findDOMNode(this.refs.audioPreview),s=this.state.audioOutput;if(s&&r&&r.setSinkId)r.setSinkId(s);};m.prototype.$FBRTCSettingsDialog3=function(){this.setState({loading:true});return c('FBRTCUserSettings').enumerateDevices().then(p).then(function(r){var s=r.audioInputs,t=r.audioOutputs,u=r.videoInputs,v=this.state,w=v.audioInput,x=v.audioOutput,y=v.videoInput;this.setState({loading:false,audioInputs:s,audioInput:w||o(s[0]),audioOutputs:t,audioOutput:x||o(t[0]),videoInputs:u,videoInput:y||o(u[0])});return {audioInputs:s,audioOutputs:t,videoInputs:u};}.bind(this))['catch'](function(r){this.setState({loading:false});throw r;}.bind(this));};var n=function r(s){var t=s.children;return (c('React').createElement(c('XUIGrayText.react'),{display:'block',size:'medium',shade:'medium',className:"_48fe"},t));};function o(r){if(!r)return null;return r.deviceId;}function p(r){var s=[],t=[],u=[];for(var v=r,w=Array.isArray(v),x=0,v=w?v:v[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var y;if(w){if(x>=v.length)break;y=v[x++];}else{x=v.next();if(x.done)break;y=x.value;}var z=y;switch(z.kind){case 'audioinput':s.push(z);break;case 'audiooutput':t.push(z);break;case 'videoinput':u.push(z);break;default:}}return {audioInputs:s,audioOutputs:t,videoInputs:u};}function q(r,s){var t=new (c('FBRTCUserMediaRequest'))(c('FBRTCConstants').StreamType.AUDIO_VIDEO);t.audioSource=r;t.videoSource=s;return t.request();}f.exports=m;}),null);
__d('FBRTCVideoEscalationDialog.react',['fbt','FBRTCCallControlActions','React','XUIDialog.react','XUIDialogBody.react','XUIDialogButton.react','XUIDialogFooter.react'],(function a(b,c,d,e,f,g,h){var i,j,k=c('React').PropTypes;i=babelHelpers.inherits(l,c('React').Component);j=i&&i.prototype;function l(){var m,n;'use strict';for(var o=arguments.length,p=Array(o),q=0;q<o;q++)p[q]=arguments[q];return n=(m=j.constructor).call.apply(m,[this].concat(p)),this.$FBRTCVideoEscalationDialog1=function(r){c('FBRTCCallControlActions').declineEscalation();},this.$FBRTCVideoEscalationDialog2=function(r){this.props.hideDialog();c('FBRTCCallControlActions').acceptEscalation();}.bind(this),n;}l.prototype.render=function(){'use strict';var m=this.props.peerName;return c('React').createElement(c('XUIDialog.react'),{layerHideOnBlur:false,shown:true,width:440},c('React').createElement(c('XUIDialogBody.react'),null,c('React').createElement('p',null,h._("{name} would like to video chat. Click \"Accept\" to enable your camera.",[h.param('name',m)]))),c('React').createElement(c('XUIDialogFooter.react'),null,c('React').createElement(c('XUIDialogButton.react'),{action:'cancel',label:h._("Decline"),onClick:this.$FBRTCVideoEscalationDialog1}),c('React').createElement(c('XUIDialogButton.react'),{action:'confirm',label:h._("Accept"),onClick:this.$FBRTCVideoEscalationDialog2,use:'confirm'})));};l.propTypes={peerName:k.string.isRequired,hideDialog:k.func.isRequired};f.exports=l;}),null);
__d('FBRTCCallDialogController',['FBRTCCallModel','FBRTCScreenSharingModel','FBRTCSettingsDialog.react','FBRTCStruct','FBRTCMediaAccessErrorDialog.react','FBRTCPeerBrowserUnsupportedDialog.react','FBRTCScreenSharingUnsupportedBrowserDialog.react','FBRTCScreenSharingInstallExtensionDialog.react','FBRTCUserSettings','FBRTCVideoEscalationDialog.react','React','ReactDOM'],(function a(b,c,d,e,f,g){var h,i,j=new (c('FBRTCStruct'))(['ERROR_ACCESSING_MEDIA','PEER_BROWSER_UNSUPPORTED','SETTINGS','SCREEN_SHARING_UNSUPPORTED','INSTALL_SCREEN_SHARING_EXT','VIDEO_ESCALATION']);h=babelHelpers.inherits(k,c('React').Component);i=h&&h.prototype;function k(){var m,n;'use strict';for(var o=arguments.length,p=Array(o),q=0;q<o;q++)p[q]=arguments[q];return n=(m=i.constructor).call.apply(m,[this].concat(p)),this.$DialogOwner1=function(r){setTimeout(function(){if(!r)l.hideDialog();},0);},n;}k.prototype.render=function(){'use strict';if(this.props.dialogType===j.ERROR_ACCESSING_MEDIA)return c('React').createElement(c('FBRTCMediaAccessErrorDialog.react'),{key:'dialog'});if(this.props.dialogType===j.PEER_BROWSER_UNSUPPORTED)if(this.props.peerName)return c('React').createElement(c('FBRTCPeerBrowserUnsupportedDialog.react'),{peerName:this.props.peerName,key:'dialog'});if(this.props.dialogType===j.SETTINGS)return (c('React').createElement(c('FBRTCSettingsDialog.react'),{onToggle:this.$DialogOwner1,callModel:this.props.callModel,key:'dialog'}));if(this.props.dialogType===j.SCREEN_SHARING_UNSUPPORTED)return c('React').createElement(c('FBRTCScreenSharingUnsupportedBrowserDialog.react'),{onToggle:this.$DialogOwner1,key:'dialog'});if(this.props.dialogType===j.INSTALL_SCREEN_SHARING_EXT)return (c('React').createElement(c('FBRTCScreenSharingInstallExtensionDialog.react'),{onToggle:this.$DialogOwner1,peerID:this.props.peerID,sessionID:this.props.sessionID,key:'dialog'}));if(this.props.dialogType===j.VIDEO_ESCALATION)if(this.props.peerName)return (c('React').createElement(c('FBRTCVideoEscalationDialog.react'),{hideDialog:function m(){l.hideDialog();},onToggle:this.$DialogOwner1,peerName:this.props.peerName,key:'dialog'}));return null;};var l={dialogTypes:j,container:null,setDialogContainer:function m(n){this.container=n;this.currentDialogType=null;this.callModel=null;this._render();},showDialog:function m(n,o){this.currentDialogType=n;this._setCallModel(o);this._render();},hideDialog:function m(){this.currentDialogType=null;this._render();},hideDialogType:function m(n){if(n===this.currentDialogType)this.hideDialog();},_render:function m(){var n,o,p;if(this.callModel instanceof c('FBRTCCallModel')){n=this.callModel.peerID;o=this.callModel.callID;p=this.callModel.peerName();}else if(this.callModel instanceof c('FBRTCScreenSharingModel')){n=this.callModel.getPeerID();o=this.callModel.getSessionID();}c('ReactDOM').render(c('React').createElement(k,{dialogType:this.currentDialogType,peerID:n,sessionID:o,peerName:p,callModel:this.callModel}),this.container);},_setCallModel:function m(n){if(n!==this.callModel){this.callModel=n;if(this.callModel)this.callModel.addListener(this._onCallModelChanged.bind(this));}},_onCallModelChanged:function m(){var n=[j.SETTINGS,j.SCREEN_SHARING_UNSUPPORTED,j.INSTALL_SCREEN_SHARING_EXT,j.VIDEO_ESCALATION];if(this.callModel.isEnded()&&n.indexOf(this.currentDialogType)>-1)this.hideDialog();}};c('FBRTCUserSettings').addListener('saved',l.hideDialog,l);f.exports=l;}),null);
__d('FBRTCStarRatingActions',['FBRTCDispatcher','keyMirror'],(function a(b,c,d,e,f,g){'use strict';var h=c('keyMirror')({SUBMIT_RATING:null,SUBMIT_FEEDBACK:null,RATING_SHOWN:null,FEEDBACK_SHOWN:null}),i={Types:h,submitRating:function j(k){c('FBRTCDispatcher').dispatch({type:h.SUBMIT_RATING,rating:k});},submitFeedback:function j(k){c('FBRTCDispatcher').dispatch({type:h.SUBMIT_FEEDBACK,feedback:k});},ratingShown:function j(){c('FBRTCDispatcher').dispatch({type:h.RATING_SHOWN});},feedbackShown:function j(){c('FBRTCDispatcher').dispatch({type:h.FEEDBACK_SHOWN});}};f.exports=i;}),null);
__d('FBRTCCallModelStatePusher',['FBRTCCallModel','FBRTCConstants','FBRTCUtils','FBRTCDispatcher','FBRTCStarRatingActions'],(function a(b,c,d,e,f,g){var h=30000,i=10000;function j(k){'use strict';this.$FBRTCCallModelStatePusher1=null;this.$FBRTCCallModelStatePusher2=k;this.$FBRTCCallModelStatePusher2.addListener(this.$FBRTCCallModelStatePusher3.bind(this));c('FBRTCDispatcher').register(this.$FBRTCCallModelStatePusher4.bind(this));}j.prototype.$FBRTCCallModelStatePusher5=function(){'use strict';return this.$FBRTCCallModelStatePusher2.uiState===c('FBRTCCallModel').UIState.CALL_ENDED&&this.$FBRTCCallModelStatePusher2.wasConnected&&this.$FBRTCCallModelStatePusher2.endCallReason===c('FBRTCConstants').CallEndReason.HANGUP_CALL&&!c('FBRTCUtils').isCollabCallable(this.$FBRTCCallModelStatePusher2.peerID);};j.prototype.$FBRTCCallModelStatePusher3=function(){'use strict';if(this.$FBRTCCallModelStatePusher2.uiState===c('FBRTCCallModel').UIState.CALL_ENDED){if(this.$FBRTCCallModelStatePusher5()){this.$FBRTCCallModelStatePusher6(3000,c('FBRTCCallModel').UIState.CALL_ENDED,c('FBRTCCallModel').UIState.COLLECT_RATING);}else this.$FBRTCCallModelStatePusher7(i);}else if(this.$FBRTCCallModelStatePusher2.uiState===c('FBRTCCallModel').UIState.COLLECT_RATING)this.$FBRTCCallModelStatePusher7(h);};j.prototype.$FBRTCCallModelStatePusher4=function(k){'use strict';if(k.type===c('FBRTCStarRatingActions').Types.FEEDBACK_SHOWN)this.$FBRTCCallModelStatePusher8();};j.prototype.$FBRTCCallModelStatePusher7=function(k){'use strict';this.$FBRTCCallModelStatePusher1=setTimeout(function(){window.close();},k);};j.prototype.$FBRTCCallModelStatePusher8=function(){'use strict';clearTimeout(this.$FBRTCCallModelStatePusher1);this.$FBRTCCallModelStatePusher1=null;};j.prototype.$FBRTCCallModelStatePusher6=function(k,l,m){'use strict';var n=this.$FBRTCCallModelStatePusher2;setTimeout(function(){n.setStateFrom(l,m);},k);};f.exports=j;}),null);
__d('FBRTCCallMonitor',['FBRTCCallSummaryStore'],(function a(b,c,d,e,f,g){var h=10000,i=3000;function j(k){'use strict';this.$FBRTCCallMonitor1=k;this.$FBRTCCallMonitor2=null;this.$FBRTCCallMonitor3=c('FBRTCCallSummaryStore').getInstance();}j.prototype.startHeartbeat=function(k){'use strict';if(this.$FBRTCCallMonitor1.isEnded())return;var l=k();if(l)this.onCallHeartbeat(l);var m=this;setTimeout(function(){m.startHeartbeat(k);},h);};j.prototype.onCallHeartbeat=function(k){'use strict';var l=new Date().valueOf();if(!this.$FBRTCCallMonitor2||l-this.$FBRTCCallMonitor2>i)k.save(this.$FBRTCCallMonitor3);};f.exports=j;}),null);
__d("FBRTCIceCache",[],(function a(b,c,d,e,f,g){function h(){"use strict";this.$FBRTCIceCache1={};}h.prototype.reset=function(i,j){"use strict";if(!this.$FBRTCIceCache1[i])this.$FBRTCIceCache1[i]={};this.$FBRTCIceCache1[i][j]=[];};h.prototype.cacheCandidate=function(i,j,k){"use strict";if(!this.$FBRTCIceCache1[i])this.$FBRTCIceCache1[i]={};if(!this.$FBRTCIceCache1[i][j])this.$FBRTCIceCache1[i][j]=[];this.$FBRTCIceCache1[i][j].unshift(k);};h.prototype.drainCandidates=function(i,j,k){"use strict";if(this.$FBRTCIceCache1[i]&&this.$FBRTCIceCache1[i][j]){var l;while(this.$FBRTCIceCache1[i][j].length>0){l=this.$FBRTCIceCache1[i][j].pop();k(l);}}};f.exports=h;}),null);
__d('FBRTCMessage',['FBRTCConstants','FBRTCExperiment','FBRTCSdpUtils','FBRTCSupport','FBRTCUtils','UserAgent'],(function a(b,c,d,e,f,g){var h='mobile';function i(j){'use strict';if(!this.$FBRTCMessage1(j))throw new Error('invalid webrtc message');this.originalMessageData=j;this.peerID=j.from;this.callID=parseInt(j.call_id,10);this.msg=JSON.parse(j.payload);this.msgType=this.msg.type;this.msgID=this.msg.msg_id;this.ackID=this.msg.ack_id;this.source=j.source;this.peerSupportsVideoInterop=!!this.msg.supports_video_interop;this.$FBRTCMessage2();this.$FBRTCMessage3();this.$FBRTCMessage4();}i.prototype.$FBRTCMessage1=function(j){'use strict';return j.from&&j.call_id&&j.payload;};i.prototype.$FBRTCMessage2=function(){'use strict';if(c('FBRTCSupport').isVideoInteropSupported()&&this.peerSupportsVideoInterop)return;if(this.isFromMobile())this.disableVideo();};i.prototype.disableVideo=function(){'use strict';if(this.msg.sdp)this.msg.sdp=c('FBRTCSdpUtils').disableVideo(this.msg.sdp);if(this.msgType===c('FBRTCConstants').PayloadType.SET_VIDEO||this.msgType===c('FBRTCConstants').PayloadType.OFFER||this.msgType===c('FBRTCConstants').PayloadType.ICERESTART_OFFER||this.msgType===c('FBRTCConstants').PayloadType.ANSWER||this.msgType===c('FBRTCConstants').PayloadType.ICERESTART_ANSWER)this.msg.videoon=false;};i.prototype.$FBRTCMessage3=function(){'use strict';if(this.isFromMobile()&&this.msg.sdp&&this.msgType!==c('FBRTCConstants').PayloadType.ICE_CANDIDATE)this.msg.sdp=c('FBRTCSdpUtils').removeFEC(this.msg.sdp);};i.prototype.$FBRTCMessage4=function(){'use strict';if(this.isFromMobile()&&c('UserAgent').isBrowser('Chrome >= 52')&&this.msg.sdp&&this.msgType!==c('FBRTCConstants').PayloadType.ICE_CANDIDATE){var j=c('FBRTCExperiment').gen('rtc_browser_use_h264'),k=j.getParam('allow_h264','no');if(k!=='yes')this.msg.sdp=c('FBRTCSdpUtils').removeH264(this.msg.sdp);}};i.prototype.isOffer=function(){'use strict';return this.msgType===c('FBRTCConstants').PayloadType.OFFER;};i.prototype.isFromMobile=function(){'use strict';return this.source===h;};i.prototype.isRemoteVideoSupported=function(){'use strict';if(!this.msg.sdp||this.msgType===c('FBRTCConstants').PayloadType.ICE_CANDIDATE)return true;return c('FBRTCSdpUtils').isVideoSupported(this.msg.sdp);};i.prototype.isRetry=function(){'use strict';return !!this.msg.flag;};i.prototype.isForCall=function(j){'use strict';return !j||j===this.callID||this.msgType===c('FBRTCConstants').PayloadType.OFFER||this.msgType===c('FBRTCConstants').PayloadType.ICERESTART_OFFER||this.msgType===c('FBRTCConstants').PayloadType.PCRESTART_OFFER||this.msgType===c('FBRTCConstants').PayloadType.ICE_CANDIDATE;};i.prototype.getSignalingExperiments=function(){'use strict';var j=this.msg.experiments;if(this.isFromMobile()&&!j)return ['sdp_update'];if(c('FBRTCUtils').isVCEndpointCallable(this.peerID))return ['screen_sharing'].concat(j||[]);return j;};f.exports=i;}),null);
__d("FBRTCMessageDedup",[],(function a(b,c,d,e,f,g){var h={},i={check:function j(k,l,m){if(!h[k])h[k]={};if(!h[k][l])h[k][l]={};if(h[k][l][m])return false;h[k][l][m]=true;return true;}};f.exports=i;}),null);
__d("XCollabCallSendMessageController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/collab\/sendmessage\/",{recipient_id:{type:"Int",required:true},msg_id:{type:"Int",required:true},message_info:{type:"String",required:true},webrtc_fbtrace:{type:"Int"}});}),null);
__d("XVideoCallSendMessageController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/videocall\/sendmessage\/",{recipient_id:{type:"Int",required:true},msg_id:{type:"Int",required:true},message_info:{type:"String",required:true},webrtc_fbtrace:{type:"Int"}});}),null);
__d('FBRTCMessageSender',['errorCode','CurrentUser','FBRTCConfig','FBRTCConstants','FBRTCLogger','FBRTCUtils','Fbtrace','Map','SiteData','FBRTCSupport','XVideoCallSendMessageController','XCollabCallSendMessageController'],(function a(b,c,d,e,f,g,h){var i=0;function j(){'use strict';this.onSendFailure=null;this.$FBRTCMessageSender1=c('FBRTCLogger').getInstance();}j.prototype.sendOffer=function(k,l,m,n,o){'use strict';return this.$FBRTCMessageSender2(c('FBRTCConstants').PayloadType.OFFER,k,l,m,n,o);};j.prototype.sendAnswer=function(k,l,m,n,o){'use strict';return this.$FBRTCMessageSender2(c('FBRTCConstants').PayloadType.ANSWER,k,l,m,n,o);};j.prototype.sendPCRestartOffer=function(k,l,m,n,o){'use strict';return this.$FBRTCMessageSender2(c('FBRTCConstants').PayloadType.PCRESTART_OFFER,k,l,m,n,o);};j.prototype.sendSdpUpdate=function(k,l,m,n,o){'use strict';return this.$FBRTCMessageSender2(c('FBRTCConstants').PayloadType.SDP_UPDATE,k,l,m,n,o);};j.prototype.resendSdpMessage=function(k,l){'use strict';l.flag=1;this.$FBRTCMessageSender3(k,l);};j.prototype.resendPayload=function(k,l){'use strict';l.flag=1;this.$FBRTCMessageSender4(k,l);};j.prototype.$FBRTCMessageSender2=function(k,l,m,n,o,p){'use strict';var q=this.$FBRTCMessageSender5(m,k);q.sdp=n;if(k===c('FBRTCConstants').PayloadType.OFFER){q.handlescollision=true;q.pranswer=false;}if(k===c('FBRTCConstants').PayloadType.OFFER||k===c('FBRTCConstants').PayloadType.ANSWER){q.icerestart=false;q.experiments=c('FBRTCConfig').supportedSignalingExperiments();}q.videoon=o;q.attributes=p;q.ull=c('FBRTCConstants').convertFromUploadLogLevel(c('FBRTCUtils').getLocalUploadLogLevel());this.$FBRTCMessageSender3(l,q);return q;};j.prototype.sendIceCandidate=function(k,l,m){'use strict';var n=this.$FBRTCMessageSender5(l,c('FBRTCConstants').PayloadType.ICE_CANDIDATE);n.sdp_mid=m.sdpMid;n.label=m.sdpMLineIndex;n.sdp=m.candidate;if(m.isDirectScreenShareFromRecipient){n.attributes={};n.attributes.isDirectScreenShareFromRecipient=m.isDirectScreenShareFromRecipient;}this.$FBRTCMessageSender4(k,n);};j.prototype.sendHangup=function(k,l,m,n,o){'use strict';var p=this.$FBRTCMessageSender5(l,c('FBRTCConstants').PayloadType.HANGUP);p.reason=c('FBRTCConstants').callEndReasonString(m);p.subreason=o||'';this.$FBRTCMessageSender4(k,p,n);};j.prototype.sendOtherDismiss=function(k){'use strict';var l=this.$FBRTCMessageSender5(k,c('FBRTCConstants').PayloadType.OTHER_DISMISS);this.$FBRTCMessageSender4(c('CurrentUser').getID(),l);};j.prototype.sendOfferAck=function(k,l,m){var n=arguments.length<=3||arguments[3]===undefined?new (c('Map'))():arguments[3];'use strict';this.$FBRTCMessageSender6(k,l,m,c('FBRTCConstants').PayloadType.OFFER_ACK,n);};j.prototype.sendOfferNack=function(k,l,m){'use strict';this.$FBRTCMessageSender6(k,l,m,c('FBRTCConstants').PayloadType.OFFER_NACK,new (c('Map'))([['error_code',1356043]]));};j.prototype.sendAnswerAck=function(k,l,m){'use strict';this.$FBRTCMessageSender6(k,l,m,c('FBRTCConstants').PayloadType.ANSWER_ACK);};j.prototype.sendAck=function(k,l,m){'use strict';this.$FBRTCMessageSender6(k,l,m,c('FBRTCConstants').PayloadType.ACK,new (c('Map'))([['ack_type',m.type]]));};j.prototype.sendMuteStateUpdate=function(k,l,m){'use strict';var n=this.$FBRTCMessageSender5(l,c('FBRTCConstants').PayloadType.SET_VIDEO);n.videoon=m;this.$FBRTCMessageSender4(k,n);};j.prototype.sendVideoEscalationRequest=function(k,l,m){'use strict';return this.sendVideoRequestResponse(k,l,0,m);};j.prototype.sendVideoRequestResponse=function(k,l,m,n){'use strict';var o=this.$FBRTCMessageSender5(l,c('FBRTCConstants').PayloadType.VIDEO_REQUEST);o.ack_id=m;o.videoon=n;o.capability=c('FBRTCSupport').getCapabilities();this.$FBRTCMessageSender4(k,o);return o;};j.prototype.sendMsgAck=function(){'use strict';};j.prototype.sendOk=function(){'use strict';};j.prototype.sendPranswer=function(){'use strict';};j.prototype.sendIcerestartAnswer=function(){'use strict';};j.prototype.$FBRTCMessageSender5=function(k,l){'use strict';var m=c('FBRTCUtils').generateRandomInt(),n={version:i,type:l,call_id:k,msg_id:m};if(this.$FBRTCMessageSender7(l))n.supports_video_interop=true;return n;};j.prototype.$FBRTCMessageSender7=function(k){'use strict';if(c('FBRTCSupport').isVideoInteropSupported())return (k===c('FBRTCConstants').PayloadType.OFFER||k===c('FBRTCConstants').PayloadType.ANSWER||k===c('FBRTCConstants').PayloadType.PRANSWER||k===c('FBRTCConstants').PayloadType.ICERESTART_OFFER||k===c('FBRTCConstants').PayloadType.ICERESTART_ANSWER||k===c('FBRTCConstants').PayloadType.PCRESTART_OFFER||k===c('FBRTCConstants').PayloadType.PCRESTART_ANSWER||k===c('FBRTCConstants').PayloadType.SDP_UPDATE||k===c('FBRTCConstants').PayloadType.SET_VIDEO||k===c('FBRTCConstants').PayloadType.VIDEO_REQUEST);return false;};j.prototype.$FBRTCMessageSender3=function(k,l){'use strict';this.$FBRTCMessageSender4(k,l,false,true,true);};j.prototype.$FBRTCMessageSender6=function(k,l,m,n){'use strict';var o=(arguments.length<=4?undefined:arguments[4])||new (c('Map'))(),p=this.$FBRTCMessageSender5(l,n);p.ack_id=m.msg_id;if(m.flag===1)p.flag=1;p.ull=c('FBRTCConstants').convertFromUploadLogLevel(c('FBRTCUtils').getLocalUploadLogLevel());o.forEach(function(q,r,s){p[r]=q;});this.$FBRTCMessageSender4(k,p);};j.prototype.$FBRTCMessageSender4=function(k,l,m,n,o){'use strict';var p=l.msg_id,q={peer_id:k,call_id:l.call_id,msg_id:p,msg_type:l.type},r={call_id:l.call_id,msg_id:p,user_id:c('CurrentUser').getID(),recipient_id:k,msg_type:l.type,app_id:256281040558,app_version:String(c('SiteData').revision||'dev'),op:'sendServerRequest:'+l.type,policy:'WebRTC'},s=c('Fbtrace').requestReceive('browser',String(c('SiteData').revision||'dev'),r),t=(c('FBRTCUtils').isCollabCallable(k)?c('XCollabCallSendMessageController'):c('XVideoCallSendMessageController')).getURIBuilder().setInt('recipient_id',k).setInt('msg_id',p).setString('message_info',JSON.stringify(l)).setInt('webrtc_fbtrace',s.isOn()?1:0).getURI();if(n)var u=this.$FBRTCMessageSender4.bind(this,k,l,m,false,o);var v=this.$FBRTCMessageSender8.bind(this,q),w=this.$FBRTCMessageSender9.bind(this,q,u,o);c('Fbtrace').withDefaultNode(s,function(){c('FBRTCUtils').sendServerRequest(t,v,w,m);});if(this.onMessageSent)this.onMessageSent(k,l);this.$FBRTCMessageSender1.logSentMessage(k,l.call_id,l);};j.prototype.$FBRTCMessageSender8=function(k){'use strict';this.$FBRTCMessageSender1.logSentMessageSuccess(k.peer_id,k.call_id,k.msg_type,k.msg_id);};j.prototype.$FBRTCMessageSender9=function(k,l,m,n){'use strict';if(n)var o=n.getError?n.getError():n;this.$FBRTCMessageSender1.logSentMessageFailure(k.peer_id,k.call_id,k.msg_type,k.msg_id,o);var p=null;if(o===1356001||o===1356049){p=c('FBRTCConstants').CallEndReason.NO_PERMISSION;}else if(o===1356046||o===1356045){p=c('FBRTCConstants').CallEndReason.CALLER_NOT_VISIBLE;}else if(o===1356003||o===1356002||o===1356044)p=c('FBRTCConstants').CallEndReason.OTHER_NOT_CAPABLE;if(!p&&l){l();return;}if(m&&this.onSendFailure){if(!p)p=c('FBRTCConstants').CallEndReason.SIGNALING_MESSAGE_FAILED;this.onSendFailure(p,o,k.msg_type);}};f.exports=j;}),null);
__d('FBRTCRetriableMessage',['mixInEventEmitter','FBRTCConstants'],(function a(b,c,d,e,f,g){var h=10000,i=7000,j=1;function k(l){'use strict';this.$FBRTCRetriableMessage1=l;this.$FBRTCRetriableMessage2=h;this.$FBRTCRetriableMessage3=j;this.$FBRTCRetriableMessage4=null;this.$FBRTCRetriableMessage5=null;this.$FBRTCRetriableMessage6=null;}k.prototype.sendMessage=function(l,m,n,o,p,q){'use strict';this.$FBRTCRetriableMessage4=m;switch(l){case c('FBRTCConstants').PayloadType.PCRESTART_OFFER:this.$FBRTCRetriableMessage5=this.$FBRTCRetriableMessage1.sendPCRestartOffer(m,n,o,p,q);break;case c('FBRTCConstants').PayloadType.OFFER:this.$FBRTCRetriableMessage5=this.$FBRTCRetriableMessage1.sendOffer(m,n,o,p,q);break;case c('FBRTCConstants').PayloadType.ANSWER:this.$FBRTCRetriableMessage2=i;this.$FBRTCRetriableMessage5=this.$FBRTCRetriableMessage1.sendAnswer(m,n,o,p,q);break;}this.$FBRTCRetriableMessage7();};k.prototype.isAckMsg=function(l){'use strict';return this.$FBRTCRetriableMessage5&&this.$FBRTCRetriableMessage5.msg_id===l.ack_id;};k.prototype.stopRetrying=function(){'use strict';if(this.$FBRTCRetriableMessage6){clearTimeout(this.$FBRTCRetriableMessage6);this.$FBRTCRetriableMessage4=null;this.$FBRTCRetriableMessage5=null;this.$FBRTCRetriableMessage6=null;}};k.prototype.$FBRTCRetriableMessage7=function(){'use strict';this.$FBRTCRetriableMessage6=setTimeout(this.$FBRTCRetriableMessage8.bind(this),this.$FBRTCRetriableMessage2);};k.prototype.$FBRTCRetriableMessage8=function(){'use strict';if(this.$FBRTCRetriableMessage3<1){this.emit('timeoutFailure');}else{this.emit('sendingRetry');this.$FBRTCRetriableMessage1.resendSdpMessage(this.$FBRTCRetriableMessage4,this.$FBRTCRetriableMessage5);this.$FBRTCRetriableMessage7();this.$FBRTCRetriableMessage3-=1;}};c('mixInEventEmitter')(k,{sendingRetry:true,timeoutFailure:true});f.exports=k;}),null);
__d('FBRTCScreenMedia',['FBRTCConstants','FBRTCDispatcher','FBRTCUserMediaRequest','keyMirror'],(function a(b,c,d,e,f,g){'use strict';var h=c('keyMirror')({STREAM_READY:null,STREAM_FAILED:null}),i={STREAM_TYPE:c('FBRTCConstants').StreamType.SCREEN_CONTENT,Types:h,requestScreenMedia:function j(k){var l=c('FBRTCConstants').VideoQuality.CUSTOM_VIDEO,m=new (c('FBRTCUserMediaRequest'))(this.STREAM_TYPE,l);m.videoSource=k;m.audioSource=null;m.request().then(function(n){return this._onRequestSuccess(n);}.bind(this),function(n){return this._onRequestFailure(n);}.bind(this));},_onRequestSuccess:function j(k){c('FBRTCDispatcher').dispatch({type:h.STREAM_READY,stream:k});},_onRequestFailure:function j(k){var l=k.name?k.name:k;c('FBRTCDispatcher').dispatch({type:h.STREAM_FAILED,error:l});}};f.exports=i;}),null);
__d('FBRTCOfferOptions',['UserAgent'],(function a(b,c,d,e,f,g){'use strict';function h(){var i=arguments.length<=0||arguments[0]===undefined?false:arguments[0],j=arguments.length<=1||arguments[1]===undefined?false:arguments[1];this.$FBRTCOfferOptions2(i,j);}h.prototype.getOptions=function(){return this.$FBRTCOfferOptions1;};h.prototype.setOptions=function(i){this.$FBRTCOfferOptions1=i;};h.prototype.$FBRTCOfferOptions2=function(i,j){if(c('UserAgent').isBrowser('Chrome <= 37')){this.setOptions({mandatory:{OfferToReceiveAudio:i,OfferToReceiveVideo:j}});}else this.setOptions({offerToReceiveAudio:i,offerToReceiveVideo:j});};f.exports=h;}),null);
__d('FBRTCScreenSharingConnection',['FBRTCConstants','FBRTCOfferOptions','FBRTCPCConfig','FBRTCScreenSharingActions','FBRTCScreenSharingLogger','FBRTCScreenStreamWrapper'],(function a(b,c,d,e,f,g){'use strict';function h(){this.$FBRTCScreenSharingConnection1=c('FBRTCScreenSharingLogger').getInstance();this.$FBRTCScreenSharingConnection5=new (c('FBRTCOfferOptions'))(false,true);this.$FBRTCScreenSharingConnection2=window.RTCIceCandidate;this.$FBRTCScreenSharingConnection3=window.RTCSessionDescription;this.$FBRTCScreenSharingConnection4=window.webkitRTCPeerConnection;this.$FBRTCScreenSharingConnection7=null;this.$FBRTCScreenSharingConnection6=null;}h.prototype.setStream=function(i){this.$FBRTCScreenSharingConnection7=i;};h.prototype.createSdpUpdate=function(){var i=this.$FBRTCScreenSharingConnection6,j=this.$FBRTCScreenSharingConnection7;if(i&&j){var k=i.getLocalStreams();for(var l=0;l<k.length;l++)i.removeStream(k[l]);i.addStream(j.getStream());this.$FBRTCScreenSharingConnection8(c('FBRTCConstants').PayloadType.SDP_UPDATE);}};h.prototype.createOffer=function(){if(!this.$FBRTCScreenSharingConnection6)this.$FBRTCScreenSharingConnection6=this.$FBRTCScreenSharingConnection9();this.$FBRTCScreenSharingConnection8(c('FBRTCConstants').PayloadType.OFFER);};h.prototype.onReceivedAnswerSDP=function(i){var j=new this.$FBRTCScreenSharingConnection3({type:c('FBRTCConstants').PayloadType.ANSWER,sdp:i}),k=this.$FBRTCScreenSharingConnection6;if(k)k.setRemoteDescription(j,this.$FBRTCScreenSharingConnection10.bind(this,j),this.$FBRTCScreenSharingConnection11);};h.prototype.onReceivedOfferSDP=function(i){var j=this.$FBRTCScreenSharingConnection6;if(!j){j=this.$FBRTCScreenSharingConnection9();this.$FBRTCScreenSharingConnection6=j;}var k=new this.$FBRTCScreenSharingConnection3({type:c('FBRTCConstants').PayloadType.OFFER,sdp:i});j.setRemoteDescription(k,this.$FBRTCScreenSharingConnection10.bind(this,k),this.$FBRTCScreenSharingConnection11);};h.prototype.onReceivedRemoteIceCandidate=function(i){if(typeof i.sdp!=='string')return;var j=new this.$FBRTCScreenSharingConnection2({sdpMLineIndex:i.label,candidate:i.sdp,sdpMid:i.sdp_mid}),k=this.$FBRTCScreenSharingConnection6;if(k)k.addIceCandidate(j);};h.prototype.cleanPeerConnection=function(){var i=this.$FBRTCScreenSharingConnection6;if(i){i.onaddstream=null;i.onremovestream=null;i.onicecandidate=null;i.oniceconnectionstatechange=null;if(i.iceConnectionState!=='closed')i.close();}};h.prototype.$FBRTCScreenSharingConnection9=function(){var i=new this.$FBRTCScreenSharingConnection4(c('FBRTCPCConfig').getConfig(),c('FBRTCPCConfig').getConstraints());i.onaddstream=this.$FBRTCScreenSharingConnection12.bind(this);i.onicecandidate=this.$FBRTCScreenSharingConnection13.bind(this);if(this.$FBRTCScreenSharingConnection7)i.addStream(this.$FBRTCScreenSharingConnection7.getStream());return i;};h.prototype.$FBRTCScreenSharingConnection13=function(event){if(event.candidate)c('FBRTCScreenSharingActions').localIceCandidateCreated(event.candidate);};h.prototype.$FBRTCScreenSharingConnection12=function(event){c('FBRTCScreenSharingActions').remoteStreamAdded(event.stream);};h.prototype.$FBRTCScreenSharingConnection8=function(i){var j=this.$FBRTCScreenSharingConnection6;if(j)j.createOffer(this.$FBRTCScreenSharingConnection14.bind(this,i),this.$FBRTCScreenSharingConnection11,this.$FBRTCScreenSharingConnection5.getOptions());};h.prototype.$FBRTCScreenSharingConnection14=function(i,j){var k=this.$FBRTCScreenSharingConnection6;j.sdp=this.$FBRTCScreenSharingConnection15(j.sdp);if(k)k.setLocalDescription(j,c('FBRTCScreenSharingActions').sdpCreated.bind(this,{type:i,sdp:j.sdp}),this.$FBRTCScreenSharingConnection11);};h.prototype.$FBRTCScreenSharingConnection15=function(i){return i.replace('UDP/TLS/RTP/SAVPF','RTP/SAVPF');};h.prototype.$FBRTCScreenSharingConnection10=function(i){if(i.type===c('FBRTCConstants').PayloadType.OFFER){var j=this.$FBRTCScreenSharingConnection6;if(j)j.createAnswer(this.$FBRTCScreenSharingConnection14.bind(this,c('FBRTCConstants').PayloadType.ANSWER),this.$FBRTCScreenSharingConnection11);}else if(i.type===c('FBRTCConstants').PayloadType.ANSWER)c('FBRTCScreenSharingActions').remoteDescriptionSet();};h.prototype.$FBRTCScreenSharingConnection11=function(i){this.$FBRTCScreenSharingConnection1.logToConsole(null,null,JSON.stringify(i,null,'\t'));};f.exports=h;}),null);
__d('FBRTCScreenSharingController',['invariant','Promise','FBRTCCallDialogController','FBRTCConstants','FBRTCLocalMessageQueue','FBRTCMessageHandler','FBRTCMessageListener','FBRTCMessageSender','FBRTCScreenMedia','FBRTCScreenSharingActions','FBRTCScreenSharingConnection','FBRTCScreenSharingConstants','FBRTCScreenSharingLogger','FBRTCScreenSharingModel','FBRTCScreenSharingUI','FBRTCScreenSharingUtils','FBRTCStore','Random'],(function a(b,c,d,e,f,g,h){'use strict';var i,j;i=babelHelpers.inherits(k,c('FBRTCStore'));j=i&&i.prototype;function k(l,m,n){j.constructor.call(this);this.$FBRTCScreenSharingController14=function(o){var p=o.origin,q=o.data;if(p!==window.location.origin||!(q.recipient&&q.recipient==='SC_DOM')||!q.type)return;window.removeEventListener('message',this.$FBRTCScreenSharingController14);var r=c('FBRTCScreenSharingLogger').Action;switch(q.type){case 'SC_EXT_INSTALLED':break;case 'SC_DIALOG_SUCCESS':this.$FBRTCScreenSharingController20(r.SCREEN_SHARING_DIALOG_SUCCESS);this.$FBRTCScreenSharingController25(q.streamId);break;case 'SC_DIALOG_CANCEL':this.$FBRTCScreenSharingController20(r.SCREEN_SHARING_DIALOG_CANCEL);this.$FBRTCScreenSharingController17();break;case 'SC_CANCELLED':this.$FBRTCScreenSharingController20(r.SCREEN_SHARING_CANCELLED);this.$FBRTCScreenSharingController17();break;default:this.$FBRTCScreenSharingController26('UNEXPECTED MESSAGE TYPE: '+q.type);}}.bind(this);this.$FBRTCScreenSharingController2=n;this.$FBRTCScreenSharingController3=false;this.$FBRTCScreenSharingController4=false;this.$FBRTCScreenSharingController5=false;this.$FBRTCScreenSharingController6=false;this.$FBRTCScreenSharingController7=null;this.$FBRTCScreenSharingController9=c('FBRTCScreenSharingLogger').getInstance();this.$FBRTCScreenSharingController12=l;this.$FBRTCScreenSharingController13=m!=null?m:c('Random').uint32();this.$FBRTCScreenSharingController11=new (c('FBRTCScreenSharingModel'))(this.$FBRTCScreenSharingController12,this.$FBRTCScreenSharingController13);this.$FBRTCScreenSharingController13!==null&&this.$FBRTCScreenSharingController13!==undefined||h(0);this.initPromise=this.$FBRTCScreenSharingController15(n,m);}k.prototype.$FBRTCScreenSharingController15=function(l,m){if(!c('FBRTCScreenSharingUtils').isScreenSharingSupported())return c('Promise').reject('screen sharing not supported');if(l){this.$FBRTCScreenSharingController16(m);}else this.$FBRTCScreenSharingController11.addListener(this.$FBRTCScreenSharingController17.bind(this));return c('FBRTCScreenSharingUtils').checkExtensionInstalled();};k.prototype.isEnabled=function(){return this.$FBRTCScreenSharingController5&&this.$FBRTCScreenSharingController11.isEnabled();};k.prototype.getStream=function(){return this.$FBRTCScreenSharingController11.getStream();};k.prototype.onStop=function(){this.$FBRTCScreenSharingController11.onStop();};k.prototype.onEndCall=function(){c('FBRTCScreenSharingUI').close();this.onStop();};k.prototype.setRemoteStream=function(l){if(!l){c('FBRTCScreenSharingUI').close();this.$FBRTCScreenSharingController11.setStream(l,true);}else this.$FBRTCScreenSharingController11.setStream(l,true);};k.prototype.initializeAsSender=function(){this.$FBRTCScreenSharingController3=false;};k.prototype.initializeAsReceiver=function(l,m){this.$FBRTCScreenSharingController3=true;this.$FBRTCScreenSharingController1.onReceivedOfferSDP(l);this.$FBRTCScreenSharingController7=m;};k.prototype.onSdpUpdateReceived=function(l){this.$FBRTCScreenSharingController1.onReceivedOfferSDP(l);this.$FBRTCScreenSharingController6=true;this.$FBRTCScreenSharingController8=true;};k.prototype.toggleScreenSharing=function(){var l=arguments.length<=0||arguments[0]===undefined?null:arguments[0];if(this.$FBRTCScreenSharingController18(l)){var m=this.$FBRTCScreenSharingController11.isEnabled()||this.$FBRTCScreenSharingController4?'SC_CANCEL':'SC_REQUEST';if(m==='SC_REQUEST'&&this.$FBRTCScreenSharingController2)c('FBRTCScreenSharingUI').openTempWindow();this.$FBRTCScreenSharingController19(m);this.$FBRTCScreenSharingController20(c('FBRTCScreenSharingLogger').Action.SCREEN_SHARING_TOGGLED,'status: '+(this.isEnabled()?'enabled':'disabled'));}};k.prototype.onDirectScreenSharingEndSession=function(){this.onStop();};k.prototype.$FBRTCScreenSharingController18=function(l){var m=l?l:this.$FBRTCScreenSharingController11;if(!c('FBRTCCallDialogController').container)c('FBRTCCallDialogController').setDialogContainer(document.body.appendChild(document.createElement('div')));if(!c('FBRTCScreenSharingUtils').isSupportedBrowser()){c('FBRTCCallDialogController').showDialog(c('FBRTCCallDialogController').dialogTypes.SCREEN_SHARING_UNSUPPORTED,m);return false;}else if(!c('FBRTCScreenSharingUtils').isExtensionInstalled()){c('FBRTCCallDialogController').showDialog(c('FBRTCCallDialogController').dialogTypes.INSTALL_SCREEN_SHARING_EXT,m);return false;}return true;};k.prototype.$FBRTCScreenSharingController21=function(){var l=arguments.length<=0||arguments[0]===undefined?false:arguments[0];if(this.$FBRTCScreenSharingController6)return;this.$FBRTCScreenSharingController4=true;this.toggleScreenSharing();c('FBRTCScreenSharingUI').close();if(this.$FBRTCScreenSharingController1)this.$FBRTCScreenSharingController1.cleanPeerConnection();if(!this.$FBRTCScreenSharingController3)c('FBRTCMessageHandler').resetListener();if(l)this.$FBRTCScreenSharingController22();};k.prototype.$FBRTCScreenSharingController23=function(){this.$FBRTCScreenSharingController6=true;this.$FBRTCScreenSharingController8=true;this.$FBRTCScreenSharingController19('SC_RESET_PORT');this.$FBRTCScreenSharingController19('SC_REQUEST');};k.prototype.$FBRTCScreenSharingController19=function(l){l==='SC_REQUEST'||l==='SC_CANCEL'||l==='SC_RESET_PORT'||h(0);window.postMessage({recipient:c('FBRTCScreenSharingUtils').RECIPIENT,type:l,text:'communicate with screen sharing extension'},'*');if(l==='SC_REQUEST'||l==='SC_CANCEL')window.addEventListener('message',this.$FBRTCScreenSharingController14);};k.prototype.$FBRTCScreenSharingController16=function(l){this.$FBRTCScreenSharingController19('SC_RESET_PORT');this.$FBRTCScreenSharingController10=new (c('FBRTCMessageSender'))();this.$FBRTCScreenSharingController1=new (c('FBRTCScreenSharingConnection'))();this.$FBRTCScreenSharingController8=false;this.$FBRTCScreenSharingController11.addListener(this.$FBRTCScreenSharingController21.bind(this,true));};k.prototype.$FBRTCScreenSharingController24=function(l){var m=JSON.parse(l.payload);switch(l.msg_type){case c('FBRTCConstants').PayloadType.ICE_CANDIDATE:this.$FBRTCScreenSharingController1.onReceivedRemoteIceCandidate(m);break;case c('FBRTCConstants').PayloadType.ANSWER:c('FBRTCScreenSharingUI').hideRingingOverlay();this.$FBRTCScreenSharingController1.onReceivedAnswerSDP(m.sdp);break;case c('FBRTCConstants').PayloadType.HANGUP:this.onDirectScreenSharingEndSession();break;default:break;}};k.prototype.$FBRTCScreenSharingController25=function(l){if(this.$FBRTCScreenSharingController5&&!this.$FBRTCScreenSharingController2){this.$FBRTCScreenSharingController9.logToConsole(this.$FBRTCScreenSharingController12,this.$FBRTCScreenSharingController13,'Screen sharing already enabled, do nothing');return;}this.$FBRTCScreenSharingController11.onStart(l);if(this.$FBRTCScreenSharingController11.isEnabled())c('FBRTCScreenMedia').requestScreenMedia(l);};k.prototype.$FBRTCScreenSharingController17=function(){if(!this.$FBRTCScreenSharingController5){this.$FBRTCScreenSharingController9.logToConsole(this.$FBRTCScreenSharingController12,this.$FBRTCScreenSharingController13,'Screen sharing already disabled, do nothing');return;}this.$FBRTCScreenSharingController20(c('FBRTCScreenSharingLogger').Action.SCREEN_SHARING_DISABLED);this.$FBRTCScreenSharingController5=false;this.__emitChange();};k.prototype.$FBRTCScreenSharingController27=function(l){this.$FBRTCScreenSharingController5=!!l.stream;this.$FBRTCScreenSharingController11.setStream(l.stream,false);if(this.$FBRTCScreenSharingController2){this.$FBRTCScreenSharingController1.setStream(this.$FBRTCScreenSharingController11.getStream());if(this.$FBRTCScreenSharingController6){this.$FBRTCScreenSharingController1.createSdpUpdate();}else this.$FBRTCScreenSharingController1.createOffer();}this.$FBRTCScreenSharingController20(c('FBRTCScreenSharingLogger').Action.SCREEN_SHARING_ENABLED);this.__emitChange();};k.prototype.$FBRTCScreenSharingController28=function(l){this.$FBRTCScreenSharingController9.logError(this.$FBRTCScreenSharingController12,this.$FBRTCScreenSharingController13,this.$FBRTCScreenSharingController2,'Failed retrieving the screen stream with error: '+l.error);};k.prototype.$FBRTCScreenSharingController29=function(l){if(l&&l.candidate){l.isDirectScreenShareFromRecipient=this.$FBRTCScreenSharingController3;this.$FBRTCScreenSharingController10.sendIceCandidate(this.$FBRTCScreenSharingController12,this.$FBRTCScreenSharingController13,l);}};k.prototype.$FBRTCScreenSharingController30=function(l){this.$FBRTCScreenSharingController10.sendOffer(this.$FBRTCScreenSharingController12,this.$FBRTCScreenSharingController13,l,false,{isDirectScreenShareFromRecipient:this.$FBRTCScreenSharingController3});};k.prototype.$FBRTCScreenSharingController31=function(l){this.$FBRTCScreenSharingController10.sendAnswer(this.$FBRTCScreenSharingController12,this.$FBRTCScreenSharingController13,l,false,{isDirectScreenShareFromRecipient:this.$FBRTCScreenSharingController3});};k.prototype.$FBRTCScreenSharingController22=function(){this.$FBRTCScreenSharingController10.sendHangup(this.$FBRTCScreenSharingController12,this.$FBRTCScreenSharingController13,c('FBRTCConstants').CallEndReason.HANGUP_CALL,true,'DirectScreenSharing');};k.prototype.$FBRTCScreenSharingController32=function(l){this.$FBRTCScreenSharingController10.sendSdpUpdate(this.$FBRTCScreenSharingController12,this.$FBRTCScreenSharingController13,l,true,{isDirectScreenShareFromRecipient:this.$FBRTCScreenSharingController3});};k.prototype.$FBRTCScreenSharingController33=function(){var l=this.$FBRTCScreenSharingController7;if(l)l.drainQueue(this.$FBRTCScreenSharingController12,this.$FBRTCScreenSharingController34.bind(this));};k.prototype.$FBRTCScreenSharingController34=function(l){var m=JSON.parse(l.payload);this.$FBRTCScreenSharingController1.onReceivedRemoteIceCandidate(m);};k.prototype.$FBRTCScreenSharingController35=function(l){switch(l.description.type){case c('FBRTCConstants').PayloadType.OFFER:this.$FBRTCScreenSharingController36(l.description.sdp);break;case c('FBRTCConstants').PayloadType.ANSWER:this.$FBRTCScreenSharingController37(l.description.sdp);break;case c('FBRTCConstants').PayloadType.SDP_UPDATE:this.$FBRTCScreenSharingController38(l.description.sdp);break;default:break;}};k.prototype.$FBRTCScreenSharingController36=function(l){c('FBRTCScreenSharingUI').open(c('FBRTCScreenSharingConstants').UITypes.DIRECT_SENDER,this.$FBRTCScreenSharingController11.getStream(),this.$FBRTCScreenSharingController12);this.$FBRTCScreenSharingController30(l);};k.prototype.$FBRTCScreenSharingController37=function(l){this.$FBRTCScreenSharingController31(l);if(!this.$FBRTCScreenSharingController8)this.$FBRTCScreenSharingController33();};k.prototype.$FBRTCScreenSharingController38=function(l){c('FBRTCScreenSharingUI').switchScreen(c('FBRTCScreenSharingConstants').UITypes.DIRECT_SENDER,this.$FBRTCScreenSharingController11.getStream());this.$FBRTCScreenSharingController6=false;this.$FBRTCScreenSharingController32(l);};k.prototype.$FBRTCScreenSharingController39=function(l){if(!this.$FBRTCScreenSharingController3)return;this.$FBRTCScreenSharingController11.setStream(l.stream,true,true);if(this.$FBRTCScreenSharingController6){c('FBRTCScreenSharingUI').switchScreen(c('FBRTCScreenSharingConstants').UITypes.DIRECT_RECIPIENT,this.$FBRTCScreenSharingController11.getStream());this.$FBRTCScreenSharingController6=false;}else c('FBRTCScreenSharingUI').open(c('FBRTCScreenSharingConstants').UITypes.DIRECT_RECIPIENT,this.$FBRTCScreenSharingController11.getStream(),this.$FBRTCScreenSharingController12);};k.prototype.$FBRTCScreenSharingController40=function(l){if(!this.$FBRTCScreenSharingController8)this.$FBRTCScreenSharingController29(l.candidate);};k.prototype.$FBRTCScreenSharingController41=function(){c('FBRTCMessageListener').removeMessageHandler();c('FBRTCMessageListener').init(false,this.$FBRTCScreenSharingController12);c('FBRTCMessageListener').setMessageHandler(this.$FBRTCScreenSharingController24,this);};k.prototype.$FBRTCScreenSharingController20=function(l){var m,n=this.$FBRTCScreenSharingController12,o=this.$FBRTCScreenSharingController13,p=this.$FBRTCScreenSharingController2;for(var q=arguments.length,r=Array(q>1?q-1:0),s=1;s<q;s++)r[s-1]=arguments[s];(m=this.$FBRTCScreenSharingController9).logAction.apply(m,[n,o,l,p].concat(r));};k.prototype.$FBRTCScreenSharingController26=function(){var l,m=this.$FBRTCScreenSharingController12,n=this.$FBRTCScreenSharingController13,o=this.$FBRTCScreenSharingController2;for(var p=arguments.length,q=Array(p),r=0;r<p;r++)q[r]=arguments[r];(l=this.$FBRTCScreenSharingController9).logError.apply(l,[m,n,o].concat(q));};k.prototype.__onDispatch=function(l){if(this.$FBRTCScreenSharingController4)return;switch(l.type){case c('FBRTCScreenMedia').Types.STREAM_READY:this.$FBRTCScreenSharingController27(l);break;case c('FBRTCScreenMedia').Types.STREAM_FAILED:this.$FBRTCScreenSharingController28(l);break;case c('FBRTCScreenSharingActions').ConnectionEventTypes.SDP_CREATED:this.$FBRTCScreenSharingController35(l);break;case c('FBRTCScreenSharingActions').ConnectionEventTypes.REMOTE_STREAM_ADDED:this.$FBRTCScreenSharingController39(l);break;case c('FBRTCScreenSharingActions').ConnectionEventTypes.LOCAL_ICE_CANDIDATE_CREATED:this.$FBRTCScreenSharingController40(l);break;case c('FBRTCScreenSharingActions').ControlEventTypes.END_SESSION:this.onDirectScreenSharingEndSession();break;case c('FBRTCScreenSharingActions').ControlEventTypes.SWITCH_SCREEN:this.$FBRTCScreenSharingController23();break;case c('FBRTCScreenSharingActions').ConnectionEventTypes.OFFER_ACK_RECEIVED:this.$FBRTCScreenSharingController41();break;case c('FBRTCScreenSharingActions').ConnectionEventTypes.REMOTE_DESCRIPTION_SET:break;default:break;}};f.exports=k;}),null);
__d("XVideoCallTurnDiscoveryController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/videocall\/turndiscovery\/",{version:{type:"Int",required:true}});}),null);
__d('FBRTCTurnDiscovery',['Promise','FBRTCLogger','FBRTCUtils','XVideoCallTurnDiscoveryController'],(function a(b,c,d,e,f,g){var h=3,i=null,j={requestTurnCreds:function k(l,m){var n=arguments.length<=2||arguments[2]===undefined?h:arguments[2];if(i)return i;var o=1,p=c('XVideoCallTurnDiscoveryController').getURIBuilder().setInt('version',o).getURI();i=new (c('Promise'))(function(q,r){s(n);function s(t){c('FBRTCUtils').sendServerRequest(p,function(u){var v=u.payload;return q(v);},function(){if(t>0){c('FBRTCLogger').getInstance().logError(m,l,'Failed turn; going to retry');s(t-1);}else r(new Error('failed'));});}});return i;}};f.exports=j;}),null);
__d("XGroupCallController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/groupcall\/{?conference_name}\/",{conference_name:{type:"String",required:true},call_id:{type:"Int"},users_to_ring:{type:"FBIDSet",defaultValue:[]},has_video:{type:"Bool",defaultValue:false},server_info_data:{type:"String"},nonce:{type:"String"}});}),null);
__d("XGroupCallSigningController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/groupcall\/init\/",{conference_name:{type:"String",required:true},call_id:{type:"Int"},users_to_ring:{type:"FBIDSet",defaultValue:[]},has_video:{type:"Bool",defaultValue:false},server_info_data:{type:"String"},nonce:{type:"String"}});}),null);
__d("XVideoCallController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/videocall\/incall\/",{peer_id:{type:"Int",required:true},call_id:{type:"Int"},is_caller:{type:"Bool",defaultValue:false},audio_only:{type:"Bool",defaultValue:false},nonce:{type:"String"}});}),null);
__d("XVideoCallInitController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/videocall\/init\/",{peer_id:{type:"Int",required:true},call_id:{type:"Int",required:true},is_caller:{type:"Bool",defaultValue:false},audio_only:{type:"Bool",defaultValue:false}});}),null);
__d('FBRTCUrlManager',['regeneratorRuntime','Promise','FBRTCConfig','FBRTCLogger','FBRTCUtils','XVideoCallInitController','XVideoCallController','XGroupCallSigningController','XGroupCallController','CurrentUser','URI'],(function a(b,c,d,e,f,g){var h=3,i=function p(q,r,s,t){c('FBRTCLogger').getInstance().logCallAction(q,r,c('FBRTCLogger').CallAction.OLD_URI);return c('XVideoCallController').getURIBuilder().setInt('peer_id',q).setInt('call_id',r).setBool('is_caller',s).setBool('audio_only',t).getURI();},j=function p(q,r,s,t,u,v,w){var x=arguments.length<=7||arguments[7]===undefined?'':arguments[7];if(w===undefined||w===null)w=h;var y=c('XVideoCallInitController').getURIBuilder().setInt('peer_id',q).setInt('call_id',r).setBool('is_caller',s).setBool('audio_only',t).getURI();y=c('FBRTCUtils').isCollabCallable(q)||x==='quickdial'?k(y):y;c('FBRTCUtils').sendServerRequest(y,function(z){u(z.payload.uri);},function(z){if(w>0){p(q,r,s,t,u,v,w-1,x);}else u(i(q,r,s,t));});};function k(p){if(c('CurrentUser').isEmployee()){p=p.setSubdomain(c('CurrentUser').hasWorkUser()||c('CurrentUser').isWorkUser()?'fb':'www');var q='/intern/';return c('URI').getRequestURI().getPath().substr(0,q.length)!==q?p:p.setDomain(p.getDomain().toString().replace(/.(intern|cstools)./,'.'));}return p;}function l(p){var q=p.conferenceName,r=p.callID,s=p.usersToRing,t=p.hasVideo,u=p.nonce,v=p.serverInfoData,w;return c('regeneratorRuntime').async(function x(y){while(1)switch(y.prev=y.next){case 0:w=c('XGroupCallSigningController').getURIBuilder().setString('conference_name',q).setInt('call_id',r).setFBIDSet('users_to_ring',s).setBool('has_video',t).setString('server_info_data',v).setString('nonce',u).getURI();return y.abrupt('return',new (c('Promise'))(function(z,aa){c('FBRTCUtils').sendServerRequest(w,function(ba){z(ba.payload.uri);},function(ba){aa(ba);});}));case 2:case 'end':return y.stop();}},null,this);}var m=function p(q,r,s,t,u,v,w){if(w===undefined||w===null)w=h;var x=c('XGroupCallSigningController').getURIBuilder().setFBID('call_id',q).setBool('is_caller',s).setBool('audio_only',t).setFBIDSet('users_to_ring',r).getURI();c('FBRTCUtils').sendServerRequest(x,function(y){u(y.payload.uri);},function(y){if(w>0){p(q,r,s,t,u,v,w-1);}else{var z=c('XGroupCallController').getURIBuilder().setFBID('call_id',q).setBool('is_caller',s).setBool('audio_only',t).setFBIDSet('users_to_ring',r).getURI();u(z);}});},n=function p(q){if(c('FBRTCConfig').disableURLManager())return;window.history.replaceState({},'',q);},o={init:function p(q){this._peerID=q;},onCallStarted:function p(){n(i(this._peerID));},getCallUri:j,getGroupCallUri:function p(q,r,s,t,u,v){var w;return c('regeneratorRuntime').async(function x(y){while(1)switch(y.prev=y.next){case 0:w=0;case 1:if(!(w<3)){y.next=14;break;}y.prev=2;y.next=5;return c('regeneratorRuntime').awrap(l({conferenceName:q,callID:r,usersToRing:s,hasVideo:t,nonce:u,serverInfoData:v}));case 5:return y.abrupt('return',y.sent);case 8:y.prev=8;y.t0=y['catch'](2);case 11:w++;y.next=1;break;case 14:return y.abrupt('return',c('XGroupCallController').getURIBuilder().setString('conference_name',q).setInt('call_id',r).setFBIDSet('users_to_ring',s).setBool('has_video',t).setString('server_info_data',v).setString('nonce',u).getURI());case 15:case 'end':return y.stop();}},null,this,[[2,8]]);},getNonceUri:function p(q,r,s,t,u){var v=arguments.length<=5||arguments[5]===undefined?'':arguments[5],w=c('XVideoCallController').getURIBuilder().setInt('peer_id',q).setInt('call_id',r).setBool('is_caller',s).setBool('audio_only',t).setString('nonce',u).getURI();return c('FBRTCUtils').isCollabCallable(q)||v==='quickdial'?k(w):w;}};f.exports=o;}),null);
__d('FBRTCStreamTester',['mixInEventEmitter','FBRTCUtils'],(function a(b,c,d,e,f,g){var h=100,i=30;function j(k){'use strict';if(!k)k={};this.$FBRTCStreamTester1=k.retries||i;this.$FBRTCStreamTester2=k.testInterval||h;this.$FBRTCStreamTester3=null;this.$FBRTCStreamTester4=null;this.$FBRTCStreamTester5=false;}j.prototype.testStream=function(k,l){'use strict';this.$FBRTCStreamTester3=k;if(!l){this.$FBRTCStreamTester5=true;this.$FBRTCStreamTester4=document.createElement('video');this.$FBRTCStreamTester4.muted=true;c('FBRTCUtils').attachMediaStream(this.$FBRTCStreamTester4,this.$FBRTCStreamTester3);this.$FBRTCStreamTester4.play();}else{this.$FBRTCStreamTester5=false;this.$FBRTCStreamTester4=l;}this.$FBRTCStreamTester6(this.$FBRTCStreamTester1);};j.prototype.$FBRTCStreamTester6=function(k){'use strict';if(this.$FBRTCStreamTester3.getVideoTracks().length===0||this.$FBRTCStreamTester4.currentTime>0){this.$FBRTCStreamTester7();this.emit('streamWorking');}else if(k<1){this.$FBRTCStreamTester7();this.emit('streamBroken');}else setTimeout(this.$FBRTCStreamTester6.bind(this,k-1),this.$FBRTCStreamTester2);};j.prototype.$FBRTCStreamTester7=function(){'use strict';if(this.$FBRTCStreamTester5)this.$FBRTCStreamTester4.pause();this.$FBRTCStreamTester4=null;this.$FBRTCStreamTester3=null;};c('mixInEventEmitter')(j,{streamWorking:true,streamBroken:true});f.exports=j;}),null);
__d('FBRTCUserMedia',['mixInEventEmitter','FBRTCConstants','FBRTCLogger','FBRTCStreamTester','FBRTCStreamWrapper','FBRTCUserMediaRequest'],(function a(b,c,d,e,f,g){var h={_localStream:null,_accessGranted:false,_pendingRequest:null,_failedVideoSources:[],_failedAudioSources:[],requestUserMedia:function i(j,k,l,m,n){if(this._localStream&&!l&&!m){this.emit('streamReady',this._localStream);}else{this._startRequestListeners();this._pendingRequest=new (c('FBRTCUserMediaRequest'))(j,k,n);this._pendingRequest.audioSource=l;this._pendingRequest.videoSource=m;this._request();}},_request:function i(){if(this._pendingRequest)this._pendingRequest.request().then(function(j){return this._onRequestSuccess(j);}.bind(this),function(j){return this._onRequestFailure(j);}.bind(this));},end:function i(){this._stopEventListeners();if(this._localStream){c('FBRTCStreamWrapper').stopStream(this._localStream);this._localStream=null;}},_startRequestListeners:function i(){if(navigator.mozGetUserMedia){this._evListener=this._onMediaPromptHidden.bind(this);document.addEventListener('mousedown',this._evListener);document.addEventListener('focus',this._evListener);}},_stopEventListeners:function i(){if(navigator.mozGetUserMedia){if(this._promptTimeout)clearTimeout(this._promptTimeout);document.removeEventListener('mousedown',this._evListener);document.removeEventListener('focus',this._evListener);}},_onMediaPromptHidden:function i(){this._promptTimeout=setTimeout(function(){if(!this._accessGranted&&this._pendingRequest)this._request();}.bind(this),1500);},_onRequestSuccess:function i(j){this._stopEventListeners();if(!this._accessGranted){this._accessGranted=true;this.emit('accessGranted');}j.videoMediaSourceId=this._pendingRequest.videoSource;j.audioMediaSourceId=this._pendingRequest.audioSource;var k=new (c('FBRTCStreamTester'))();k.addListener('streamWorking',function(){this._pendingRequest=null;if(this._localStream&&this._localStream!==j)c('FBRTCStreamWrapper').stopStream(this._localStream);this._localStream=j;this.emit('streamReady',this._localStream);}.bind(this));k.addListener('streamBroken',function(){c('FBRTCStreamWrapper').stopStream(j);this._onRequestFailure('StreamFailedToStart');}.bind(this));k.testStream(j);},_onRequestFailure:function i(j){this._stopEventListeners();var k=this._getErrorName(j);if(this._shouldRetryRequest(k,this._pendingRequest)){this._configureRequestForRetry(this._pendingRequest,k);return;}if(k==='InvalidStateError'){c('FBRTCLogger').getInstance().logErrorWithoutID('Invalid state while requesting user media');return;}this._pendingRequest=null;if(k==='PERMISSION_DENIED'||k==='PermissionDeniedError'||k==='PermissionDismissedError'){this.emit('accessDenied',k);}else{if(k==='NO_DEVICES_FOUND')k='DevicesNotFoundError';c('FBRTCLogger').getInstance().logErrorWithoutID('getUserMedia error: '+k);this.emit('accessFailed',k);}},_getErrorName:function i(j){if(j.name)return j.name;return j;},_shouldRetryRequest:function i(j,k){return k.streamType!==c('FBRTCConstants').StreamType.AUDIO_ONLY&&(j==='DevicesNotFoundError'||j==='StreamFailedToStart');},_configureRequestForRetry:function i(j,k){if(k==='StreamFailedToStart'&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources){if(j.videoSource)this._failedVideoSources.push(j.videoSource);window.MediaStreamTrack.getSources(function(l){for(var m=0;m<l.length;m++){var n=l[m];if(n.kind==='video'&&this._failedVideoSources.indexOf(n.id)===-1){j.videoSource=n.id;this._request();return;}}j.streamType=c('FBRTCConstants').StreamType.AUDIO_ONLY;this._request();}.bind(this));}else{j.streamType=c('FBRTCConstants').StreamType.AUDIO_ONLY;this._request();}}};c('mixInEventEmitter')(h,{streamReady:true,accessGranted:true,accessDenied:true,accessFailed:true});f.exports=h;}),null);
__d('FBRTCVideoEscalationStore',['FBRTCCallControlActions','FBRTCConstants','FBRTCStore','keyMirror'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=25000,k=10000,l=c('keyMirror')({direct_video:null,escalated:null,escalation_declined:null,voip:null});h=babelHelpers.inherits(m,c('FBRTCStore'));i=h&&h.prototype;function m(n,o,p){i.constructor.call(this);this.$FBRTCVideoEscalationStore7=n;this.$FBRTCVideoEscalationStore2=o;this.$FBRTCVideoEscalationStore1=p;this.$FBRTCVideoEscalationStore4=p;this.$FBRTCVideoEscalationStore3=false;this.$FBRTCVideoEscalationStore5=null;this.$FBRTCVideoEscalationStore8=null;}m.prototype.isPending=function(){return !!this.$FBRTCVideoEscalationStore5;};m.prototype.callHasEscalated=function(){return this.$FBRTCVideoEscalationStore1;};m.prototype.getCallType=function(){if(!this.$FBRTCVideoEscalationStore2.isRemoteVideoSupported){return l.voip;}else if(this.$FBRTCVideoEscalationStore4){return l.direct_video;}else if(this.$FBRTCVideoEscalationStore1){return l.escalated;}else if(this.$FBRTCVideoEscalationStore3)return l.escalation_declined;return l.voip;};m.prototype.__onDispatch=function(n){switch(n.type){case c('FBRTCCallControlActions').Types.RECEIVED_SIGNALING_MESSAGE:var o=n.message;if(n.message_type===c('FBRTCConstants').PayloadType.VIDEO_REQUEST){this.$FBRTCVideoEscalationStore3=true;if(o.ackID){this.$FBRTCVideoEscalationStore10(o);}else this.$FBRTCVideoEscalationStore11(o);}if(n.message_type===c('FBRTCConstants').PayloadType.ACK&&o.msg.ack_type===c('FBRTCConstants').PayloadType.VIDEO_REQUEST)this.$FBRTCVideoEscalationStore12(o);break;case c('FBRTCCallControlActions').Types.ACCEPT_ESCALATION:this.$FBRTCVideoEscalationStore13(true);break;case c('FBRTCCallControlActions').Types.DECLINE_ESCALATION:this.$FBRTCVideoEscalationStore13(false);break;case c('FBRTCCallControlActions').Types.TOGGLE_MUTE_VIDEO:this.$FBRTCVideoEscalationStore3=true;this.getDispatcher().waitFor([this.$FBRTCVideoEscalationStore2.getDispatchToken()]);this.$FBRTCVideoEscalationStore14();break;}};m.prototype.$FBRTCVideoEscalationStore12=function(n){if(this.$FBRTCVideoEscalationStore8&&this.$FBRTCVideoEscalationStore8.msg_id===n.ackID)this.$FBRTCVideoEscalationStore15();};m.prototype.$FBRTCVideoEscalationStore15=function(){clearTimeout(this.$FBRTCVideoEscalationStore6);};m.prototype.$FBRTCVideoEscalationStore16=function(){this.$FBRTCVideoEscalationStore6=setTimeout(function(){if(!this.$FBRTCVideoEscalationStore8)return;this.$FBRTCVideoEscalationStore7.resendPayload(this.$FBRTCVideoEscalationStore2.peerID,this.$FBRTCVideoEscalationStore8);}.bind(this),k);};m.prototype.$FBRTCVideoEscalationStore10=function(n){if(!this.$FBRTCVideoEscalationStore8||n.ackID!==this.$FBRTCVideoEscalationStore8.msg_id)return;clearTimeout(this.$FBRTCVideoEscalationStore9);this.$FBRTCVideoEscalationStore15();var o=n.msg,p=n.peerID,q=n.callID,r=this.$FBRTCVideoEscalationStore17(o);this.$FBRTCVideoEscalationStore7.sendAck(p,q,o);this.$FBRTCVideoEscalationStore8=null;this.$FBRTCVideoEscalationStore1=r;this.$FBRTCVideoEscalationStore18(r);if(!r&&this.$FBRTCVideoEscalationStore2.localStream.hasVideo())this.$FBRTCVideoEscalationStore2.localStream.toggleMuteVideo();this.__emitChange();};m.prototype.$FBRTCVideoEscalationStore11=function(n){if(this.$FBRTCVideoEscalationStore1){if(this.$FBRTCVideoEscalationStore17(n.msg)){this.$FBRTCVideoEscalationStore5=n;this.$FBRTCVideoEscalationStore13(true);}else this.$FBRTCVideoEscalationStore2.remoteStream.setVideoEnabled(false);return;}var o=n.msg,p=n.peerID,q=n.callID;this.$FBRTCVideoEscalationStore7.sendAck(p,q,o);if(this.$FBRTCVideoEscalationStore17(o)){this.$FBRTCVideoEscalationStore5=n;this.$FBRTCVideoEscalationStore9=setTimeout(function(){c('FBRTCCallControlActions').declineEscalation();},j);}else this.$FBRTCVideoEscalationStore5=null;this.__emitChange();};m.prototype.$FBRTCVideoEscalationStore13=function(n){clearTimeout(this.$FBRTCVideoEscalationStore9);if(this.$FBRTCVideoEscalationStore5){var o=this.$FBRTCVideoEscalationStore5,p=o.peerID,q=o.callID,r=o.msgID;this.$FBRTCVideoEscalationStore8=this.$FBRTCVideoEscalationStore7.sendVideoRequestResponse(p,q,r,n);this.$FBRTCVideoEscalationStore16();this.$FBRTCVideoEscalationStore1=n;this.$FBRTCVideoEscalationStore5=null;this.__emitChange();}};m.prototype.$FBRTCVideoEscalationStore14=function(){if(this.$FBRTCVideoEscalationStore1){this.$FBRTCVideoEscalationStore19();return;}this.$FBRTCVideoEscalationStore8=this.$FBRTCVideoEscalationStore7.sendVideoEscalationRequest(this.$FBRTCVideoEscalationStore2.peerID,this.$FBRTCVideoEscalationStore2.callID,this.$FBRTCVideoEscalationStore2.localStream.hasVideo());if(this.$FBRTCVideoEscalationStore2.localStream.hasVideo()){this.$FBRTCVideoEscalationStore16();this.$FBRTCVideoEscalationStore9=setTimeout(function(){if(this.$FBRTCVideoEscalationStore2.localStream.hasVideo())c('FBRTCCallControlActions').toggleMuteVideo();}.bind(this),j);}else{this.$FBRTCVideoEscalationStore15();clearTimeout(this.$FBRTCVideoEscalationStore9);this.$FBRTCVideoEscalationStore8=null;}this.__emitChange();};m.prototype.$FBRTCVideoEscalationStore19=function(){if(!this.$FBRTCVideoEscalationStore2.isRemoteVideoSupported)return;this.$FBRTCVideoEscalationStore7.sendMuteStateUpdate(this.$FBRTCVideoEscalationStore2.peerID,this.$FBRTCVideoEscalationStore2.callID,this.$FBRTCVideoEscalationStore2.localStream.hasVideo());};m.prototype.$FBRTCVideoEscalationStore18=function(n){this.$FBRTCVideoEscalationStore2.remoteStream.setVideoEnabled(n);};m.prototype.$FBRTCVideoEscalationStore17=function(n){return !!(n.reqVideoOn||n.videoon);};f.exports=m;}),null);
__d('FBRTCRingback',['RTCConfig','Sound','FBRTCCallModel'],(function a(b,c,d,e,f,g){var h=[c('RTCConfig').ringback_mp3_url,c('RTCConfig').ringback_ogg_url],i={monitorCallModel:function j(k){if(this._subscription)this._subscription.remove();this._callModel=k;this._subscription=k.addListener(this._onChange.bind(this));},_soundIsPlaying:false,_onChange:function j(){if(this._callModel.uiState===c('FBRTCCallModel').UIState.RINGING){this._startSound();}else this._stopSound();},_startSound:function j(){if(!this._soundIsPlaying){c('Sound').play(h,this._syncToken(),true);this._soundIsPlaying=true;}},_syncToken:function j(){return 'ring_back_'+this._callModel.callID.toString();},_stopSound:function j(){if(this._soundIsPlaying){c('Sound').stop(h);this._soundIsPlaying=false;}}};f.exports=i;}),null);
__d('FBRTCStarRatingStore',['FBRTCLogger','FBRTCStore','FBRTCStarRatingActions'],(function a(b,c,d,e,f,g){'use strict';var h,i;h=babelHelpers.inherits(j,c('FBRTCStore'));i=h&&h.prototype;function j(k,l){i.constructor.call(this);this.$FBRTCStarRatingStore1=k;this.$FBRTCStarRatingStore2=l;}j.prototype.setCallSummary=function(k){this.$FBRTCStarRatingStore1=k;};j.prototype.__onDispatch=function(k){switch(k.type){case c('FBRTCStarRatingActions').Types.SUBMIT_RATING:this.$FBRTCStarRatingStore3(k.rating);break;case c('FBRTCStarRatingActions').Types.SUBMIT_FEEDBACK:this.$FBRTCStarRatingStore4(k.feedback);break;case c('FBRTCStarRatingActions').Types.RATING_SHOWN:this.$FBRTCStarRatingStore5();break;}};j.prototype.$FBRTCStarRatingStore3=function(k){this.$FBRTCStarRatingStore1.addExtraInfo(c('FBRTCLogger').Key.RATING,k);this.$FBRTCStarRatingStore1.save(this.$FBRTCStarRatingStore2);};j.prototype.$FBRTCStarRatingStore4=function(k){this.$FBRTCStarRatingStore1.addExtraInfo(c('FBRTCLogger').Key.SURVEY_DETAILS,k);this.$FBRTCStarRatingStore1.save(this.$FBRTCStarRatingStore2);};j.prototype.$FBRTCStarRatingStore5=function(){this.$FBRTCStarRatingStore1.addExtraInfo(c('FBRTCLogger').Key.RATING_SHOWN,'1');this.$FBRTCStarRatingStore1.save(this.$FBRTCStarRatingStore2);};f.exports=j;}),null);
__d('FBRTCViewController',['FBRTCCallModel','FBRTCConstants','FBRTCLogger','FBRTCRingback','FBRTCStarRatingStore'],(function a(b,c,d,e,f,g){var h=500;function i(j,k,l){'use strict';this.$FBRTCViewController1=j;this.$FBRTCViewController2=new (c('FBRTCStarRatingStore'))(k,l);this.$FBRTCViewController3=false;this.$FBRTCViewController4=c('FBRTCLogger').getInstance();}i.prototype.init=function(){'use strict';c('FBRTCRingback').monitorCallModel(this.$FBRTCViewController1);this.$FBRTCViewController1.fetchPeerInfo();};i.prototype.onLocalStreamReady=function(j){'use strict';this.$FBRTCViewController1.setLocalStream(j);if(this.$FBRTCViewController1.uiState>c('FBRTCCallModel').UIState.MORE_INIT){this.$FBRTCViewController4.logInfo(this.$FBRTCViewController1.peerID,this.$FBRTCViewController1.callID,'UI: Already @ MORE_INIT, no update');}else if(this.$FBRTCViewController1.canStartCall()&&!this.$FBRTCViewController1.isCaller){this.$FBRTCViewController1.setState(c('FBRTCCallModel').UIState.CALL_CONNECTING);}else this.$FBRTCViewController1.setState(c('FBRTCCallModel').UIState.MORE_INIT);};i.prototype.waitForUserInput=function(){'use strict';this.$FBRTCViewController1.setStateFrom(c('FBRTCCallModel').UIState.INIT,c('FBRTCCallModel').UIState.AWAITING_USER_START);};i.prototype.userMediaRequested=function(){'use strict';setTimeout(function(){var j=this.$FBRTCViewController1.uiState;if(j===c('FBRTCCallModel').UIState.INIT||j>=c('FBRTCCallModel').UIState.CALL_ENDED)this.$FBRTCViewController1.setState(c('FBRTCCallModel').UIState.PENDING_LOCAL_MEDIA);}.bind(this),h);};i.prototype.userMediaGranted=function(){'use strict';this.$FBRTCViewController1.setState(c('FBRTCCallModel').UIState.MORE_INIT);};i.prototype.userMediaDenied=function(){'use strict';this.$FBRTCViewController1.setState(c('FBRTCCallModel').UIState.USER_MEDIA_DENIED);};i.prototype.onTurnCredentialsReady=function(j){'use strict';if(!this.$FBRTCViewController1.isCaller)this.$FBRTCViewController1.setStateFrom(c('FBRTCCallModel').UIState.MORE_INIT,c('FBRTCCallModel').UIState.CALL_CONNECTING);};i.prototype.onMessageTypeSent=function(j){'use strict';if(j!==c('FBRTCConstants').PayloadType.OFFER&&j!==c('FBRTCConstants').PayloadType.PCRESTART_OFFER)return;if(j===c('FBRTCConstants').PayloadType.PCRESTART_OFFER)this.$FBRTCViewController3=true;if(j===c('FBRTCConstants').PayloadType.OFFER)this.$FBRTCViewController1.setState(c('FBRTCCallModel').UIState.CONTACTING);};i.prototype.onMessageTypeReceived=function(j){'use strict';if(this.$FBRTCViewController3){if(j===c('FBRTCConstants').PayloadType.ANSWER)this.$FBRTCViewController1.setStateFrom(c('FBRTCCallModel').UIState.CONTACTING,c('FBRTCCallModel').UIState.CALL_CONNECTING);}else if(j===c('FBRTCConstants').PayloadType.OFFER_ACK){this.$FBRTCViewController1.setStateFrom(c('FBRTCCallModel').UIState.CONTACTING,c('FBRTCCallModel').UIState.RINGING);}else if(j===c('FBRTCConstants').PayloadType.ANSWER)if(this.$FBRTCViewController1.uiState===c('FBRTCCallModel').UIState.CONTACTING||this.$FBRTCViewController1.uiState===c('FBRTCCallModel').UIState.RINGING)this.$FBRTCViewController1.setState(c('FBRTCCallModel').UIState.CALL_CONNECTING);};i.prototype.onRemoteStreamAdded=function(event){'use strict';this.$FBRTCViewController1.setRemoteStream(event.stream);};i.prototype.end=function(j,k,l){'use strict';this.$FBRTCViewController1.endCallReason=j;this.$FBRTCViewController1.endCallSubreason=l;this.$FBRTCViewController1.isRemoteEnded=k;this.$FBRTCViewController1.setState(c('FBRTCCallModel').UIState.CALL_ENDED);};i.prototype.reset=function(j,k){'use strict';this.$FBRTCViewController1.resetForReconnect(j);this.$FBRTCViewController2.setCallSummary(k);this.$FBRTCViewController1.setState(c('FBRTCCallModel').UIState.CALL_CONNECTING);};i.prototype.$FBRTCViewController5=function(j,k){'use strict';this.$FBRTCViewController4.logCallAction(this.$FBRTCViewController1.peerID,this.$FBRTCViewController1.callID,j,k?'true':'false');};f.exports=i;}),null);
__d("FBRTCWindowManager",[],(function a(b,c,d,e,f,g){var h={height:0,width:0,top:0,left:0},i={height:447,width:675,bottomRightOffset:50},j={init:function k(l,m){this._window=l;this._callModel=m;m.addListener(this._setProgressIndicator.bind(this));this._setProgressIndicator();this._monitorOpenerForChanges();this._storePosition();},updatePosition:function k(l){if(!this._window)return;if(l&&h.height>0&&h.width>0){this._window.moveTo(h.left,h.top);this._window.resizeTo(h.width,h.height);return;}this._storePosition();this._window.resizeTo(i.width,i.height);var m=screen.width-i.width-i.bottomRightOffset,n=screen.height-i.height-i.bottomRightOffset;this._window.moveTo(m,n);},reload:function k(){if(this._window&&!this._window.closed)this._window.location.reload();},close:function k(){if(this._window&&!this._window.closed)this._window.close();},_setProgressIndicator:function k(){if(this._callModel.isEnded()){this._window.rtcCallInProgessWith=null;}else this._window.rtcCallInProgessWith=this._callModel.peerID.toString();},_monitorOpenerForChanges:function k(){if(this._window.opener)try{this._window.opener.addEventListener("unload",function(event){this._passWindowToOpener(10);}.bind(this));}catch(l){}},_passWindowToOpener:function k(l){setTimeout(function(){setTimeout(function(){if(this._window.opener&&!this._window.opener.closed)this._window.opener.rtcCallChildWindow=this._window;}.bind(this),1);if(l>1)this._passWindowToOpener(l-1);}.bind(this),1000);},_storePosition:function k(){if(this._window){if(this._window.innerWidth!==undefined){h.height=this._window.outerHeight;h.width=this._window.outerWidth;}else{h.height=this._window.screen.height;h.width=this._window.screen.width;}if(this._window.screenLeft!==undefined){h.left=this._window.screenLeft;h.top=this._window.screenTop;}else{h.left=this._window.screenX;h.top=this._window.screenY;}}}};f.exports=j;}),null);
__d('FBRTCCallController',['fbt','ChannelManager','ErrorUtils','Run','Bootloader','CollabCallMessengerBrowserEventEnum','FBRTCCallConnection','FBRTCCallConnectionMonitor','FBRTCCallControlActions','FBRTCCallModel','FBRTCCallMonitor','FBRTCCallSummary','FBRTCCallSummaryStore','FBRTCConfig','FBRTCConstants','FBRTCDispatcher','FBRTCExperiment','FBRTCIceCache','FBRTCLocalMessageQueue','FBRTCLogger','FBRTCMessage','FBRTCMessageDedup','FBRTCMessageListener','FBRTCMessageSender','FBRTCPCConfig','FBRTCTurnDiscovery','FBRTCUserMedia','FBRTCViewController','FBRTCCallModelStatePusher','FBRTCCallDialogController','FBRTCRetriableMessage','FBRTCUserSettings','FBRTCScreenSharingController','FBRTCScreenSharingUtils','FBRTCSdpUtils','FBRTCUrlManager','FBRTCUtils','FBRTCVideoEscalationStore','FBRTCWindowManager','QE','RTCConfig','randomInt'],(function a(b,c,d,e,f,g,h){c('ChannelManager');var i=60000,j=3000;function k(){return c('randomInt')(0,4294967295);}function l(n,o,p,q){'use strict';this.$FBRTCCallController39=function(t){var u;try{u=new (c('FBRTCMessage'))(t);}catch(v){this.$FBRTCCallController2.logError(this.$FBRTCCallController8.peerID,this.$FBRTCCallController8.callID,'Unknown data: '+JSON.stringify(t));return;}this.$FBRTCCallController2.logReceivedMessage(u.peerID,u.callID,u.msg);this.$FBRTCCallController7(c('CollabCallMessengerBrowserEventEnum').MESSAGE_RECEIVED,u.msgID);if(this.$FBRTCCallController8.isEnded()){this.$FBRTCCallController2.logInfo(this.$FBRTCCallController8.peerID,this.$FBRTCCallController8.callID,'Ignoring message (call ended): '+u.msgID);return;}if(!c('FBRTCMessageDedup').check(u.peerID,u.callID,u.msgID)){this.$FBRTCCallController2.logInfo(this.$FBRTCCallController8.peerID,this.$FBRTCCallController8.callID,'Ignoring message (duplicate): '+u.msgID);return;}if(this.$FBRTCCallController8.isAwaitingUserStart())return;if(this.$FBRTCCallController8.peerID&&this.$FBRTCCallController8.peerID!==u.peerID){if(u.isOffer())this.$FBRTCCallController69(u);this.$FBRTCCallController2.logInfo(this.$FBRTCCallController8.peerID,this.$FBRTCCallController8.callID,'Ignoring message (different peer): '+u.msgID);return;}if(!u.isForCall(this.$FBRTCCallController8.callID)){this.$FBRTCCallController2.logInfo(this.$FBRTCCallController8.peerID,this.$FBRTCCallController8.callID,'Ignoring message (different call): '+u.msgID);return;}this.$FBRTCCallController13.onMessageTypeReceived(u.msgType);if(this.$FBRTCCallController8.callID&&this.$FBRTCCallController8.callID===u.callID)this.$FBRTCCallController10.onFullMessageReceived(u);this.$FBRTCCallController8.setSignalingExperiments(u.getSignalingExperiments());switch(u.msgType){case c('FBRTCConstants').PayloadType.OFFER:case c('FBRTCConstants').PayloadType.ICERESTART_OFFER:case c('FBRTCConstants').PayloadType.PCRESTART_OFFER:this.$FBRTCCallController70(u);break;case c('FBRTCConstants').PayloadType.ANSWER:case c('FBRTCConstants').PayloadType.ICERESTART_ANSWER:case c('FBRTCConstants').PayloadType.PCRESTART_ANSWER:this.$FBRTCCallController71(u);this.$FBRTCCallController40.onCallHeartbeat(this.$FBRTCCallController10);break;case c('FBRTCConstants').PayloadType.SDP_UPDATE:this.$FBRTCCallController72(u);break;case c('FBRTCConstants').PayloadType.ICE_CANDIDATE:this.$FBRTCCallController73(u);break;case c('FBRTCConstants').PayloadType.HANGUP:this.$FBRTCCallController74(u);break;case c('FBRTCConstants').PayloadType.OFFER_ACK:this.$FBRTCCallController75(u);break;case c('FBRTCConstants').PayloadType.OFFER_NACK:this.$FBRTCCallController8.receivedNack=true;break;case c('FBRTCConstants').PayloadType.ANSWER_ACK:this.$FBRTCCallController76();break;case c('FBRTCConstants').PayloadType.MSG_ACK:this.$FBRTCCallController77(u);break;case c('FBRTCConstants').PayloadType.SET_VIDEO:if(this.$FBRTCCallController8.isRemoteVideoSupported&&(this.$FBRTCCallController32.callHasEscalated()||!this.$FBRTCCallController8.isPeerOnMobile))this.$FBRTCCallController48(u.msg.videoon);break;case c('FBRTCConstants').PayloadType.VIDEO_REQUEST:case c('FBRTCConstants').PayloadType.ACK:case c('FBRTCConstants').PayloadType.OK:case c('FBRTCConstants').PayloadType.PING:case c('FBRTCConstants').PayloadType.PING_ACK:case c('FBRTCConstants').PayloadType.OTHER_DISMISS:case c('FBRTCConstants').PayloadType.PRANSWER:break;default:break;}c('FBRTCCallControlActions').receivedSignalingMessage(u);}.bind(this);c('QE').logExposure('rtc_www_routing_service_vs_channel');this.$FBRTCCallController1=q;this.$FBRTCCallController2=c('FBRTCLogger').getInstance();this.$FBRTCCallController3=new (c('FBRTCLocalMessageQueue'))();this.$FBRTCCallController4=c('FBRTCCallSummaryStore').getInstance();this.$FBRTCCallController5=null;this.$FBRTCCallController6=false;if(!p){var r=this.$FBRTCCallController3.getOffer(n);if(r){this.$FBRTCCallController5=new (c('FBRTCMessage'))(r);c('FBRTCMessageDedup').check(n,this.$FBRTCCallController5.callID,this.$FBRTCCallController5.msgID);}else p=true;}if(!o)o=this.$FBRTCCallController5?this.$FBRTCCallController5.callID:k();this.$FBRTCCallController2.logCallAction(n,o,c('FBRTCLogger').CallAction.POPUP_OPENED);this.$FBRTCCallController7(c('CollabCallMessengerBrowserEventEnum').CALL_CONTROLLER_INIT);this.$FBRTCCallController8=new (c('FBRTCCallModel'))({peerID:n,callID:o,isCaller:p,isAudioOnly:q});if(this.$FBRTCCallController5)this.$FBRTCCallController8.onSDPMessageFromPeer(this.$FBRTCCallController5);this.$FBRTCCallController8.localStream.setVideoEnabled(!q);this.$FBRTCCallController9=new (c('FBRTCCallModelStatePusher'))(this.$FBRTCCallController8);this.$FBRTCCallController10=c('FBRTCCallSummary').restoreOrInitialize(this.$FBRTCCallController4,n,o,p,this.$FBRTCCallController5&&this.$FBRTCCallController5.msg);this.$FBRTCCallController10.onPopupOpened();c('FBRTCUrlManager').init(this.$FBRTCCallController8.peerID);c('FBRTCWindowManager').init(window,this.$FBRTCCallController8);this.$FBRTCCallController11=new (c('FBRTCScreenSharingController'))(n,o,false);if(c('FBRTCScreenSharingUtils').isScreenSharingSupported())this.$FBRTCCallController11.addListener(this.$FBRTCCallController12.bind(this));this.$FBRTCCallController13=new (c('FBRTCViewController'))(this.$FBRTCCallController8,this.$FBRTCCallController10,this.$FBRTCCallController4);this.$FBRTCCallController13.init();this.$FBRTCCallController14=new (c('FBRTCCallConnection'))();this.$FBRTCCallController14.addListener('remoteStreamAdded',this.$FBRTCCallController15,this);this.$FBRTCCallController14.addListener('remoteStreamRemoved',this.$FBRTCCallController16,this);this.$FBRTCCallController14.addListener('sdpCreated',this.$FBRTCCallController17,this);this.$FBRTCCallController14.addListener('localIceCandidateCreated',this.$FBRTCCallController18,this);this.$FBRTCCallController14.addListener('remoteDescriptionSet',this.$FBRTCCallController19,this);this.$FBRTCCallController14.addListener('connected',this.$FBRTCCallController20,this);this.$FBRTCCallController14.addListener('disconnected',this.$FBRTCCallController21,this);this.$FBRTCCallController14.addListener('connectionUnstable',this.$FBRTCCallController22,this);this.$FBRTCCallController14.addListener('connectionError',this.$FBRTCCallController23,this);this.$FBRTCCallController24=false;this.$FBRTCCallController25=new (c('FBRTCCallConnectionMonitor'))(this.$FBRTCCallController14,this.$FBRTCCallController10);this.$FBRTCCallController25.addListener('connectionPoor',this.$FBRTCCallController26,this);this.$FBRTCCallController27=new (c('FBRTCMessageSender'))();this.$FBRTCCallController27.onMessageSent=this.$FBRTCCallController28.bind(this);this.$FBRTCCallController27.onSendFailure=this.$FBRTCCallController29.bind(this);this.$FBRTCCallController30=null;this.$FBRTCCallController31=null;this.$FBRTCCallController32=new (c('FBRTCVideoEscalationStore'))(this.$FBRTCCallController27,this.$FBRTCCallController8,!q);this.$FBRTCCallController10.setCallType(this.$FBRTCCallController32.getCallType());this.$FBRTCCallController32.addListener(this.$FBRTCCallController33.bind(this));this.$FBRTCCallController34=new (c('FBRTCIceCache'))();this.$FBRTCCallController35=false;c('Run').onBeforeUnload(this.$FBRTCCallController36.bind(this),false);c('Run').onUnload(this.$FBRTCCallController37.bind(this));c('ErrorUtils').addListener(this.$FBRTCCallController38.bind(this),true);c('FBRTCMessageListener').init(true,this.$FBRTCCallController8.peerID);c('FBRTCMessageListener').setMessageHandler(this.$FBRTCCallController39,this);var s=this;this.$FBRTCCallController40=new (c('FBRTCCallMonitor'))(this.$FBRTCCallController8);this.$FBRTCCallController40.startHeartbeat(function(){return s.$FBRTCCallController10;});this.$FBRTCCallController41=null;c('FBRTCUserSettings').addListener('saved',this.$FBRTCCallController42,this);if(c('FBRTCConfig').isVCEndpointCall()&&c('RTCConfig').CollabDisableBrowserTurnDiscoveryGK){this.$FBRTCCallController2.logInfo(this.$FBRTCCallController8.peerID,this.$FBRTCCallController8.callID,'Skipping the TURN discovery');this.$FBRTCCallController43();}else c('FBRTCTurnDiscovery').requestTurnCreds(this.$FBRTCCallController8.callID,this.$FBRTCCallController8.peerID).done(function(t){return this.$FBRTCCallController44(t);}.bind(this),function(){return this.$FBRTCCallController45();}.bind(this));c('FBRTCDispatcher').register(this.__onDispatch.bind(this));this.$FBRTCCallController46=setTimeout(function(){this.waitForUserInput();}.bind(this),1500);m(function(t){var u=t.logConnectionStats(function(){return this.$FBRTCCallController14.getStatsNative();}.bind(this),n,o),v=u.start,w=u.stop;this.$FBRTCCallController14.addListener('connected',function(){v();this.$FBRTCCallController14.addListener('isEnding',w);}.bind(this));}.bind(this));}l.prototype.__onDispatch=function(n){'use strict';switch(n.type){case c('FBRTCCallControlActions').Types.HANG_UP:this.$FBRTCCallController47(c('FBRTCConstants').CallEndReason.HANGUP_CALL,false,true,false);break;case c('FBRTCCallControlActions').Types.TOGGLE_SCREEN_SHARING:if(this.$FBRTCCallController11)this.$FBRTCCallController11.toggleScreenSharing(this.$FBRTCCallController8);break;case c('FBRTCCallControlActions').Types.SHOW_SETTINGS:c('FBRTCCallDialogController').showDialog(c('FBRTCCallDialogController').dialogTypes.SETTINGS,this.$FBRTCCallController8);break;case c('FBRTCCallControlActions').Types.ACCEPT_ESCALATION:this.$FBRTCCallController8.localStream.setVideoEnabled(true);this.$FBRTCCallController48(true);break;case c('FBRTCCallControlActions').Types.RESET_CALL:this.$FBRTCCallController49(n);break;case c('FBRTCCallControlActions').Types.PARENT_WINDOW_START_CALL:if(this.$FBRTCCallController8.canBeStartedByParentWindow())this.startCallProcess();break;case c('FBRTCCallControlActions').Types.REDIAL_CALL:this.$FBRTCCallController8.resetCallInfo(k());this.$FBRTCCallController10=new (c('FBRTCCallSummary'))({peerID:this.$FBRTCCallController8.peerID,callID:this.$FBRTCCallController8.callID,isCaller:true});this.$FBRTCCallController50(c('FBRTCLogger').Trigger.REDIAL_BUTTON);break;case c('FBRTCCallControlActions').Types.START_CALL:this.$FBRTCCallController50(c('FBRTCLogger').Trigger.POPUP_CALL_START_BUTTON);break;}};l.prototype.getCallModel=function(){'use strict';return this.$FBRTCCallController8;};l.prototype.getConnection=function(){'use strict';return this.$FBRTCCallController14;};l.prototype.sendData=function(n,o){'use strict';this.$FBRTCCallController14.sendData({topic:n,data:o});};l.prototype.addDataChannelListener=function(n,o){'use strict';return this.$FBRTCCallController14.addListener('data_message',n,o);};l.prototype.$FBRTCCallController50=function(n){'use strict';this.$FBRTCCallController10.onCallStarted(n);this.startCallProcess();};l.prototype.startCallProcess=function(){'use strict';this.$FBRTCCallController51();this.$FBRTCCallController13.userMediaRequested();this.$FBRTCCallController7(c('CollabCallMessengerBrowserEventEnum').CALL_PROCESS_STARTED);};l.prototype.waitForUserInput=function(){'use strict';this.$FBRTCCallController13.waitForUserInput();};l.prototype.$FBRTCCallController51=function(){'use strict';var n=this.$FBRTCCallController8.localStream;c('FBRTCUserMedia').once('streamReady',this.$FBRTCCallController52,this);c('FBRTCUserMedia').addListener('accessDenied',this.$FBRTCCallController53,this);c('FBRTCUserMedia').addListener('accessFailed',this.$FBRTCCallController54,this);c('FBRTCUserMedia').addListener('accessGranted',this.$FBRTCCallController55,this);n.addListener('streamStarted',function(){this.$FBRTCCallController10.setVideoCaptureStats(n.videoWidth,n.videoHeight);this.$FBRTCCallController7(c('CollabCallMessengerBrowserEventEnum').LOCAL_STREAM_STARTED,n.getStream());}.bind(this));this.$FBRTCCallController7(c('CollabCallMessengerBrowserEventEnum').REQUEST_USER_MEDIA,'init');this.$FBRTCCallController56();};l.prototype.$FBRTCCallController56=function(){'use strict';var n;if(!this.$FBRTCCallController8.isRemoteVideoSupported){n=c('FBRTCConstants').VideoQuality.NO_VIDEO;}else if(this.$FBRTCCallController8.isPeerOnMobile){n=c('FBRTCConstants').VideoQuality.LQ_VIDEO;}else if(c('FBRTCUtils').isCollabCallable(this.$FBRTCCallController8.peerID)){n=c('FBRTCConstants').VideoQuality.CUSTOM_VIDEO;}else if(this.$FBRTCCallController8.isCaller&&this.$FBRTCCallController8.uiState>=c('FBRTCCallModel').UIState.CALL_CONNECTING){var o=c('FBRTCExperiment').gen('rtc_web_video_quality_3'),p=o.getParam('renegotiate_to_hd','no');if(p==='yes'){n=c('FBRTCConstants').VideoQuality.HD_VIDEO;}else n=c('FBRTCConstants').VideoQuality.SD_VIDEO;}else n=c('FBRTCConstants').VideoQuality.SD_VIDEO;var q=c('FBRTCConstants').StreamType.AUDIO_ONLY;if(this.$FBRTCCallController8.localStream&&this.$FBRTCCallController8.localStream.hasVideoTracks())q=c('FBRTCConstants').StreamType.AUDIO_VIDEO;var r=c('FBRTCUserSettings').audioInput,s=c('FBRTCUserSettings').videoInput;this.$FBRTCCallController57=n;this.$FBRTCCallController7(c('CollabCallMessengerBrowserEventEnum').REQUEST_USER_MEDIA,{streamType:q,videoQuality:n,audioInput:r,videoInput:s});c('FBRTCUserMedia').requestUserMedia(q,n,r,s,this.$FBRTCCallController1);};l.prototype.$FBRTCCallController42=function(n){'use strict';this.$FBRTCCallController2.logCallAction(this.$FBRTCCallController8.peerID,this.$FBRTCCallController8.callID,c('FBRTCLogger').CallAction.USER_SETTINGS_CHANGED);this.$FBRTCCallController7(c('CollabCallMessengerBrowserEventEnum').USER_SETTINGS_CHANGED,{updateStream:n});if(n){c('FBRTCUserMedia').once('streamReady',function(o){c('FBRTCUserSettings').updateForLocalStream(o);this.$FBRTCCallController8.setLocalStream(o);this.$FBRTCCallController58();}.bind(this));this.$FBRTCCallController56();}};l.prototype.$FBRTCCallController12=function(){'use strict';var n=this.$FBRTCCallController11.isEnabled(),o=this.$FBRTCCallController11.getStream();if(n){this.$FBRTCCallController14.addScreenStream(o);}else{this.$FBRTCCallController14.removeScreenStream(o);this.$FBRTCCallController11.onStop();}this.$FBRTCCallController58();c('FBRTCWindowManager').updatePosition(!n);if(n){this.$FBRTCCallController8.setLocalScreenStream(o);}else this.$FBRTCCallController8.setLocalScreenStream(null);this.$FBRTCCallController7(c('CollabCallMessengerBrowserEventEnum').SCREEN_SHARING_TOGGLED,n);};l.prototype.$FBRTCCallController15=function(event){'use strict';var n=event.stream;this.$FBRTCCallController7(c('CollabCallMessengerBrowserEventEnum').REMOTE_STREAM_ADDED,n);if(this.$FBRTCCallController14.isScreenStream(n)&&this.$FBRTCCallController14.getRemoteStreamsCount()>1){this.$FBRTCCallController11.setRemoteStream(n);this.$FBRTCCallController8.setRemoteScreenStream(this.$FBRTCCallController11.getStream());}else{this.$FBRTCCallController13.onRemoteStreamAdded(event);c('FBRTCUserSettings').updateForRemoteStream(n);if(this.$FBRTCCallController8.isCaller&&this.$FBRTCCallController8.supportsSdpUpdate())this.$FBRTCCallController59=setTimeout(function(){this.$FBRTCCallController60();}.bind(this),j);}};l.prototype.$FBRTCCallController60=function(){'use strict';if(!this.$FBRTCCallController8.isRemoteVideoSupported&&this.$FBRTCCallController57===c('FBRTCConstants').VideoQuality.NO_VIDEO){return;}else if(this.$FBRTCCallController8.isPeerOnMobile&&this.$FBRTCCallController57===c('FBRTCConstants').VideoQuality.LQ_VIDEO)return;this.$FBRTCCallController58();};l.prototype.$FBRTCCallController16=function(n){var o=n.stream;'use strict';this.$FBRTCCallController7(c('CollabCallMessengerBrowserEventEnum').REMOTE_STREAM_REMOVED,o);var p=this.$FBRTCCallController8.getRemoteScreenStream();if(p&&o&&p.getStreamId()==o.id){this.$FBRTCCallController8.setRemoteScreenStream(null);this.$FBRTCCallController11.setRemoteStream(null);}clearTimeout(this.$FBRTCCallController59);};l.prototype.$FBRTCCallController22=function(){'use strict';this.$FBRTCCallController2.logInfo(this.$FBRTCCallController8.peerID,this.$FBRTCCallController8.callID,'Network unstable');this.$FBRTCCallController7(c('CollabCallMessengerBrowserEventEnum').CONNECTION_INFO,'unstable');};l.prototype.$FBRTCCallController26=function(){'use strict';this.$FBRTCCallController2.logInfo(this.$FBRTCCallController8.peerID,this.$FBRTCCallController8.callID,'Network poor');this.$FBRTCCallController7(c('CollabCallMessengerBrowserEventEnum').CONNECTION_INFO,'poor');if(c('FBRTCConfig').shouldAutoDisableVideo())this.$FBRTCCallController8.autoDisableVideo();};l.prototype.$FBRTCCallController38=function(n){'use strict';var o=n.message+'; '+n.stackFrames[0].identifier;this.$FBRTCCallController2.logError(this.$FBRTCCallController8.peerID,this.$FBRTCCallController8.callID,'JSError: '+o);};l.prototype.$FBRTCCallController36=function(){'use strict';if(this.$FBRTCCallController8.isInProgress())return h._("Leaving this page will end your call.");};l.prototype.$FBRTCCallController37=function(){'use strict';if(this.$FBRTCCallController8.isEnded())return;var n=this.$FBRTCCallController8.isUserMediaPending(),o=this.$FBRTCCallController8.isUserMediaDenied(),p=c('FBRTCConstants').CallEndReason.HANGUP_CALL,q='BrowserClosed';if(n||o){p=c('FBRTCConstants').CallEndReason.CLIENT_ERROR;q=n?'MediaPending':'MediaDenied';}else if(this.$FBRTCCallController8.isAwaitingUserStart())q='AwaitingUserStart';this.$FBRTCCallController47(p,false,true,true,q);};l.prototype.$FBRTCCallController44=function(n){'use strict';this.$FBRTCCallController2.logInfo(this.$FBRTCCallController8.peerID,this.$FBRTCCallController8.callID,'Received Turn Creds');this.$FBRTCCallController7(c('CollabCallMessengerBrowserEventEnum').TURN_CREDENTIALS_RECEIVED,n);c('FBRTCPCConfig').setTurnCredentials(n);this.$FBRTCCallController13.onTurnCredentialsReady(n);this.$FBRTCCallController43();};l.prototype.$FBRTCCallController45=function(){'use strict';this.$FBRTCCallController2.logError(this.$FBRTCCallController8.peerID,this.$FBRTCCallController8.callID,'Failed to get turn creds');this.$FBRTCCallController47(c('FBRTCConstants').CallEndReason.CLIENT_ERROR,false,!this.$FBRTCCallController8.isCaller,false,'NoTurnCreds');};l.prototype.$FBRTCCallController43=function(){'use strict';if(this.$FBRTCCallController8.canStartCall()){c('FBRTCUrlManager').onCallStarted();var n=this.$FBRTCCallController8.localStream;this.$FBRTCCallController14.init(n);if(!this.$FBRTCCallController5){this.$FBRTCCallController14.createOffer();}else{if(this.$FBRTCCallController5.isFromMobile()&&!n.hasVideoTracks())this.$FBRTCCallController5.disableVideo();if(this.$FBRTCCallController5.msg.hasOwnProperty('videoon'))this.$FBRTCCallController48(this.$FBRTCCallController5.msg.videoon);this.$FBRTCCallController8.setSignalingExperiments(this.$FBRTCCallController5.getSignalingExperiments());this.$FBRTCCallController61(this.$FBRTCCallController5.msg.sdp,true,this.$FBRTCCallController5.msg.attributes);this.$FBRTCCallController3.removeOffer(this.$FBRTCCallController8.peerID);this.$FBRTCCallController5=null;}this.$FBRTCCallController7(c('CollabCallMessengerBrowserEventEnum').CALL_START_TRY);}else this.$FBRTCCallController7(c('CollabCallMessengerBrowserEventEnum').CALL_START_TRY,'not ready');};l.prototype.$FBRTCCallController58=function(){'use strict';if(this.$FBRTCCallController8.isAwaitingAnswer()){this.$FBRTCCallController24=true;}else{this.$FBRTCCallController24=false;this.$FBRTCCallController56();var n=[];if(this.$FBRTCCallController8.supportsSdpUpdate()){var o=this.$FBRTCCallController8.supportsMultipleStreamsPlanB();this.$FBRTCCallController14.createSdpUpdate(o);n.push('SDP update',o?'plan B':null);}else{this.$FBRTCCallController6=true;this.$FBRTCCallController34.reset(this.$FBRTCCallController8.peerID,this.$FBRTCCallController8.callID);this.$FBRTCCallController35=false;this.$FBRTCCallController14.createOffer();n.push('new offer');}this.$FBRTCCallController7(c('CollabCallMessengerBrowserEventEnum').RENEGOTIATION,n);}};l.prototype.$FBRTCCallController52=function(n){'use strict';c('FBRTCUserSettings').updateForLocalStream(n);this.$FBRTCCallController13.onLocalStreamReady(n);this.$FBRTCCallController43();this.$FBRTCCallController7(c('CollabCallMessengerBrowserEventEnum').LOCAL_STREAM_READY,n);};l.prototype.$FBRTCCallController53=function(){'use strict';this.$FBRTCCallController2.logCallAction(this.$FBRTCCallController8.peerID,this.$FBRTCCallController8.callID,c('FBRTCLogger').CallAction.DENIED_PERMISSION);this.$FBRTCCallController7(c('CollabCallMessengerBrowserEventEnum').REQUEST_USER_MEDIA,'denied');this.$FBRTCCallController13.userMediaDenied();};l.prototype.$FBRTCCallController54=function(n){'use strict';this.$FBRTCCallController7(c('CollabCallMessengerBrowserEventEnum').REQUEST_USER_MEDIA,'failed');this.$FBRTCCallController47(c('FBRTCConstants').CallEndReason.CLIENT_ERROR,false,true,false,n);c('FBRTCCallDialogController').showDialog(c('FBRTCCallDialogController').dialogTypes.ERROR_ACCESSING_MEDIA,this.$FBRTCCallController8);};l.prototype.$FBRTCCallController55=function(){'use strict';this.$FBRTCCallController7(c('CollabCallMessengerBrowserEventEnum').REQUEST_USER_MEDIA,'granted');this.$FBRTCCallController13.userMediaGranted();};l.prototype.$FBRTCCallController17=function(n){'use strict';switch(n.type){case 'offer':this.$FBRTCCallController62(n.sdp,n.attributes);break;case 'answer':this.$FBRTCCallController63(n.sdp,n.attributes);break;case 'sdp_update':this.$FBRTCCallController64(n.sdp,n.attributes);break;default:break;}};l.prototype.$FBRTCCallController64=function(n,o){'use strict';this.$FBRTCCallController27.sendSdpUpdate(this.$FBRTCCallController8.peerID,this.$FBRTCCallController8.callID,n,this.$FBRTCCallController8.localStream.hasVideo(),o);};l.prototype.$FBRTCCallController62=function(n,o){'use strict';var p;if(!this.$FBRTCCallController6){p=c('FBRTCConstants').PayloadType.OFFER;}else{p=c('FBRTCConstants').PayloadType.PCRESTART_OFFER;this.$FBRTCCallController6=false;}this.$FBRTCCallController30=new (c('FBRTCRetriableMessage'))(this.$FBRTCCallController27);this.$FBRTCCallController30.addListener('sendingRetry',this.$FBRTCCallController65.bind(this));this.$FBRTCCallController30.addListener('timeoutFailure',this.$FBRTCCallController66.bind(this));this.$FBRTCCallController30.sendMessage(p,this.$FBRTCCallController8.peerID,this.$FBRTCCallController8.callID,n,this.$FBRTCCallController8.localStream.hasVideo(),o);this.$FBRTCCallController41=setTimeout(function(){this.$FBRTCCallController47(c('FBRTCConstants').CallEndReason.NO_ANSWER_TIMEOUT,false,true,false);}.bind(this),i);};l.prototype.$FBRTCCallController66=function(){'use strict';var n;if(this.$FBRTCCallController8.receivedNack){n=c('FBRTCConstants').CallEndReason.UNSUPPORTED_VERSION;c('FBRTCCallDialogController').showDialog(c('FBRTCCallDialogController').dialogTypes.PEER_BROWSER_UNSUPPORTED,this.$FBRTCCallController8);}else n=c('FBRTCConstants').CallEndReason.OTHER_NOT_CAPABLE;this.$FBRTCCallController47(n,false,true,false,'TimedOut');};l.prototype.$FBRTCCallController48=function(n){'use strict';var o=this.$FBRTCCallController8.remoteStream;o.setVideoEnabled(n);this.$FBRTCCallController7(c('CollabCallMessengerBrowserEventEnum').REMOTE_STREAM_MUTE_TOGGLED,o.getStream());};l.prototype.$FBRTCCallController63=function(n,o){'use strict';var p=this.$FBRTCCallController8.localStream.hasVideo()&&this.$FBRTCCallController8.isRemoteVideoSupported;this.$FBRTCCallController31=new (c('FBRTCRetriableMessage'))(this.$FBRTCCallController27);this.$FBRTCCallController31.addListener('sendingRetry',this.$FBRTCCallController65.bind(this));this.$FBRTCCallController31.sendMessage(c('FBRTCConstants').PayloadType.ANSWER,this.$FBRTCCallController8.peerID,this.$FBRTCCallController8.callID,n,p,o);};l.prototype.$FBRTCCallController65=function(){'use strict';var n=this.$FBRTCCallController14.getCreatedIceCandidates();for(var o=0;o<n.length;o++)this.$FBRTCCallController67(n[o]);};l.prototype.$FBRTCCallController67=function(n){'use strict';this.$FBRTCCallController27.sendIceCandidate(this.$FBRTCCallController8.peerID,this.$FBRTCCallController8.callID,n);};l.prototype.$FBRTCCallController61=function(n,o,p){'use strict';this.$FBRTCCallController14.setPeerSupportsVideo(this.$FBRTCCallController8.isRemoteVideoSupported);if(this.$FBRTCCallController8.isPeerOnMobile)n=c('FBRTCSdpUtils').setVideoBitrateConstraint(n);if(o){this.$FBRTCCallController14.onReceivedOfferSDP(n,p);}else this.$FBRTCCallController14.onReceivedAnswerSDP(n,p);};l.prototype.$FBRTCCallController18=function(n){'use strict';this.$FBRTCCallController67(n);};l.prototype.$FBRTCCallController19=function(){'use strict';this.$FBRTCCallController35=true;var n=this;this.$FBRTCCallController34.drainCandidates(this.$FBRTCCallController8.peerID,this.$FBRTCCallController8.callID,function(o){n.$FBRTCCallController14.onReceivedRemoteIceCandidate(o);});};l.prototype.$FBRTCCallController20=function(){'use strict';this.$FBRTCCallController68();this.$FBRTCCallController10.onCallConnected();this.$FBRTCCallController40.onCallHeartbeat(this.$FBRTCCallController10);this.$FBRTCCallController2.logInfo(this.$FBRTCCallController8.peerID,this.$FBRTCCallController8.callID,'Call Connected');this.$FBRTCCallController7(c('CollabCallMessengerBrowserEventEnum').CALL_CONNECTED);};l.prototype.$FBRTCCallController21=function(){'use strict';this.$FBRTCCallController47(c('FBRTCConstants').CallEndReason.CONNECTION_DROPPED,false,true,false);};l.prototype.$FBRTCCallController23=function(n){'use strict';this.$FBRTCCallController47(c('FBRTCConstants').CallEndReason.WEBRTC_ERROR,false,true,false,n.endCallSubreason);this.$FBRTCCallController2.logError(this.$FBRTCCallController8.peerID,this.$FBRTCCallController8.callID,'webrtc error: '+JSON.stringify(n.details));this.$FBRTCCallController7(c('CollabCallMessengerBrowserEventEnum').RTC_ERROR,n.details);};l.prototype.$FBRTCCallController29=function(n,o){'use strict';this.$FBRTCCallController47(n,false,false,false,o);};l.prototype.$FBRTCCallController28=function(n,o){'use strict';var p=o.call_id,q=o.type;if(this.$FBRTCCallController8.isEnded()){this.$FBRTCCallController2.logError(this.$FBRTCCallController8.peerID,this.$FBRTCCallController8.callID,'Message sent after call ended: '+q);return;}if(this.$FBRTCCallController8.peerID!==n||this.$FBRTCCallController8.callID!==p)return;this.$FBRTCCallController13.onMessageTypeSent(q);this.$FBRTCCallController10.onMessageSent(o);this.$FBRTCCallController7(c('CollabCallMessengerBrowserEventEnum').MESSAGE_SENT,o.msg_id);};l.prototype.$FBRTCCallController69=function(n){'use strict';var o=n.peerID,p=n.callID,q=n.msg,r=new (c('FBRTCCallSummary'))({peerID:o,callID:p,isCaller:false});r.onFullMessageReceived(n);this.$FBRTCCallController27.sendOfferAck(o,p,q);r.onOfferAckSent(q);var s=c('FBRTCConstants').CallEndReason.IN_ANOTHER_CALL;this.$FBRTCCallController78(o,p,s);r.onCallEnded(s,false);r.save(this.$FBRTCCallController4);};l.prototype.$FBRTCCallController70=function(n){'use strict';var o=n.msg;if(o.calltype){this.$FBRTCCallController27.sendOfferNack(this.$FBRTCCallController8.peerID,o.call_id,o);return;}this.$FBRTCCallController27.sendOfferAck(this.$FBRTCCallController8.peerID,o.call_id,o);this.$FBRTCCallController27.sendOtherDismiss(o.call_id);if(this.$FBRTCCallController79(o)){this.$FBRTCCallController80(n);}else this.$FBRTCCallController81(n);};l.prototype.$FBRTCCallController72=function(n){var o=n.msg;'use strict';var p=o.attributes,q=o.sdp;if(o.hasOwnProperty('videoon'))this.$FBRTCCallController48(o.videoon);if(this.$FBRTCCallController8.isPeerOnMobile)q=c('FBRTCSdpUtils').setVideoBitrateConstraint(q);this.$FBRTCCallController14.onReceivedSdpUpdate(q,p);this.$FBRTCCallController7(c('CollabCallMessengerBrowserEventEnum').SDP_UPDATE,{sdp:q,attributes:p});};l.prototype.$FBRTCCallController79=function(n){'use strict';if(n.call_id===this.$FBRTCCallController8.callID)return true;return ((this.$FBRTCCallController41||!this.$FBRTCCallController5)&&(!this.$FBRTCCallController8.callID||n.call_id!==this.$FBRTCCallController8.callID)&&this.$FBRTCCallController8.isCaller&&(!n.handlescollision||n.call_id<this.$FBRTCCallController8.callID));};l.prototype.$FBRTCCallController80=function(n){'use strict';var o=n.msg;if(o.hasOwnProperty('videoon'))this.$FBRTCCallController48(o.videoon);this.$FBRTCCallController82();this.$FBRTCCallController83();this.$FBRTCCallController68();if(this.$FBRTCCallController8.callID!==o.call_id){var p=c('FBRTCConstants').CallEndReason.OTHER_INSTANCE_HANDLED;this.$FBRTCCallController78(this.$FBRTCCallController8.peerID,this.$FBRTCCallController8.callID,p);this.$FBRTCCallController10.onCallEnded(p,false);this.$FBRTCCallController10.save(this.$FBRTCCallController4);this.$FBRTCCallController10=new (c('FBRTCCallSummary'))({peerID:this.$FBRTCCallController8.peerID,callID:o.call_id,isCaller:false});this.$FBRTCCallController10.onFullMessageReceived(n);this.$FBRTCCallController10.onOfferAckSent(o);this.$FBRTCCallController2.logEvent(this.$FBRTCCallController8.peerID,this.$FBRTCCallController8.callID,'Handling offer collision');}else this.$FBRTCCallController2.logEvent(this.$FBRTCCallController8.peerID,this.$FBRTCCallController8.callID,'Handling offer refresh');this.$FBRTCCallController14.end();this.$FBRTCCallController35=false;this.$FBRTCCallController13.reset(o.call_id,this.$FBRTCCallController10);this.$FBRTCCallController8.onSDPMessageFromPeer(n);this.$FBRTCCallController5=n;this.$FBRTCCallController43();this.$FBRTCCallController7(c('CollabCallMessengerBrowserEventEnum').OFFER_ACCEPTED,n.msgID);};l.prototype.$FBRTCCallController81=function(n){'use strict';this.$FBRTCCallController2.logEvent(this.$FBRTCCallController8.peerID,this.$FBRTCCallController8.callID,'Ignoring offer');this.$FBRTCCallController7(c('CollabCallMessengerBrowserEventEnum').OFFER_IGNORED,n.msgID);};l.prototype.$FBRTCCallController71=function(n){'use strict';var o=n.msg;this.$FBRTCCallController82();this.$FBRTCCallController83();this.$FBRTCCallController27.sendAnswerAck(this.$FBRTCCallController8.peerID,this.$FBRTCCallController8.callID,o);this.$FBRTCCallController8.onSDPMessageFromPeer(n);if(this.$FBRTCCallController24){this.$FBRTCCallController58();}else{this.$FBRTCCallController61(o.sdp,false,o.attributes);if(o.hasOwnProperty('videoon'))this.$FBRTCCallController48(o.videoon);}};l.prototype.$FBRTCCallController77=function(n){'use strict';var o=n.msg;if(this.$FBRTCCallController30&&this.$FBRTCCallController30.isAckMsg(o)){this.$FBRTCCallController10.onMsgAckReceived(n,true);this.$FBRTCCallController13.onMessageTypeReceived(c('FBRTCConstants').PayloadType.OFFER_ACK);this.$FBRTCCallController75(n);}else if(this.$FBRTCCallController31&&this.$FBRTCCallController31.isAckMsg(o)){this.$FBRTCCallController10.onMsgAckReceived(n,false);this.$FBRTCCallController76();}};l.prototype.$FBRTCCallController75=function(n){'use strict';this.$FBRTCCallController10.setUploadLogLevel(c('FBRTCUtils').getUploadLogLevel(c('FBRTCConstants').convertToUploadLogLevel(n.msg.ull)));this.$FBRTCCallController10.save(this.$FBRTCCallController4);this.$FBRTCCallController82();this.$FBRTCCallController40.onCallHeartbeat(this.$FBRTCCallController10);};l.prototype.$FBRTCCallController76=function(){'use strict';this.$FBRTCCallController68();};l.prototype.$FBRTCCallController73=function(n){'use strict';var o=n.msg;if(o.call_id===this.$FBRTCCallController8.callID&&this.$FBRTCCallController35){this.$FBRTCCallController14.onReceivedRemoteIceCandidate(o);}else this.$FBRTCCallController34.cacheCandidate(this.$FBRTCCallController8.peerID,o.call_id,o);};l.prototype.$FBRTCCallController74=function(n){'use strict';var o=n.msg;if(o.call_id===this.$FBRTCCallController8.callID){this.$FBRTCCallController47(o.reason,true,false,false,o.subreason);}else{var p=o.call_id.toString();this.$FBRTCCallController2.logError(this.$FBRTCCallController8.peerID,this.$FBRTCCallController8.callID,'Receiving hangup for a different call: '+p);this.$FBRTCCallController7(c('CollabCallMessengerBrowserEventEnum').HANGUP_CALL_ID_MISSMATCH,p);}};l.prototype.$FBRTCCallController49=function(n){'use strict';var o=n.trigger;if(!o||o!==c('FBRTCLogger').Trigger.RESET_CALL)return;var p=c('FBRTCConstants').CallEndReason.HANGUP_CALL;this.$FBRTCCallController47(p,false,true,false,'CallReset');c('FBRTCWindowManager').reload();};l.prototype.$FBRTCCallController47=function(n,o,p,q,r){'use strict';if(typeof n=='string'||n instanceof String)n=c('FBRTCConstants').endCallReasonFromString(n);var s=c('FBRTCConstants').fullCallEndReasonString(n,o);this.$FBRTCCallController2.logCallAction(this.$FBRTCCallController8.peerID,this.$FBRTCCallController8.callID,c('FBRTCLogger').CallAction.END_CALL,s);this.$FBRTCCallController82();this.$FBRTCCallController83();this.$FBRTCCallController68();if(this.$FBRTCCallController8.isEnded()){this.$FBRTCCallController2.logError(this.$FBRTCCallController8.peerID,this.$FBRTCCallController8.callID,'Ending an already-ended call');return;}if(p)this.$FBRTCCallController78(this.$FBRTCCallController8.peerID,this.$FBRTCCallController8.callID,n,q,r);this.$FBRTCCallController11.onEndCall();this.$FBRTCCallController14.end();c('FBRTCUserMedia').end();this.$FBRTCCallController13.end(n,o,r);this.$FBRTCCallController10.setCallType(this.$FBRTCCallController32.getCallType());this.$FBRTCCallController10.setVideoDurations(this.$FBRTCCallController8.getLocalVideoDuration(),this.$FBRTCCallController8.getRemoteVideoDuration());this.$FBRTCCallController10.onCallEnded(n,o,null,r);this.$FBRTCCallController10.save(this.$FBRTCCallController4);clearTimeout(this.$FBRTCCallController59);this.$FBRTCCallController7(c('CollabCallMessengerBrowserEventEnum').CALL_ENDED,{reason:s,reasonID:n,subReason:r,isRemoteEnded:o});if(n===c('FBRTCConstants').CallEndReason.HANGUP_CALL&&r==='CallReset'&&o)c('FBRTCWindowManager').close();};l.prototype.$FBRTCCallController78=function(n,o,p,q,r){'use strict';this.$FBRTCCallController27.sendHangup(n,o,p,q,r);this.$FBRTCCallController27.sendOtherDismiss(o);};l.prototype.$FBRTCCallController82=function(){'use strict';if(this.$FBRTCCallController30)this.$FBRTCCallController30.stopRetrying();};l.prototype.$FBRTCCallController68=function(){'use strict';if(this.$FBRTCCallController31)this.$FBRTCCallController31.stopRetrying();};l.prototype.$FBRTCCallController83=function(){'use strict';if(this.$FBRTCCallController41)clearTimeout(this.$FBRTCCallController41);this.$FBRTCCallController41=null;};l.prototype.$FBRTCCallController33=function(){'use strict';if(this.$FBRTCCallController32.isPending()){c('FBRTCCallDialogController').showDialog(c('FBRTCCallDialogController').dialogTypes.VIDEO_ESCALATION,this.$FBRTCCallController8);}else c('FBRTCCallDialogController').hideDialogType(c('FBRTCCallDialogController').dialogTypes.VIDEO_ESCALATION);this.$FBRTCCallController10.setCallType(this.$FBRTCCallController32.getCallType());this.$FBRTCCallController10.save(this.$FBRTCCallController4);};l.prototype.$FBRTCCallController7=function(event,n){'use strict';if(!c('FBRTCConfig').isVCEndpointCall())return;m(function(o){return o.log(event,{peerID:this.$FBRTCCallController8.peerID,callID:this.$FBRTCCallController8.callID,eventDetails:n});}.bind(this));};function m(n){if(!c('FBRTCConfig').isVCEndpointCall())return;c('Bootloader').loadModules(["CollabMessengerLogger"],n,'FBRTCCallController');}f.exports=l;}),null);
__d('FBRTCBackground.react',['cx','Image.react','React','WorkModeConfig'],(function a(b,c,d,e,f,g,h){'use strict';var i,j,k='/images/messengerdotcom/favicon/favicon.ico',l='/images/messengerdotcom/favicon/favicon_work.ico',m='/images/messengerdotcom/favicon/favicon_sandbox.ico',n=c('React').PropTypes;i=babelHelpers.inherits(o,c('React').PureComponent);j=i&&i.prototype;function o(p,q){j.constructor.call(this,p,q);this.$FBRTCBackground2=function(){this.setState({showCoverPhoto:false});}.bind(this);this.$FBRTCBackground1=function(){var r=document.querySelector('link[rel*=icon][href*=".ico"]'),s=false;if(s){r.href=m;}else if(c('WorkModeConfig').is_work_user){r.href=l;}else r.href=k;};this.$FBRTCBackground1();this.state={showCoverPhoto:true};}o.prototype.render=function(){if(this.props.messengerUI)return null;var p=this.props.src;if(this.state.showCoverPhoto&&p){return c('React').createElement('div',{className:"_1_5p"},c('React').createElement('div',{className:"_1_5q"}),c('React').createElement(c('Image.react'),{src:p,className:"_1_5r",alt:'',onError:this.$FBRTCBackground2}));}else return c('React').createElement('div',{className:"_1_5p"});};o.propTypes={messengerUI:n.bool.isRequired,src:n.string};f.exports=o;}),null);
__d('FBRTCCallControlPopover.react',['fbt','LayerFadeOnHide','LayerFadeOnShow','React','ReactDOM','XUIContextualDialog.react','XUIContextualDialogBody.react','XUIContextualDialogTitle.react'],(function a(b,c,d,e,f,g,h){'use strict';var i,j,k=c('React').PropTypes,l={NONE:0,REMOTE_VIDEO_UNSUPPORTED:1,NO_VIDEO_TRACKS:2,VIDEO_AUTO_DISABLED:3,SCREENSHARING_UNAVAILABLE:4,PEER_IS_SHARING_SCREEN:5};i=babelHelpers.inherits(m,c('React').PureComponent);j=i&&i.prototype;m.prototype.render=function(){var n=this.$FBRTCCallControlPopover1();if(n)return (c('React').createElement(c('XUIContextualDialog.react'),this.$FBRTCCallControlPopover2(),n,this.$FBRTCCallControlPopover3()));return (c('React').createElement(c('XUIContextualDialog.react'),this.$FBRTCCallControlPopover2(),this.$FBRTCCallControlPopover3()));};m.prototype.$FBRTCCallControlPopover1=function(){if(this.props.reason===l.NO_VIDEO_TRACKS)return (c('React').createElement(c('XUIContextualDialogTitle.react'),{className:this.props.className},h._("Can't find camera")));return null;};m.prototype.$FBRTCCallControlPopover3=function(){var n=null;switch(this.props.reason){case l.NONE:break;case l.REMOTE_VIDEO_UNSUPPORTED:n=h._("Video is disabled for this call because {name}'s device does not support video.",[h.param('name',this.props.peerName)]);break;case l.NO_VIDEO_TRACKS:n=h._("Connect your camera and refresh the page to turn on video. If your camera is already connected, try restarting your browser.");break;case l.VIDEO_AUTO_DISABLED:n=h._("Video is paused because the connection is slow.");break;case l.SCREENSHARING_UNAVAILABLE:n=this.props.isVCEndpointCall?h._("Screen sharing is not currently available for Messenger to room calls."):h._("Screen sharing is disabled for this call because {name}'s device does not support receiving screen shares.",[h.param('name',this.props.peerName)]);break;case l.PEER_IS_SHARING_SCREEN:n=h._("{name} is already sharing their screen. You can share your screen as soon as they've stopped sharing.",[h.param('name',this.props.peerName)]);break;}return (c('React').createElement(c('XUIContextualDialogBody.react'),{className:this.props.className},n));};m.prototype.$FBRTCCallControlPopover2=function(){var n={alignment:'left',behaviors:{LayerFadeOnHide:c('LayerFadeOnHide'),LayerFadeOnShow:c('LayerFadeOnShow')},contextRef:function(){return this.props.reference;}.bind(this),hoverContext:c('ReactDOM').findDOMNode(this.props.reference),position:'above',shown:false,width:this.props.width};return n;};function m(){i.apply(this,arguments);}m.Types=l;m.propTypes={reason:k.number.isRequired,peerName:k.string.isRequired,isVCEndpointCall:k.bool,reference:k.object.isRequired,width:k.number.isRequired};f.exports=m;}),null);
__d('RTCCallControlReducer',['RTCGroupCallActionTypes'],(function a(b,c,d,e,f,g){'use strict';function h(i,j){switch(j.type){case c('RTCGroupCallActionTypes').AUDIO_MUTED:case c('RTCGroupCallActionTypes').AUDIO_UNMUTED:return i.set('localUser',i.localUser.toggleMuteAudio());case c('RTCGroupCallActionTypes').VIDEO_MUTED:case c('RTCGroupCallActionTypes').VIDEO_UNMUTED:return i.set('localUser',i.localUser.toggleMuteVideo());}return i;}f.exports={toggleLocalStream:h};}),null);
__d('RTCCallStarRatingReducer',['FBRTCCallSummaryStore','FBRTCLogger','RTCGroupCallActionTypes'],(function a(b,c,d,e,f,g){'use strict';function h(l,m){switch(m.type){case c('RTCGroupCallActionTypes').SUBMIT_RATING:l.callSummary.addExtraInfo(c('FBRTCLogger').Key.RATING,m.rating);l.callSummary.save(c('FBRTCCallSummaryStore').getInstance());return l;}return l;}function i(l,m){switch(m.type){case c('RTCGroupCallActionTypes').SUBMIT_FEEDBACK:l.callSummary.addExtraInfo(c('FBRTCLogger').Key.SURVEY_DETAILS,m.feedback);l.callSummary.save(c('FBRTCCallSummaryStore').getInstance());return l;}return l;}function j(l,m){switch(m.type){case c('RTCGroupCallActionTypes').RATING_SHOWN:l.callSummary.addExtraInfo(c('FBRTCLogger').Key.RATING_SHOWN,'1');l.callSummary.save(c('FBRTCCallSummaryStore').getInstance());return l;}return l;}function k(l,m){switch(m.type){case c('RTCGroupCallActionTypes').FEEDBACK_SHOWN:l.callSummary.addExtraInfo(c('FBRTCLogger').Key.SURVEY_SHOWN,'1');l.callSummary.save(c('FBRTCCallSummaryStore').getInstance());return l;}return l;}f.exports={submitRating:h,submitFeedback:i,ratingShown:j,feedbackShown:k};}),null);
__d('RTCConferenceState',[],(function a(b,c,d,e,f,g){'use strict';var h={NEW:'NEW',AWAITING_USER_START:'AWAITING_USER_START',CONNECTING:'CONNECTING',CONNECTED:'CONNECTED',TERMINATING:'TERMINATING',TERMINATED:'TERMINATED'};f.exports=h;}),null);
__d('RTCUser',['MultiwayTypes','URI'],(function a(b,c,d,e,f,g){'use strict';var h=c('MultiwayTypes').ParticipantCallState;function i(j){var k=j.FBID,l=j.streams,m=l===undefined?{}:l,n=j.screenStreams,o=n===undefined?{}:n,p=j.profileUrl,q=j.profilePictureUrl,r=j.isMessengerUser,s=r===undefined?false:r,t=j.userName,u=t===undefined?'':t,v=j.userShortName,w=v===undefined?'':v,x=j.participantState,y=j.lastConnectedAt,z=y===undefined?0:y;Object.assign(this,{FBID:k,streams:babelHelpers['extends']({},m),screenStreams:babelHelpers['extends']({},o),profileUrl:p,profilePictureUrl:q,isMessengerUser:s,userName:u,userShortName:w,participantState:x,lastConnectedAt:z});}i.prototype.getUserID=function(){return this.FBID;};i.prototype.getProfileUrl=function(){return this.profileUrl;};i.prototype.setProfilePictureUrl=function(j){return new i(babelHelpers['extends']({},this,{profilePictureUrl:j}));};i.prototype.getProfilePictureUrl=function(){return this.profilePictureUrl;};i.prototype.setIsMessengerUser=function(j){return new i(babelHelpers['extends']({},this,{isMessengerUser:j}));};i.prototype.getIsMessengerUser=function(){return this.isMessengerUser;};i.prototype.getUserName=function(){return this.userName;};i.prototype.getUserShortName=function(){return this.userShortName;};i.prototype.setParticipantState=function(j){if((!this.participantState||this.participantState.state!==h.CONNECTED)&&j.state===h.CONNECTED)return new i(babelHelpers['extends']({},this,{participantState:j,lastConnectedAt:Date.now()}));return new i(babelHelpers['extends']({},this,{participantState:j}));};i.prototype.getParticipantState=function(){return this.participantState;};i.prototype.getLastConnectedAt=function(){return this.lastConnectedAt;};i.prototype.hasAudio=function(){return this.getStreamsAsArray().some(function(j){return j.getAudioTracks().length>0;});};i.prototype.hasVideo=function(){return this.getStreamsAsArray().some(function(j){return j.getVideoTracks().length>0;});};i.prototype.hasScreenStream=function(){return this.getScreenStreamsAsArray().length>0;};i.prototype.isAudioMuted=function(){if(!this.hasAudio())return true;return this.getStreamsAsArray().every(function(j){return this.areAllTracksMuted(j.getAudioTracks());}.bind(this));};i.prototype.isVideoMuted=function(){if(!this.hasVideo())return true;return this.getStreamsAsArray().every(function(j){return this.areAllTracksMuted(j.getVideoTracks());}.bind(this));};i.prototype.areAllTracksMuted=function(j){return !j.some(function(k){return k.enabled;});};i.prototype.isTrackMuted=function(j){return this.getStreamsAsArray().some(function(k){var l=k.getTrackById(j);if(!l)return true;return !l.enabled;});};i.prototype.toggleMuteAudio=function(j){this.getStreamsAsArray().forEach(function(k){return this.$RTCUser1(k.getAudioTracks(),j);}.bind(this));return new i(babelHelpers['extends']({},this));};i.prototype.toggleMuteVideo=function(j){this.getStreamsAsArray().forEach(function(k){return this.$RTCUser1(k.getVideoTracks(),j);}.bind(this));return new i(babelHelpers['extends']({},this));};i.prototype.addStream=function(j){var k;return new i(babelHelpers['extends']({},this,{streams:babelHelpers['extends']({},this.streams,(k={},k[j.id]=j,k))}));};i.prototype.removeAllStreams=function(){return new i(babelHelpers['extends']({},this,{streams:{}}));};i.prototype.removeStream=function(j){return this.removeStreamWithID(j.id);};i.prototype.removeStreamWithID=function(j){var k=babelHelpers['extends']({},this.streams);delete k[j];return new i(babelHelpers['extends']({},this,{streams:k}));};i.prototype.setStreams=function(j){return new i(babelHelpers['extends']({},this,{streams:j}));};i.prototype.getStreams=function(){return this.streams;};i.prototype.getStreamsAsArray=function(){return Object.keys(this.streams).map(function(j){return this.streams[j];}.bind(this));};i.prototype.getStream=function(j){return this.streams[j];};i.prototype.addTrack=function(j){return new i(babelHelpers['extends']({},this));};i.prototype.removeTrack=function(j){return new i(babelHelpers['extends']({},this));};i.prototype.hasStream=function(){return this.getStreamsAsArray().length>0;};i.prototype.addScreenStream=function(j){var k;return new i(babelHelpers['extends']({},this,{screenStreams:babelHelpers['extends']({},this.screenStreams,(k={},k[j.id]=j,k))}));};i.prototype.removeScreenStream=function(j){var k=j.id,l=babelHelpers['extends']({},this.screenStreams);delete l[k];return new i(babelHelpers['extends']({},this,{screenStreams:l}));};i.prototype.removeAllScreenStreams=function(){return new i(babelHelpers['extends']({},this,{screenStreams:{}}));};i.prototype.getScreenStreams=function(){return this.screenStreams;};i.prototype.getScreenStreamsAsArray=function(){return Object.keys(this.screenStreams).map(function(j){return this.screenStreams[j];}.bind(this));};i.prototype.$RTCUser1=function(j,k){var l=k!=null?!k:this.areAllTracksMuted(j);j.forEach(function(m){return m.enabled=l;});};f.exports=i;}),null);
__d('RTCCallStoreState',['CurrentUser','FBRTCCallSummary','immutable','RTCConferenceState','RTCUser'],(function a(b,c,d,e,f,g){'use strict';var h,i,j,k,l={debugID:0,conferenceState:c('RTCConferenceState').NEW,conferenceName:'',protocol:'',serverInfoData:''};h=babelHelpers.inherits(m,c('immutable').Record(l));i=h&&h.prototype;function m(){h.apply(this,arguments);}var n={connections:c('immutable').Set(),localUser:new (c('RTCUser'))({FBID:c('CurrentUser').getID()}),remoteUsers:c('immutable').Set(),callInfo:new m(),callSummary:null};j=babelHelpers.inherits(o,c('immutable').Record(n));k=j&&j.prototype;function o(){j.apply(this,arguments);}f.exports=o;}),null);
__d('RTCGroupCallDispatcher',['ExplicitRegistrationDispatcher'],(function a(b,c,d,e,f,g){var h,i;h=babelHelpers.inherits(j,c('ExplicitRegistrationDispatcher'));i=h&&h.prototype;function j(k){'use strict';i.constructor.call(this,k);this.dispatch=this.dispatch.bind(this);}f.exports=new j({strict:true});}),null);
__d('RTCCallStore',['FluxReduceStore','RTCCallStoreState','RTCGroupCallDispatcher','RTCCallReducer','RTCCallControlReducer','RTCCallStarRatingReducer'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=c('RTCCallReducer').callEnd,k=c('RTCCallReducer').callInit,l=c('RTCCallReducer').callStart,m=c('RTCCallReducer').addParticipants,n=c('RTCCallReducer').initUsers,o=c('RTCCallReducer').processLocalStream,p=c('RTCCallReducer').processLocalScreenStream,q=c('RTCCallReducer').processRemoteStream,r=c('RTCCallReducer').processRemoteScreenStream,s=c('RTCCallReducer').processRemoteTrack,t=c('RTCCallReducer').toggleRemoteStream,u=c('RTCCallReducer').processConferenceState,v=c('RTCCallReducer').processJoinResponse,w=c('RTCCallReducer').waitForUserInput,x=c('RTCCallControlReducer').toggleLocalStream,y=c('RTCCallStarRatingReducer').submitRating,z=c('RTCCallStarRatingReducer').submitFeedback,aa=c('RTCCallStarRatingReducer').ratingShown,ba=c('RTCCallStarRatingReducer').feedbackShown,ca=[k,l,j,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,function(ea,fa){return ea;}];h=babelHelpers.inherits(da,c('FluxReduceStore'));i=h&&h.prototype;da.prototype.getInitialState=function(){return new (c('RTCCallStoreState'))();};da.prototype.reduce=function(ea,fa){return ca.reduce(function(ga,ha){return ha(ga,fa);},ea);};function da(){h.apply(this,arguments);}f.exports=new da(c('RTCGroupCallDispatcher'));}),null);
__d("XGroupCallSendMessageController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/groupcall\/sendmessage\/",{webrtc_fbtrace:{type:"Int"}});}),null);
__d('RTCMessageSender',['Promise','CurrentUser','XGroupCallSendMessageController','SiteData','Fbtrace','AsyncRequest'],(function a(b,c,d,e,f,g){var h=6000;function i(){'use strict';}i.prototype.send=function(j){'use strict';return new (c('Promise'))(function(k,l){var m=j.jsonPayload.header.conferenceName,n={conference_name:m,user_id:c('CurrentUser').getID(),message:j,app_id:256281040558,app_version:String(c('SiteData').revision||'dev'),op:'RTCMessageSender.send',policy:'WebRTC'},o=c('Fbtrace').requestReceive('browser',String(c('SiteData').revision||'dev'),n),p=c('XGroupCallSendMessageController').getURIBuilder().setInt('webrtc_fbtrace',o.isOn()?1:0).getURI();c('Fbtrace').withDefaultNode(o,function(){var q=new (c('AsyncRequest'))(p).setMethod('POST').setData({message:JSON.stringify(j)}).setAllowCrossPageTransition(true).setHandler(function(r){k(r);}).setErrorHandler(function(r){var s=Error(r.getErrorDescription?r.getErrorDescription():'AsyncRequest error');l(s);}).setTimeoutHandler(h,function(){l('Timeout');});q.send();});});};f.exports=i;}),null);
__d('FBRTCTransactions',['Promise','Map','RTCMessageSender'],(function a(b,c,d,e,f,g){'use strict';var h=60000,i={INIT:0,PROCESSING:1,COMPLETED:2,TERMINATED:3};function j(){this.$FBRTCTransactionOwner1=new (c('Map'))();}j.prototype.findTransaction=function(l){return this.$FBRTCTransactionOwner1.get(l);};j.prototype.addTransaction=function(l){this.$FBRTCTransactionOwner1.set(l.id,l);};j.prototype.removeTransaction=function(l){this.$FBRTCTransactionOwner1['delete'](l.id);};j.prototype.getTransaction=function(l){return this.findTransaction(l.transactionId())||new k(this,l);};function k(l,m){this.id=m.transactionId();this.$FBRTCServerTransaction1=i.INIT;this.$FBRTCServerTransaction2=m;this.$FBRTCServerTransaction3=null;this.$FBRTCServerTransaction4=l;this.$FBRTCServerTransaction5=new Error('Unknown');this.$FBRTCServerTransaction6=null;this.$FBRTCServerTransaction7=new (c('RTCMessageSender'))();this.$FBRTCServerTransaction8();this.$FBRTCServerTransaction4.addTransaction(this);}k.prototype.start=function(){if(this.$FBRTCServerTransaction1==i.INIT){this.$FBRTCServerTransaction9(i.PROCESSING);return c('Promise').resolve(this.$FBRTCServerTransaction2);}else if(this.$FBRTCServerTransaction1==i.PROCESSING){return c('Promise').resolve(null);}else if(this.$FBRTCServerTransaction1==i.COMPLETED){this.$FBRTCServerTransaction10();return c('Promise').resolve(null);}return c('Promise').reject(this.$FBRTCServerTransaction5);};k.prototype.sendResponse=function(l){this.$FBRTCServerTransaction3=l;this.$FBRTCServerTransaction9(i.COMPLETED);this.$FBRTCServerTransaction7.send(l.message()).then(function(m){},function(m){this.$FBRTCServerTransaction5=m;this.$FBRTCServerTransaction9(i.TERMINATED);}.bind(this)).done();};k.prototype.$FBRTCServerTransaction10=function(){if(this.$FBRTCServerTransaction3!=null){var l=this.$FBRTCServerTransaction3;l.incrementRetryCount();this.sendResponse(l);}};k.prototype.$FBRTCServerTransaction9=function(l){if(l!=this.$FBRTCServerTransaction1){this.$FBRTCServerTransaction1=l;if(this.$FBRTCServerTransaction1!=i.TERMINATED)this.$FBRTCServerTransaction8();if(this.$FBRTCServerTransaction1==i.TERMINATED){this.$FBRTCServerTransaction5=new Error('Terminated');this.$FBRTCServerTransaction4.removeTransaction(this);}}};k.prototype.$FBRTCServerTransaction8=function(){if(this.$FBRTCServerTransaction6){clearTimeout(this.$FBRTCServerTransaction6);this.$FBRTCServerTransaction6=null;}this.$FBRTCServerTransaction6=setTimeout(function(){this.$FBRTCServerTransaction9(i.TERMINATED);}.bind(this),h);};f.exports={FBRTCTransactionOwner:j,FBRTCServerTransaction:k};}),null);
__d('RTCGroupCallActions',['FBRTCTransactions','RTCGroupCallActionTypes','RTCGroupCallDispatcher','RTCUtils'],(function a(b,c,d,e,f,g){'use strict';var h=c('FBRTCTransactions').FBRTCServerTransaction,i={toggleRemoteStream:function j(k){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').TOGGLE_REMOTE_STREAM,mediaStatus:k});},addParticipants:function j(k){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').ADD_PARTICIPANTS,usersToInvite:k});},handleDismissRequest:function j(k,l){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').DISMISS,transaction:k,request:l,endCallReason:c('RTCUtils').endCallReasonFromDismissRequest(l.dismissRequest())});},handleConferenceStateRequest:function j(k,l,m,n){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').ON_CONFERENCE_STATE,transaction:k,request:l,conferenceStateVersion:m,resolve:n});},onJoinResponse:function j(k){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').ON_JOIN_RESPONSE,serverInfoData:k});},onClientMediaUpdateResponse:function j(k,l){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').ON_CLIENT_MEDIA_UPDATE_RESPONSE,responseStatusCode:k,currentVersion:l});}};f.exports=i;}),null);
__d('RTCGroupCallAddGroupMembersDialog.react',['cx','fbt','invariant','immutable','ImmutableObject','MessengerDialog.react','MessengerDialogButton.react','MessengerDialogCancelButton.react','MessengerDialogHeader.react','MessengerDialogTitle.react','MessengerRTCGroupCallContactList.react','MessengerRTCGroupCallRingParticipantsRow.react','MessengerRTCGroupCallThreadRow.react','React','RTCGroupCallActions','RTCUser'],(function a(b,c,d,e,f,g,h,i,j){'use strict';var k,l,m=c('React').PropTypes,n=460;k=babelHelpers.inherits(o,c('React').Component);l=k&&k.prototype;function o(){var p,q;for(var r=arguments.length,s=Array(r),t=0;t<r;t++)s[t]=arguments[t];return q=(p=l.constructor).call.apply(p,[this].concat(s)),this.state={isParticipantSelected:this.props.participants.mapEntries(function(u){var v=u[0],w=u[1];return [v,false];})},this.$RTCGroupCallAddGroupMembersDialog1=function(){c('RTCGroupCallActions').addParticipants(this.$RTCGroupCallAddGroupMembersDialog2().map(function(u){u.fbid||j(0);return new (c('RTCUser'))({FBID:u.fbid,profilePictureUrl:u.image_src,isMessengerUser:!!u.is_messenger_user,userName:u.name,userShortName:u.short_name});}));this.props.onUnmount();}.bind(this),q;}o.prototype.render=function(){var p=this.props,q=p.participants,r=p.participantStates,s=p.thread,t=p.viewerID;return c('React').createElement(c('MessengerDialog.react'),{onToggle:this.props.onUnmount,type:'default',width:n},c('React').createElement('div',{className:"_1axt"},c('React').createElement(c('MessengerDialogHeader.react'),null,c('React').createElement(c('MessengerDialogCancelButton.react'),null),c('React').createElement(c('MessengerDialogTitle.react'),null,i._("Add group members")),c('React').createElement(c('MessengerDialogButton.react'),{label:i._("Ring"),onClick:this.$RTCGroupCallAddGroupMembersDialog1,disabled:this.$RTCGroupCallAddGroupMembersDialog2().length===0,type:'primary'})),c('React').createElement(c('MessengerRTCGroupCallThreadRow.react'),{participants:q,thread:s,viewerID:t}),c('React').createElement(c('MessengerRTCGroupCallRingParticipantsRow.react'),{names:this.$RTCGroupCallAddGroupMembersDialog2().map(function(u){var v=u.name;return v;}).sort(function(u,v){return u.localeCompare(v);})}),c('React').createElement(c('MessengerRTCGroupCallContactList.react'),{participants:q.toArray().sort(function(u,v){return u.name.localeCompare(v.name);}),participantStates:r,isParticipantSelected:this.state.isParticipantSelected,onClick:function(u){return this.setState({isParticipantSelected:this.state.isParticipantSelected.set(u,!this.state.isParticipantSelected.get(u))});}.bind(this)})));};o.prototype.$RTCGroupCallAddGroupMembersDialog2=function(){return this.props.participants.filter(function(p,q){return this.state.isParticipantSelected.get(q);}.bind(this)).toArray();};o.propTypes={participants:m.instanceOf(c('immutable').Map).isRequired,participantStates:m.instanceOf(c('immutable').Map).isRequired,thread:m.instanceOf(c('ImmutableObject')).isRequired,viewerID:m.string.isRequired,onUnmount:m.func.isRequired};f.exports=o;}),null);
__d('RTCGroupCallAddMembersDialog.react',['cx','fbt','immutable','ImmutableObject','MercuryIDs','MessengerDialog.react','MessengerDialogButton.react','MessengerDialogCancelButton.react','MessengerDialogHeader.react','MessengerDialogTitle.react','MessengerGraphQLTokenizer.react','MessengerRTCGroupCallContactList.react','MessengerRTCGroupCallThreadRow.react','React'],(function a(b,c,d,e,f,g,h,i){'use strict';var j,k,l=c('React').PropTypes,m=460;j=babelHelpers.inherits(n,c('React').Component);k=j&&j.prototype;function n(){var o,p;for(var q=arguments.length,r=Array(q),s=0;s<q;s++)r[s]=arguments[s];return p=(o=k.constructor).call.apply(o,[this].concat(r)),this.state={isParticipantSelected:this.props.participants.mapEntries(function(t){var u=t[0],v=t[1];return [u,false];}),selectedEntries:c('immutable').List()},this.$RTCGroupCallAddMembersDialog1=function(t){this.setState({isParticipantSelected:this.state.isParticipantSelected.set(t,!this.state.isParticipantSelected.get(t))});}.bind(this),this.$RTCGroupCallAddMembersDialog2=function(){this.props.onUnmount();}.bind(this),this.$RTCGroupCallAddMembersDialog4=function(t){this.setState({selectedEntries:this.state.selectedEntries.push(t)});}.bind(this),this.$RTCGroupCallAddMembersDialog6=function(t){var u=t.getUniqueID(),v=this.state.selectedEntries,w=v.findIndex(function(x){return x.getUniqueID()===u;});if(w!==-1)this.setState({selectedEntries:v['delete'](w)});}.bind(this),this.$RTCGroupCallAddMembersDialog5=function(){this.setState({selectedEntries:c('immutable').List()});}.bind(this),p;}n.prototype.render=function(){var o=this.props,p=o.participants,q=o.participantStates,r=o.thread,s=o.viewerID,t=c('React').createElement('div',null,c('React').createElement('div',{className:"_225b"},i._("Already Added")),c('React').createElement(c('MessengerRTCGroupCallContactList.react'),{participants:p.toArray().sort(function(u,v){return u.name.localeCompare(v.name);}),participantStates:q,isParticipantSelected:this.state.isParticipantSelected,onClick:this.$RTCGroupCallAddMembersDialog1}));return c('React').createElement(c('MessengerDialog.react'),{onToggle:this.props.onUnmount,type:'default',width:m},c('React').createElement('div',{className:"_5zad"},c('React').createElement(c('MessengerDialogHeader.react'),null,c('React').createElement(c('MessengerDialogCancelButton.react'),null),c('React').createElement(c('MessengerDialogTitle.react'),null,i._("Add group members")),c('React').createElement(c('MessengerDialogButton.react'),{label:i._("Ring"),onClick:this.$RTCGroupCallAddMembersDialog2,disabled:this.$RTCGroupCallAddMembersDialog3().length===0,type:'primary'})),c('React').createElement(c('MessengerRTCGroupCallThreadRow.react'),{displayAddMemberWarning:true,participants:p,thread:r,viewerID:s}),c('React').createElement(c('MessengerGraphQLTokenizer.react'),{autoFocus:false,context:null,className:"_2el3",defaultEntries:t,enableMessageSearch:false,entries:this.state.selectedEntries,excludeGroups:true,excludePages:true,forceHideClearButton:true,hasHoverState:false,hideViewWithEntries:false,onAddEntryAttempt:this.$RTCGroupCallAddMembersDialog4,onClear:this.$RTCGroupCallAddMembersDialog5,onRemoveEntryAttempt:this.$RTCGroupCallAddMembersDialog6,originalEntryIDs:c('immutable').Set(this.props.participants.keySeq().toArray().map(function(u){return c('MercuryIDs').getUserIDFromParticipantID(u)||u;})),placeholder:i._("Add to group:"),showDefaultEntries:true,shouldQueryInternalBot:false,shouldQueryVCEndpoint:false,scrollableViewClassName:"_2el2",useLayer:false,viewer:this.props.viewerID,width:m})));};n.prototype.$RTCGroupCallAddMembersDialog3=function(){return this.props.participants.filter(function(o,p){return this.state.isParticipantSelected.get(p);}.bind(this)).toArray();};n.propTypes={participants:l.instanceOf(c('immutable').Map).isRequired,participantStates:l.instanceOf(c('immutable').Map).isRequired,thread:l.instanceOf(c('ImmutableObject')).isRequired,viewerID:l.string.isRequired,onUnmount:l.func.isRequired};f.exports=n;}),null);
__d('RTCGroupCallDialogController',['DOM','FBRTCGroupCallVideoEscalationDialog.react','immutable','RTCGroupCallAddGroupMembersDialog.react','RTCGroupCallAddMembersDialog.react','React','ReactDOM','RTCConfig'],(function a(b,c,d,e,f,g){'use strict';var h={_container:c('DOM').create('div'),showAddGroupMembersDialog:function i(j,k,l,m){c('ReactDOM').render(c('RTCConfig').RtcAddNewParticipantsGK?c('React').createElement(c('RTCGroupCallAddMembersDialog.react'),{participants:j,participantStates:k,thread:l,viewerID:m,onUnmount:function(){return this._onUnmount();}.bind(this)}):c('React').createElement(c('RTCGroupCallAddGroupMembersDialog.react'),{participants:j,participantStates:k,thread:l,viewerID:m,onUnmount:function(){return this._onUnmount();}.bind(this)}),this._container);},showVideoEscalationDialog:function i(j,k){c('ReactDOM').render(c('React').createElement(c('FBRTCGroupCallVideoEscalationDialog.react'),{userName:j,onToggle:function(){this._onUnmount();k();}.bind(this)}),this._container);},_onUnmount:function i(){c('ReactDOM').unmountComponentAtNode(this._container);}};f.exports=h;}),null);
__d('RTCMWSessionDescription',['Promise','MultiwayTypes','RTCCallStore','RTCConfig','RTCGroupCallActions','RTCGroupCallDialogController'],(function a(b,c,d,e,f,g){'use strict';var h=c('MultiwayTypes').MediaType,i={_videoEnabled:{},serverMediaUpdate:function j(k,l){var m,n=k.fromVersion,o=k.toVersion,p=k.mediaUpdates,q=c('RTCCallStore').getState().connections.first(),r=q.getLocalDescription(),s=q.getRemoteDescription(),t=s.sessionDescription.getVersion();if(t!==n)l(t);var u=function(){p.forEach(function(w){s.processServerMediaUpdate(w);w.media.forEach(function(x){var y=x.type,z=x.enabled;if(y===h.VIDEO)this._videoEnabled[w.sourceKey]=z;}.bind(this));}.bind(this));s.sessionDescription.setVersion(o);c('Promise').all([q.setLocalDescription(r),q.setRemoteDescription(s)]).then(function(){var w;c('RTCGroupCallActions').toggleRemoteStream((w=[]).concat.apply(w,p.map(function(x){var y=x.media;return y;})).reduce(function(x,y){var z=y.id,aa=y.enabled;x[z]=aa;return x;},{}));l(o);},function(){return l(t);})['catch'](function(w){});}.bind(this),v=p.find(function(w){var x=w.sourceKey,y=w.media;return !this._videoEnabled[x]&&y.some(function(z){var aa=z.type,ba=z.enabled;return aa===h.VIDEO&&ba;});}.bind(this));if(c('RTCConfig').RtcConferencingVideoGK&&!c('RTCCallStore').getState().localUser.hasVideo()&&v){(function(){var w=v.sourceKey.split(':'),x=w[0],y=c('RTCCallStore').getState().remoteUsers.find(function(z){return z.getUserID()===x;});c('RTCGroupCallDialogController').showVideoEscalationDialog(y.getUserName(),u);})();}else u();}};f.exports=i;}),null);
__d('FBRTCMultiwayMessage',['CurrentUser','ChannelManager','RTCUtils','MultiwayTypes'],(function a(b,c,d,e,f,g){var h=c('MultiwayTypes').MessageType;function i(j){'use strict';this.$FBRTCMultiwayMessage1=j;}i.prototype.isRequest=function(){'use strict';return this.$FBRTCMultiwayMessage1.jsonPayload.header.responseStatusCode==null;};i.prototype.isType=function(j){'use strict';return this.header().type==j;};i.prototype.transactionId=function(){'use strict';return this.$FBRTCMultiwayMessage1.jsonPayload.header.transactionId;};i.prototype.conferenceName=function(){'use strict';return this.$FBRTCMultiwayMessage1.jsonPayload.header.conferenceName;};i.prototype.serverInfoData=function(){'use strict';return this.$FBRTCMultiwayMessage1.jsonPayload.header.serverInfoData;};i.prototype.message=function(){'use strict';return this.$FBRTCMultiwayMessage1;};i.prototype.endpoint=function(){'use strict';return this.$FBRTCMultiwayMessage1.endpoint;};i.prototype.header=function(){'use strict';return this.$FBRTCMultiwayMessage1.jsonPayload.header;};i.prototype.body=function(){'use strict';return this.$FBRTCMultiwayMessage1.jsonPayload.body;};i.prototype.incrementRetryCount=function(){'use strict';this.$FBRTCMultiwayMessage1.jsonPayload.header.retryCount++;};i.prototype.ringRequest=function(){'use strict';return this.isRequest()&&this.isType(h.RING)?this.body().ringRequest:null;};i.prototype.dismissRequest=function(){'use strict';return this.isRequest()&&this.isType(h.DISMISS)?this.body().dismissRequest:null;};i.prototype.serverMediaUpdateRequest=function(){'use strict';return this.isRequest()&&this.isType(h.SERVER_MEDIA_UPDATE)?this.body().serverMediaUpdateRequest:null;};i.prototype.conferenceStateRequest=function(){'use strict';return this.isRequest()&&this.isType(h.CONFERENCE_STATE)?this.body().conferenceStateRequest:null;};i.prototype.createResponse=function(j,k){'use strict';var l={endpoint:{appId:'229895473858072',deviceId:c('ChannelManager').getCompleteConfig().sessionID,userId:c('CurrentUser').getID()},jsonPayload:{header:c('RTCUtils').createResponseHeader(this.header(),j),body:k||{}}};return new i(l);};f.exports=i;}),null);
__d('RTCMultiwayMessageHandler',['Arbiter','FBRTCTransactions','ChannelConstants','FBRTCMultiwayMessage','RTCGroupCallActions','RTCMWSessionDescription','MultiwayTypes'],(function a(b,c,d,e,f,g){'use strict';var h=c('FBRTCTransactions').FBRTCServerTransaction,i=c('FBRTCTransactions').FBRTCTransactionOwner,j=c('MultiwayTypes').RtcResponseStatusCode;function k(){this.$RTCMultiwayMessageHandler3=-1;this.$RTCMultiwayMessageHandler4();}k.prototype.initialize=function(l,m){this.$RTCMultiwayMessageHandler1=l;this.$RTCMultiwayMessageHandler2=m;};k.initHandler=function(l,m){new k().initialize(l,m);};k.prototype.$RTCMultiwayMessageHandler4=function(){c('Arbiter').subscribe(c('ChannelConstants').getArbiterType('rtc_multi_json'),function(l,m){this.$RTCMultiwayMessageHandler5(m.obj);}.bind(this));};k.prototype.$RTCMultiwayMessageHandler5=function(l){var m=new (c('FBRTCMultiwayMessage'))(l);if(!m.isRequest())return;if(this.$RTCMultiwayMessageHandler1===m.conferenceName())this.$RTCMultiwayMessageHandler6(m);};k.prototype.$RTCMultiwayMessageHandler6=function(l){var m=new h(new i(),l);m.start().then(function(n){if(n!=null)if(n.dismissRequest()!=null){c('RTCGroupCallActions').handleDismissRequest(m,n);}else if(n.serverMediaUpdateRequest()!=null){c('RTCMWSessionDescription').serverMediaUpdate(n.serverMediaUpdateRequest(),function(o){return m.sendResponse(n.createResponse(j.OK,{serverMediaUpdateResponse:{currentVersion:o}}));});}else if(n.conferenceStateRequest()!=null)c('RTCGroupCallActions').handleConferenceStateRequest(m,n,this.$RTCMultiwayMessageHandler3,function(o){this.$RTCMultiwayMessageHandler3=o;}.bind(this));}.bind(this)).done();};f.exports=k;}),null);
__d('RTCCallType',['keyMirror'],(function a(b,c,d,e,f,g){'use strict';var h=c('keyMirror')({AUDIO_ONLY:null,VIDEO_ONLY:null,AUDIO_VIDEO:null,NO_AUDIO_VIDEO:null});f.exports=h;}),null);
__d('RTCP2PConstants',['keyMirror'],(function a(b,c,d,e,f,g){'use strict';var h=c('keyMirror')({INIT:null,CONTACTING:null,RINGING:null,CONNECTING:null,RECONNECTING:null,CONNECTED:null,DISCONNECTED:null});f.exports={ConnectionStatus:h};}),null);
__d('RTCP2PCallStoreState',['immutable','RTCSignalingExperiments','RTCCallType','RTCP2PConstants'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=c('RTCP2PConstants').ConnectionStatus,k={callType:c('RTCCallType').AUDIO_ONLY,connectionStatus:j.INIT,endCallReason:null,signalingExperiments:new (c('RTCSignalingExperiments'))()};h=babelHelpers.inherits(l,c('immutable').Record(k));i=h&&h.prototype;function l(){h.apply(this,arguments);}f.exports=l;}),null);
__d('RTCP2PCallStore',['FluxReduceStore','RTCP2PCallStoreState','RTCGroupCallDispatcher','RTCP2PCallReducer'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=c('RTCP2PCallReducer').processCallType,k=c('RTCP2PCallReducer').processConnectionStatus,l=c('RTCP2PCallReducer').processEndCallReason,m=c('RTCP2PCallReducer').processLocalScreenStream,n=c('RTCP2PCallReducer').processSignalingExperiments,o=[j,k,l,m,n,function(q,r){return q;}];h=babelHelpers.inherits(p,c('FluxReduceStore'));i=h&&h.prototype;p.prototype.getInitialState=function(){return new (c('RTCP2PCallStoreState'))();};p.prototype.reduce=function(q,r){return o.reduce(function(s,t){return t(s,r);},q);};function p(){h.apply(this,arguments);}f.exports=new p(c('RTCGroupCallDispatcher'));}),null);
__d('RTCP2PCallWindowHandler',['RTCCallStore','RTCP2PCallStore','RTCP2PConstants'],(function a(b,c,d,e,f,g){'use strict';var h=c('RTCP2PConstants').ConnectionStatus,i={height:0,width:0,top:0,left:0},j={height:447,width:675,bottomRightOffset:50},k=void 0,l={init:function m(n){if(this._isWindowOpened())this.close();k=n;this.updateCallInProgressIndicator();this._monitorOpenerForChanges();this._storePositionAndSize();},updateCallInProgressIndicator:function m(n){if(!this._isWindowOpened())return;var o=c('RTCCallStore').getState(),p=o.remoteUsers,q=n?n:c('RTCP2PCallStore').getState().connectionStatus;if(!p.count()||q===h.DISCONNECTED){k.rtcCallInProgessWith=null;}else k.rtcCallInProgessWith=p.first().getUserID().toString();},restore:function m(){if(!this._isWindowOpened())return;if(i.height>0&&i.width>0){k.moveTo(i.left,i.top);k.resizeTo(i.width,i.height);return;}},resizeAndMoveOnSharedContent:function m(){if(!this._isWindowOpened())return;this._storePositionAndSize();k.resizeTo(j.width,j.height);var n=screen.width-j.width-j.bottomRightOffset,o=screen.height-j.height-j.bottomRightOffset;k.moveTo(n,o);},reload:function m(){if(this._isWindowOpened())k.location.reload();},close:function m(){if(this._isWindowOpened())k.close();},_monitorOpenerForChanges:function m(){if(k.opener)try{k.opener.addEventListener('unload',function(event){this._passWindowToOpener();}.bind(this));}catch(n){}},_passWindowToOpener:function m(){var n=arguments.length<=0||arguments[0]===undefined?10:arguments[0];setTimeout(function(){if(!this._isWindowOpened()||n<=1)return;if(k.opener&&!k.opener.closed){k.opener.rtcCallChildWindow=k;}else this._passWindowToOpener(n-1);}.bind(this),1000);},_storePositionAndSize:function m(){if(!this._isWindowOpened())return;if(k.innerWidth!==undefined){i.height=k.outerHeight;i.width=k.outerWidth;}else{i.height=k.screen.height;i.width=k.screen.width;}if(k.screenLeft!==undefined){i.left=k.screenLeft;i.top=k.screenTop;}else{i.left=k.screenX;i.top=k.screenY;}},_isWindowOpened:function m(){return !!(k&&!k.closed);}};f.exports=l;}),null);
__d('RTCCallActions',['RTCCallActionTypes','RTCGroupCallActionTypes','RTCGroupCallDispatcher','RTCP2PCallWindowHandler','RTCUtils','emptyFunction','mixInEventEmitter'],(function a(b,c,d,e,f,g){'use strict';var h={addListener:c('emptyFunction'),emit:c('emptyFunction'),initialize:function i(j,k,l,m,n){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').INIT,conferenceName:k,callID:m,serverInfoData:l,protocol:j,callTrigger:n});},call:function i(j,k){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').CALL,usersToRing:j,peerConnection:k});},callSuccess:function i(){var j=arguments.length<=0||arguments[0]===undefined?false:arguments[0];c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').CALL_SUCCESS,connected:j});},callError:function i(j){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').CALL_ERROR,endCallReason:c('RTCUtils').endCallReasonFromResponseStatusCode(j),endCallSubreason:'Call error: '+(j||0)});},hangupSuccess:function i(){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').HANGUP_SUCCESS});},hangupError:function i(j){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').HANGUP_ERROR,error:j});},redial:function i(){c('RTCP2PCallWindowHandler').reload();},join:function i(j){this.call([],j);},hangup:function i(j,k){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').HANGUP,hangupReason:j,detailedReasonString:k,endCallReason:c('RTCUtils').endCallReasonFromHangupReason(j)});},initLocalUser:function i(j){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').INIT_LOCAL_USER,localUser:j});},initRemoteUsers:function i(j){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').INIT_REMOTE_USERS,remoteUsers:j});},addLocalStream:function i(j){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').ADD_LOCAL_STREAM,stream:j});},removeLocalStream:function i(j){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').REMOVE_LOCAL_STREAM,stream:j});},removeAllLocalStreams:function i(){var j=arguments.length<=0||arguments[0]===undefined?false:arguments[0];c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').REMOVE_ALL_LOCAL_STREAMS,stopStreams:j});},removeAllLocalScreenStreams:function i(){var j=arguments.length<=0||arguments[0]===undefined?false:arguments[0];c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').REMOVE_ALL_LOCAL_SCREEN_STREAMS,stopStreams:j});},addRemoteStream:function i(j,k){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').ADD_REMOTE_STREAM,stream:j,userID:k});},removeRemoteStream:function i(j,k){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').REMOVE_REMOTE_STREAM,stream:j,userID:k});},removeAllRemoteStreams:function i(j){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').REMOVE_ALL_REMOTE_STREAMS,userID:j});},addRemoteTrack:function i(j,k){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').ADD_REMOTE_TRACK,stream:j,track:k});},removeRemoteTrack:function i(j,k){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').REMOVE_REMOTE_TRACK,stream:j,track:k});},addLocalScreenStream:function i(j){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').ADD_LOCAL_SCREEN_STREAM,stream:j});},removeLocalScreenStream:function i(j){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').REMOVE_LOCAL_SCREEN_STREAM,stream:j});},addRemoteScreenStream:function i(j,k){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').ADD_REMOTE_SCREEN_STREAM,stream:j,userID:k});},removeRemoteScreenStream:function i(j,k){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').REMOVE_REMOTE_SCREEN_STREAM,stream:j,userID:k});},endCall:function i(j,k){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').END_CALL,endCallReason:j,endCallSubreason:k});},waitForUserInput:function i(){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').WAIT_FOR_USER_INPUT});},toggleMuteAudio:function i(j){c('RTCGroupCallDispatcher').dispatch({type:j?c('RTCGroupCallActionTypes').AUDIO_UNMUTED:c('RTCGroupCallActionTypes').AUDIO_MUTED});},toggleMuteVideo:function i(j){c('RTCGroupCallDispatcher').dispatch({type:j?c('RTCGroupCallActionTypes').VIDEO_UNMUTED:c('RTCGroupCallActionTypes').VIDEO_MUTED});},toggleMuteRemoteVideo:function i(j,k){c('RTCGroupCallDispatcher').dispatch({type:j?c('RTCCallActionTypes').REMOTE_VIDEO_MUTED:c('RTCCallActionTypes').REMOTE_VIDEO_UNMUTED,userID:k});},toggleSelfView:function i(j){c('RTCGroupCallDispatcher').dispatch({type:j?c('RTCGroupCallActionTypes').SELF_VIEW_COLLAPSED:c('RTCGroupCallActionTypes').SELF_VIEW_UNCOLLAPSED});},submitRating:function i(j){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').SUBMIT_RATING,rating:j});},submitFeedback:function i(j){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').SUBMIT_FEEDBACK,feedback:j});},ratingShown:function i(){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').RATING_SHOWN});},feedbackShown:function i(){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').FEEDBACK_SHOWN});}};c('mixInEventEmitter')(h,{onIceConnectionStateChange:true});f.exports=h;}),null);
__d('RTCCallReducer',['FBRTCCallSummary','FBRTCCallSummaryStore','immutable','MultiwayTypes','RTCCallActionTypes','RTCCallStore','RTCConferenceState','RTCGroupCallActionTypes','RTCMWProtocolHandler','RTCUtils'],(function a(b,c,d,e,f,g){'use strict';var h=c('MultiwayTypes').ParticipantCallState,i=c('MultiwayTypes').RtcResponseStatusCode;function j(z,aa){switch(aa.type){case c('RTCGroupCallActionTypes').INIT:var ba=c('FBRTCCallSummary').restoreOrInitialize(c('FBRTCCallSummaryStore').getInstance(),-1,aa.callID,!aa.serverInfoData);if(aa.callTrigger)ba.onCallStarted(aa.callTrigger);ba.setCallType('mws');ba.setConferenceName(aa.conferenceName);ba.setServerInfoData(aa.serverInfoData);ba.onPopupOpened();ba.save(c('FBRTCCallSummaryStore').getInstance());return z.mergeDeep(c('immutable').fromJS({callInfo:{conferenceName:aa.conferenceName,serverInfoData:aa.serverInfoData,protocol:aa.protocol},callSummary:ba}));}return z;}function k(z,aa){switch(aa.type){case c('RTCGroupCallActionTypes').CALL:return z.mergeDeep(c('immutable').fromJS({connections:z.connections.add(aa.peerConnection),callInfo:{conferenceState:c('RTCConferenceState').CONNECTING}}));case c('RTCGroupCallActionTypes').CALL_ERROR:y(z,aa.endCallReason,false,aa.endCallSubreason);return z.setIn(['callInfo','conferenceState'],c('RTCConferenceState').TERMINATED);case c('RTCGroupCallActionTypes').CALL_SUCCESS:z.callSummary.onCallConnected();z.callSummary.save(c('FBRTCCallSummaryStore').getInstance());var ba=function ca(){var da=c('RTCCallStore').getState().callInfo.conferenceState;if(da!==c('RTCConferenceState').TERMINATED)z.callSummary.save(c('FBRTCCallSummaryStore').getInstance());setTimeout(ca,10000);};ba();if(aa.connected)return z.setIn(['callInfo','conferenceState'],c('RTCConferenceState').CONNECTED);return z;}return z;}function l(z,aa){switch(aa.type){case c('RTCGroupCallActionTypes').HANGUP:y(z,aa.endCallReason,false,aa.detailedReasonString);return z.mergeDeep(c('immutable').fromJS({connections:new (c('immutable').Set)(),remoteUsers:new (c('immutable').Set)(),callInfo:{conferenceState:c('RTCConferenceState').TERMINATING}}));case c('RTCGroupCallActionTypes').DISMISS:if(aa.request.serverInfoData()!==z.callInfo.serverInfoData)return z;y(z,aa.endCallReason,true,aa.request.dismissRequest().detailedReasonString);aa.transaction.sendResponse(aa.request.createResponse(i.OK,{}));case c('RTCGroupCallActionTypes').HANGUP_ERROR:case c('RTCGroupCallActionTypes').HANGUP_SUCCESS:return z.setIn(['callInfo','conferenceState'],c('RTCConferenceState').TERMINATED);case c('RTCGroupCallActionTypes').END_CALL:y(z,aa.endCallReason,false,aa.endCallSubreason);return z.setIn(['callInfo','conferenceState'],c('RTCConferenceState').TERMINATED);}return z;}function m(z,aa){switch(aa.type){case c('RTCGroupCallActionTypes').ADD_PARTICIPANTS:c('RTCMWProtocolHandler').addParticipants(z.callInfo.conferenceName,z.callInfo.serverInfoData,aa.usersToInvite.map(function(ba){return ba.getUserID();}));return z.mergeDeep(c('immutable').fromJS({remoteUsers:aa.usersToInvite.filter(function(ba){return z.remoteUsers.every(function(ca){return ca.getUserID()!==ba.getUserID();});})}));}return z;}function n(z,aa){switch(aa.type){case c('RTCGroupCallActionTypes').ON_CONFERENCE_STATE:var ba=aa.transaction,ca=aa.request,da=aa.request.conferenceStateRequest();if(aa.conferenceStateVersion>=da.version){ba.sendResponse(ca.createResponse(i.OK,{ConferenceStateResponse:{currentVerison:aa.conferenceStateVersion}}));return z;}aa.resolve(da.version);var ea=z.remoteUsers.map(function(ha){var ia=da.participantStates[ha.getUserID()];return ia?ha.setParticipantState(ia):ha;}),fa=ea.some(function(ha){var ia=ha.getParticipantState();return ia&&ia.state===h.CONNECTED;}),ga=fa?c('RTCConferenceState').CONNECTED:z.callInfo.conferenceState;ba.sendResponse(ca.createResponse(i.OK,{ConferenceStateResponse:{currentVerison:aa.conferenceStateVersion}}));return z.setIn(['remoteUsers'],ea).setIn(['callInfo','conferenceState'],ga);}return z;}function o(z,aa){switch(aa.type){case c('RTCGroupCallActionTypes').ON_JOIN_RESPONSE:z.callSummary.setServerInfoData(aa.serverInfoData);return z.setIn(['callInfo','serverInfoData'],aa.serverInfoData);}return z;}function p(z,aa){switch(aa.type){case c('RTCGroupCallActionTypes').INIT_LOCAL_USER:return z.set('localUser',aa.localUser);case c('RTCGroupCallActionTypes').INIT_REMOTE_USERS:return z.set('remoteUsers',aa.remoteUsers);}return z;}function q(z,aa){switch(aa.type){case c('RTCGroupCallActionTypes').ADD_LOCAL_STREAM:return z.set('localUser',z.localUser.addStream(aa.stream));case c('RTCGroupCallActionTypes').REMOVE_LOCAL_STREAM:return z.set('localUser',z.localUser.removeStream(aa.stream));case c('RTCGroupCallActionTypes').REMOVE_ALL_LOCAL_STREAMS:if(aa.stopStreams)for(var ba=z.localUser.getStreamsAsArray(),ca=Array.isArray(ba),da=0,ba=ca?ba:ba[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var ea;if(ca){if(da>=ba.length)break;ea=ba[da++];}else{da=ba.next();if(da.done)break;ea=da.value;}var fa=ea;c('RTCUtils').stopMediaStream(fa);}return z.set('localUser',z.localUser.removeAllStreams());}return z;}function r(z,aa){switch(aa.type){case c('RTCGroupCallActionTypes').ADD_LOCAL_SCREEN_STREAM:return z.set('localUser',z.localUser.addScreenStream(aa.stream));case c('RTCGroupCallActionTypes').REMOVE_LOCAL_SCREEN_STREAM:return z.set('localUser',z.localUser.removeScreenStream(aa.stream));case c('RTCGroupCallActionTypes').REMOVE_ALL_LOCAL_SCREEN_STREAMS:if(aa.stopStreams)for(var ba=z.localUser.getScreenStreamsAsArray(),ca=Array.isArray(ba),da=0,ba=ca?ba:ba[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var ea;if(ca){if(da>=ba.length)break;ea=ba[da++];}else{da=ba.next();if(da.done)break;ea=da.value;}var fa=ea;c('RTCUtils').stopMediaStream(fa);}return z.set('localUser',z.localUser.removeAllScreenStreams());}return z;}function s(z,aa){var ba=void 0;switch(aa.type){case c('RTCGroupCallActionTypes').ADD_REMOTE_STREAM:ba=w(z,aa);return z.setIn(['remoteUsers'],z.remoteUsers['delete'](ba).add(ba.addStream(aa.stream)));case c('RTCGroupCallActionTypes').REMOVE_REMOTE_STREAM:ba=w(z,aa);return z.setIn(['remoteUsers'],z.remoteUsers['delete'](ba).add(ba.removeStream(aa.stream)));case c('RTCGroupCallActionTypes').REMOVE_ALL_REMOTE_STREAMS:ba=w(z,aa);return z.setIn(['remoteUsers'],z.remoteUsers['delete'](ba).add(ba.removeAllStreams().removeAllScreenStreams()));}return z;}function t(z,aa){var ba=void 0;switch(aa.type){case c('RTCGroupCallActionTypes').ADD_REMOTE_TRACK:ba=w(z,aa);return z.setIn(['remoteUsers'],z.remoteUsers['delete'](ba).add(ba.addTrack(aa.track)));case c('RTCGroupCallActionTypes').REMOVE_REMOTE_TRACK:ba=w(z,aa);return z.setIn(['remoteUsers'],z.remoteUsers['delete'](ba).add(ba.removeTrack(aa.track)));}return z;}function u(z,aa){var ba=void 0;switch(aa.type){case c('RTCGroupCallActionTypes').ADD_REMOTE_SCREEN_STREAM:ba=w(z,aa);return z.setIn(['remoteUsers'],z.remoteUsers['delete'](ba).add(ba.addScreenStream(aa.stream)));case c('RTCGroupCallActionTypes').REMOVE_REMOTE_SCREEN_STREAM:ba=w(z,aa);return z.setIn(['remoteUsers'],z.remoteUsers['delete'](ba).add(ba.removeScreenStream(aa.stream)));}return z;}function v(z,aa){var ba=void 0;switch(aa.type){case c('RTCGroupCallActionTypes').TOGGLE_REMOTE_STREAM:return z.set('remoteUsers',Object.entries(aa.mediaStatus).reduce(function(ca,da){var ea=da[0],fa=da[1],ga=ca.reduce(function(ja,ka){var la,ma=(la=[]).concat.apply(la,ka.getStreamsAsArray().map(function(na){return na.getTracks();})).find(function(na){return na.id===ea;});return ma?{user:ka,track:ma}:ja;},{}),ha=ga.user,ia=ga.track;if(ha&&ia){if(ia.kind==='audio'&&ha.isAudioMuted()===fa)return ca['delete'](ha).add(ha.toggleMuteAudio());if(ia.kind==='video'&&ha.isVideoMuted()===fa)return ca['delete'](ha).add(ha.toggleMuteVideo());}return ca;},z.remoteUsers));case c('RTCCallActionTypes').REMOTE_VIDEO_MUTED:ba=w(z,aa);return z.setIn(['remoteUsers'],z.remoteUsers['delete'](ba).add(ba.toggleMuteVideo(true)));case c('RTCCallActionTypes').REMOTE_VIDEO_UNMUTED:ba=w(z,aa);return z.setIn(['remoteUsers'],z.remoteUsers['delete'](ba).add(ba.toggleMuteVideo(false)));}return z;}function w(z,aa){return z.remoteUsers.find(function(ba){if(aa.userID)return ba.getUserID()==aa.userID;return ba.getUserID()===aa.stream.id.split(':')[0];});}function x(z,aa){switch(aa.type){case c('RTCGroupCallActionTypes').WAIT_FOR_USER_INPUT:if(z.callInfo.conferenceState===c('RTCConferenceState').NEW)return z.setIn(['callInfo','conferenceState'],c('RTCConferenceState').AWAITING_USER_START);return z;}return z;}function y(z,aa,ba,ca){z.callSummary.onCallEnded(aa,ba,false,ca);z.callSummary.save(c('FBRTCCallSummaryStore').getInstance());}f.exports={callInit:j,callStart:k,callEnd:l,addParticipants:m,initUsers:p,processLocalStream:q,processLocalScreenStream:r,processRemoteStream:s,processRemoteScreenStream:u,processRemoteTrack:t,toggleRemoteStream:v,processConferenceState:n,processJoinResponse:o,waitForUserInput:x};}),null);
__d('RTCP2PCallReducer',['RTCP2PCallActionTypes','RTCP2PCallWindowHandler','RTCGroupCallActionTypes'],(function a(b,c,d,e,f,g){'use strict';function h(m,n){switch(n.type){case c('RTCP2PCallActionTypes').SET_CALL_TYPE:return m.set('callType',n.callType);}return m;}function i(m,n){switch(n.type){case c('RTCP2PCallActionTypes').SET_CONNECTION_STATUS:c('RTCP2PCallWindowHandler').updateCallInProgressIndicator(n.connectionStatus);return m.set('connectionStatus',n.connectionStatus);}return m;}function j(m,n){switch(n.type){case c('RTCP2PCallActionTypes').SET_END_CALL_REASON:return m.set('endCallReason',n.endCallReason);}return m;}function k(m,n){switch(n.type){case c('RTCGroupCallActionTypes').ADD_LOCAL_SCREEN_STREAM:c('RTCP2PCallWindowHandler').resizeAndMoveOnSharedContent();break;case c('RTCGroupCallActionTypes').REMOVE_LOCAL_SCREEN_STREAM:c('RTCP2PCallWindowHandler').restore();break;}return m;}function l(m,n){switch(n.type){case c('RTCP2PCallActionTypes').SET_REMOTE_SIGNALING_EXPERIMENTS:return m.set('signalingExperiments',m.signalingExperiments.setRemote(n.remoteSignalingExperiments));}return m;}f.exports={processCallType:h,processConnectionStatus:i,processLocalScreenStream:k,processEndCallReason:j,processSignalingExperiments:l};}),null);
__d('FBRTCGroupCallVideoEscalationDialog.react',['fbt','MessengerDialog.react','MessengerDialogBody.react','MessengerDialogButton.react','MessengerDialogCancelButton.react','MessengerDialogFooter.react','React','RTCMWProtocolHandler'],(function a(b,c,d,e,f,g,h){'use strict';var i=function j(k){var l=k.userName,m=k.onToggle;return (c('React').createElement(c('MessengerDialog.react'),{onToggle:m},c('React').createElement(c('MessengerDialogBody.react'),null,h._("{name} added video chat. Would you like to share your video?",[h.param('name',l)])),c('React').createElement(c('MessengerDialogFooter.react'),null,c('React').createElement(c('MessengerDialogCancelButton.react'),null),c('React').createElement(c('MessengerDialogButton.react'),{label:h._("Share Video"),onClick:function n(){new (c('RTCMWProtocolHandler'))().videoEscalation();m();},type:'primary'}))));};f.exports=i;}),null);
__d('RTCSessionDescription',['FBRTCSdpUtils','FBRTCExperiment','MultiwayTypes','FBRTCConstants'],(function a(b,c,d,e,f,g){var h=c('MultiwayTypes').MediaType,i=c('FBRTCConstants').SignalingProtocol,j=window.RTCSessionDescription||window.mozRTCSessionDescription,k=2,l='o',m='m',n='a',o='rtpmap',p='ssrc-group',q='ssrc',r='cname',s='msid',t='mslabel',u='label',v='sendonly',w='recvonly',x='sendrecv',y='inactive',z='offer',aa='answer',ba='=',ca=' ',da=':',ea='\r\n',fa='audio',ga='video',ha=function oa(pa,qa){return pa.startsWith(qa+ba);},ia=function oa(pa){return pa.substr(k);},ja=function oa(pa,qa){return pa.startsWith(qa+ea)||pa.startsWith(qa+da);},ka=function oa(pa,qa){return pa.substr(qa.length+1);};function la(oa){'use strict';this.$SessionDescription1=[];this.$SessionDescription2='-';this.$SessionDescription3='multiway';this.$SessionDescription4=1;this.$SessionDescription5='IN';this.$SessionDescription6='IP4';this.$SessionDescription7='127.0.0.1';oa.forEach(function(pa){if(ha(pa,l)){var qa=ia(pa).split(ca);if(qa.length==6){this.$SessionDescription2=qa[0];this.$SessionDescription3=qa[1];this.$SessionDescription4=parseInt(qa[2],10);this.$SessionDescription5=qa[3];this.$SessionDescription6=qa[4];this.$SessionDescription7=qa[5];}}this.$SessionDescription1.push(pa);}.bind(this));}la.prototype.setVersion=function(oa){'use strict';this.$SessionDescription4=oa;};la.prototype.getVersion=function(){'use strict';return this.$SessionDescription4;};la.prototype.toSdp=function(){'use strict';return this.$SessionDescription1.map(function(oa){if(ha(oa,l)){return l+ba+this.$SessionDescription2+ca+this.$SessionDescription3+ca+this.$SessionDescription4+ca+this.$SessionDescription5+ca+this.$SessionDescription6+ca+this.$SessionDescription7;}else return oa;}.bind(this)).join(ea);};function ma(oa,pa){var qa=arguments.length<=2||arguments[2]===undefined?{}:arguments[2];'use strict';this.$MediaDescription1=[];var ra={},sa=[],ta=[];oa.forEach(function(ua){var va=ia(ua);if(ha(ua,m))this.$MediaDescription4=va.split(ca)[0];if(ha(ua,n)&&ja(va,o)){var wa=ka(va,o),xa=wa.split(ca),ya=xa[0],za=xa[1];ra[za]=ya;}if(ha(ua,n)&&ja(va,q)){this.$MediaDescription6(va,sa);}else if(ha(ua,n)&&ja(va,p)){this.$MediaDescription7(va,ta);}else if(ha(ua,n)&&(va===v||va===w||va===x||va===y)){this.$MediaDescription5=va;}else this.$MediaDescription1.push(ua);}.bind(this));Object.keys(qa).forEach(function(ua){if(ra[ua]){var va=Object.keys(qa[ua]).map(function(wa){return wa+'='+qa[ua][wa];}).join(';');this.$MediaDescription1.push('a=fmtp:'+ra[ua]+' '+va);}}.bind(this));this.$MediaDescription3={};this.$MediaDescription2={};sa.forEach(function(ua){if(ua.hasOwnProperty(r)){var va=ua.cname;if(!this.$MediaDescription3[va]){this.$MediaDescription3[va]=[ua];}else this.$MediaDescription3[va].push(ua);var wa=this.findSsrcGroupForSsrc(ta,ua.ssrc);if(wa){if(!this.$MediaDescription2[va]){this.$MediaDescription2[va]=[wa];}else this.$MediaDescription2[va].push(wa);this.removeSsrcGroup(wa,ta);}}}.bind(this));if(pa===z){if(sa.length===0){this.$MediaDescription5=w;}else this.$MediaDescription5=x;}else if(pa===aa)this.$MediaDescription5=x;}ma.prototype.getMediaType=function(){'use strict';return this.$MediaDescription4;};ma.prototype.findSsrcGroupForSsrc=function(oa,pa){'use strict';return oa.find(function(qa){var ra=qa.ssrcs;return ra.some(function(sa){return sa===pa;});});};ma.prototype.addStreamsForEndpoint=function(oa,pa){'use strict';this.$MediaDescription3[oa]=pa;};ma.prototype.addSsrcGroupsForEndpoint=function(oa,pa){'use strict';this.$MediaDescription3[oa].forEach(function(qa){var ra=qa.ssrc,sa=this.findSsrcGroupForSsrc(pa,ra);if(sa){if(!this.$MediaDescription2[oa]){this.$MediaDescription2[oa]=[sa];}else this.$MediaDescription2[oa].push(sa);this.removeSsrcGroup(sa,pa);}}.bind(this));};ma.prototype.removeSsrcGroup=function(oa,pa){'use strict';var qa=pa.indexOf(oa);if(qa!==-1)pa.splice(qa,1);};ma.prototype.$MediaDescription7=function(oa,pa){'use strict';var qa=ka(oa,p);if(qa){var ra=qa.split(ca),sa=ra[0],ta=ra.slice(1);pa.push({semantics:sa,ssrcs:ta.map(function(ua){return parseInt(ua,10);})});}};ma.prototype.$MediaDescription6=function(oa,pa){'use strict';var qa=oa.indexOf(ca),ra=oa.substr(0,qa),sa=parseInt(ka(ra,q),10),ta=oa.substr(qa+1),ua=pa.find(function(wa){return wa.ssrc===sa;});if(!ua){ua={};ua.ssrc=sa;pa.push(ua);}if(ja(ta,r)){ua.cname=ka(ta,r);}else if(ja(ta,s)){var va=ka(ta,s).split(ca);ua.msid={id:va[0],appdata:va[1]};}else if(ja(ta,t)){ua.mslabel=ka(ta,t);}else if(ja(ta,u))ua.label=ka(ta,u);};ma.prototype.toSdp=function(){'use strict';var oa=[];this.$MediaDescription1.forEach(function(ra){oa.push(ra);});for(var pa in this.$MediaDescription2)this.$MediaDescription2[pa].forEach(function(ra){oa.push(n+ba+p+da+ra.semantics+ca+ra.ssrcs.join(ca));});oa.push(n+ba+this.$MediaDescription5);for(var qa in this.$MediaDescription3)this.$MediaDescription3[qa].forEach(function(ra){if(ra.cname)oa.push(n+ba+q+da+ra.ssrc+ca+r+da+ra.cname);if(ra.msid)oa.push(n+ba+q+da+ra.ssrc+ca+s+da+ra.msid.id+(ra.msid.appdata?ca+ra.msid.appdata:''));if(ra.mslabel)oa.push(n+ba+q+da+ra.ssrc+ca+t+da+ra.mslabel);if(ra.label)oa.push(n+ba+q+da+ra.ssrc+ca+u+da+ra.label);});return oa.join(ea);};function na(oa,pa){var qa=arguments.length<=2||arguments[2]===undefined?{}:arguments[2];'use strict';var ra=pa||{},sa=ra.type,ta=sa===undefined?'offer':sa,ua=ra.sdp,va=ua===undefined?'':ua;this.$RTCSessionDescription1=oa;this.type=ta;if(oa===i.P2P){if(this.type==='offer'){var wa=[];if(qa.DISABLE_VIDEO)wa.push(function(db){return c('FBRTCSdpUtils').disableVideo(db);});wa.push(function(db){return c('FBRTCSdpUtils').addIceOptionToSdp(db,'fb-force-5245');},function(db){return c('FBRTCSdpUtils').replaceRTPSAVPFProfile(db);});var xa=c('FBRTCExperiment').gen('rtc_web_use_isac'),ya=xa.getParam('use_isac','no');if(ya==='yes')wa.push(function(db){return c('FBRTCSdpUtils').preferIsac(db);});wa.push(function(db){return c('FBRTCSdpUtils').removeSdparta(db);});if(qa.ADD_AUDIO_NACK)wa.push(function(db){return c('FBRTCSdpUtils').addAudioNack(db);});this.$RTCSessionDescription2=wa.reduce(function(db,eb){return eb(db);},va);}else this.$RTCSessionDescription2=va;}else{var za=va.trim().split(ea),ab=0,bb=[];while(ab<za.length&&!ha(za[ab],m)){bb.push(za[ab]);ab++;}this.sessionDescription=new la(bb);this.mediaDescriptions=[];while(ab<za.length){var cb=[];cb.push(za[ab]);ab++;while(ab<za.length&&!ha(za[ab],m)){cb.push(za[ab]);ab++;}this.mediaDescriptions.push(new ma(cb,this.type,qa.FORMAT_PARAMETERS));}}}na.prototype.processServerMediaUpdate=function(oa){'use strict';var pa=oa.sourceKey,qa=oa.media,ra=oa.ssrcGroups,sa=[],ta=[];qa.forEach(function(ua){ua.ssrcs.forEach(function(va){var wa={ssrc:va,cname:pa,msid:{id:pa,appdata:ua.id},label:ua.id,mslabel:pa};if(h.AUDIO===ua.type){sa.push(wa);}else if(h.VIDEO===ua.type)ta.push(wa);});});this.mediaDescriptions.forEach(function(ua){if(ua.getMediaType()===fa){ua.addStreamsForEndpoint(pa,sa);ua.addSsrcGroupsForEndpoint(pa,ra);}else if(ua.getMediaType()===ga){ua.addStreamsForEndpoint(pa,ta);ua.addSsrcGroupsForEndpoint(pa,ra);}});};na.prototype.toDesc=function(){'use strict';return new j({type:this.type,sdp:this.toSdp()});};na.prototype.toSdp=function(){'use strict';var oa=this.$RTCSessionDescription1;switch(oa){case i.P2P:return this.$RTCSessionDescription2;case i.MULTIWAY:return this.sessionDescription.toSdp()+ea+this.mediaDescriptions.map(function(pa){return pa.toSdp();}).join(ea)+ea;default:throw new Error('Unknown signaling protocol '+oa);}};na.prototype.strongDiff=function(oa){'use strict';var pa=this.toSdp(),qa=oa.toSdp();return pa!==qa&&this.$RTCSessionDescription3(pa)!==this.$RTCSessionDescription3(qa);};na.prototype.$RTCSessionDescription3=function(oa){'use strict';return this.$RTCSessionDescription4(oa).split('\r\n').filter(function(pa){return !/^a=(candidate|setup):/.test(pa);}).join('\r\n');};na.prototype.$RTCSessionDescription4=function(oa){'use strict';return oa.replace(/(o=\S+\s\S+)\s\S+\s/,'$1 - ');};f.exports=na;}),null);
__d("XGroupCallSendRequestController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/groupcall\/sendrequest\/",{webrtc_fbtrace:{type:"Int"}});}),null);
__d('MultiwayRequests',['Promise','RTCSessionDescription','RTCUtils','XGroupCallSendRequestController','AsyncRequest','MultiwayTypes'],(function a(b,c,d,e,f,g){'use strict';var h=15000,i=c('MultiwayTypes').MessageType,j=c('MultiwayTypes').Capability;function k(){}k.prototype.sendJoinRequest=function(l,m,n,o,p,q){var r=c('RTCUtils').createRequestHeader(i.JOIN,m,n),s={offer:{sdpString:o.toSdp()},deviceCapabilities:[j.SUPPORT_AUDIO,j.SUPPORT_VIDEO]};if(p&&p.length>0)s.usersToCall=p;if(q)s.mediaStatus=q;var t={endpoint:l,jsonPayload:{header:r,body:{joinRequest:s}}};return this.$MultiwayRequests1(t);};k.prototype.sendHangupRequest=function(l,m,n,o,p){var q=c('RTCUtils').createRequestHeader(i.HANGUP,m,n),r={reason:o,detailedReasonString:p},s={endpoint:l,jsonPayload:{header:q,body:{hangupRequest:r}}};return this.$MultiwayRequests1(s);};k.prototype.sendAddParticipantsRequest=function(l,m,n,o){var p=c('RTCUtils').createRequestHeader(i.ADD_PARTICIPANTS,m,n),q={usersToInvite:o},r={endpoint:l,jsonPayload:{header:p,body:{addParticipantsRequest:q}}};return this.$MultiwayRequests1(r);};k.prototype.sendSubscriptionRequest=function(l,m,n,o){return this.$MultiwayRequests1({endpoint:l,jsonPayload:{header:c('RTCUtils').createRequestHeader(i.SUBSCRIPTION,m,n),body:{subscriptionRequest:{subscriptions:o}}}});};k.prototype.sendClientMediaUpdateRequest=function(l,m,n,o,p,q){return this.$MultiwayRequests1({endpoint:l,jsonPayload:{header:c('RTCUtils').createRequestHeader(i.CLIENT_MEDIA_UPDATE,m,n),body:{clientMediaUpdateRequest:{fromVersion:o,toVersion:p,mediaUpdates:q}}}});};k.prototype.$MultiwayRequests1=function(l){return new (c('Promise'))(function(m,n){var o=c('XGroupCallSendRequestController').getURIBuilder().getURI(),p=new (c('AsyncRequest'))(o).setMethod('POST').setData({request:JSON.stringify(l)}).setAllowCrossPageTransition(true).setHandler(function(q){m(q.payload);}).setErrorHandler(function(q){var r=Error(q.getErrorDescription?q.getErrorDescription():'AsyncRequest error');n(r);}).setTimeoutHandler(h,function(){n('Timeout');});p.send();});};f.exports=new k();}),null);
__d('RTCPeerConnection',['regeneratorRuntime','Promise','FBRTCSdpUtils','Map','RTCSessionDescription','UserAgent','FBRTCConstants'],(function a(b,c,d,e,f,g){'use strict';var h=c('FBRTCConstants').SignalingProtocol,i=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,j=window.RTCIceCandidate||window.mozRTCPeerConnection;function k(n){var o=arguments.length<=1||arguments[1]===undefined?{}:arguments[1],p=arguments.length<=2||arguments[2]===undefined?{}:arguments[2];this.$RTCPeerConnection3=[];this.$RTCPeerConnection6=new (c('Map'))();this.addEventListener=function(q,r){m('PC add event listener %o',q);var s=this.$RTCPeerConnection6.get(q);if(!Array.isArray(s)){s=[];this.$RTCPeerConnection6.set(q,s);}s.push(r);this.$RTCPeerConnection4.addEventListener(q,r);};this.removeEventListener=function(q,r){m('PC remove event listener %o',q);var s=this.$RTCPeerConnection6.get(q);if(!Array.isArray(s))return;s=s.filter(function(t){return t!==r;});if(s.length<1){this.$RTCPeerConnection6['delete'](q);}else this.$RTCPeerConnection6.set(q,s);this.$RTCPeerConnection4.removeEventListener(q,r);};this.$RTCPeerConnection8=function(q){var r=q.candidate;if(r){this.$RTCPeerConnection3.push(r);m('PC add local ICE candidate %o',r);}}.bind(this);this.$RTCPeerConnection5=n;this.$RTCPeerConnection1=o;this.$RTCPeerConnection2=p;this.$RTCPeerConnection4=this.$RTCPeerConnection7();}k.prototype.$RTCPeerConnection7=function(){var n=new i(this.$RTCPeerConnection1,this.$RTCPeerConnection2);n.addEventListener('icecandidate',this.$RTCPeerConnection8);for(var o=this.$RTCPeerConnection6.entries(),p=Array.isArray(o),q=0,o=p?o:o[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var r;if(p){if(q>=o.length)break;r=o[q++];}else{q=o.next();if(q.done)break;r=q.value;}var s=r,t=s[0],u=s[1];for(var v=u,w=Array.isArray(v),x=0,v=w?v:v[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var y;if(w){if(x>=v.length)break;y=v[x++];}else{x=v.next();if(x.done)break;y=x.value;}var z=y;n.addEventListener(t,z);}}return n;};k.prototype.reset=function(){m('PC reset');var n=this.$RTCPeerConnection4;for(var o=this.$RTCPeerConnection6.entries(),p=Array.isArray(o),q=0,o=p?o:o[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var r;if(p){if(q>=o.length)break;r=o[q++];}else{q=o.next();if(q.done)break;r=q.value;}var s=r,t=s[0],u=s[1];for(var v=u,w=Array.isArray(v),x=0,v=w?v:v[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var y;if(w){if(x>=v.length)break;y=v[x++];}else{x=v.next();if(x.done)break;y=x.value;}var z=y;n.removeEventListener(t,z);}}n.removeEventListener('icecandidate',this.$RTCPeerConnection8);this.$RTCPeerConnection3=[];this.$RTCPeerConnection4=this.$RTCPeerConnection7();for(var aa=n.getLocalStreams(),ba=Array.isArray(aa),ca=0,aa=ba?aa:aa[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var da;if(ba){if(ca>=aa.length)break;da=aa[ca++];}else{ca=aa.next();if(ca.done)break;da=ca.value;}var ea=da;this.$RTCPeerConnection4.addStream(ea);}l(n);};k.prototype.close=function(){m('PC close');l(this.$RTCPeerConnection4);};k.prototype.getCreatedIceCandidates=function(){return this.$RTCPeerConnection3;};k.prototype.onReceivedRemoteIceCandidate=function(n){var o=n.sdp,p=n.label,q=n.sdp_mid,r=new j({sdpMLineIndex:p,candidate:c('FBRTCSdpUtils').fixMobileIceSdp(o),sdpMid:q});this.$RTCPeerConnection4.addIceCandidate(r);m('PC add remote ICE candidate %o',r);};k.prototype.getLocalStreams=function(){return this.$RTCPeerConnection4.getLocalStreams();};k.prototype.getRemoteStreams=function(){return this.$RTCPeerConnection4.getRemoteStreams();};k.prototype.addStream=function(n){this.$RTCPeerConnection4.addStream(n);};k.prototype.removeStream=function(n){this.$RTCPeerConnection4.removeStream(n);};k.prototype.createOffer=function n(){var o=arguments.length<=0||arguments[0]===undefined?{}:arguments[0],p=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];return c('regeneratorRuntime').async(function q(r){while(1)switch(r.prev=r.next){case 0:m('PC create %o','offer');o=babelHelpers['extends']({},o,{mandatory:{OfferToReceiveAudio:true,OfferToReceiveVideo:true}});return r.abrupt('return',this.$RTCPeerConnection4.createOffer(o).then(function(s){return new (c('RTCSessionDescription'))(this.$RTCPeerConnection5,s,{FORMAT_PARAMETERS:p});}.bind(this)));case 3:case 'end':return r.stop();}},null,this);};k.prototype.createAnswer=function n(){return c('regeneratorRuntime').async(function o(p){while(1)switch(p.prev=p.next){case 0:m('PC create %o','answer');return p.abrupt('return',this.$RTCPeerConnection4.createAnswer().then(function(q){return new (c('RTCSessionDescription'))(this.$RTCPeerConnection5,q);}.bind(this)));case 2:case 'end':return p.stop();}},null,this);};k.prototype.setLocalDescription=function n(o){return c('regeneratorRuntime').async(function p(q){while(1)switch(q.prev=q.next){case 0:m('PC set %o description %o','local',o);return q.abrupt('return',this.$RTCPeerConnection4.setLocalDescription(o.toDesc()).then(function(){return o;}));case 2:case 'end':return q.stop();}},null,this);};k.prototype.setRemoteDescription=function n(o){return c('regeneratorRuntime').async(function p(q){while(1)switch(q.prev=q.next){case 0:m('PC set %o description %o','remote',o);return q.abrupt('return',this.$RTCPeerConnection4.setRemoteDescription(o.toDesc()).then(function(){return o;}));case 2:case 'end':return q.stop();}},null,this);};k.prototype.getLocalDescription=function(){return new (c('RTCSessionDescription'))(this.$RTCPeerConnection5,this.$RTCPeerConnection4.localDescription);};k.prototype.getRemoteDescription=function(){return new (c('RTCSessionDescription'))(this.$RTCPeerConnection5,this.$RTCPeerConnection4.remoteDescription);};k.prototype.getSignalingState=function(){return this.$RTCPeerConnection4.signalingState;};k.prototype.getIceGatheringState=function(){return this.$RTCPeerConnection4.iceGatheringState;};k.prototype.getIceConnectionState=function(){return this.$RTCPeerConnection4.iceConnectionState;};k.prototype.getStats=function(){if(c('UserAgent').isBrowser('Firefox'))return c('Promise').resolve(this.$RTCPeerConnection4.getStats());return new (c('Promise'))(function(n,o){this.$RTCPeerConnection4.getStats(n,o);}.bind(this)).then(function(n){var o={};for(var p=n.result(),q=Array.isArray(p),r=0,p=q?p:p[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var s;if(q){if(r>=p.length)break;s=p[r++];}else{r=p.next();if(r.done)break;s=r.value;}var t=s,u={id:t.id,timestamp:t.timestamp,type:t.type};for(var v=t.names(),w=Array.isArray(v),x=0,v=w?v:v[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var y;if(w){if(x>=v.length)break;y=v[x++];}else{x=v.next();if(x.done)break;y=x.value;}var z=y;u[z]=t.stat(z);}o[u.id]=u;}return o;});};k.prototype.createDataChannel=function(n,o){return this.$RTCPeerConnection4.createDataChannel(n,o);};function l(n){if(n&&n.signalingState!=='closed')n.close();}function m(){}f.exports=k;}),null);
__d('RTCMWProtocolHandler',['regeneratorRuntime','Promise','ChannelManager','CurrentUser','MultiwayRequests','RTCCallActions','RTCCallStore','RTCGroupCallActions','RTCMultiwayMessageHandler','RTCPeerConnection','RTCSessionDescription','RTCUtils','FBRTCConstants','MultiwayTypes'],(function a(b,c,d,e,f,g){'use strict';var h=c('FBRTCConstants').CallEndReason,i=c('FBRTCConstants').IceConnectionState,j=c('FBRTCConstants').SignalingProtocol,k=c('MultiwayTypes').RtcResponseStatusCode,l='229895473858072',m=25000,n={appId:l,deviceId:c('ChannelManager').getCompleteConfig().sessionID,userId:c('CurrentUser').getID()};function o(){var p=arguments.length<=0||arguments[0]===undefined?null:arguments[0];this.$RTCMWProtocolHandler4=function(q){var r=q.target;c('RTCCallActions').emit('onIceConnectionStateChange',r.iceConnectionState);switch(r.iceConnectionState){case i.DISCONNECTED:case i.FAILED:if(!this.$RTCMWProtocolHandler2)this.$RTCMWProtocolHandler2=setTimeout(function(){c('RTCCallActions').endCall(h.CONNECTION_DROPPED,'ConnectionDropped');},m);break;default:clearTimeout(this.$RTCMWProtocolHandler2);this.$RTCMWProtocolHandler2=null;}}.bind(this);this.$RTCMWProtocolHandler1=p;}o.prototype.startCall=function(p,q,r,s,t){var u=arguments.length<=5||arguments[5]===undefined?{}:arguments[5];c('RTCCallActions').initialize(j.MULTIWAY,r,s,this.$RTCMWProtocolHandler1,t);var v=new (c('RTCPeerConnection'))(j.MULTIWAY,{iceServers:[]},{mandatory:{},optional:[{DtlsSrtpKeyAgreement:false},{googNumUnsignalledRecvStreams:10},{googHighBitrate:true},{googVeryHighBitrate:true}]});v.addEventListener('addstream',function(event){event.stream.onaddtrack=function(w){var x=w.target,y=w.track;c('RTCCallActions').addRemoteTrack(x,y);};event.stream.onremovetrack=function(w){var x=w.target,y=w.track;c('RTCCallActions').removeRemoteTrack(x,y);};c('RTCCallActions').addRemoteStream(event.stream);this.$RTCMWProtocolHandler3(c('RTCCallStore').getState().callInfo.conferenceName,c('RTCCallStore').getState().callInfo.serverInfoData,c('RTCCallStore').getState().connections.first().getRemoteStreams().map(function(w){var x=w.id;return {cname:x};}));}.bind(this));v.addEventListener('removestream',function(event){c('RTCCallActions').removeRemoteStream(event.stream);});v.addEventListener('iceconnectionstatechange',this.$RTCMWProtocolHandler4);this.$RTCMWProtocolHandler5(v,q,r,s,p,u);if(!s){c('RTCCallActions').call(p,v);}else c('RTCCallActions').join(v);return v;};o.prototype.videoEscalation=function(){return c('RTCUtils').initLocalStream(true).then(function(p){var q=c('RTCCallStore').getState(),r=q.callInfo,s=r.conferenceName,t=r.serverInfoData,u=q.connections,v=q.localUser,w=v.getStreamsAsArray()[0];u.first().removeStream(w);return this.$RTCMWProtocolHandler6(u.first(),[p],s,t,[]).then(function(){c('RTCCallActions').removeLocalStream(w);c('RTCCallActions').addLocalStream(p);});}.bind(this));};o.endCall=function(p,q,r){var s=arguments.length<=3||arguments[3]===undefined?'':arguments[3];c('RTCCallActions').hangup(r,s);c('MultiwayRequests').sendHangupRequest(n,p,q,r,s||'Hangup by user').done(c('RTCCallActions').hangupSuccess,c('RTCCallActions').hangupError);};o.prototype.iceRestart=function(p,q){this.$RTCMWProtocolHandler6(c('RTCCallStore').getState().connections.first(),[],p,q,[],{iceRestart:true});};o.addParticipants=function(p,q,r){c('MultiwayRequests').sendAddParticipantsRequest(n,p,q,r);};o.prototype.$RTCMWProtocolHandler3=function(p,q,r){c('MultiwayRequests').sendSubscriptionRequest(n,p,q,r);};o.clientMediaUpdate=function(p,q,r,s,t){c('MultiwayRequests').sendClientMediaUpdateRequest(n,p,q,r,s,t).then(function(u){var v=u.header.responseStatusCode,w=u.body.clientMediaUpdateResponse.currentVersion;return c('RTCGroupCallActions').onClientMediaUpdateResponse(v,w);})['catch'](function(u){});};o.prototype.$RTCMWProtocolHandler5=function(p,q,r,s,t,u){this.$RTCMWProtocolHandler7(r,s);this.$RTCMWProtocolHandler6(p,q,r,s,t,{},u).done(function(v){return c('RTCCallActions').callSuccess();},function(v){return c('RTCCallActions').callError(v);});};o.prototype.$RTCMWProtocolHandler6=function p(q,r,s,t,u){var v=arguments.length<=5||arguments[5]===undefined?{}:arguments[5],w=arguments.length<=6||arguments[6]===undefined?{}:arguments[6],x,y,z,aa,ba,ca;return c('regeneratorRuntime').async(function da(ea){while(1)switch(ea.prev=ea.next){case 0:x={};y=[];r.forEach(function(fa){y.concat(fa.getTracks());q.addStream(fa);});y.forEach(function(fa){x[fa.id]=true;});ea.next=6;return c('regeneratorRuntime').awrap(q.createOffer(v,w));case 6:z=ea.sent;ea.next=9;return c('regeneratorRuntime').awrap(c('MultiwayRequests').sendJoinRequest(n,s,t,z,u.length>0?u:null,y.length>0?x:null));case 9:aa=ea.sent;ba=aa.header.responseStatusCode;if(!(ba!==k.OK)){ea.next=13;break;}return ea.abrupt('return',new (c('Promise'))(function(fa,ga){ga(ba);}));case 13:c('RTCGroupCallActions').onJoinResponse(aa.header.serverInfoData);ca=new (c('RTCSessionDescription'))(j.MULTIWAY,{type:'answer',sdp:aa.body.joinResponse.answer.sdpString},{FORMAT_PARAMETERS:w});ea.next=17;return c('regeneratorRuntime').awrap(q.setLocalDescription(z));case 17:ea.next=19;return c('regeneratorRuntime').awrap(q.setRemoteDescription(ca));case 19:c('RTCGroupCallActions').toggleRemoteStream(aa.body.joinResponse.mediaStatus);return ea.abrupt('return',q);case 21:case 'end':return ea.stop();}},null,this);};o.prototype.$RTCMWProtocolHandler7=function(p,q){c('RTCMultiwayMessageHandler').initHandler(p,q);};f.exports=o;}),null);
__d('FBRTCCallEndButton.react',['fbt','React','FBRTCCallControlActions','FBRTCCallControlButton.react','RTCCallActions','VideoCallWebDriverIDs','MultiwayTypes'],(function a(b,c,d,e,f,g,h){'use strict';var i=c('MultiwayTypes').HangupReason,j=function k(l){var m=h._("End Call"),n=function o(){if(l.onClick)l.onClick();c('FBRTCCallControlActions').hangUp();c('RTCCallActions').hangup(i.HANGUP_CALL,'');};return (c('React').createElement(c('FBRTCCallControlButton.react'),{endButton:true,title:m,iconType:c('FBRTCCallControlButton.react').IconTypes.END,onClick:n,'data-testid':c('VideoCallWebDriverIDs').END_CALL_BUTTON}));};f.exports=j;}),null);
__d('FBRTCCallControls.react',['cx','fbt','React','FBRTCCallControlActions','FBRTCCallControlButton.react','FBRTCCallEndButton.react','FBRTCCallControlPopover.react','FBRTCConfig','FBRTCFullScreenController','FBRTCScreenSharingUtils','FBRTCUserSettings','ScreenSharingWebDriverIDs','keyMirror'],(function a(b,c,d,e,f,g,h,i){'use strict';var j,k,l=c('React').Component,m=c('React').PropTypes,n=10000,o=c('keyMirror')({READY:null,SHOWN:null,COMPLETE:null});j=babelHelpers.inherits(p,l);k=j&&j.prototype;function p(){var q,r;for(var s=arguments.length,t=Array(s),u=0;u<s;u++)t[u]=arguments[u];return r=(q=k.constructor).call.apply(q,[this].concat(t)),this.state={forceVisible:o.READY,hasFocus:false},this.$FBRTCCallControls2=function(){this.forceUpdate();}.bind(this),this.$FBRTCCallControls12=function(){c('FBRTCCallControlActions').toggleMuteVideo();},this.$FBRTCCallControls13=function(){c('FBRTCCallControlActions').toggleMuteAudio();},this.$FBRTCCallControls15=function(){if(c('FBRTCScreenSharingUtils').isScreenSharingSupported())if(this.props.canPeerReceiveScreenSharing&&!this.props.hasRemoteScreenStream){c('FBRTCCallControlActions').toggleScreenSharing();}else c('FBRTCScreenSharingUtils').logFailedAttempt(Number(this.props.peerID),Number(this.props.callID));}.bind(this),this.onFocus=function(){this.setState({hasFocus:true});}.bind(this),this.onBlur=function(){this.setState({hasFocus:false});}.bind(this),r;}p.prototype.componentDidMount=function(){this.$FBRTCCallControls1=c('FBRTCFullScreenController').addListener(this.$FBRTCCallControls2);};p.prototype.componentWillUnmount=function(){if(this.$FBRTCCallControls1){this.$FBRTCCallControls1.remove();this.$FBRTCCallControls1=null;}};p.prototype.componentWillReceiveProps=function(q){var r=this.state.forceVisible;if(q.videoIsAutoDisabled||q.hasStream&&!q.hasVideo){if(r===o.READY){this.setState({forceVisible:o.SHOWN});setTimeout(function(){this.setState({forceVisible:o.COMPLETE});}.bind(this),n);}}else if(r===o.SHOWN)this.setState({forceVisible:o.COMPLETE});};p.prototype.$FBRTCCallControls3=function(q){var r=65;return c('FBRTCUserSettings').isEnabled()?q:q-r;};p.prototype.$FBRTCCallControls4=function(){var q=null,r=null,s={};if(!this.props.isRemoteVideoSupported){q=c('FBRTCCallControlPopover.react').Types.REMOTE_VIDEO_UNSUPPORTED;}else if(!this.props.hasVideo){q=c('FBRTCCallControlPopover.react').Types.NO_VIDEO_TRACKS;}else if(this.props.videoIsAutoDisabled)q=c('FBRTCCallControlPopover.react').Types.VIDEO_AUTO_DISABLED;if(q)s.videoPopover=c('React').createElement(c('FBRTCCallControlPopover.react'),{reason:q,peerName:this.props.peerShortName,reference:this.refs.videoButton,width:this.$FBRTCCallControls3(320)});if(c('FBRTCScreenSharingUtils').isScreenSharingSupported()){if(this.props.isConnected&&!this.props.canPeerReceiveScreenSharing){r=c('FBRTCCallControlPopover.react').Types.SCREENSHARING_UNAVAILABLE;}else if(this.props.hasRemoteScreenStream)r=c('FBRTCCallControlPopover.react').Types.PEER_IS_SHARING_SCREEN;if(r)s.screenSharingPopover=c('React').createElement(c('FBRTCCallControlPopover.react'),{reason:r,peerName:this.props.peerShortName,isVCEndpointCall:c('FBRTCConfig').isVCEndpointCall(),reference:this.refs.shareScreenButton,width:this.$FBRTCCallControls3(255)});}return s;};p.prototype.render=function(){var q=this.props,r=q.isVideoMuted,s=q.isAudioMuted,t=q.isFullScreen,u=q.showSettings,v=c('FBRTCUserSettings').isEnabled()&&u,w=this.$FBRTCCallControls5(),x=!w&&r,y=c('FBRTCScreenSharingUtils').isScreenSharingSupported(),z=s,aa=this.$FBRTCCallControls4();return c('React').createElement('div',{className:"_4bbt"},c('React').createElement('div',{className:this.$FBRTCCallControls6(),onFocus:this.onFocus,onBlur:this.onBlur},this.$FBRTCCallControls7(x,w),this.$FBRTCCallControls8(z),this.$FBRTCCallControls9(y),c('React').createElement(c('FBRTCCallEndButton.react'),null),this.$FBRTCCallControls10(v),this.$FBRTCCallControls11(t),aa.videoPopover,aa.screenSharingPopover));};p.prototype.$FBRTCCallControls5=function(){var q=this.props,r=q.isConnected,s=q.isRemoteVideoSupported,t=q.hasVideo;return !s||!t||!r;};p.prototype.$FBRTCCallControls7=function(q,r){var s=q?i._("Enable Your Video"):i._("Disable Your Video");return c('React').createElement(c('FBRTCCallControlButton.react'),{active:q,disabled:r,highlighted:q,title:s,iconType:c('FBRTCCallControlButton.react').IconTypes.VIDEO,onClick:this.$FBRTCCallControls12,ref:'videoButton'});};p.prototype.$FBRTCCallControls8=function(q){var r=q?i._("Unmute your microphone"):i._("Mute your microphone");return c('React').createElement(c('FBRTCCallControlButton.react'),{active:q,iconType:c('FBRTCCallControlButton.react').IconTypes.MUTE,highlighted:q,title:r,onClick:this.$FBRTCCallControls13});};p.prototype.$FBRTCCallControls14=function(){if(c('FBRTCUserSettings').isEnabled())c('FBRTCCallControlActions').showSettings();};p.prototype.$FBRTCCallControls10=function(q){if(q){var r=i._("Settings");return c('React').createElement(c('FBRTCCallControlButton.react'),{iconType:c('FBRTCCallControlButton.react').IconTypes.SETTINGS,title:r,onClick:this.$FBRTCCallControls14});}return null;};p.prototype.$FBRTCCallControls9=function(q){if(!q)return null;var r=this.props,s=r.canPeerReceiveScreenSharing,t=r.isScreenSharingEnabled,u=s&&t,v=!s||!this.props.isConnected||this.props.hasRemoteScreenStream,w=i._("Share Your Screen");return c('React').createElement(c('FBRTCCallControlButton.react'),{active:u,disabled:v,highlighted:u,iconType:c('FBRTCCallControlButton.react').IconTypes.SHARE_SCREEN,title:w,onClick:this.$FBRTCCallControls15,ref:'shareScreenButton','data-testid':c('ScreenSharingWebDriverIDs').SHARE_SCREEN_BUTTON});};p.prototype.$FBRTCCallControls16=function(){c('FBRTCCallControlActions').toggleFullScreen();};p.prototype.$FBRTCCallControls11=function(q){var r=q?i._("Exit Full Screen"):i._("Enter Full Screen");return c('React').createElement(c('FBRTCCallControlButton.react'),{active:q,title:r,iconType:c('FBRTCCallControlButton.react').IconTypes.FULL_SCREEN,onClick:this.$FBRTCCallControls16});};p.prototype.$FBRTCCallControls6=function(){var q=!this.props.hasStream||this.props.isEnded,r=this.props.isMouseActive||this.state.hasFocus||this.state.forceVisible===o.SHOWN;return "_4bbx"+(q?' '+"_4bby":'')+(r?' '+"_4bbz":'');};p.defaultProps={hasRemoteScreenStream:false,isFullScreen:false,isMouseActive:true,isRemoteVideoSupported:true,isScreenSharingEnabled:false,showSettings:false,videoIsAutoDisabled:false};p.propTypes={canPeerReceiveScreenSharing:m.bool,hasAudio:m.bool.isRequired,hasRemoteScreenStream:m.bool,hasStream:m.bool.isRequired,hasVideo:m.bool.isRequired,isAudioMuted:m.bool.isRequired,isConnected:m.bool.isRequired,isEnded:m.bool.isRequired,isFullScreen:m.bool,isMouseActive:m.bool,isRemoteVideoSupported:m.bool,isScreenSharingEnabled:m.bool,isVideoMuted:m.bool.isRequired,peerShortName:m.string.isRequired,showSettings:m.bool,videoIsAutoDisabled:m.bool,callID:m.string.isRequired,peerID:m.oneOfType([m.number,m.string]).isRequired};f.exports=p;}),null);
__d('FBRTCButton.react',['cx','MessengerButton.react','React','XUIOverlayButton.react','joinClasses'],(function a(b,c,d,e,f,g,h){'use strict';var i,j,k=c('React').PropTypes;i=babelHelpers.inherits(l,c('React').PureComponent);j=i&&i.prototype;l.prototype.render=function(){var m=this.props,n=m.className,o=m.messengerUI,p=m.type,q=babelHelpers.objectWithoutProperties(m,['className','messengerUI','type']);if(o)return (c('React').createElement(c('MessengerButton.react'),babelHelpers['extends']({className:n,type:p},q)));return (c('React').createElement(c('XUIOverlayButton.react'),babelHelpers['extends']({className:c('joinClasses')("_1-7l",n)},q)));};function l(){i.apply(this,arguments);}l.propTypes={label:k.node.isRequired,messengerUI:k.bool.isRequired,type:k.oneOf(['primary','secondary']).isRequired};f.exports=l;}),null);
__d('FBRTCCallEndMessage.react',['cx','fbt','FBRTCConstants','ReactComponentWithPureRenderMixin','React'],(function a(b,c,d,e,f,g,h,i){'use strict';var j=c('FBRTCConstants').CallEndReason,k=c('FBRTCConstants').CollabCallEndSubreason,l=c('React').PropTypes,m=c('React').createClass({displayName:'FBRTCCallEndMessage',mixins:[c('ReactComponentWithPureRenderMixin')],propTypes:{endCallReason:l.number,endCallSubreason:l.any,isCollabCall:l.bool},defaultProps:{isCollabCall:false},render:function n(){return (c('React').createElement('div',{className:"_2ze8"},this._getCallEndReason(),this._getCallEndSubreason()));},_getCallEndSubreason:function n(){var o=this.props,p=o.isCollabCall,q=o.endCallReason,r=o.endCallSubreason;if(!p)return null;if(q!==j.OTHER_NOT_CAPABLE&&q!==j.SIGNALING_MESSAGE_FAILED)return null;switch(r){case k.REMOTE_PEER_HANGUP:case k.REMOTE_PEER_REJECT:return null;case k.CLOSED_BY_MCU:return ' - Call expired';case k.CLOSED_AS_STALE:return ' - Server failed, call is stale';case k.CALL_INITIALIZATION_FAILED:return ' - Call initialization to room failed';case k.SIP_CONNECTION_INITIALIZATION_FAILED:return ' or No Answer';case k.LOST_MCU_CONNECTION:return ' - MCU Media connection failed';case k.LOST_MCU_THRIFT_CONNECTION:return ' - MCU infrastructure dropped connection';case k.LOST_SIP_ADAPTER_CONNECTION:return ' - SIP infrastructure dropped connection';case k.MCU_NO_AUDIO_STREAM:return ' - Invalid audio stream';case k.MCU_INVALID_STREAM_CONFIGURATION:return ' - Invalid stream configuration';case k.UNKNOWN:default:return ' - Unexpected call failure: '+r;}},_getCallEndReason:function n(){var o=this.props,p=o.endCallReason,q=o.endCallSubreason,r=i._("Not Reachable");switch(p){case j.NO_ANSWER_TIMEOUT:case j.IGNORE_CALL:return i._("No Answer");case j.INCOMING_TIMEOUT:case j.NO_PERMISSION:case j.OTHER_CARRIER_BLOCKED:return r;case j.OTHER_NOT_CAPABLE:return q!==k.MCU_INVALID_STREAM_CONFIGURATION?r:i._("Too many clients connected to the room");case j.SIGNALING_MESSAGE_FAILED:case j.WEBRTC_ERROR:case j.NO_UI_ERROR:case j.CALLER_NOT_VISIBLE:case j.CLIENT_ERROR:return i._("Call Failed");case j.UNSUPPORTED_VERSION:return i._("Can't connect Call");case j.IN_ANOTHER_CALL:return i._("On Another Call");case j.CARRIER_BLOCKED:return i._("Switch to Wi-Fi to complete your call");case j.CLIENT_INTERRUPTED:return i._("Call Interrupted");case j.HANGUP_CALL:case j.ACCEPT_AFTER_HANGUP:return i._("Call ended");case j.CONNECTION_DROPPED:return i._("Connection lost");case j.OTHER_INSTANCE_HANDLED:return '';default:return '';}}});f.exports=m;}),null);
__d('FBRTCCallTimer.react',['React'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=c('React').PureComponent;h=babelHelpers.inherits(k,j);i=h&&h.prototype;function k(){var l,m;for(var n=arguments.length,o=Array(n),p=0;p<n;p++)o[p]=arguments[p];return m=(l=i.constructor).call.apply(l,[this].concat(o)),this.state={secondsElapsed:Math.floor(Date.now()/1000)-this.props.start},this.$FBRTCCallTimer2=function(){this.setState({secondsElapsed:Math.floor(Date.now()/1000)-this.props.start});}.bind(this),m;}k.prototype.componentDidMount=function(){this.$FBRTCCallTimer1=setInterval(this.$FBRTCCallTimer2,1000);};k.prototype.componentWillUnmount=function(){clearInterval(this.$FBRTCCallTimer1);};k.prototype.render=function(){var l=this.state.secondsElapsed;return c('React').createElement('span',null,l>=3600?('0'+Math.floor(l/3600)).slice(-2)+':':'',('0'+Math.floor(l%3600/60)).slice(-2),':',('0'+l%60).slice(-2));};f.exports=k;}),null);
__d('FBRTCSpinner.react',['MessengerSpinner.react','React','XUISpinner.react'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=c('React').PropTypes;h=babelHelpers.inherits(k,c('React').PureComponent);i=h&&h.prototype;k.prototype.render=function(){if(this.props.messengerUI)return c('React').createElement(c('MessengerSpinner.react'),{color:'blue'});return c('React').createElement(c('XUISpinner.react'),{background:'dark',size:'large'});};function k(){h.apply(this,arguments);}k.propTypes={messengerUI:j.bool.isRequired};f.exports=k;}),null);
__d('FBRTCCallStateInfo.react',['cx','fbt','FBRTCButton.react','FBRTCCallControlActions','FBRTCCallEndMessage.react','FBRTCCallModel','FBRTCCallTimer.react','FBRTCConstants','FBRTCSpinner.react','Image.react','MessengerContactImage.react','React'],(function a(b,c,d,e,f,g,h,i){var j,k,l=function n(o,p){switch(o.uiState){case c('FBRTCCallModel').UIState.INIT:case c('FBRTCCallModel').UIState.PENDING_LOCAL_MEDIA:case c('FBRTCCallModel').UIState.MORE_INIT:case c('FBRTCCallModel').UIState.USER_MEDIA_DENIED:return c('React').createElement(c('FBRTCSpinner.react'),{messengerUI:p});case c('FBRTCCallModel').UIState.CONTACTING:return (c('React').createElement('p',{className:"_2ze8"},i._("Contacting...")));case c('FBRTCCallModel').UIState.RINGING:return (c('React').createElement('p',{className:"_2ze8"},i._("Ringing...")));case c('FBRTCCallModel').UIState.CALL_CONNECTING:return (c('React').createElement('p',{className:"_2ze8"},i._("Connecting...")));case c('FBRTCCallModel').UIState.CALL_CONNECTED:if(!this._start)this._start=Math.floor(Date.now()/1000);return (c('React').createElement('p',{className:"_2ze8"},c('React').createElement(c('FBRTCCallTimer.react'),{start:this._start})));case c('FBRTCCallModel').UIState.CALL_ENDED:return c('React').createElement(c('FBRTCCallEndMessage.react'),{endCallReason:o.endCallReason});default:return '';}};j=babelHelpers.inherits(m,c('React').Component);k=j&&j.prototype;function m(){var n,o;'use strict';for(var p=arguments.length,q=Array(p),r=0;r<p;r++)q[r]=arguments[r];return o=(n=k.constructor).call.apply(n,[this].concat(q)),this.revealContainer=function(){var s="_4j_h",t=document.getElementsByClassName(s)[0];if(t)t.className=s;},this.onCloseButtonClicked=function(s){window.close();return;},this.renderMessage=function(){var s=this.props.callModel;if(s.uiState===c('FBRTCCallModel').UIState.AWAITING_USER_START)return (c('React').createElement('p',{className:"_4j_k"},i._("Ready to call {name}?",[i.param('name',s.peerShortName())])));return (c('React').createElement('p',{className:"_4j_k"},this.props.callModel.peerName()));}.bind(this),this.renderSubMessage=function(){return l(this.props.callModel,this.props.messengerUI);}.bind(this),this.renderPeerImage=function(s){if(s.peerPicUrl()){if(this.props.messengerUI)return (c('React').createElement(c('MessengerContactImage.react'),{className:"_3z3i",isMessengerUser:true,size:75,src:s.peerPicUrl()}));return (c('React').createElement(c('Image.react'),{className:"_4j_j",src:s.peerPicUrl(),alt:i._("Profile picture"),onLoad:this.revealContainer,onError:this.revealContainer}));}return '';}.bind(this),this.shouldRenderCloseButton=function(){var s=this.props.callModel;return s.uiState===c('FBRTCCallModel').UIState.CALL_ENDED&&(!s.wasConnected||s.endCallReason!==c('FBRTCConstants').CallEndReason.HANGUP_CALL);}.bind(this),this.renderCloseWindowButton=function(){if(this.shouldRenderCloseButton()){return (c('React').createElement(c('FBRTCButton.react'),{label:i._("Close Window"),messengerUI:this.props.messengerUI,onClick:this.onCloseButtonClicked,type:'primary'}));}else return '';}.bind(this),this.renderStartCallButton=function(){var s=this.props.callModel;if(s.uiState===c('FBRTCCallModel').UIState.AWAITING_USER_START){return (c('React').createElement(c('FBRTCButton.react'),{label:i._("Start Call"),messengerUI:this.props.messengerUI,onClick:c('FBRTCCallControlActions').startCall,type:'primary'}));}else return '';}.bind(this),o;}m.prototype.componentDidMount=function(){'use strict';setTimeout(function(){this.revealContainer();}.bind(this),2000);};m.prototype.render=function(){'use strict';var n=this.props.callModel;return c('React').createElement('div',{className:"_4j_i"},this.renderPeerImage(n),this.renderMessage(),this.renderSubMessage(),this.renderCloseWindowButton(),this.renderStartCallButton());};f.exports=m;}),null);
__d('FBRTCFadeInMixin',['cx','ReactDOM','joinClasses'],(function a(b,c,d,e,f,g,h){var i={componentDidMount:function j(){var k=c('ReactDOM').findDOMNode(this);k.style.opacity=0;k.className=c('joinClasses')(k.className,"_2hy");setTimeout(function(){k.style.opacity=1;},1);}};f.exports=i;}),null);
__d('FBRTCCollabCallFeedbackView.react',['ix','cx','fbt','FBRTCButton.react','FBRTCCallControlActions','FBRTCCallEndMessage.react','FBRTCCallModel','FBRTCFadeInMixin','Image.react','ReactComponentWithPureRenderMixin','React','fbglyph'],(function a(b,c,d,e,f,g,h,i,j){'use strict';var k=c('React').PropTypes,l=241233369258619,m=c('React').createClass({displayName:'FBRTCCollabCallFeedbackView',mixins:[c('FBRTCFadeInMixin'),c('ReactComponentWithPureRenderMixin')],propTypes:{callModel:k.instanceOf(c('FBRTCCallModel')).isRequired,messengerUI:k.bool.isRequired},closeCurrentWindow:function n(){window.close();},messageString:function n(){return j._("Please leave feedback in the VC Feedback group");},render:function n(){var o=this.props.callModel,p=c('React').createElement(c('Image.react'),{src:h("\/images\/assets_DO_NOT_HARDCODE\/fb_glyphs\/camcorder_20_fig-white.png")});return (c('React').createElement('div',null,c('React').createElement('div',{className:"_1-7k"},c('React').createElement(c('FBRTCCallEndMessage.react'),{endCallReason:o.endCallReason,endCallSubreason:o.endCallSubreason,isCollabCall:true}),c('React').createElement('p',{className:"_4j_k"},this.messageString()),c('React').createElement('div',null,c('React').createElement(c('FBRTCButton.react'),{label:j._("Close Window"),messengerUI:this.props.messengerUI,onClick:this.closeCurrentWindow,type:'secondary'}),c('React').createElement(c('FBRTCButton.react'),{label:j._("Leave Feedback"),messengerUI:this.props.messengerUI,href:'/groups/'+l,onClick:this.closeCurrentWindow,target:'_blank',type:'primary'}))),c('React').createElement('div',{className:"_15wx"},c('React').createElement(c('FBRTCButton.react'),{className:"_15wy",label:j._("Redial"),image:p,messengerUI:this.props.messengerUI,use:'special',onClick:c('FBRTCCallControlActions').redialCall,type:'secondary'}))));}});f.exports=m;}),null);
__d('FBRTCInCallView.react',['cx','FBRTCScreenSharingUI','FBRTCScreenSharingView.react','FBRTCStreamWrapper','FBRTCUserSettings','FBRTCVideo.react','EmitterSubscription','React'],(function a(b,c,d,e,f,g,h){'use strict';var i,j,k=c('React').PropTypes,l=c('React').Component;i=babelHelpers.inherits(m,l);j=i&&i.prototype;function m(){var n,o;for(var p=arguments.length,q=Array(p),r=0;r<p;r++)q[r]=arguments[r];return o=(n=j.constructor).call.apply(n,[this].concat(q)),this.state={audioSinkID:null,settingsActivateListener:null,settingsDeactivateListener:null,settingsSaveListener:null,muted:false},this.$FBRTCInCallView2=function(){var s=this.props,t=s.isCallConnected,u=s.hasCallEnded;return "_of-"+(t||u?' '+"_of_":'')+(t?' '+"_og0":'')+(u?' '+"_og1":'');}.bind(this),this.$FBRTCInCallView3=function(s){var t=this.props.isRemoteVideoMuted;return "_og2"+(t?' '+"_og3":'')+(s?' '+"_og4":'');}.bind(this),o;}m.prototype.$FBRTCInCallView1=function(n){return !!n&&!c('FBRTCScreenSharingUI').isOpen();};m.prototype.render=function(){var n=this.props,o=n.hasRemoteMediaStream,p=n.remoteMediaStream,q=n.remoteScreenStreamWrapper,r=n.remoteStreamWrapper,s=this.state,t=s.audioSinkID,u=s.muted,v=this.$FBRTCInCallView1(q);if(!o&&!v)return c('React').createElement('div',{className:"_hgl"});return (c('React').createElement('div',{className:this.$FBRTCInCallView2()},c('React').createElement('div',{className:this.$FBRTCInCallView3(v)},c('React').createElement(c('FBRTCVideo.react'),{audioSinkID:t,muted:u,stream:r,mediaStream:p})),this.$FBRTCInCallView4(q,v)));};m.prototype.$FBRTCInCallView4=function(n,o){if(!n||!o)return null;return (c('React').createElement(c('FBRTCScreenSharingView.react'),{canSwitchScreens:false,screenStream:n}));};m.prototype.componentDidMount=function(){var n=c('FBRTCUserSettings').addListener('previewStarted',function(){return this.setState({muted:true});}.bind(this)),o=c('FBRTCUserSettings').addListener('previewEnded',function(){return this.setState({muted:false});}.bind(this)),p=c('FBRTCUserSettings').addListener('saved',function(){return this.setState({audioSinkID:c('FBRTCUserSettings').audioOutput});}.bind(this));this.setState({settingsActivateListener:n,settingsDeactivateListener:o,settingsSaveListener:p});};m.prototype.componentWillUnmount=function(){var n=this.state,o=n.settingsActivateListener,p=n.settingsDeactivateListener,q=n.settingsSaveListener;o&&o.remove();p&&p.remove();q&&q.remove();};m.propTypes={hasCallEnded:k.bool,hasRemoteMediaStream:k.bool,isCallConnected:k.bool,isRemoteVideoMuted:k.bool,remoteScreenStreamWrapper:k.instanceOf(c('FBRTCStreamWrapper')),remoteStreamWrapper:k.instanceOf(c('FBRTCStreamWrapper')),remoteMediaStream:k.any};f.exports=m;}),null);
__d('FBRTCMediaAccessPrompt.react',['cx','fbt','React','ReactDOM','UserAgent','Link.react','XUIText.react','CurrentUser','FBRTCCallModel','FBRTCConfig'],(function a(b,c,d,e,f,g,h,i){var j,k;j=babelHelpers.inherits(l,c('React').Component);k=j&&j.prototype;function l(){var m,n;'use strict';for(var o=arguments.length,p=Array(o),q=0;q<o;q++)p[q]=arguments[q];return n=(m=k.constructor).call.apply(m,[this].concat(p)),this.isVisible=function(r){return (c('UserAgent').isBrowser('Chrome')||c('UserAgent').isBrowser('Firefox'))&&r===c('FBRTCCallModel').UIState.PENDING_LOCAL_MEDIA;},this.dialogTitle=function(){if(c('UserAgent').isBrowser('Chrome')){return i._("Click \"Allow\" to Make a Call");}else return i._("Click the camera and choose \"Share Selected Devices\"");},this.dialogLowerBody=function(){return i._("You can always turn these off later.");},this.learnMoreLink=function(){return (c('React').createElement(c('Link.react'),{href:c('FBRTCConfig').userMediaPermissionErrorUrl(),target:'_blank'},i._("Learn more")));},n;}l.prototype.componentWillUpdate=function(m,n){'use strict';var o=m.callModel.uiState;if(this.isVisible(o)){clearTimeout(this.timeout);c('ReactDOM').findDOMNode(this).style.display='block';}};l.prototype.componentDidUpdate=function(m,n){'use strict';var o=this.props.callModel.uiState;if(!this.isVisible(o))this.timeout=setTimeout(function(){c('ReactDOM').findDOMNode(this).style.display='none';}.bind(this),500);};l.prototype.componentWillUnmount=function(){'use strict';clearTimeout(this.timeout);};l.prototype.dialogBody=function(){'use strict';if(!c('CurrentUser').isWorkUser()){return i._("To make a video call on Facebook, you need to turn on your camera and microphone. This will let your friend see and hear you during the call.");}else return i._("To make a video call on Workplace, you need to turn your camera and microphone on. This will let your colleague see and hear you during the call.");};l.prototype.render=function(){'use strict';var m=this.props.callModel.uiState;return (c('React').createElement('div',{className:"_3jne"+(!this.isVisible(m)?' '+"_3jnf":'')},c('React').createElement('div',{className:"_3jnu"},c('React').createElement('h1',{className:"_3jnv"},this.dialogTitle()),c('React').createElement(c('XUIText.react'),{className:"_3jnw",display:'block',size:'small'},this.dialogBody()),c('React').createElement(c('XUIText.react'),{className:"_3jnw",display:'block',size:'small'},this.dialogLowerBody(),' ',this.learnMoreLink()))));};f.exports=l;}),null);
__d('FBRTCMediaDeniedPrompt.react',['cx','fbt','React','UserAgent','XUIContextualDialog.react','XUIContextualDialogBody.react','XUIContextualDialogTitle.react','FBRTCCallModel'],(function a(b,c,d,e,f,g,h,i){var j,k;j=babelHelpers.inherits(l,c('React').Component);k=j&&j.prototype;function l(){var m,n;'use strict';for(var o=arguments.length,p=Array(o),q=0;q<o;q++)p[q]=arguments[q];return n=(m=k.constructor).call.apply(m,[this].concat(p)),this.showDialog=function(){var r=this.props.callModel;return r.uiState===c('FBRTCCallModel').UIState.USER_MEDIA_DENIED;}.bind(this),this.arrowAlignment=function(){return c('UserAgent').isBrowser('Chrome')?'right':'left';},this.dialogTitle=function(){return i._("Click to Turn on Camera\/Microphone");},this.dialogBody=function(){return i._("To use video calling, you need to turn on your camera and microphone during the call.");},this.renderLayers=function(){return (c('React').createElement(c('XUIContextualDialog.react'),{contextRef:function(){return this.refs.mpTarget;}.bind(this),shown:this.showDialog(),position:'below',alignment:this.arrowAlignment(),width:c('XUIContextualDialog.react').WIDTH.NORMAL,key:'popover'},c('React').createElement(c('XUIContextualDialogTitle.react'),null,this.dialogTitle()),c('React').createElement(c('XUIContextualDialogBody.react'),null,this.dialogBody())));}.bind(this),n;}l.prototype.render=function(){'use strict';return (c('React').createElement('span',null,c('React').createElement('div',{className:"_3wrz",ref:'mpTarget'}),this.renderLayers()));};f.exports=l;}),null);
__d('FBRTCVideoMuteOverlay.react',['cx','Image.react','React'],(function a(b,c,d,e,f,g,h){'use strict';var i,j,k=c('React').PropTypes;i=babelHelpers.inherits(l,c('React').PureComponent);j=i&&i.prototype;l.prototype.render=function(){var m="_30ve"+(this.props.videoMuted?' '+"_30vf":'');return (c('React').createElement('div',{className:m},c('React').createElement(c('Image.react'),{src:this.props.imageSrc,alt:'video muted'})));};function l(){i.apply(this,arguments);}l.propTypes={videoMuted:k.bool.isRequired,imageSrc:k.oneOfType([k.string,k.object]).isRequired};f.exports=l;}),null);
__d('FBRTCSelfView.react',['cx','FBRTCActiveMouseMixin','FBRTCCallModel','FBRTCCallControlActions','FBRTCUtils','FBRTCVideo.react','FBRTCVideoMuteOverlay.react','React'],(function a(b,c,d,e,f,g,h){'use strict';var i=c('React').PropTypes,j=c('React').createClass({displayName:'FBRTCSelfView',mixins:[c('FBRTCActiveMouseMixin')],propTypes:{callModel:i.instanceOf(c('FBRTCCallModel')).isRequired},getInitialState:function k(){return {};},activeMouseCallback:function k(l){if(this.isMounted())this.setState({mouseActive:l});},toggleIconClass:function k(l,m){return "_2q_n"+(l?' '+"_2q_o":'')+(!l?' '+"_2q_p":'')+(!m?' '+"_2q_q":'');},wrapperClasses:function k(l){return "_2q_r"+(!l.selfViewOpen?' '+"_2q_s":'');},overlayClasses:function k(l){var m=l.localStream.hasAudio();return "_2q_t"+(m?' '+"_2q_u":'');},buttonClasses:function k(){return "_2q_w"+(this.state.mouseActive?' '+"_sxz":'');},render:function k(){var l=this.props.callModel,m=l.selfViewOpen,n=l.isScreenSharingEnabled()?"_nxg":"_2q_y",o=l.isScreenSharingEnabled()?l.getLocalScreenStream():l.localStream;return (c('React').createElement('div',{className:"_2q_v"},c('React').createElement('button',{className:this.buttonClasses(),onClick:c('FBRTCCallControlActions').toggleSelfView},c('React').createElement('i',{className:this.toggleIconClass(true,!m)}),c('React').createElement('i',{className:this.toggleIconClass(false,m)})),c('React').createElement('div',{className:this.wrapperClasses(l)},c('React').createElement('div',{className:"_5aq5"},c('React').createElement(c('FBRTCVideoMuteOverlay.react'),{videoMuted:!o.hasVideo(),imageSrc:l.selfPicUrl()}),c('React').createElement('div',{className:this.overlayClasses(l)},c('React').createElement('i',{className:"_2q_x"})),c('React').createElement(c('FBRTCVideo.react'),{muted:true,className:n,stream:o})))));}});f.exports=j;}),null);
__d('FBRTCFeedbackCompleteView.react',['cx','fbt','FBRTCButton.react','FBRTCCallControlActions','FBRTCFadeInMixin','React'],(function a(b,c,d,e,f,g,h,i){var j=c('React').createClass({displayName:'FBRTCFeedbackCompleteView',mixins:[c('FBRTCFadeInMixin')],onCallBackButtonClicked:function k(){return;},onCloseButtonClicked:function k(){window.close();return;},messageString:function k(){if(this.props.skipped)return i._("Your call has ended");return i._("Thank you for your feedback!");},render:function k(){return (c('React').createElement('div',{className:"_1-7k"},c('React').createElement('p',{className:"_4j_k"},this.messageString()),c('React').createElement('div',null,c('React').createElement(c('FBRTCButton.react'),{className:"_g6b",label:i._("Close Window"),messengerUI:this.props.messengerUI,onClick:this.onCloseButtonClicked,type:'primary'}),this.props.isGroupCall?null:c('React').createElement(c('FBRTCButton.react'),{className:"_g6b",label:i._("Call Back"),messengerUI:this.props.messengerUI,onClick:c('FBRTCCallControlActions').redialCall,type:'primary'}))));}});f.exports=j;}),null);
__d('FBRTCFeedbackView.react',['cx','fbt','FBRTCButton.react','FBRTCFadeInMixin','FBRTCFeedbackCompleteView.react','FBRTCStarRatingActions','React'],(function a(b,c,d,e,f,g,h,i){var j=c('React').createClass({displayName:'FBRTCFeedbackView',mixins:[c('FBRTCFadeInMixin')],getInitialState:function k(){return {submitted:false,skipped:false,feedbackText:''};},componentDidMount:function k(){c('FBRTCStarRatingActions').feedbackShown();},onSubmitButtonClicked:function k(){if(this.canSubmitFeedback()){this.setState({submitted:true});c('FBRTCStarRatingActions').submitFeedback(this.state.feedbackText);}},onNotNowClicked:function k(){this.setState({skipped:true,submitted:true});return;},canSubmitFeedback:function k(){return this.state.feedbackText!=='';},feedbackChanged:function k(l){this.setState({feedbackText:l.target.value});l.preventDefault();},render:function k(){if(this.state.submitted)return (c('React').createElement(c('FBRTCFeedbackCompleteView.react'),{messengerUI:this.props.messengerUI,skipped:this.state.skipped}));return (c('React').createElement('div',{className:"_1-7k"},c('React').createElement('p',{className:"_4j_k"},i._("Give Feedback")),c('React').createElement('div',{className:"_4ru1"},c('React').createElement('label',{htmlFor:'fbwebrtcfeedback',className:"_4j_k _4ru2"},i._("What was the worst problem you experienced?")),c('React').createElement('textarea',{className:"_4ru3",id:'fbwebrtcfeedback',rows:'4',onChange:this.feedbackChanged,placeholder:i._("Enter your feedback")}),c('React').createElement('div',{className:"_s97"},c('React').createElement(c('FBRTCButton.react'),{className:"_g6b",label:i._("Not Now"),messengerUI:this.props.messengerUI,onClick:this.onNotNowClicked,type:'secondary'}),c('React').createElement(c('FBRTCButton.react'),{className:"_g6b",disabled:!this.canSubmitFeedback(),label:i._("Submit"),messengerUI:this.props.messengerUI,onClick:this.onSubmitButtonClicked,type:'primary'})))));}});f.exports=j;}),null);
__d('FBRTCStarRatingView.react',['cx','fbt','FBRTCButton.react','FBRTCFadeInMixin','FBRTCFeedbackCompleteView.react','FBRTCFeedbackView.react','FBRTCStarRatingActions','React','StarsInput.react','VideoCallWebDriverIDs'],(function a(b,c,d,e,f,g,h,i){var j=c('React').createClass({displayName:'FBRTCStarRatingView',mixins:[c('FBRTCFadeInMixin')],getInitialState:function k(){return {rating:0,submitted:false,skipped:false,feedbackText:''};},componentDidMount:function k(){c('FBRTCStarRatingActions').ratingShown();},onCallBackButtonClicked:function k(){return;},onCloseButtonClicked:function k(){window.close();return;},onStarClicked:function k(l){this.setState({rating:l});},onSubmitButtonClicked:function k(){if(this.state.rating>0){this.setState({submitted:true});c('FBRTCStarRatingActions').submitRating(this.state.rating);}},onNotNowClicked:function k(){this.setState({skipped:true,submitted:true});return;},getRatingString:function k(){switch(this.state.rating){case 1:return i._("Poor");case 2:return i._("Fair");case 3:return i._("Good");case 4:return i._("Very good");case 5:return i._("Excellent");default:return '---';}},shouldAskForFeedback:function k(){return this.state.rating===1&&this.state.submitted&&!this.state.skipped;},render:function k(){if(this.shouldAskForFeedback()){return (c('React').createElement(c('FBRTCFeedbackView.react'),{messengerUI:this.props.messengerUI}));}else if(this.state.submitted)return (c('React').createElement(c('FBRTCFeedbackCompleteView.react'),{skipped:this.state.skipped,messengerUI:this.props.messengerUI}));var l=this.getRatingString();return (c('React').createElement('div',{className:"_1-7k",'data-testid':c('VideoCallWebDriverIDs').STAR_RATING_VIEW},c('React').createElement('p',{className:"_4j_k"},this.props.hasVideo?i._("Please rate the quality of your video call."):i._("Please rate the quality of your audio call.")),c('React').createElement('p',{className:"_4j_k _a16"},l),c('React').createElement(c('StarsInput.react'),{allowMultipleSubmissions:true,onClick:this.onStarClicked}),c('React').createElement('div',{className:"_s97"},c('React').createElement(c('FBRTCButton.react'),{className:"_g6b",label:i._("Not Now"),messengerUI:this.props.messengerUI,onClick:this.onNotNowClicked,type:'secondary'}),c('React').createElement(c('FBRTCButton.react'),{className:"_g6b",label:i._("Submit"),disabled:this.state.rating===0,messengerUI:this.props.messengerUI,onClick:this.onSubmitButtonClicked,type:'primary'}))));}});f.exports=j;}),null);
__d('FBRTCView.react',['cx','FBRTCBackground.react','FBRTCCallControls.react','FBRTCCallModel','FBRTCCallStateInfo.react','FBRTCUtils','FBRTCCollabCallFeedbackView.react','FBRTCInCallView.react','FBRTCMediaAccessPrompt.react','FBRTCSelfView.react','FBRTCMediaDeniedPrompt.react','FBRTCStarRatingView.react','React'],(function a(b,c,d,e,f,g,h){'use strict';var i,j,k=c('React').PropTypes,l=c('React').Component;i=babelHelpers.inherits(m,l);j=i&&i.prototype;m.prototype.render=function(){var n=this.props,o=n.callModel,p=n.messengerUI,q=o.backgroundUrl(),r=o.getLocalVideoDuration()>0&&o.getRemoteVideoDuration()>0;if(c('FBRTCUtils').isCollabCallable(o.peerID)&&o.uiState===c('FBRTCCallModel').UIState.CALL_ENDED)return (c('React').createElement('div',{className:this.$FBRTCView2()},c('React').createElement(c('FBRTCBackground.react'),{src:q,messengerUI:p}),this.$FBRTCView3(),c('React').createElement(c('FBRTCCollabCallFeedbackView.react'),{callModel:o,messengerUI:p})));if(o.uiState===c('FBRTCCallModel').UIState.COLLECT_RATING){return (c('React').createElement('div',{className:this.$FBRTCView2()},c('React').createElement(c('FBRTCBackground.react'),babelHelpers['extends']({messengerUI:p},{src:q})),this.$FBRTCView3(),c('React').createElement(c('FBRTCStarRatingView.react'),{hasVideo:r,messengerUI:p})));}else{var s=o.localStream,t=o.remoteStream;return (c('React').createElement('div',{className:this.$FBRTCView2()},c('React').createElement(c('FBRTCMediaAccessPrompt.react'),{callModel:o}),c('React').createElement(c('FBRTCMediaDeniedPrompt.react'),{callModel:o}),c('React').createElement(c('FBRTCCallStateInfo.react'),{callModel:o,messengerUI:p}),c('React').createElement(c('FBRTCBackground.react'),{src:q,messengerUI:p}),this.$FBRTCView3(),c('React').createElement(c('FBRTCInCallView.react'),{hasCallEnded:o.isEnded(),hasRemoteMediaStream:t.hasStream(),isCallConnected:o.isConnected(),isRemoteVideoMuted:!t.hasVideo(),remoteScreenStreamWrapper:o.getRemoteScreenStream(),remoteStreamWrapper:t}),this.$FBRTCView4(o),c('React').createElement(c('FBRTCCallControls.react'),{callID:o.callID.toString(),canPeerReceiveScreenSharing:o.canPeerReceiveScreenSharing(),hasAudio:s.hasAudioTracks(),hasRemoteScreenStream:o.getRemoteScreenStream()!==null,hasStream:s.hasStream(),hasVideo:s.hasVideoTracks(),isAudioMuted:!s.hasAudio(),isConnected:o.isConnected(),isFullScreen:o.isFullScreen(),isEnded:o.isEnded(),isRemoteVideoSupported:o.isRemoteVideoSupported,isScreenSharingEnabled:o.isScreenSharingEnabled(),isVideoMuted:!s.hasVideo(),peerID:o.peerID,peerShortName:o.peerShortName(),showSettings:o.supportsSdpUpdate()||c('FBRTCUtils').supportsSetSink(),videoIsAutoDisabled:o.videoIsAutoDisabled()})));}};m.prototype.$FBRTCView2=function(){return "_3ref"+(this.props.messengerUI?' '+"_17cj":'');};m.prototype.$FBRTCView3=function(){if(!this.props.messengerUI){var n="_263g"+(' '+"_56ut");return c('React').createElement('i',{className:n});}return null;};m.prototype.$FBRTCView4=function(n){if(!this.props.excludeSelfView&&n.isRemoteVideoSupported&&!n.isEnded())return c('React').createElement(c('FBRTCSelfView.react'),{callModel:n});return null;};m.prototype.componentDidMount=function(){var n=this.props.callModel;if(n)this.$FBRTCView1=n.addListener(function(){return this.forceUpdate();}.bind(this));};m.prototype.componentWillUnmount=function(){if(this.$FBRTCView1)this.$FBRTCView1.remove();};function m(){i.apply(this,arguments);}m.propTypes={callModel:k.instanceOf(c('FBRTCCallModel')).isRequired,messengerUI:k.bool.isRequired,excludeSelfView:k.bool};f.exports=m;}),null);
__d('FBRTCApplication',['PageHooks','Bootloader','FBRTCCallController','FBRTCConfig','FBRTCLogger','FBRTCSupport','FBRTCUtils','FBRTCView.react','React','ReactDOM'],(function a(b,c,d,e,f,g){if(!window.PageHooks)c('PageHooks');var h={init:function i(j,k,l,m,n,o,p){o=o||document.getElementById('fbRTC/container');var q=c('FBRTCLogger').getInstance();q.logInfo(j,k,'Starting Call Controller');document.documentElement.style.overflow='hidden';if(!c('FBRTCSupport').isWebrtcSupported()){q.logError(j,k,'Webrtc not supported');}else if(c('FBRTCUtils').isVCEndpointCallable(j)&&!c('FBRTCSupport').isCollabSupported()){q.logError(j,k,'browser not supported by collab');c('Bootloader').loadModules(["FBRTCUnsupportedBrowserMessage"],function(s){s.showForUnsupportedCollabCall();},'FBRTCApplication');document.getElementById('fbRTC/scrollBox').style.display='none';}else{var r=new (c('FBRTCCallController'))(j,k,l,n);c('ReactDOM').render(c('React').createElement(c('FBRTCView.react'),{callModel:r.getCallModel(),messengerUI:c('FBRTCConfig').useMessengerCallUI()}),o);}}};f.exports=h;}),null);