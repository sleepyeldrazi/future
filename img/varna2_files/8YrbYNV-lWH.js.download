if (self.CavalryLogger) { CavalryLogger.start_js(["GplOS"]); }

__d('MessengerRTCGroupCallIncomingDialog.react',['cx','fbt','Facepile.react','ImageBlock.react','ImmutableObject','MessengerActions','MessengerContactImage.react','MessengerDialog.react','messengerDialogBodyReact','MessengerDialogButton.react','MessengerDialogFooter.react','MessengerDialogHeader.react','React'],(function a(b,c,d,e,f,g,h,i){'use strict';var j=c('messengerDialogBodyReact').comp,k=c('React').PropTypes,l=400,m=5,n=50,o=function u(v){var w=v.hasVideo,x=v.caller,y=v.callees,z=v.onAnswer,aa=v.onIgnore;return (c('React').createElement(c('MessengerDialog.react'),{layerHideOnBlur:false,shown:true,onToggle:function ba(ca){return t(ca,aa);},width:l},c('React').createElement(p,{hasVideo:w}),c('React').createElement(q,{hasVideo:w,caller:x,callees:y}),c('React').createElement(c('MessengerDialogFooter.react'),null,c('React').createElement(c('MessengerDialogButton.react'),{label:i._("Ignore"),onClick:function ba(){return r(aa);},type:'secondary'}),c('React').createElement(c('MessengerDialogButton.react'),{label:i._("Answer Call"),onClick:function ba(){return s(z);},type:'primary'}))));},p=function u(v){var w=v.hasVideo;return (c('React').createElement(c('MessengerDialogHeader.react'),null,w?i._("Incoming group video chat"):i._("Incoming group call")));},q=function u(v){var w=v.hasVideo,x=v.caller,y=v.callees;return (c('React').createElement(j,null,c('React').createElement(c('ImageBlock.react'),null,c('React').createElement(c('MessengerContactImage.react'),{isMessengerUser:x.is_messenger_user,size:n,src:x.big_image_src||x.image_src}),c('React').createElement('div',{className:"_2n1r"},c('React').createElement('div',{className:"_2n1s"},w?i._("{caller name} started a group video chat in a group you're a member of.",[i.param('caller name',x.name)]):i._("{caller name} started a group call in a group you're a member of.",[i.param('caller name',x.name)])),c('React').createElement(c('Facepile.react'),{moreCount:Math.max(0,y.length-m),profiles:y.map(function(z){var aa=z.name,ba=z.fbid,ca=z.big_image_src;return {name:aa,uniqueID:ba,profilePicURI:ca};}).slice(0,m),size:'medium'}),c('React').createElement('div',{className:"_2n1t"},w?i._("Video will start as soon as you answer."):i._("The call will start as soon as you answer."))))));},r=function u(v){c('MessengerActions').hideDialog(o);v();},s=function u(v){c('MessengerActions').hideDialog(o);v();},t=function u(v,w){if(!v){c('MessengerActions').hideDialog(o);w();}};o.propTypes={caller:k.instanceOf(c('ImmutableObject')).isRequired,callees:k.arrayOf(k.instanceOf(c('ImmutableObject'))).isRequired,hasVideo:k.bool.isRequired,onAnswer:k.func.isRequired,onIgnore:k.func.isRequired};f.exports=o;}),null);
__d('MessengerRTCGroupCallIncomingDialogController',['EventEmitter','FBRTCSoundController','MercuryIDs','MercuryParticipants','MessengerActions','MessengerRTCGroupCallIncomingDialog.react','XGroupCallController','randomInt','setTimeoutAcrossTransitions'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=70000;h=babelHelpers.inherits(k,c('EventEmitter'));i=h&&h.prototype;function k(l,m,n,o,p,q){i.constructor.call(this);this.$MessengerRTCGroupCallIncomingDialogController1=l;this.$MessengerRTCGroupCallIncomingDialogController2=m;this.$MessengerRTCGroupCallIncomingDialogController3=n;this.$MessengerRTCGroupCallIncomingDialogController4=o;this.$MessengerRTCGroupCallIncomingDialogController5=p;this.$MessengerRTCGroupCallIncomingDialogController6=q;this.$MessengerRTCGroupCallIncomingDialogController7=null;}k.prototype.serverInfoData=function(){return this.$MessengerRTCGroupCallIncomingDialogController6;};k.prototype.showIncomingDialog=function(){this.$MessengerRTCGroupCallIncomingDialogController7=c('setTimeoutAcrossTransitions')(this.$MessengerRTCGroupCallIncomingDialogController8.bind(this),j);var l=this.$MessengerRTCGroupCallIncomingDialogController1+c('randomInt')(0,4294967295).toString();c('FBRTCSoundController').playIncomingRingtone(l,this.$MessengerRTCGroupCallIncomingDialogController1,true);var m=[this.$MessengerRTCGroupCallIncomingDialogController3].concat(this.$MessengerRTCGroupCallIncomingDialogController4);c('MercuryParticipants').getMulti(m.map(c('MercuryIDs').getParticipantIDFromUserID),function(n){return c('MessengerActions').showDialog(c('MessengerRTCGroupCallIncomingDialog.react'),{caller:n[c('MercuryIDs').getParticipantIDFromUserID(this.$MessengerRTCGroupCallIncomingDialogController3)],callees:Object.values(n).filter(function(o){var p=o.fbid;return (p!==this.$MessengerRTCGroupCallIncomingDialogController3);}.bind(this)),hasVideo:this.$MessengerRTCGroupCallIncomingDialogController5,onAnswer:function(){return this.$MessengerRTCGroupCallIncomingDialogController9();}.bind(this),onIgnore:function(){return this.$MessengerRTCGroupCallIncomingDialogController10();}.bind(this)});}.bind(this));};k.prototype.cancel=function(){if(this.$MessengerRTCGroupCallIncomingDialogController7)clearTimeout(this.$MessengerRTCGroupCallIncomingDialogController7);c('MessengerActions').hideDialog(c('MessengerRTCGroupCallIncomingDialog.react'));c('FBRTCSoundController').stopIncomingRingtone();};k.prototype.$MessengerRTCGroupCallIncomingDialogController9=function(){this.cancel();var l=c('XGroupCallController').getURIBuilder().setString('conference_name',this.$MessengerRTCGroupCallIncomingDialogController1).setInt('call_id',this.$MessengerRTCGroupCallIncomingDialogController2).setBool('has_video',this.$MessengerRTCGroupCallIncomingDialogController5).setString('server_info_data',this.$MessengerRTCGroupCallIncomingDialogController6).getURI();this.emit('answerCall',this.$MessengerRTCGroupCallIncomingDialogController1,l);};k.prototype.$MessengerRTCGroupCallIncomingDialogController10=function(){this.cancel();this.emit('ignoreCall');};k.prototype.$MessengerRTCGroupCallIncomingDialogController8=function(){this.cancel();this.emit('timeout');};f.exports=k;}),null);
__d("XGroupCallIncomingDialogController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/groupcall\/incoming\/",{conference_name:{type:"String",required:true},call_id:{type:"Int"},caller_id:{type:"FBID",required:true},users_to_ring:{type:"FBIDSet",defaultValue:[]},has_video:{type:"Bool",defaultValue:false},server_info_data:{type:"String",required:true},__asyncDialog:{type:"Int"}});}),null);
__d('FBRTCGroupCallIncomingDialog',['AsyncDialog','AsyncRequest','Dialog','setTimeoutAcrossTransitions','XGroupCallIncomingDialogController','FBRTCSoundController','randomInt','EventEmitter'],(function a(b,c,d,e,f,g){var h,i,j=70000;h=babelHelpers.inherits(k,c('EventEmitter'));i=h&&h.prototype;function k(l,m,n,o,p,q){'use strict';i.constructor.call(this);this.$FBRTCGroupCallIncomingDialog1=l;this.$FBRTCGroupCallIncomingDialog2=m;this.$FBRTCGroupCallIncomingDialog3=n;this.$FBRTCGroupCallIncomingDialog4=o;this.$FBRTCGroupCallIncomingDialog5=p;this.$FBRTCGroupCallIncomingDialog6=q;this.$FBRTCGroupCallIncomingDialog7=null;this.$FBRTCGroupCallIncomingDialog8=null;this.$FBRTCGroupCallIncomingDialog9=null;}k.prototype.serverInfoData=function(){'use strict';return this.$FBRTCGroupCallIncomingDialog6;};k.prototype.showIncomingDialog=function(){'use strict';var l=c('Dialog').getCurrent();if(l)l.hide();var m=c('XGroupCallIncomingDialogController').getURIBuilder().setString('conference_name',this.$FBRTCGroupCallIncomingDialog1).setInt('call_id',this.$FBRTCGroupCallIncomingDialog2).setFBID('caller_id',this.$FBRTCGroupCallIncomingDialog3).setFBIDSet('users_to_ring',this.$FBRTCGroupCallIncomingDialog4).setBool('has_video',this.$FBRTCGroupCallIncomingDialog5).setString('server_info_data',this.$FBRTCGroupCallIncomingDialog6).getURI();this.$FBRTCGroupCallIncomingDialog7=new (c('AsyncRequest'))(m);c('AsyncDialog').send(this.$FBRTCGroupCallIncomingDialog7,this.$FBRTCGroupCallIncomingDialog10.bind(this));};k.prototype.$FBRTCGroupCallIncomingDialog10=function(l){'use strict';if(!this.$FBRTCGroupCallIncomingDialog7){setTimeout(function(){l.hide();},1);return;}this.$FBRTCGroupCallIncomingDialog7=null;this.$FBRTCGroupCallIncomingDialog8=l;l.subscribe('confirm',this.$FBRTCGroupCallIncomingDialog11.bind(this));l.subscribe('cancel',this.$FBRTCGroupCallIncomingDialog12.bind(this));var m=this.$FBRTCGroupCallIncomingDialog1+c('randomInt')(0,4294967295).toString();c('FBRTCSoundController').playIncomingRingtone(m,this.$FBRTCGroupCallIncomingDialog1,true);this.$FBRTCGroupCallIncomingDialog9=c('setTimeoutAcrossTransitions')(this.$FBRTCGroupCallIncomingDialog13.bind(this),j);};k.prototype.cancel=function(){'use strict';if(this.$FBRTCGroupCallIncomingDialog7){this.$FBRTCGroupCallIncomingDialog7.abort();this.$FBRTCGroupCallIncomingDialog7=null;}if(this.$FBRTCGroupCallIncomingDialog9)clearTimeout(this.$FBRTCGroupCallIncomingDialog9);if(this.$FBRTCGroupCallIncomingDialog8){this.$FBRTCGroupCallIncomingDialog8.hide();this.$FBRTCGroupCallIncomingDialog8=null;}c('FBRTCSoundController').stopIncomingRingtone();};k.prototype.$FBRTCGroupCallIncomingDialog11=function(l,m){'use strict';this.cancel();this.emit('answerCall',this.$FBRTCGroupCallIncomingDialog1,m.value);};k.prototype.$FBRTCGroupCallIncomingDialog12=function(){'use strict';this.cancel();this.emit('ignoreCall');};k.prototype.$FBRTCGroupCallIncomingDialog13=function(){'use strict';this.cancel();this.emit('timeout');};f.exports=k;}),null);
__d('FBRTCGroupCallIncomingController',['FBRTCCallSummary','FBRTCCallSummaryStore','FBRTCConstants','FBRTCGroupCallIncomingDialog','FBRTCSupport','MessengerRTCGroupCallIncomingDialogController','MessengerRTCGroupCallUnsupportedBrowserDialogController','MultiwayTypes','RTCMWProtocolHandler','RTCUtils','FBRTCCallUIWrapper','FBRTCTransactions','RTCConfig','FBRTCMultiwayMessage'],(function a(b,c,d,e,f,g){var h,i,j=c('FBRTCTransactions').FBRTCTransactionOwner,k=c('FBRTCTransactions').FBRTCServerTransaction,l=c('MultiwayTypes').HangupReason,m=c('MultiwayTypes').Capability,n=c('MultiwayTypes').RtcResponseStatusCode,o=c('MultiwayTypes').DeviceStatus,p=c('MultiwayTypes').RingType;h=babelHelpers.inherits(q,j);i=h&&h.prototype;function q(r){'use strict';i.constructor.call(this);this.$FBRTCGroupCallIncomingController1=r;this.$FBRTCGroupCallIncomingController2=null;}q.prototype.onMessageReceived=function(r){'use strict';var s=new (c('FBRTCMultiwayMessage'))(r),t=this.getTransaction(s);t.start().then(function(u){if(u!=null)if(u.ringRequest()!=null){if(u.conferenceName().split(':')[0]==='PEER'&&!c('RTCConfig').RTCConferencingP2PCanReceiveGK)return;var v=c('RTCUtils').generateRandomInt(),w=new (c('FBRTCCallSummary'))({peerID:-1,callID:v,isCaller:false});if(!c('FBRTCSupport').isGroupCallWebtrcSupported()){w.onCallEnded(c('FBRTCConstants').CallEndReason.UNSUPPORTED_VERSION,false);w.save(c('FBRTCCallSummaryStore').getInstance());c('MessengerRTCGroupCallUnsupportedBrowserDialogController').render();return;}t.sendResponse(this.handleRingRequest(u,v,w));}else if(u.dismissRequest()!=null)t.sendResponse(this.handleDismissRequest(u));}.bind(this),function(u){}).done();};q.prototype.cancelIncomingCallDialog=function(){'use strict';if(this.$FBRTCGroupCallIncomingController2){this.$FBRTCGroupCallIncomingController2.cancel();this.$FBRTCGroupCallIncomingController2=null;}};q.prototype.handleDismissRequest=function(r){'use strict';c('MessengerRTCGroupCallUnsupportedBrowserDialogController').unmount();if(this.$FBRTCGroupCallIncomingController2){var s=this.$FBRTCGroupCallIncomingController2.serverInfoData();if(s==r.serverInfoData())this.cancelIncomingCallDialog();}return r.createResponse(n.OK,{});};q.prototype.handleRingRequest=function(r,s,t){'use strict';var u=r.ringRequest(),v=r.serverInfoData();if(u==null||v==null)return r.createResponse(n.BAD_REQUEST);var w=u.caller,x=u.otherParticipants,y=c('RTCConfig').RtcConferencingVideoGK&&(u.ringType==p.GROUP_VIDEO_CALL||u.ringType==p.PEER_VIDEO_CALL),z=new this.$FBRTCGroupCallIncomingController1(r.conferenceName(),s,w,x,y,v);z.addListener('answerCall',function(ba,ca){c('FBRTCCallUIWrapper').openGroupCallURI(ba,s,y,v,'answer button',t);});z.addListener('ignoreCall',function(){c('RTCMWProtocolHandler').endCall(r.conferenceName(),v,l.IGNORE_CALL);t.onCallEnded(c('FBRTCConstants').CallEndReason.IGNORE_CALL,false);t.save(c('FBRTCCallSummaryStore').getInstance());this.cancelIncomingCallDialog();}.bind(this));z.addListener('timeout',function(){c('RTCMWProtocolHandler').endCall(r.conferenceName(),v,l.NO_ANSWER_TIMEOUT);t.onCallEnded(c('FBRTCConstants').CallEndReason.NO_ANSWER_TIMEOUT,false);t.save(c('FBRTCCallSummaryStore').getInstance());this.cancelIncomingCallDialog();}.bind(this));this.$FBRTCGroupCallIncomingController2=z;z.showIncomingDialog();var aa={deviceCapabilities:[m.SUPPORT_AUDIO,m.SUPPORT_VIDEO],deviceStatus:o.OK};return r.createResponse(n.OK,{ringResponse:aa});};f.exports=q;}),null);