if (self.CavalryLogger) { CavalryLogger.start_js(["MOjBh"]); }

__d('ConversationNubTabsUpdateEventController',['Arbiter'],(function a(b,c,d,e,f,g){'use strict';var h='ConversationNub/tabsUpdated',i='ConversationNub/minimizedByUser',j='ConversationNub/maximizedByUser',k=false;function l(p){if(!k)c('Arbiter').inform(h,p);}function m(p){return c('Arbiter').subscribe(h,function(q,r){k=true;p(r);k=false;});}function n(p,q){q&&c('Arbiter').inform(i,{tab:p});p.minimize();l();}function o(p,q){q&&c('Arbiter').inform(j,{tab:p});p.popOut();l();}f.exports={TAB_MINIMIZED_BY_USER_EVENT:i,TAB_MAXIMIZED_BY_USER_EVENT:j,informTabsUpdated:l,subscribeToTabsUpdated:m,minimizeAndInformTabUpdate:n,popOutAndInformTabUpdate:o};}),null);
__d('ConversationNub',['csx','cx','Arbiter','ConversationNubHeader','ConversationNubTabsUpdateEventController','ConversationNubUtils','NotificationUserActions','PinnedConversationNubsConfig','CSS','DOM','EventListener','ConversationNubTabState','SubscriptionsHandler','URI','debounce','guid'],(function a(b,c,d,e,f,g,h,i){'use strict';var j=c('ConversationNubTabState').getConversationNubTabState,k=c('ConversationNubTabsUpdateEventController').minimizeAndInformTabUpdate,l=c('ConversationNubTabsUpdateEventController').popOutAndInformTabUpdate,m=j(),n=10,o=500,p=100;q.createDefaultState=function(r,s,t,u,v,w){return {tabID:r,permalinkURI:s?new (c('URI'))(s):null,ftID:t,notifAlertID:u,title:v,keepAtBottom:false,isTabRaised:false,isBlinkingUnread:false,badgeCount:0,shouldShowNux:w===true,allSeenNewComments:{},unseenCommentsSinceLastCleared:{},hasFakeInitBadge:false};};function q(r,s,t){this.$ConversationNub1=r;this.$ConversationNub8=s;this.$ConversationNub4=c('guid')();this.$ConversationNub6=null;this.$ConversationNub7=null;this.$ConversationNub5=new (c('SubscriptionsHandler'))();this.$ConversationNub9();this.$ConversationNub10();if(t!=null)m.modifyTabState(this.$ConversationNub8,function(u){if(t){u.hasFakeInitBadge=false;}else{u.hasFakeInitBadge=true;this.$ConversationNub11(1);this.$ConversationNub12(true);}}.bind(this));this.$ConversationNub13();}q.prototype.$ConversationNub13=function(){this.$ConversationNub14();this.$ConversationNub15();c('ConversationNubUtils').informShouldRecheckTabVisibility(this);this.forceReflow();};q.prototype.getPersistentState=function(){return m.getTabState(this.$ConversationNub8);};q.prototype.$ConversationNub9=function(){var r=this.$ConversationNub16();if(r){this.$ConversationNub5.addSubscriptions(c('EventListener').listen(r,'click',this.$ConversationNub17.bind(this)),c('EventListener').listen(r,'mouseenter',this.$ConversationNub18.bind(this)),c('EventListener').listen(r,'mouseleave',this.$ConversationNub19.bind(this)));var s=c('ConversationNubUtils').getCloseButtonElem(r);if(s)c('ConversationNubUtils').addCloseButtonListeners(s,this.$ConversationNub5,this.$ConversationNub20.bind(this));}var t=this.$ConversationNub21();if(t){m.modifyTabState(this.$ConversationNub8,function(u){u.keepAtBottom=true;});this.$ConversationNub5.addSubscriptions(c('EventListener').listen(t,'scroll',c('debounce')(this.$ConversationNub22.bind(this),p)),c('Arbiter').subscribe('reflow',this.$ConversationNub23.bind(this)));}};q.prototype.$ConversationNub10=function(){var r=this.$ConversationNub24();if(!r){this.$ConversationNub2=null;return;}var s=function(){var u=this.getPersistentState();return {permalinkURI:u.permalinkURI,ftID:u.ftID,tabID:u.tabID};}.bind(this),t=new (c('ConversationNubHeader'))(r,s);this.$ConversationNub5.addSubscriptions(t.subscribe('closeButton',this.$ConversationNub20.bind(this)),t.subscribe('showMenu',this.$ConversationNub25.bind(this)),t.subscribe('hideMenu',this.$ConversationNub26.bind(this)),t.subscribe('minimizeButton',this.$ConversationNub27.bind(this,true)),t.subscribe('clickHeader',this.$ConversationNub27.bind(this,true)),t.subscribe('menuPermalinkClick',this.$ConversationNub27.bind(this,false)));this.$ConversationNub2=t;};q.prototype.$ConversationNub24=function(){return this.$ConversationNub1&&c('DOM').scry(this.$ConversationNub1,".fbNubFlyoutTitlebar")[0];};q.prototype.$ConversationNub16=function(){return this.$ConversationNub1&&c('DOM').scry(this.$ConversationNub1,".fbNubButton")[0];};q.prototype.$ConversationNub21=function(){if(!this.$ConversationNub3&&this.$ConversationNub1)this.$ConversationNub3=c('DOM').scry(this.$ConversationNub1,".uiScrollableAreaWrap")[0];return this.$ConversationNub3;};q.prototype.$ConversationNub28=function(){var r=this.$ConversationNub16();if(r)return c('DOM').scry(r,"._37op")[0];return null;};q.prototype.$ConversationNub20=function(){c('ConversationNubUtils').informShouldCloseTab(this.$ConversationNub8,c('ConversationNubUtils').CLOSE_REASON_TAB_X_OUT);};q.prototype.$ConversationNub27=function(r){k(this,r);};q.prototype.$ConversationNub25=function(){this.$ConversationNub1&&c('CSS').addClass(this.$ConversationNub1,"_1uw3");};q.prototype.$ConversationNub26=function(){this.$ConversationNub1&&c('CSS').removeClass(this.$ConversationNub1,"_1uw3");};q.prototype.$ConversationNub17=function(){if(this.getPersistentState().isTabRaised){k(this,true);}else l(this,true);};q.prototype.$ConversationNub18=function(){if(this.getPersistentState().isBlinkingUnread)this.$ConversationNub7=new Date();};q.prototype.$ConversationNub19=function(){var r=this.$ConversationNub7;if(r&&this.getPersistentState().isBlinkingUnread){var s=new Date();if(s-r>=o)this.$ConversationNub12(false);}this.$ConversationNub7=null;};q.prototype.$ConversationNub29=function(){var r=this.$ConversationNub21();if(r){var s=r.scrollHeight;if(s>0&&!this.$ConversationNub30(r))r.scrollTop=s;}};q.prototype.$ConversationNub30=function(r){r=r||this.$ConversationNub21();return !!(r&&r.scrollTop>=r.scrollHeight-r.clientHeight-n);};q.prototype.$ConversationNub22=function(){if(!this.getPersistentState().isTabRaised)return;m.modifyTabState(this.$ConversationNub8,function(r){r.keepAtBottom=this.$ConversationNub30();c('ConversationNubUtils').informShouldRecheckTabVisibility(this);}.bind(this));};q.prototype.$ConversationNub23=function(){var r=this.getPersistentState();if(!r.isTabRaised)return;if(r.keepAtBottom){this.$ConversationNub29();this.$ConversationNub6&&clearTimeout(this.$ConversationNub6);this.$ConversationNub6=setTimeout(function(){if(r.keepAtBottom)this.$ConversationNub29();}.bind(this),100);}};q.prototype.$ConversationNub11=function(r){m.modifyTabState(this.$ConversationNub8,function(s){s.badgeCount=r;this.$ConversationNub14();}.bind(this));};q.prototype.$ConversationNub12=function(r){m.modifyTabState(this.$ConversationNub8,function(s){s.isBlinkingUnread=r;this.$ConversationNub15();}.bind(this));};q.prototype.$ConversationNub14=function(){var r=this.$ConversationNub28();if(!r)return;var s=this.getPersistentState().badgeCount,t=s>0;if(t){c('DOM').setContent(r,s);c('CSS').show(r);}else{c('CSS').hide(r);c('DOM').setContent(r,s);}};q.prototype.$ConversationNub15=function(){if(this.$ConversationNub1){var r=this.getPersistentState().isBlinkingUnread;c('CSS').conditionClass(this.$ConversationNub1,"_53tf",r);}};q.prototype.getRootDOM=function(){return this.$ConversationNub1;};q.prototype.getShouldShowNux=function(){return this.getPersistentState().shouldShowNux;};q.prototype.getTabID=function(){return this.$ConversationNub8;};q.prototype.getNotificationAlertID=function(){return this.getPersistentState().notifAlertID;};q.prototype.getFeedbackTargetID=function(){return this.getPersistentState().ftID;};q.prototype.getPermalinkURI=function(){return this.getPersistentState().permalinkURI;};q.prototype.getTitle=function(){return this.getPersistentState().title;};q.prototype.getBadgeCount=function(){return this.getPersistentState().badgeCount;};q.prototype.getIsRaised=function(){return this.getPersistentState().isTabRaised;};q.prototype.getSessionID=function(){return this.$ConversationNub4;};q.prototype.markCommentsAsSeenWithoutBadging=function(r){m.modifyTabState(this.$ConversationNub8,function(s){r.forEach(function(t){s.allSeenNewComments[t]=true;});});};q.prototype.attemptAddNewCommentsToBadge=function(r){m.modifyTabState(this.$ConversationNub8,function(s){r.forEach(function(v){if(s.allSeenNewComments[v])return;s.allSeenNewComments[v]=true;s.unseenCommentsSinceLastCleared[v]=true;});var t=Object.keys(s.unseenCommentsSinceLastCleared).length;if(s.hasFakeInitBadge)t+=1;var u=s.badgeCount;this.$ConversationNub11(t);this.$ConversationNub12(t>0&&t>u);}.bind(this));};q.prototype.clearBadge=function(){m.modifyTabState(this.$ConversationNub8,function(s){s.unseenCommentsSinceLastCleared={};s.hasFakeInitBadge=false;this.$ConversationNub11(0);this.$ConversationNub12(false);}.bind(this));if(c('PinnedConversationNubsConfig').sharedNotificationsReadStateEnabled){var r=this.getNotificationAlertID();if(r)c('NotificationUserActions').markNotificationsAsRead([r]);}};q.prototype.popOutAndInformTabUpdate=function(){this.popOut();c('ConversationNubTabsUpdateEventController').informTabsUpdated();};q.prototype.popOut=function(){m.modifyTabState(this.$ConversationNub8,function(r){if(this.$ConversationNub1)c('CSS').addClass(this.$ConversationNub1,"_5r93");r.isTabRaised=true;this.clearBadge();if(r.keepAtBottom)this.$ConversationNub29();}.bind(this));};q.prototype.minimize=function(){m.modifyTabState(this.$ConversationNub8,function(r){if(this.$ConversationNub1)c('CSS').removeClass(this.$ConversationNub1,"_5r93");r.isTabRaised=false;this.$ConversationNub2&&this.$ConversationNub2.hideMenu();this.clearBadge();}.bind(this));};q.prototype.forceReflow=function(){this.$ConversationNub23();};q.prototype.destroy=function(){this.minimize();this.$ConversationNub5.release();this.$ConversationNub2&&this.$ConversationNub2.destroy();this.$ConversationNub2=null;this.$ConversationNub6&&clearTimeout(this.$ConversationNub6);if(this.$ConversationNub1){c('DOM').remove(this.$ConversationNub1);c('Arbiter').inform('ConversationNub/destroy',{root:this.$ConversationNub1});this.$ConversationNub1=null;}};f.exports=q;}),null);
__d('ConversationNubHeader',['csx','ArbiterMixin','Bootloader','ConversationNubUtils','DOM','Event','EventListener','Keys','SubscriptionsHandler','ifRequired','mixin'],(function a(b,c,d,e,f,g,h){'use strict';var i,j;function k(m,n){return c('EventListener').listen(m,'keydown',function(o){if(c('Event').getKeyCode(o)===c('Keys').RETURN)n(o);});}i=babelHelpers.inherits(l,c('mixin')(c('ArbiterMixin')));j=i&&i.prototype;function l(m,n){j.constructor.call(this);this.$ConversationNubHeader1=m;this.$ConversationNubHeader3=n;this.$ConversationNubHeader4=null;this.$ConversationNubHeader5=false;this.$ConversationNubHeader2=new (c('SubscriptionsHandler'))();this.$ConversationNubHeader6();}l.prototype.$ConversationNubHeader6=function(){var m=this.$ConversationNubHeader1;this.$ConversationNubHeader2.addSubscriptions(c('EventListener').listen(m,'click',this.$ConversationNubHeader7.bind(this)));var n=c('ConversationNubUtils').getCloseButtonElem(m);if(n)c('ConversationNubUtils').addCloseButtonListeners(n,this.$ConversationNubHeader2,this.$ConversationNubHeader8.bind(this));var o=this.$ConversationNubHeader9();if(o)this.$ConversationNubHeader2.addSubscriptions(c('EventListener').listen(o,'click',this.$ConversationNubHeader10.bind(this)),k(o,this.$ConversationNubHeader10.bind(this)));var p=this.$ConversationNubHeader11();if(p)this.$ConversationNubHeader2.addSubscriptions(c('EventListener').listen(p,'click',this.$ConversationNubHeader12.bind(this)),c('EventListener').listen(p,'mouseover',this.$ConversationNubHeader13.bind(this)),c('EventListener').listen(p,'focus',this.$ConversationNubHeader14.bind(this)),k(p,this.$ConversationNubHeader15.bind(this)));};l.prototype.$ConversationNubHeader11=function(){return c('DOM').scry(this.$ConversationNubHeader1,"._1rf1")[0];};l.prototype.$ConversationNubHeader9=function(){return c('DOM').scry(this.$ConversationNubHeader1,"._4a56")[0];};l.prototype.$ConversationNubHeader16=function(){return c('ConversationNubUtils').getCloseButtonElem(this.$ConversationNubHeader1);};l.prototype.$ConversationNubHeader8=function(){this.inform('closeButton');};l.prototype.$ConversationNubHeader10=function(m){if(m.type==='click')m.kill();this.inform('minimizeButton');};l.prototype.$ConversationNubHeader7=function(){this.inform('clickHeader');};l.prototype.$ConversationNubHeader17=function(){this.inform('showMenu');};l.prototype.$ConversationNubHeader18=function(){this.inform('hideMenu');var m=this.$ConversationNubHeader11();m&&m.blur();};l.prototype.$ConversationNubHeader19=function(){this.inform('menuPermalinkClick');};l.prototype.$ConversationNubHeader20=function(m){if(this.$ConversationNubHeader4)return;var n=this.$ConversationNubHeader11();if(!n)return;if(m)this.$ConversationNubHeader5=true;c('Bootloader').loadModules(["React","ReactDOM","ConversationNubHeaderMenu.react"],function(o,p,q){var r=babelHelpers['extends']({},this.$ConversationNubHeader3(),{onMenuShow:this.$ConversationNubHeader17.bind(this),onMenuHide:this.$ConversationNubHeader18.bind(this),onPermalinkClick:this.$ConversationNubHeader19.bind(this),showOnMount:this.$ConversationNubHeader5});this.$ConversationNubHeader4=p.render(o.createElement(q,r),n);}.bind(this),'ConversationNubHeader');};l.prototype.$ConversationNubHeader12=function(m){m.kill();this.$ConversationNubHeader20(true);};l.prototype.$ConversationNubHeader13=function(){this.$ConversationNubHeader20(false);};l.prototype.$ConversationNubHeader14=function(){this.$ConversationNubHeader20(false);};l.prototype.$ConversationNubHeader15=function(){if(this.$ConversationNubHeader4){this.$ConversationNubHeader4.toggle();}else this.$ConversationNubHeader20(true);};l.prototype.hideMenu=function(){this.$ConversationNubHeader4&&this.$ConversationNubHeader4.hide();};l.prototype.destroy=function(){var m=this.$ConversationNubHeader11();if(m&&this.$ConversationNubHeader4)c('ifRequired')('ReactDOM',function(n){n.unmountComponentAtNode(m);});this.$ConversationNubHeader2.release();};f.exports=l;}),null);
__d('PersistedStore',['invariant','WebStorage','areEqual','deepFreezeValue'],(function a(b,c,d,e,f,g,h){'use strict';function i(j){var k=j.initialValue,l=j.storageKeyPrefix,m=j.serializer,n=j.deserializer,o=j.onDataUpdatedOutOfBand,p=j.enablePersistence,q=p===undefined?true:p;this.$PersistedStore4=0;if(q)this.$PersistedStore6=c('WebStorage').getLocalStorage();this.$PersistedStore1=k;this.$PersistedStore3=l;this.$PersistedStore5=l+'.PersistedStoreMetadata';this.$PersistedStore7=m;this.$PersistedStore8=n;this.$PersistedStore9=o;this.reloadFromStorageIfNecessary();}i.prototype.$PersistedStore10=function(j){var k=JSON.stringify(this.$PersistedStore7(j));return this.$PersistedStore8(JSON.parse(k));};i.prototype.$PersistedStore11=function(){return this.$PersistedStore10(this.$PersistedStore1);};i.prototype.isPersisted=function(){return this.$PersistedStore6!=null;};i.prototype.modify=function(j){if(!this.isPersisted()){this.$PersistedStore1=j(this.$PersistedStore1);}else if(this.$PersistedStore2){this.$PersistedStore2=j(this.$PersistedStore2);}else{var k=void 0;try{this.$PersistedStore2=this.$PersistedStore11();k=j(this.$PersistedStore2);}finally{this.$PersistedStore2=null;}if(k&&!c('areEqual')(this.$PersistedStore1,k)){this.$PersistedStore1=k;this.$PersistedStore12();}}};i.prototype.getData=function(){var j=this.$PersistedStore2?this.$PersistedStore10(this.$PersistedStore2):this.$PersistedStore11();c('deepFreezeValue')(j);return j;};i.prototype.$PersistedStore13=function(j){if(this.$PersistedStore6!=null)if(j>i.VERSION){this.$PersistedStore6=null;}else if(j<i.VERSION){this.$PersistedStore6.removeItem(this.$PersistedStore5);this.$PersistedStore6.removeItem(this.$PersistedStore3);}else return true;return false;};i.prototype.$PersistedStore14=function(){try{if(this.$PersistedStore6!=null){var k=this.$PersistedStore6.getItem(this.$PersistedStore5);if(k!=null){var l=JSON.parse(k),m=Number.parseInt(l.highWaterMark,10),n=Number.parseInt(l.version,10);if(m&&n)return {highWaterMark:m,version:n};}}}catch(j){this.$PersistedStore6=null;}return null;};i.prototype.reloadFromStorageIfNecessary=function(){if(!this.isPersisted())return;var j=this.$PersistedStore14();if(j){var k=j.highWaterMark,l=j.version;if(this.$PersistedStore13(l)&&this.$PersistedStore4<k)this.$PersistedStore15(k);}};i.prototype.$PersistedStore15=function(j){var k=this.$PersistedStore16();if(k)this.$PersistedStore17(k,j);};i.prototype.$PersistedStore16=function(){var j=null;try{if(this.$PersistedStore6){var l=this.$PersistedStore6.getItem(this.$PersistedStore3);if(l!=null)j=JSON.parse(l);}}catch(k){this.$PersistedStore6=null;}return j;};i.prototype.$PersistedStore17=function(j,k){var l=this.$PersistedStore8(j),m=this.$PersistedStore1;this.$PersistedStore1=l;this.$PersistedStore4=k;this.$PersistedStore9(m,l);};i.prototype.$PersistedStore12=function(){this.reloadFromStorageIfNecessary();if(!this.isPersisted())return;var j=this.$PersistedStore7(this.$PersistedStore1),k=JSON.stringify(j),l={highWaterMark:++this.$PersistedStore4,version:i.VERSION},m=JSON.stringify(l);try{this.$PersistedStore6!=null||h(0);this.$PersistedStore6.setItem(this.$PersistedStore5,m);this.$PersistedStore6.setItem(this.$PersistedStore3,k);}catch(n){this.$PersistedStore6=null;}};i.VERSION=24;f.exports=i;}),null);
__d('filterSet',['Set'],(function a(b,c,d,e,f,g){'use strict';function h(i,j){var k=new (c('Set'))();for(var l=i,m=Array.isArray(l),n=0,l=m?l:l[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var o;if(m){if(n>=l.length)break;o=l[n++];}else{n=l.next();if(n.done)break;o=n.value;}var p=o;if(j(p))k.add(p);}return k;}f.exports=h;}),null);
__d('differenceSets',['filterSet'],(function a(b,c,d,e,f,g){'use strict';function h(i){for(var j=arguments.length,k=Array(j>1?j-1:0),l=1;l<j;l++)k[l-1]=arguments[l];return c('filterSet')(i,function(m){return !k.some(function(n){return n.has(m);});});}f.exports=h;}),null);
__d('ConversationNubTabStateList',['invariant','PersistedStore','PinnedConversationNubsConfig','Set','URI','differenceSets'],(function a(b,c,d,e,f,g,h){'use strict';function i(){this.$ConversationNubTabStateList2=new (c('Set'))();this.$ConversationNubTabStateList1=new (c('PersistedStore'))({initialValue:[],storageKeyPrefix:'conversationNubTabState',serializer:i.serializeStateArrayToJson,deserializer:i.deserializeJsonToStateArray,onDataUpdatedOutOfBand:this.$ConversationNubTabStateList3.bind(this),enablePersistence:c('PinnedConversationNubsConfig').persistenceEnabled});}i.prototype.modifyTabState=function(j,k){this.modifyTabs(function(l){var m=l.findIndex(function(n){return n.tabID===j;});m!==-1||h(0);k(l[m]);return l;});};i.prototype.$ConversationNubTabStateList4=function(j){return new (c('Set'))(j.map(function(k){return k.tabID;}));};i.prototype.modifyTabs=function(j){try{this.$ConversationNubTabStateList1.modify(function(k){var l=this.$ConversationNubTabStateList4(k),m=j(k),n=this.$ConversationNubTabStateList4(m);this.$ConversationNubTabStateList2=c('differenceSets')(l,n);return m;}.bind(this));}finally{this.$ConversationNubTabStateList2=new (c('Set'))();}};i.prototype.getTabs=function(){return this.$ConversationNubTabStateList1.getData();};i.prototype.getTabState=function(j){var k=this.getTabStateIfExists(j);k||h(0);return k;};i.prototype.getTabStateIfExists=function(j){return this.getTabs().find(function(k){return k.tabID===j;});};i.prototype.$ConversationNubTabStateList3=function(j,k){var l=j.length!==0,m=this.$ConversationNubTabStateList2.size!==0;if(l||m)this.modifyTabs(function(n){var o=this.$ConversationNubTabStateList4(k),p=this.$ConversationNubTabStateList4(j),q=this.$ConversationNubTabStateList2,r=c('differenceSets')(o,p,q),s=k.filter(function(t){return r.has(t.tabID);});return j.concat(s);}.bind(this));};i.prototype.reloadFromStorageIfNecessary=function(){var j;(j=this.$ConversationNubTabStateList1).reloadFromStorageIfNecessary.apply(j,arguments);};i.serializeStateArrayToJson=function(j){var k=[];if(Array.isArray(j))k=j.map(i.serializeStateToJson).filter(Boolean);return k;};i.serializeStateToJson=function(j){var k=j.permalinkURI?j.permalinkURI.toString():null,l=babelHelpers['extends']({},j,{permalinkURI:k});return l;};i.deserializeJsonToStateArray=function(j){if(Array.isArray(j)){return j.map(i.deserializeJsonToState).filter(Boolean);}else return [];};i.deserializeJsonToState=function(j){if(j!=null&&typeof j.tabID==='string'&&typeof j.ftID==='string'&&typeof j.title==='string'&&typeof j.keepAtBottom==='boolean'&&typeof j.isTabRaised==='boolean'&&typeof j.isBlinkingUnread==='boolean'&&j.allSeenNewComments!=null&&j.allSeenNewComments instanceof Object&&j.unseenCommentsSinceLastCleared!=null&&j.unseenCommentsSinceLastCleared instanceof Object&&typeof j.hasFakeInitBadge==='boolean'&&typeof j.badgeCount==='number'&&typeof j.shouldShowNux==='boolean'&&(j.permalinkURI==null||typeof j.permalinkURI==='string')&&(j.notifAlertID==null||typeof j.notifAlertID==='string')){var k=j.permalinkURI?new (c('URI'))(j.permalinkURI):null,l={tabID:j.tabID,ftID:j.ftID,notifAlertID:j.notifAlertID,title:j.title,keepAtBottom:j.keepAtBottom,isTabRaised:j.isTabRaised,isBlinkingUnread:j.isBlinkingUnread,allSeenNewComments:j.allSeenNewComments,unseenCommentsSinceLastCleared:j.unseenCommentsSinceLastCleared,hasFakeInitBadge:j.hasFakeInitBadge,badgeCount:j.badgeCount,shouldShowNux:j.shouldShowNux,permalinkURI:k};return l;}else return null;};i.prototype.push=function(){for(var j=arguments.length,k=Array(j),l=0;l<j;l++)k[l]=arguments[l];this.modifyTabs(function(m){k.forEach(function(n){if(m.find(function(o){return o.tabID===n.tabID;})){h(0);}else m.push(n);});return m;});};i.prototype.remove=function(j){this.modifyTabs(function(k){var l=k.findIndex(function(m){return m.tabID===j;});if(l!==-1)k.splice(l,1);return k;});};f.exports=i;}),null);
__d('ConversationNubTabState',['invariant','ConversationNub','ConversationNubTabStateList'],(function a(b,c,d,e,f,g,h){'use strict';var i;function j(){this.$ConversationNubTabState1=Object.create(null);this.$ConversationNubTabState2=new (c('ConversationNubTabStateList'))();this.$ConversationNubTabState3=Infinity;}j.prototype.getTabState=function(k){return this.$ConversationNubTabState2.getTabState(k);};j.prototype.getTabStateIfExists=function(k){return this.$ConversationNubTabState2.getTabStateIfExists(k);};j.prototype.getUnloadedTabs=function(){var k=this.$ConversationNubTabState2.getTabs().filter(function(l){return !this.getLoadedTab(l.tabID);}.bind(this));return k;};j.prototype.setMaxDockTabs=function(k){this.$ConversationNubTabState3=k;};j.prototype.getNumDockTabs=function(){var k=this.$ConversationNubTabState3,l=this.getTotalTabCount();return Math.min(k,l);};j.prototype.getNumMenuTabs=function(){return this.getTotalTabCount()-this.getNumDockTabs();};j.prototype.addTabState=function(k){this.$ConversationNubTabState2.push(k);};j.prototype.addLoadedTab=function(k,l){var m=this.getTabState(k);if(!m)return;var n=this.getLoadedTab(k);if(n)return;this.$ConversationNubTabState1[k]=l;};j.prototype.getLoadedTab=function(k){return this.$ConversationNubTabState1[k];};j.prototype.getLoadedTabByFeedbackTarget=function(k){return this.getLoadedTabs().find(function(l){return l.getPersistentState().ftID===k;});};j.prototype.isTabInDock=function(k){var l=this.getLoadedTab(k);if(!l)return false;var m=this.$ConversationNubTabState4(l);return 0<=m&&m<this.getNumDockTabs();};j.prototype.$ConversationNubTabState4=function(k){return this.getLoadedTabs().indexOf(k);};j.prototype.deleteTab=function(k){var l=this.getLoadedTab(k);if(l){delete this.$ConversationNubTabState1[k];l.destroy();}this.$ConversationNubTabState2.remove(k);return Boolean(l);};j.prototype.modifyTabState=function(k,l){return this.$ConversationNubTabState2.modifyTabState(k,l);};j.prototype.moveTabToDockLeft=function(k){var l=this.getLoadedTab(k);if(!l)return;this.$ConversationNubTabState2.modifyTabs(function(m){var n=m.findIndex(function(w){return w.tabID===k;});n!==-1||h(0);var o=m[n],p=this.$ConversationNubTabState4(l),q=this.getLoadedTabs().length,r=this.getNumDockTabs();if(p<0||q===0){return m;}else if(r===0){if(p!==0){m.splice(n,1);m.unshift(o);}return m;}var s=r-1;if(p===s)return m;m.splice(n,1);if(p<s)s-=1;var t=this.getLoadedTabs()[s],u=this.getTabState(t.getTabID());u||h(0);var v=m.findIndex(function(w){return w.tabID===u.tabID;});m.splice(v,0,o);return m;}.bind(this));};j.prototype.getLoadedTabs=function(){var k=this.$ConversationNubTabState2.getTabs().map(function(l){return this.getLoadedTab(l.tabID);}.bind(this)).filter(Boolean);return k;};j.prototype.getUnsortedLoadedTabs=function(){var k=Object.values(this.$ConversationNubTabState1);return k;};j.prototype.getTotalTabCount=function(){return this.getUnsortedLoadedTabs().length;};j.prototype.getTabsForDockOldestFirst=function(){return this.getLoadedTabs().slice(0,this.getNumDockTabs());};j.prototype.getTabsForDockNewestFirst=function(){return this.getTabsForDockOldestFirst().slice().reverse();};j.prototype.getTabsForMenu=function(){return this.getLoadedTabs().slice(this.getNumDockTabs()).reverse();};(function(){var k=void 0;function l(){if(!k)k=new j();return k;}f.exports={getConversationNubTabState:l,ConversationNubTabState:j};})();}),null);
__d("XConversationNubTogglePinController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/ajax\/conversation\/nub_story\/toggle_pin\/",{ft_id:{type:"String"},pin:{type:"Bool",defaultValue:false},with_render:{type:"Bool",defaultValue:false},notif_setting:{type:"Enum",enumType:1}});}),null);
__d("XConversationsToggleController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/ajax\/conversation\/toggle_feature\/",{turn_conversations_on:{type:"Bool",defaultValue:false}});}),null);
__d('ConversationNubUtils',['csx','Arbiter','AsyncFeature','AsyncRequest','DOM','Event','EventListener','ConversationNubTabState','Keys','XConversationNubTogglePinController','XConversationsToggleController'],(function a(b,c,d,e,f,g,h){'use strict';var i=c('ConversationNubTabState').getConversationNubTabState,j=i(),k={DISABLE:'disable',ENABLE:'enable'},l='ConversationNubUtils/closeTab',m='ConversationNubUtils/unpinnedFromHeader',n='ConversationNubUtils/recheckTabVisibility',o='ConversationNubUtils/openPermalinkFromHeader',p='ConversationNubUtils/turnOff',q='ConversationNubUtils/turnOn',r='tab-x-out',s='overflow-x-out',t='unpin';function u(na){var oa=Object.values(k);return oa.find(function(pa){return pa===na;})||null;}function v(na,oa,pa,qa){var ra=qa||{},sa=ra.notif_setting,ta=c('XConversationNubTogglePinController').getURIBuilder().setString('ft_id',String(na)).setBool('pin',oa);if(sa&&c('AsyncFeature').__serverHasFeatureImpl(3))ta.setEnum('notif_setting',sa);var ua=ta.getURI(),va=new (c('AsyncRequest'))().setURI(ua).setMethod('POST');if(pa)va.setAllowCrossPageTransition(true);va.send();}function w(na){var oa=c('XConversationsToggleController').getURIBuilder().setBool('turn_conversations_on',na).getURI();na?ma():la();var pa=new (c('AsyncRequest'))().setURI(oa).setAllowCrossPageTransition(true).setHandler(function(qa){if(qa.getPayload().conversationsStatus){ma();}else la();}).setErrorHandler(function(qa){na?la():ma();}).setMethod('POST');pa.send();}function x(na,oa,pa){v(na,true,oa,pa);}function y(na,oa,pa){v(na,false,oa,pa);}function z(na,oa){x(na,false,oa);}function aa(na,oa){y(na,false,oa);}function ba(na,oa){x(na,true,oa);}function ca(na,oa){y(na,true,oa);}function da(){w(false);}function ea(){w(true);}function fa(na){return c('DOM').scry(na,"._4iz6")[0];}function ga(na,oa,pa){var qa=function ra(){pa();};oa.addSubscriptions(c('EventListener').listen(na,'click',qa),c('EventListener').listen(na,'keydown',function(ra){if(c('Event').getKeyCode(ra)===c('Keys').RETURN)qa();}));}function ha(na,oa){var pa=j.getLoadedTab(na);if(!pa)return;var qa=pa.getPersistentState(),ra=pa.getSessionID();c('Arbiter').inform(l,{tabID:na,tabState:qa,sessionID:ra,reason:oa});}function ia(na){var oa=j.getLoadedTab(na);if(!oa)return;c('Arbiter').inform(m,{tab:oa});}function ja(na){c('Arbiter').inform(n,{tab:na});}function ka(na){var oa=j.getLoadedTab(na);if(!oa)return;c('Arbiter').inform(o,{tab:oa});}function la(){c('Arbiter').inform(p,{});}function ma(){c('Arbiter').inform(q,{});}f.exports={CLOSE_TAB_EVENT:l,UNPIN_FROM_HEADER_EVENT:m,OPEN_PERMALINK_FROM_HEADER_EVENT:o,TURN_CONVERSATIONS_OFF_EVENT:p,TURN_CONVERSATIONS_ON_EVENT:q,CLOSE_REASON_TAB_X_OUT:r,CLOSE_REASON_OVERFLOW_X_OUT:s,CLOSE_REASON_UNPIN:t,coerceToPinRequestNotifSetting:u,sendPinRequest:z,sendUnpinRequest:aa,sendPinRequestAcrossTransitions:ba,sendUnpinRequestAcrossTransitions:ca,getCloseButtonElem:fa,addCloseButtonListeners:ga,informShouldCloseTab:ha,informDidUnpinFromHeaderMenu:ia,informShouldRecheckTabVisibility:ja,informOpenPermalinkFromHeader:ka,turnConversationsOff:da,turnConversationsOn:ea};}),null);
__d('ConversationNubPermalinkUtils',['URI','isFacebookURI'],(function a(b,c,d,e,f,g){'use strict';function h(l){return l.substr(-1)==='/'?l.slice(0,-1):l;}function i(l,m){var n=l.getPath(),o=m.getPath();return h(n)===h(o);}function j(l,m,n){var o=l.getQueryData(),p=m.getQueryData(),q=o[n],r=p[n];if(q==null&&r==null)return true;return q===r;}function k(l){var m=new (c('URI'))(window.location.href);return (m&&l&&c('isFacebookURI')(m)&&c('isFacebookURI')(l)&&i(m,l)&&j(m,l,'fbid')&&j(m,l,'story_fbid'));}f.exports={isOnPermalink:k};}),null);
__d('ConversationNubViewportManager',['DockTabsViewportCalculator','DockTabsViewportPinnedConversationTabUtils'],(function a(b,c,d,e,f,g){'use strict';var h=c('DockTabsViewportPinnedConversationTabUtils').getMinRequiredWidthForFirstConvoTab;function i(j,k,l){this.$ConversationNubViewportManager1=j;this.$ConversationNubViewportManager3=k;this.$ConversationNubViewportManager2=c('DockTabsViewportCalculator').getInstance(this.$ConversationNubViewportManager1);this.$ConversationNubViewportManager2&&this.$ConversationNubViewportManager2.registerPinnedConvoTabCallbacks(babelHelpers['extends']({},l,{pinnedConvoTabStateGetter:function(){return this.$ConversationNubViewportManager3;}.bind(this)}));}i.prototype.getNumDockTabsToShow=function(j){return this.getCouldFitAtLeastOneDockTab(j)?1:0;};i.prototype.getCouldFitAtLeastOneDockTab=function(j){var k=h();return k<=j;};i.prototype.forceRecalculatePinnedConvoTabs=function(j){this.$ConversationNubViewportManager2&&this.$ConversationNubViewportManager2.forceRecalculatePinnedConvoTabs(j);};f.exports=i;}),null);
__d('ConversationNubVisibilityDedupeUtils',['Bootloader','emptyFunction','ifRequired'],(function a(b,c,d,e,f,g){'use strict';function h(j){c('Bootloader').loadModules(["UFICommentVisibilityStore"],j,'ConversationNubVisibilityDedupeUtils');}function i(j){return c('ifRequired')('UFICommentVisibilityStore',function(k){return (k.isFeedbackTargetVisible(j));},c('emptyFunction').thatReturnsFalse);}f.exports={bootloadUFIVisibilityModule:h,isFeedbackTargetVisible:i};}),null);
__d("XNotificationNubStoryController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/conversation\/nub_story\/",{notif_alert_id:{type:"String"},notif_id:{type:"Int"},ft_id:{type:"String"},force_minimized:{type:"Bool",defaultValue:false}});}),null);
__d('NotificationConversationController',['csx','cx','Arbiter','AsyncRequest','Bootloader','ConversationNub','ConversationNubTabsUpdateEventController','ConversationNubPermalinkUtils','ConversationNubUtils','ConversationNubViewportManager','ConversationNubVisibilityDedupeUtils','CSS','DOM','ConversationNubTabState','NotificationConstants','NotificationUpdates','PinnedConversationNubsConfig','SubscriptionsHandler','URI','XNotificationNubStoryController','ge','ifRequired'],(function a(b,c,d,e,f,g,h,i){'use strict';var j=c('ConversationNubTabState').getConversationNubTabState,k=c('NotificationConstants').PayloadSourceType,l=k.LIVE_SEND,m=k.OTHER_APPLICATION,n=c('ConversationNubVisibilityDedupeUtils').bootloadUFIVisibilityModule,o=c('ConversationNubVisibilityDedupeUtils').isFeedbackTargetVisible,p=1,q=j(),r=Object.create(null),s=Object.create(null),t=null,u=null,v=null,w=null,x=null,y=null,z=false,aa=null,ba=null,ca=null,da=null,ea=Object.create(null);function fa(){if(!u)u=c('DOM').scry(c('ge')('pagelet_dock'),"._1mw-")[0];return u;}function ga(){if(!v){var ja=fa();if(ja)v=c('DOM').scry(ja,"._1tvj")[0];}return v;}function ha(){if(!w){var ja=fa();if(ja)w=c('DOM').scry(ja,"._2ikx .fbNubButton")[0];}return w;}ia.prototype.init=function(){if(z)return;z=true;this.$NotificationConversationController1();var ja='update-notifications',ka=new (c('SubscriptionsHandler'))();ka.addSubscriptions(c('NotificationUpdates').subscribe(ja,function(la,ma){if(ma.payloadsource===l&&ma.readState&&Object.keys(ma.readState).length){this.$NotificationConversationController2(ma.readState);}else if(ma.payloadsource===l||ma.payloadsource===m){var na=ma.nodes;if(na&&na.length)this.$NotificationConversationController3(na);}}.bind(this)),c('ConversationNubTabsUpdateEventController').subscribeToTabsUpdated(this.$NotificationConversationController4.bind(this)),c('Arbiter').subscribe(c('ConversationNubUtils').CLOSE_TAB_EVENT,function(la,ma){var na=ma||{},oa=na.tabID;if(oa)this.$NotificationConversationController5(oa);}.bind(this)));aa=ka;n(function(la){ka.addSubscriptions(la.addListener(this.$NotificationConversationController6.bind(this)));}.bind(this));};ia.prototype.$NotificationConversationController1=function(){q.getUnloadedTabs().forEach(function(ja){this.$NotificationConversationController7(ja.tabID,ja.ftID,ja.permalinkURI,'page_refresh');}.bind(this));};ia.prototype.$NotificationConversationController8=function(ja){var ka=t?t.getNumDockTabsToShow(ja):p;q.setMaxDockTabs(ka);};ia.prototype.$NotificationConversationController9=function(ja,ka){this.$NotificationConversationController8(ja);if(ka){var la=ka.tabToPromote,ma=ka.tabToOpenIfInDock;if(la&&!q.isTabInDock(la.getTabID()))q.moveTabToDockLeft(la.getTabID());if(ma&&q.isTabInDock(ma.getTabID()))ma.popOut();}this.$NotificationConversationController10(ja);};ia.prototype.$NotificationConversationController4=function(ja){t&&t.forceRecalculatePinnedConvoTabs(ja);};ia.prototype.$NotificationConversationController10=function(ja){var ka=q.getTotalTabCount(),la=q.getNumDockTabs(),ma=t&&t.getCouldFitAtLeastOneDockTab(ja),na=ka>0&&ma,oa=la<ka&&na,pa=fa();if(pa){c('CSS').conditionClass(pa,"_1tvf",na);c('CSS').conditionClass(pa,"_1dex",oa);c('CSS').conditionClass(pa,"_1tvi",oa);}var qa=c('PinnedConversationNubsConfig').pinnedToLeft?q.getTabsForDockOldestFirst():q.getTabsForDockNewestFirst();qa.forEach(function(sa){if(sa.getIsRaised())sa.clearBadge();});var ra=q.getTabsForMenu();this.$NotificationConversationController11(qa);this.$NotificationConversationController12(ra);};ia.prototype.$NotificationConversationController2=function(ja){q.getUnsortedLoadedTabs().forEach(function(la){var ma=la.getNotificationAlertID();if(ja[ma])la.clearBadge();});var ka=q.getTabsForMenu();this.$NotificationConversationController12(ka);};ia.prototype.$NotificationConversationController3=function(ja){ja.forEach(function(ka){var la=ka.alert_id,ma=ka.pinnedConvoConfig,na=ka.tracking;if(!ma)return;var oa=ma.ft_id,pa=ma.permalink_uri,qa=JSON.parse(na),ra=pa?new (c('URI'))(pa):null;this.$NotificationConversationController13(qa.alert_id,oa,la,ra);}.bind(this));};ia.prototype.$NotificationConversationController13=function(ja,ka,la,ma){var na=c('XNotificationNubStoryController').getURIBuilder().setString('notif_alert_id',la).setInt('notif_id',ja);this.$NotificationConversationController14(ka,'notification');this.$NotificationConversationController15(s,ja,ka,ma,na);};ia.prototype.$NotificationConversationController14=function(ja,ka){if(!ea[ja])ea[ja]=ka;};ia.prototype.$NotificationConversationController7=function(ja,ka,la,ma){if(q.getLoadedTab(ja))return;this.$NotificationConversationController14(ka,ma);var na=c('XNotificationNubStoryController').getURIBuilder().setString('ft_id',ka);this.$NotificationConversationController15(r,ja,ka,la,na);};ia.prototype.$NotificationConversationController15=function(ja,ka,la,ma,na){if(ja[ka])return;if(c('ConversationNubPermalinkUtils').isOnPermalink(ma)||o(la))na.setBool('force_minimized',true);ja[ka]=true;new (c('AsyncRequest'))().setURI(na.getURI()).setAllowCrossPageTransition(true).setFinallyHandler(function(){delete ja[ka];}).send();};ia.prototype.$NotificationConversationController6=function(){var ja=false;q.getUnsortedLoadedTabs().forEach(function(ka){if(ka.getBadgeCount()>0&&o(ka.getFeedbackTargetID())){ka.clearBadge();ja=true;}});if(ja)c('ConversationNubTabsUpdateEventController').informTabsUpdated();};ia.prototype.$NotificationConversationController16=function(ja){var ka=true;q.getUnsortedLoadedTabs().forEach(function(la){var ma=la.getFeedbackTargetID(),na=ja[ma],oa=na?Object.keys(na):[];if(oa.length){var pa=la.getBadgeCount();if(o(ma)){la.markCommentsAsSeenWithoutBadging(oa);la.clearBadge();}else la.attemptAddNewCommentsToBadge(oa);var qa=la.getBadgeCount();if(pa!==qa)ka=true;}});if(ka)c('ConversationNubTabsUpdateEventController').informTabsUpdated();};ia.prototype.$NotificationConversationController17=function(ja){if(da)return;c('Bootloader').loadModules(["ConversationNubSurveys"],function(ka){if(!da)da=new ka(ja);},'NotificationConversationController');};ia.prototype.$NotificationConversationController18=function(ja,ka,la){if(ca){ca.addTab(ja,la);delete ea[ja.getPersistentState().ftID];return;}c('Bootloader').loadModules(["ConversationNubLogger"],function(ma){if(!ca)ca=new ma(ka);ca.addTab(ja,la);delete ea[ja.getPersistentState().ftID];},'NotificationConversationController');};ia.prototype.$NotificationConversationController19=function(){if(ba)return;c('Bootloader').loadModules(["ConversationNubUFICentralUpdateManager"],function(ja){if(ba)return;ba=new ja(this.$NotificationConversationController16.bind(this));}.bind(this),'NotificationConversationController');};ia.prototype.$NotificationConversationController11=function(ja){var ka=ga();if(!ka)return;c('Bootloader').loadModules(["React","ReactDOM","ConversationNubDockedTabGroup.react"],function(la,ma,na){y=ma.render(la.createElement(na,{dockTabs:ja}),ka);},'NotificationConversationController');};ia.prototype.$NotificationConversationController20=function(ja){ja.popOut();c('ConversationNubTabsUpdateEventController').informTabsUpdated({tabToPromote:ja});};ia.prototype.$NotificationConversationController12=function(ja){var ka=ha();if(!ka)return;c('Bootloader').loadModules(["React","ReactDOM","ConversationNubCollapsedSelectorMenu.react"],function(la,ma,na){x=ma.render(la.createElement(na,{menuTabs:ja,onTabSelected:this.$NotificationConversationController20.bind(this)}),ka);}.bind(this),'NotificationConversationController');};ia.prototype.$NotificationConversationController21=function(){if(!t){var ja=fa();if(ja){var ka={onAvailableWidthChanged:this.$NotificationConversationController9.bind(this)};t=new (c('ConversationNubViewportManager'))(ja,q,ka);}}};ia.prototype.storyFromServer=function(ja,ka){if(!z)return;var la=ka.tab_id,ma=ka.ft_id,na=ka.notif_alert_id,oa=ka.title,pa=ka.permalink_uri,qa=ka.promote_on_init,ra=ka.attempt_open_on_init,sa=ka.init_without_badge,ta=ka.tab_add_source,ua=q.getLoadedTab(la);if(ua){if(qa||ra)c('ConversationNubTabsUpdateEventController').informTabsUpdated({tabToPromote:qa?ua:null,tabToOpenIfInDock:ra?ua:null});return;}sa=sa||o(ma);var va=q.getTabStateIfExists(la);if(va){sa=null;}else{var wa=c('ConversationNub').createDefaultState(la,pa,ma,na,oa);q.addTabState(wa);}var xa=new (c('ConversationNub'))(ja,la,sa);q.addLoadedTab(la,xa);ra=ra||xa.getPersistentState().isTabRaised;this.$NotificationConversationController19();this.$NotificationConversationController21();c('ConversationNubTabsUpdateEventController').informTabsUpdated({tabToPromote:qa?xa:null,tabToOpenIfInDock:ra?xa:null});this.$NotificationConversationController17(q);var ya=ea[ma]||ta||'unknown';this.$NotificationConversationController18(xa,q,ya);};ia.prototype.$NotificationConversationController5=function(ja){var ka=q.deleteTab(ja);if(ka)c('ConversationNubTabsUpdateEventController').informTabsUpdated();};ia.prototype.unsubscribe=function(){aa&&aa.release();aa=null;ca&&ca.destroy();ca=null;da&&da.destroy();da=null;ba&&ba.destroy();ba=null;c('ifRequired')('ReactDOM',function(ja){var ka=ha();if(x&&ka)ja.unmountComponentAtNode(ka);var la=ga();if(y&&la)ja.unmountComponentAtNode(la);});};function ia(){}f.exports=new ia();}),null);