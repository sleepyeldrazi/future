if (self.CavalryLogger) { CavalryLogger.start_js(["0vLzn"]); }

__d("GroupSellUserActionEvents",[],(function a(b,c,d,e,f,g){f.exports={MARK_AS_SOLD:"mark_as_sold",MARK_AS_AVAILABLE:"mark_as_available",MARK_AS_ARCHIVE:"mark_as_archive",MARK_AS_UNARCHIVE:"mark_as_unarchive",NON_FOR_SALE_MARK_AS_SOLD:"non_for_sale_mark_as_sold",GROUP_POST:"group_post",MARKETPLACE_POST:"marketplace_post",PROFILE_POST:"profile_post",LAUNCH_EDIT:"launch_edit",GROUP_POST_EDIT:"group_post_edit",GROUP_POST_REPORT:"group_post_report",ADMIN_OPT_IN:"admin_opt_in",ADMIN_OPT_OUT:"admin_opt_out",ADMIN_NOT_FOR_SALE:"admin_not_for_sale",ADMIN_DO_NOT_WANT:"admin_do_not_want",GROUP_CURRENCY_CHANGE:"group_currency_change",OPT_IN_MEGAPHONE_SEEN:"opt_in_megaphone_seen",OPT_IN_NOTIFICATION_SENT:"opt_in_notification_sent",AUTO_OPT_IN_MEGAPHONE_SEEN:"auto_opt_in_megaphone_seen",AUTO_OPTED_IN_MEGAPHONE_SEEN:"auto_opted_in_megaphone_seen",GROUP_PURPOSES_NUX_SEEN:"group_purposes_nux_seen",GROUP_PURPOSE_SELECTED:"group_purpose_selected",GROUP_NON_FOR_SALE_POST:"group_non_for_sale_post",GROUP_MARKED_AS_MAY_BE_FOR_SALE:"group_marked_as_may_be_for_sale",GROUP_CRT_CATEGORIZED_FOR_SALE:"group_crt_categorized_for_sale",GROUP_CRT_CATEGORIZED_FOR_SALE_FAIL:"group_crt_categorized_for_sale_fail",GROUP_ENABLED:"group_enabled",GROUP_DISABLED:"group_disabled",GROUP_NON_FOR_SALE_POST_INTERCEPT_WORDS:"group_non_for_sale_post_intercept_words",GROUP_NON_FOR_SALE_POST_NLU_INTERCEPT:"group_non_for_sale_post_nlu_intercept",GROUP_NON_FOR_SALE_POST_NLU_ATTEMPT:"group_non_for_sale_post_nlu_attempt",GROUP_NON_FOR_SALE_POST_NLU_ERROR:"group_non_for_sale_post_nlu_error",GROUP_NON_FOR_SALE_POST_NLU_TIMEOUT:"group_non_for_sale_post_nlu_timeout",ADMIN_GROUP_PURPOSE_EDIT_DISALLOWED:"admin_group_purpose_edit_disallowed",ADMIN_GROUP_REQUEST_PURPOSE_CHANGE:"admin_group_request_purpose_change",FOR_SALE_POST_APPROVE:"for_sale_post_approve",NON_FOR_SALE_POST_APPROVE:"non_for_sale_post_approve",FOR_SALE_POST_DELETED:"for_sale_post_deleted",NON_FOR_SALE_POST_DELETED:"non_for_sale_post_deleted",GROUP_NON_FOR_SALE_POST_INTERCEPT_CREATED:"group_non_for_sale_post_intercept_created",LAUNCH_MESSAGE_SELLER_DIALOG:"launch_message_seller_dialog",MESSAGE_SELLER:"message_seller",SHARED_TO_GROUP:"shared_to_group",RECENT_ACTIVITY_PAGE_CONTENT:"recent_activity_page_content",RECENT_ACTIVITY_DELETE_ITEM:"recent_activity_delete_item",SAVED_SEARCH_CREATED:"saved_search_created",SAVED_SEARCH_DELETED:"saved_search_deleted",SAVED_SEARCH_NOTIFICATION_SENT:"saved_search_notification_sent",P2P_PLATFORM_CONTEXT_CREATED:"p2p_platform_context_created",INCOMPLETE_POST_SAVED_AS_NON_FOR_SALE:"incomplete_post_saved_as_non_for_sale",GROUP_CROSS_POST_ATTEMPTED:"group_cross_post_attempted",EDIT_SYNC_ATTEMPTED:"edit_sync_attempted",EDIT_SYNC_SUCCESS:"edit_sync_success",SERVER_SALE_POST_INTERCEPT_TRIGGERED:"server_sale_post_intercept_triggered",SSFY_SEE_MORE_CLICK:"ssfy_see_more_click",COMPOSER_TOOLTIP_NUX_SEEN:"composer_tooltip_nux_seen",AUTHOR_COMMENT:"author_comment",GROUP_NON_FOR_SALE_POST_INTERCEPT_ATTEMPTED:"group_non_for_sale_post_intercept_attempted",GROUP_NON_FOR_SALE_POST_INTERCEPT_DETECTED:"group_non_for_sale_post_intercept_detected",GROUP_NON_FOR_SALE_POST_INTERCEPT_DECLINED:"group_non_for_sale_post_intercept_declined",GROUP_NON_FOR_SALE_POST_INTERCEPT_ACCEPTED:"group_non_for_sale_post_intercept_accepted",H_SCROLL_STORY_CLICKED:"h_scroll_story_clicked",XGROUP_ITEMS_FOR_SALE_NOTIF_OPT_OUT:"xgroup_fs_notif_opt_out",XGROUP_ITEMS_FOR_SALE_NOTIF_OPT_IN:"xgroup_fs_notif_opt_in",CLIENT_LIKE:"client_like",CLIENT_COMMENT:"client_comment",MARKETPLACE_POST_CREATION_FAIL_SIMILAR_POST:"MARKETPLACE_POST_CREATION_FAIL_SIMILAR_POST",MARKETPLACE_POST_CREATION_FAIL_NO_MARKETPLACE_ID:"marketplace_post_creation_fail_no_marketplace_id",THEME_CARD_SELL_CLICK:"theme_card_sell_click",COMPOSER_ZIP_CODE_AUTO_FILL_SUCCESS:"composer_zip_code_auto_fill_success",COMPOSER_ZIP_CODE_AUTO_FILL_FAILURE:"composer_zip_code_auto_fill_failure",COMPOSER_ZIP_CODE_INVALID_ENTRY:"composer_zip_code_invalid_entry",COMPOSER_ZIP_CODE_NO_INFERRED_COUNTRY:"composer_zip_code_no_inferred_country",COMPOSER_ZIP_CODE_LAT_LONG_NOT_FOUND:"composer_zip_code_lat_long_not_found",COMPOSER_ZIP_CODE_SAVED:"composer_zip_code_saved",COMPOSER_NEIGHBORHOOD_AUTO_FILL_SUCCESS:"composer_neighborhood_auto_fill_success",COMPOSER_NEIGHBORHOOD_AUTO_FILL_FAILURE:"composer_neighborhood_auto_fill_failure",LOCATION_GEOPROFILE_FALLBACK_NO_PREDICTED_ZIPCODE:"location_geoprofile_fallback_no_predicted_zipcode",LOCATION_NO_PREDICTED_HOME_CITY:"location_no_predicted_home_city",LOCATION_NO_PREDICTED_ZIPCODE:"location_no_predicted_zipcode",LOCATION_NO_BUY_LOCATION:"location_no_buy_location",LOCATION_NO_SELL_LOCATION:"location_no_sell_location",COMMERCE_INVENTORY_ENTER:"commerce_inventory_enter",COMPOSER_GROUP_SALE_POST_INTERCEPT:"composer_group_sale_post_intercept",COMPOSER_GROUP_SALE_POST_INTERCEPT_ACCEPTED:"composer_group_sale_post_intercept_accepted",COMPOSER_GROUP_SALE_POST_INTERCEPT_DECLINED:"composer_group_sale_post_intercept_declined",FOR_SALE_ITEM_MESSAGE_SELLER_BUTTON_CLICKED:"for_sale_item_message_seller_button_clicked",FOR_SALE_ITEM_SAVE_BUTTON_CLICKED:"for_sale_item_save_button_clicked",COMCOM_TEL_CLICK:"comcom_tel_click",COMCOM_COPY_NUM_CLICK:"comcom_copy_num_click",COMCOM_NUM_CLICK:"comcom_num_click",COMCOM_CREATE_CONTACT_CLICK:"comcom_create_contact_click",COMCOM_SEND_SMS_CLICK:"comcom_send_sms_click"};}),null);
__d('ComposerTagSuggestionsWaterfall',['Banzai'],(function a(b,c,d,e,f,g){var h='composer_tag_suggestions';function i(j){'use strict';this._waterfallID=j;}i.prototype.setWaterfallID=function(j){'use strict';this._waterfallID=j;};i.prototype._logStep=function(j,k){'use strict';k=babelHelpers['extends']({},k||{},{waterfall_id:this._waterfallID,step:j});c('Banzai').post(h,k);return this;};i.prototype.logBegin=function(){'use strict';return this._logStep('begin');};i.prototype.logAddPhoto=function(j){'use strict';return this._logStep('add_photo',{photo:j});};i.prototype.logAddPhotos=function(j){'use strict';j.forEach(this.logAddPhoto.bind(this));};i.prototype.logRemovePhoto=function(j,k,l){'use strict';return this._logStep('remove_photo',{photo:j,tokens:k,suggestions:l});};i.prototype.logAddToken=function(j,k){'use strict';return this._logStep('add_token',{user:j,replaced_with_tag:k});};i.prototype.logRemoveToken=function(j,k){'use strict';return this._logStep('remove_token',{user:j,suggestions:k});};i.prototype.logAddSuggestion=function(j,k,l,m){'use strict';return this._logStep('add_suggestion',{photo:j,facebox:k,user:l,certainty:m});};i.prototype.logRemoveSuggestion=function(j,k,l,m){'use strict';return this._logStep('remove_suggestion',{photo:j,facebox:k,user:l,certainty:m});};i.prototype.logAddManualTag=function(j,k,l){'use strict';return this._logStep('add_tag',{photo:j,facebox:k,user:l});};i.prototype.logRemoveManualTag=function(j,k,l){'use strict';return this._logStep('remove_tag',{photo:j,facebox:k,user:l});};i.prototype.logStartPoll=function(j){'use strict';return this._logStep('start_poll',{photos:j});};i.prototype.logStopPoll=function(j,k){'use strict';return this._logStep('stop_poll',{time_spent:j,unresolved_photos:k});};i.prototype.logSubmit=function(j,k,l,m,n,o){'use strict';return this._logStep('submit',{photos:j,tokens:k,manual_tokens:l,suggestions:m,manual_tags:n,time_spent:o});};i.prototype.logFailure=function(j,k){'use strict';return this._logStep('fail',{photo:j,user:k});};f.exports=i;}),null);
__d('AttachmentWithPhotoEditorTaggingMixin',['Arbiter','ComposerTagSuggestionsWaterfall','DOM','FaceRecognitionController','Form','Map','Parent','PhotoTagStore','SubscriptionsHandler'],(function a(b,c,d,e,f,g){f.exports={initPhotoEditorTaggingMixin:function h(){this._tagStore=c('PhotoTagStore').getInstance();this._tagsWaitingForFaceboxes=new (c('Map'))();this._photoEditorTagging={};this._photoEditorTagging.uploadArea=this.getUploadArea();this._photoEditorTagging.xyTagInputs={};this._photoEditorTagging.subscriptions=new (c('SubscriptionsHandler'))();this._photoEditorTagging.recognitionController=new (c('FaceRecognitionController'))({include_unrecognized_faceboxes:true});this._photoEditorTagging.faceRecSubmitButtonLock=null;var i=this.getWaterfallID();this._photoEditorTagging.tagSuggestionsWaterfall=new (c('ComposerTagSuggestionsWaterfall'))(i);this._photoEditorTagging.tagSuggestionsWaterfall.logBegin();this._photoEditorTagging.flowBeginTimestamp=Date.now();this._photoEditorTagging.subscriptions.addSubscriptions(c('Arbiter').subscribe('AttachmentsPhotoEditor/tagsUpdated'+this.getGridID(),this._onTagsUpdatedForPhoto.bind(this)),c('Arbiter').subscribe('AttachmentsPhotoEditor/requestFaceboxes'+this.getGridID(),this._onFaceboxesRequestedForPhoto.bind(this)),c('Arbiter').subscribe('multi-upload/images-added/'+this.getGridID(),this._onImageAdded.bind(this)),c('Arbiter').subscribe('multi-upload/image-removed/'+this.getGridID(),this._onImageRemoved.bind(this)),this._photoEditorTagging.recognitionController.subscribe('photo',this._onPhotoRecognitionComplete.bind(this)),this._photoEditorTagging.recognitionController.subscribe('done',this._onRecognitionDone.bind(this)));var j=this.getComponentInstance('withtagger');if(j)this._photoEditorTagging.subscriptions.addSubscriptions(j.subscribe('removeToken',this._onTokenRemoved.bind(this)));this._tagStore.clear();this._taggingFlyoutData=this._photoEditorTagging;},setPhotoEditorFaceRecSubmitButtonLock:function h(i){this._photoEditorTagging.faceRecSubmitButtonLock=i;},_onFaceboxesRequestedForPhoto:function h(i,j){var k=j.fbid,l=j.tags;if(j.shouldTransferFaceboxTags)this._tagsWaitingForFaceboxes.set(k,l);this._photoEditorTagging.faceRecSubmitButtonLock.lock();this._photoEditorTagging.recognitionController.start([k]);},_onPhotoRecognitionComplete:function h(i,j){var k=j.photo,l=this._tagsWaitingForFaceboxes.get(k),m=j.faceboxes;if(l){l=l.map(function(n){if(!n.from_facebox)return n;for(var o=0;o<m.length;++o)if(this._isTagInFacebox(n,m[o])){n.x=m[o].x;n.y=m[o].y;n.facebox=m[o].fbid;m.splice(o,1);return n;}n.from_facebox=false;delete n.facebox;return n;}.bind(this));this._tagsWaitingForFaceboxes['delete'](k);}else{l=[];m.forEach(function(n){if(n.recognitions.length)l.push({fbid:this._fbid,x:n.x,y:n.y,subject:n.recognitions[0].user.fbid,name:n.recognitions[0].user.name,from_facebox:true,facebox:n.fbid});}.bind(this));}this._photoEditorTagging.faceRecSubmitButtonLock.unlock();this._updateTagsForPhoto(k,l);},_onRecognitionDone:function h(i,j){j.unresolved.forEach(function(k){var l=this._tagsWaitingForFaceboxes.get(k)||[];l=l.map(function(m){m.from_facebox=false;delete m.facebox;return m;});this._tagsWaitingForFaceboxes['delete'](k);this._updateTagsForPhoto(k,l);}.bind(this));},_isTagInFacebox:function h(i,j){return i.x>=j.left&&i.x<=j.left+j.width&&i.y>=j.top&&i.y<=j.top+j.height;},_onTagsUpdatedForPhoto:function h(i,j){this._updateTagsForPhoto(j.fbid,j.xyTags);},_updateTagsForPhoto:function h(i,j){var k=false,l=this.getComponentInstance('withtagger');this._removeTagsForPhoto(i);j.forEach(function(m){k=this._tagStore.userHasDirtyTags(m.subject);m.fbid=i;this._tagStore.storeTagWithOptions(i,m.subject,m.x,m.y,m);if(l&&!k)l.replaceToken(l.createDecorativeToken({uid:m.subject,text:m.name},'faceSuggestion'));}.bind(this));c('Arbiter').inform('AttachmentsPhotoEditor/tagStateChanged'+i,!!j.length);this._updateXYTagsInputs();},_onImageAdded:function h(){if(this.getComponent('withtagger'))this.getTagger().eventuallySwitchToTagger('with');},_onImageRemoved:function h(i,j){this._removeTagsForPhoto(j);this._updateXYTagsInputs();},_removeTagsForPhoto:function h(i){var j=this.getComponentInstance('withtagger'),k;if(j){k=Object.keys(this._tagStore.getPhotoTags(i));this._tagStore.removeAllTagsFromPhoto(i);k.forEach(function(l){if(!this._tagStore.userHasDirtyTags(l))j.removeToken(j.findToken({uid:l}));}.bind(this));}},_updateXYTagsInputs:function h(){var i=c('Parent').byTag(this.getSubmitButton(),'form');this._removeAllXYTagInputs();var j=this._tagStore.getAllTags();c('Form').createHiddenInputs({xy_tags:j},i,this._photoEditorTagging.xyTagInputs);},_removeAllXYTagInputs:function h(){for(var i in this._photoEditorTagging.xyTagInputs)c('DOM').remove(this._photoEditorTagging.xyTagInputs[i]);this._photoEditorTagging.xyTagInputs={};},_onTokenRemoved:function h(i,j){var k=j.info.uid,l=this._tagStore.removeAllNewTagsOfUser(k);l.forEach(function(m){if(!this._tagStore.photoHasTags(m.fbid))c('Arbiter').inform('AttachmentsPhotoEditor/tagStateChanged'+m.fbid,false);}.bind(this));this._updateXYTagsInputs();},cleanupPhotoEditorTagging:function h(){this._photoEditorTagging.subscriptions.release();this._photoEditorTagging.subscriptions.engage();},resetPhotoEditorTagging:function h(){this._tagStore.clear();this._removeAllXYTagInputs();}};}),null);
__d("InstanceRegistry",[],(function a(b,c,d,e,f,g){function h(){"use strict";this.instances={};this.waits=[];}h.prototype.set=function(i,j){"use strict";this.instances[i]=j;this.waits=this.waits.filter(function(k){if(this._isWaitResolved(k.names)){k.callback.apply(this,this._mapNamesToInstances(k.names));return false;}return true;}.bind(this));};h.prototype.get=function(i){"use strict";return this.instances[i];};h.prototype.remove=function(i){"use strict";delete this.instances[i];};h.prototype.waitFor=function(i,j){"use strict";if(this._isWaitResolved(i))return j.apply(this,this._mapNamesToInstances(i));this.waits.push({names:i,callback:j});};h.prototype.waitForAndRemove=function(i,j){"use strict";this.waitFor(i,function(){j.apply(this,arguments);i.forEach(this.remove.bind(this));}.bind(this));};h.prototype._isWaitResolved=function(i){"use strict";return i.every(this.instances.hasOwnProperty.bind(this.instances));};h.prototype._mapNamesToInstances=function(i){"use strict";return i.map(function(j){return this.instances[j];}.bind(this));};f.exports=new h();}),null);
__d('PhotosTaggingFlyoutLoader',['ArbiterMixin','AsyncRequest','InstanceRegistry','URI','arrayContains','mixin','removeFromArray'],(function a(b,c,d,e,f,g){var h,i;h=babelHelpers.inherits(j,c('mixin')(c('ArbiterMixin')));i=h&&h.prototype;function j(k){'use strict';i.constructor.call(this);this._flyouts={};this._loading=[];this._callbacks={};this._targetID=k;}j.prototype.get=function(k,l){'use strict';if(this._isLoaded(k))return l(this._flyouts[k]);this._callbacks[k]=this._callbacks[k]||[];if(!this._isLoading(k))this._load(k);this._callbacks[k].push(l);};j.prototype.whenLoaded=function(k,l){'use strict';if(this._isLoaded(k))return l(this._flyouts[k]);this._callbacks[k]=this._callbacks[k]||[];this._callbacks[k].push(l);};j.prototype._load=function(k){'use strict';if(this._isLoading(k))return;this._loading.push(k);new (c('AsyncRequest'))().setURI(new (c('URI'))('/ajax/photos/tagging-flyout/').addQueryData({photo:k,target:this._targetID,recognitionFeature:'composer_facerec'})).setHandler(function(){c('InstanceRegistry').waitForAndRemove(['PhotosTaggingFlyout_'+k],function(l){if(!this._isLoading(k))return;this.inform('loaded',l);this._flyouts[k]=l;this._callbacks[k].forEach(function(m){m(l);});delete this._callbacks[k];}.bind(this));}.bind(this)).setFinallyHandler(function(){c('removeFromArray')(this._loading,k);}.bind(this)).send();};j.prototype._isLoading=function(k){'use strict';return c('arrayContains')(this._loading,k);};j.prototype._isLoaded=function(k){'use strict';return !!this._flyouts[k];};j.prototype.remove=function(k){'use strict';if(this._isLoaded(k))this._flyouts[k].cleanup();delete this._flyouts[k];delete this._callbacks[k];c('removeFromArray')(this._loading,k);};j.prototype.cleanup=function(){'use strict';Object.keys(this._flyouts).forEach(this.remove.bind(this));Object.keys(this._callbacks).forEach(this.remove.bind(this));};f.exports=j;}),null);
__d('AttachmentWithPhotosTaggingFlyoutMixin',['csx','cx','fbt','Arbiter','AsyncRequest','BanzaiODS','ComposerNUXType','ComposerTagSuggestionsWaterfall','ComposerXNUX','CSS','DOM','DOMQuery','Event','FaceRecognitionController','Form','Parent','PhotosTaggingFlyoutLoader','PhotosUploadWaterfallXMixin','PhotoTagStore','SubscriptionsHandler','Tooltip','getObjectValues','isEmpty'],(function a(b,c,d,e,f,g,h,i,j){var k=[];f.exports=Object.assign(c('PhotosUploadWaterfallXMixin'),{initTaggingFlyoutMixin:function l(m,n){this._attachment=m;this._taggingFlyoutData={};this._taggingFlyoutData.root=m.getRoot();this._taggingFlyoutData.gridID=m.getGridID();this._taggingFlyoutData.uploadArea=m.getUploadArea();this._taggingFlyoutData.submitButton=m.getSubmitButton();this._taggingFlyoutData.tagger=m.getTagger();this._taggingFlyoutData.config=n;this._taggingFlyoutData.xyTagInputs={};this._taggingFlyoutData.subscriptions=new (c('SubscriptionsHandler'))();this._initTaggingFlyout();},setFaceRecSubmitButtonLock:function l(m){this._taggingFlyoutData.faceRecSubmitButtonLock=m;},initTaggingFlyoutWithComponents:function l(){this._taggingFlyoutData.scrollableArea=this._attachment.getScrollableArea();this._taggingFlyoutData.subscriptions.addSubscriptions(c('Arbiter').subscribe('multi-upload/image-removed/'+this._taggingFlyoutData.gridID,this._doHandleImageRemoved.bind(this)),c('Arbiter').subscribe('multi-upload/images-added/'+this._taggingFlyoutData.gridID,this._doHandleImageAdded.bind(this)),this._taggingFlyoutData.recognitionController.subscribe('recognition',this._doHandleRecognitionResult.bind(this)),this._taggingFlyoutData.recognitionController.subscribe('photo',this._doHandlePhotoRecognitionDone.bind(this)),this._taggingFlyoutData.recognitionController.subscribe('done',function(o,p){this._taggingFlyoutData.faceRecSubmitButtonLock.unlock();this._setSubmitButtonTooltip('');p.unresolved.forEach(function(q){this._taggingFlyoutData.flyoutLoader.whenLoaded(q,function(r){r.reset();});this._taggingFlyoutData.facerecLogger.bump('facerec_queries_fail');this._taggingFlyoutData.tagSuggestionsWaterfall.logFailure(q,p.user);this._doHandlePhotoRecognitionDone(o,{photo:q,faceboxes:[],recognitions:0});},this);this._taggingFlyoutData.facerecLogger.bump('facerec_queries_done');this._taggingFlyoutData.tagSuggestionsWaterfall.logStopPoll(Date.now()-this._taggingFlyoutData.pollLastStartedTimestamp,p.unresolved.length);}.bind(this)));var m=this.getComponentInstance('withtagger');if(m)this._taggingFlyoutData.subscriptions.addSubscriptions(m.subscribe('removeToken',this._doHandleTokenRemoved.bind(this)));c('PhotoTagStore').getInstance().clear();var n=this.getWaterfallID();this._taggingFlyoutData.tagSuggestionsWaterfall=new (c('ComposerTagSuggestionsWaterfall'))(n);this._taggingFlyoutData.tagSuggestionsWaterfall.logBegin();this._taggingFlyoutData.flowBeginTimestamp=Date.now();this._taggingFlyoutData.recognitionController.setWaterfallID(n);},cleanupTaggingFlyout:function l(){this._taggingFlyoutData.flyoutLoader.cleanup();if(this._taggingFlyoutData.config.taggingFlyoutNUXDialog)c('ComposerXNUX').onCleanup(this._taggingFlyoutData.config.taggingFlyoutNUXDialog);this.releaseSubscriptions();this.engageSubscriptions();},resetTaggingFlyout:function l(){c('PhotoTagStore').getInstance().clear();if(this._taggingFlyoutData){this._taggingFlyoutData.recognitionController.stop();for(var m in this._taggingFlyoutData.xyTagInputs)c('DOM').remove(this._taggingFlyoutData.xyTagInputs[m]);this._taggingFlyoutData.xyTagInputs={};}},getWaterfallID:function l(){throw new Error("Classes using AttachmentWithPhotosTaggingFlyoutMixin "+"should implement getWaterfallID");},releaseSubscriptions:function l(){this._taggingFlyoutData.subscriptions.release();},engageSubscriptions:function l(){this._taggingFlyoutData.subscriptions.engage();},addSubscriptions:function l(){var m=this._taggingFlyoutData.subscriptions;for(var n=arguments.length,o=Array(n),p=0;p<n;p++)o[p]=arguments[p];m.addSubscriptions.apply(m,o);},getSubscriptions:function l(m){return this._taggingFlyoutData.subscriptions;},logWithTaggingData:function l(m,n){var o=0,p=this.getComponentInstance('withtagger');if(p){var q=c('PhotoTagStore').getInstance(),r=p.getTokens();o=r.filter(function(u){return !q.userHasDirtyTags(u.info.uid);}).length;var s=q.getAllTags(),t=s.filter(function(u){return u.source=='composerx_suggestions';});this._taggingFlyoutData.tagSuggestionsWaterfall.logSubmit(m,r.length,o,t.length,s.length-t.length,Date.now()-this._taggingFlyoutData.flowBeginTimestamp);}return o;},_initTaggingFlyout:function l(){this._taggingFlyoutData.flyoutLoader=new (c('PhotosTaggingFlyoutLoader'))(this._taggingFlyoutData.config.targetID);this._taggingFlyoutData.flyoutLoader.subscribe('loaded',function(m,n){this._setupTaggingFlyout(n);}.bind(this));this._taggingFlyoutData.facerecLogger={bump:function m(n,o){c('BanzaiODS').bumpEntityKey('composer_facerec_suggestions',n,o);}};this._taggingFlyoutData.recognitionController=new (c('FaceRecognitionController'))({targetID:this._taggingFlyoutData.config.targetID,targetIsPage:this._taggingFlyoutData.config.targetIsPage});},_setupTaggingFlyout:function l(m){k.push(m);if(!this._getPhotoGridItem(m.getPhotoID()))return;this._taggingFlyoutData.subscriptions.addSubscriptions(m.subscribe('show',this._onTaggingFlyoutShow.bind(this,m)),m.subscribe('beforehide',this._onTaggingFlyoutHide.bind(this,m)),m.subscribe('confirm',this._onTaggingFlyoutConfirmed.bind(this,m)),m.subscribe('select',this._onTaggingFlyoutSelect.bind(this,m)),m.subscribe('unselect',this._onTaggingFlyoutUnselect.bind(this,m)));},_onTaggingFlyoutShow:function l(m,n,o){k.forEach(function(p){if(p!=m)p.hide();});if(this._taggingFlyoutData.config.taggingFlyoutNUXDialog)c('ComposerXNUX').acknowledgeDialog(c('ComposerNUXType').TAGGING_FLYOUT_NUX,this._taggingFlyoutData.config.taggingFlyoutNUXDialog);m.setNextButtonVisibility(!this._findNextTaggableGridItem(this._getPhotoGridItem(m.getPhotoID())));},_onTaggingFlyoutHide:function l(m,n,o){c('CSS').removeClass(m.getContext(),"_58pl");c('CSS').conditionClass(this._taggingFlyoutData.uploadArea,"_58pk",c('DOMQuery').scry(this._taggingFlyoutData.uploadArea,"._58pl").length);},_onTaggingFlyoutConfirmed:function l(m,n,o){var p=this._findNextTaggableGridItem(this._getPhotoGridItem(m.getPhotoID()));if(!p)return;if(this._taggingFlyoutData.scrollableArea)this._taggingFlyoutData.scrollableArea.scrollIntoView(p);c('CSS').addClass(this._taggingFlyoutData.uploadArea,"_58pk");c('CSS').addClass(p,"_58pl");this._getTaggingFlyout(p.getAttribute('data-fbid'),function(q){q.show(p);});},_onTaggingFlyoutSelect:function l(m,n,o){c('CSS').addClass(this._getPhotoGridItem(m.getPhotoID()),"_57vj");var p=c('PhotoTagStore').getInstance().userHasDirtyTags(o.user);if(!p)this._taggingFlyoutData.facerecLogger.bump('suggestion_tags_added');c('PhotoTagStore').getInstance().storeTagWithOptions(o.photo,o.user,o.facebox.x,o.facebox.y,{fbid:o.photo,name:o.name,subject:o.user,from_facebox:true,facebox:o.facebox.fbid,source:'composerx_flyout'});this._taggingFlyoutData.tagSuggestionsWaterfall.logAddManualTag(o.photo,o.facebox.fbid,o.user);var q=this.getComponentInstance('withtagger');if(q)if(!p){var r=q.replaceToken(q.createDecorativeToken({uid:o.user,text:o.name},'faceSuggestion'));this._taggingFlyoutData.tagSuggestionsWaterfall.logAddToken(o.user,r);}this._updateXYTagInputs();},_onTaggingFlyoutUnselect:function l(m,n,o){this._fireDismissRequest([{facebox:o.facebox,log_data:{tagee:o.user,is_first:true}}]);var p=c('PhotoTagStore').getInstance().removeTag(o.photo,o.user);if(c('isEmpty')(p))return;var q=this._taggingFlyoutData.tagSuggestionsWaterfall;p.forEach(function(t){if(t.source=='composerx_suggestions'){q.logRemoveSuggestion(t.fbid,t.facebox,t.subject,t.certainty);}else q.logRemoveManualTag(t.fbid,t.facebox,t.subject);});c('CSS').conditionClass(this._getPhotoGridItem(m.getPhotoID()),"_57vj",!c('isEmpty')(c('PhotoTagStore').getInstance().getPhotoTags(o.photo)));var r=c('PhotoTagStore').getInstance().userHasDirtyTags(o.user),s=this.getComponentInstance('withtagger');if(s&&!r){s.removeToken(s.findToken({uid:o.user}));this._taggingFlyoutData.tagSuggestionsWaterfall.logRemoveToken(o.user,0);}this._updateXYTagInputs();},_doHandleImageRemoved:function l(m,n){this._taggingFlyoutData.flyoutLoader.remove(n);var o=0,p=[],q=this.getComponentInstance('withtagger');if(q){p=Object.keys(c('PhotoTagStore').getInstance().getPhotoTags(n));c('PhotoTagStore').getInstance().removeAllTagsFromPhoto(n);p.forEach(function(r){if(!c('PhotoTagStore').getInstance().userHasDirtyTags(r)){o++;q.removeToken(q.findToken({uid:r}));}});}this._taggingFlyoutData.tagSuggestionsWaterfall.logRemovePhoto(n,o,p.length);this._updateXYTagInputs();k.forEach(function(r){return r.hide();});},_doHandleImageAdded:function l(m,n){if(n.disableRecognition)return;Object.keys(n.fbids).forEach(function(o){var p=n.fbids[o],q=this._getPhotoGridItem(p);if(q)c('CSS').addClass(q,"_57vh");},this);this._taggingFlyoutData.tagSuggestionsWaterfall.logAddPhotos(c('getObjectValues')(n.fbids));this._taggingFlyoutData.facerecLogger.bump('photos_queried');if(this.getComponent('withtagger')&&!this._taggingFlyoutData.config.hideWithTagger)this._taggingFlyoutData.tagger.eventuallySwitchToTagger('with');if(!this._taggingFlyoutData.config.applyTagSuggestionsDelay)this._taggingFlyoutData.faceRecSubmitButtonLock.lock();this._taggingFlyoutData.recognitionController.start(c('getObjectValues')(n.fbids));this._setSubmitButtonTooltip(j._("Processing"));this._taggingFlyoutData.pollLastStartedTimestamp=Date.now();this._taggingFlyoutData.tagSuggestionsWaterfall.logStartPoll(Object.keys(n.fbids).length);},_doHandleRecognitionResult:function l(m,n){var o=n.facebox,p=n.recognition,q=c('PhotoTagStore').getInstance().userHasDirtyTags(p.user.fbid);this._taggingFlyoutData.facerecLogger.bump('xy_tags_added');this._taggingFlyoutData.tagSuggestionsWaterfall.logAddSuggestion(n.photo,o.fbid,p.user.fbid,p.certainty);if(!q)this._taggingFlyoutData.facerecLogger.bump('suggestion_tags_added');c('PhotoTagStore').getInstance().storeTagWithOptions(n.photo,p.user.fbid,o.x,o.y,{fbid:n.photo,name:p.user.name,subject:p.user.fbid,from_facebox:true,facebox:o.fbid,certainty:p.certainty,source:'composerx_suggestions',timestamp:Date.now()});var r=this.getComponentInstance('withtagger');if(r){if(!q){var s=r.replaceToken(r.createDecorativeToken({uid:p.user.fbid,text:p.user.name},this._taggingFlyoutData.config.additionalTokensGlyph));this._taggingFlyoutData.tagSuggestionsWaterfall.logAddToken(p.user.fbid,s);}this._taggingFlyoutData.tagger.eventuallySwitchToTagger('with');}setTimeout(this._updateXYTagInputs.bind(this),this._taggingFlyoutData.config.applyTagSuggestionsDelay?500:0);},_doHandlePhotoRecognitionDone:function l(m,n){var o=n.photo,p=this._getPhotoGridItem(o);if(!p)return;c('CSS').removeClass(p,"_57vh");if(!this._taggingFlyoutData.config.useTaggingFlyout)return;c('CSS').addClass(p,"_57vi");c('CSS').conditionClass(p,"_57vj",n.recognitions);c('CSS').conditionClass(p,"_57vk",n.faceboxes.length);if(n.recognitions&&this._taggingFlyoutData.config.taggingFlyoutNUXDialog&&!this._taggingFlyoutData.taggingFlyoutNUXShown){this._scrollIntoView(p);c('ComposerXNUX').onInit(this._taggingFlyoutData.config.taggingFlyoutNUXDialog,p,c('ComposerNUXType').TAGGING_FLYOUT_NUX);this._taggingFlyoutData.taggingFlyoutNUXShown=true;}this._taggingFlyoutData.subscriptions.addSubscriptions(c('Event').listen(p,'click',function(q){if(c('CSS').hasClass(q.target,'fbVaultGridPhotoItemRemoveButton')||c('CSS').hasClass(q.target,'fbVaultGridPhotoItemEditButton')||c('CSS').matchesSelector(q.target,"._24iq"))return;c('CSS').addClass(this._taggingFlyoutData.uploadArea,"_58pk");c('CSS').addClass(p,"_58pl");this._getTaggingFlyout(o,function(r){r.toggle(p);});}.bind(this)));},_setSubmitButtonTooltip:function l(m){var n=c('DOMQuery').find(this._taggingFlyoutData.root,"._yo");if(m){c('Tooltip').set(n,m,'above','center');}else{c('Tooltip').remove(n);n.setAttribute('aria-label',j._("Post"));}},_doHandleTokenRemoved:function l(m,n){var o=c('PhotoTagStore').getInstance(),p=n.info.uid,q=this._taggingFlyoutData;if(o.userHasDirtyTags(p)){var r=o.userDirtyTagsCount(p);q.tagSuggestionsWaterfall.logRemoveToken(p,r);q.facerecLogger.bump('suggestion_tokens_removed');q.facerecLogger.bump('xy_tags_removed',r);}var s=[];o.removeAllNewTagsOfUser(p).forEach(function(t){s.push({facebox:t.facebox,log_data:{tagee:t.subject,is_first:true}});if(q.config.useTaggingFlyout){if(!o.photoHasTags(t.fbid))c('CSS').removeClass(this._getPhotoGridItem(t.fbid),"_57vj");q.flyoutLoader.whenLoaded(t.fbid,function(u){u.getFaceboxInstance(t.facebox).reset();});}if(t.source=='composerx_suggestions'){q.tagSuggestionsWaterfall.logRemoveSuggestion(t.fbid,t.facebox,t.subject,t.certainty);}else q.tagSuggestionsWaterfall.logRemoveManualTag(t.fbid,t.facebox,t.subject);}.bind(this));this._fireDismissRequest(s);this._updateXYTagInputs();},_updateXYTagInputs:function l(){var m=c('Parent').byTag(this._taggingFlyoutData.submitButton,'form');for(var n in this._taggingFlyoutData.xyTagInputs)c('DOM').remove(this._taggingFlyoutData.xyTagInputs[n]);var o=c('PhotoTagStore').getInstance().getAllTags();if(this._taggingFlyoutData.config.applyTagSuggestionsDelay)o=o.filter(function(p){return !p.timestamp||p.timestamp+500<=Date.now();});c('Form').createHiddenInputs({xy_tags:o},m,this._taggingFlyoutData.xyTagInputs);},_getPhotoGridItem:function l(m){return c('DOMQuery').scry(this._taggingFlyoutData.uploadArea,'.fbVaultGridItem[data-fbid="'+m+'"]')[0];},_findNextTaggableGridItem:function l(m){var n=c('DOMQuery').scry(this._taggingFlyoutData.uploadArea,'.fbVaultGridItem'),o=n.indexOf(m);while(++o<n.length)if(c('CSS').matchesSelector(n[o],"._57vk"))break;return n[o];},_getTaggingFlyout:function l(m,n){this._taggingFlyoutData.flyoutLoader.get(m,n);},_fireDismissRequest:function l(m){if(m.length>0)new (c('AsyncRequest'))().setURI('/ajax/dismiss_tag_suggest.php').setMethod('POST').setData({facebox_logs:m,closing_source:'composerx_suggestions',closing_action:'no'}).setAllowCrossPageTransition(true).send();},_scrollIntoView:function l(m){if(this._taggingFlyoutData.scrollableArea)this._taggingFlyoutData.scrollableArea.scrollIntoView(m);}});}),null);
__d('ComposerXMediaUploadAttachment',['csx','cx','fbt','Arbiter','Button','ComposerXAttachment','ComposerXAttachmentUtils','ComposerXAttachmentButtonBarState','ComposerXAttachmentPrefillMixin','ComposerXPrivacyWidgetTags','ComposerXSessionIDInserter','Dialog','DOM','DOMQuery','Event','PagesEventObserver','PagesComposerEntryLogger','Parent','SubscriptionsHandler','classWithMixins','ge','mixin'],(function a(b,c,d,e,f,g,h,i,j){var k,l;k=babelHelpers.inherits(m,c('classWithMixins')(c('ComposerXAttachment'),c('mixin')(c('ComposerXAttachmentPrefillMixin'))));l=k&&k.prototype;function m(n,o,p){'use strict';l.constructor.call(this);this._root=n;this._tagger=o;this._config=p;this._hasSelected=false;this._subscriptions=new (c('SubscriptionsHandler'))();this._submitButton=c('DOM').find(this._root,"._yo");}m.prototype.getRoot=function(){'use strict';return this._root;};m.prototype.getUploadArea=function(){'use strict';return this._uploadArea;};m.prototype.getSubmitButton=function(){'use strict';return this._submitButton;};m.prototype.getTagger=function(){'use strict';return this._tagger;};m.prototype.initWithComponents=function(){'use strict';this._uploadArea=c('DOM').find(this._root,"div._yn");this._initFileInput();var n=this.getComponent('maininput');c('ComposerXAttachmentUtils').initMentions(n,this._config.mentionsPlaceholder,this.getComposerID(),{dontFocusMentions:this._config.dontFocusMentions});var o=c('DOMQuery').find(n.element,'textarea.input');if(!o.value&&this._config.targetIsPage){this._pagesComposerEntryLogger=new (c('PagesComposerEntryLogger'))(this._config.targetID);this._pagesComposerEntryLogger.registerForContentEntryEvents(o);}if(this._config.prefill)this._initPrefill(c('DOMQuery').find(this.getComponent('maininput').element,'textarea.input'),this._config.prefill);this._root.action=this._config.photoEndpoint;this._tagger.init(this);this._privacyWidgetTags=new (c('ComposerXPrivacyWidgetTags'))(this);c('ComposerXAttachmentButtonBarState').trackCityChanges(this);c('Arbiter').inform('ComposerXMediaUpload/start');var p=this._config.fileForm;this._subscriptions.addSubscriptions(p.subscribe('submit',function(){c('ComposerXSessionIDInserter').insertSessionInput(p.getRoot());}.bind(this)));if(this._config.postActionsButton!=null)this._config.postActionsButton.initHiddenInputs(this.getComponent('pabhiddeninputs').instance);c('Arbiter').inform('composer/render_pab_nux');};m.prototype.persistUploadArea=function(){'use strict';return false;};m.prototype.cleanup=function(){'use strict';this._tagger.cleanup();this._privacyWidgetTags&&this._privacyWidgetTags.destroy();this._privacyWidgetTags=null;this._subscriptions.release();this._subscriptions.engage();if(this._pagesComposerEntryLogger)this._pagesComposerEntryLogger.unregister();};m.prototype.reset=function(){'use strict';this._tagger.reset();this._resetFileInput();if(this._config.prefill)this._resetPrefill();};m.prototype._resetFileInput=function(){'use strict';c('DOM').replace(this._fileInput,this._fileInputCopy);this._initFileInput();};m.prototype.canSwitchAway=function(){'use strict';return !c('Parent').byClass(this._root,'async_saving');};m.prototype._setSubmitButtonEnabled=function(n){'use strict';c('Button').setEnabled(this._submitButton,n);};m.prototype._isImageFile=function(){'use strict';return !!this._config.imageExtensions[this._getFileExtension()];};m.prototype._getFileExtension=function(){'use strict';return this._fileInput.value.split('.').pop().toLowerCase();};m.prototype._initFileInput=function(){'use strict';this._fileInput=c('DOM').find(this._root,"._n");this._fileInputCopy=this._fileInput.cloneNode(false);this._subscriptions.addSubscriptions(c('Event').listen(this._fileInput,'change',this._onFileChange.bind(this)));};m.prototype._onFileChange=function(){'use strict';if(this._isImagesOnly()&&!this._isImageFile()){new (c('Dialog'))().setTitle(j._("Invalid Image File")).setBody(j._("Please upload a valid image file.")).setModal(true).setButtons([c('Dialog').OK]).show();this._resetFileInput();}else{c('DOM').setContent(c('ge')('fbComposerUploadMediaFilename'),this._fileInput.value.split('\\').pop());this._setSubmitButtonEnabled(!!this._fileInput.value);}var n=this._getPageSelectLoggingData();if(n&&!this._hasSelected&&this._fileInput.value){this._hasSelected=true;c('PagesEventObserver').logData_DEPRECATED(n,null);}};m.prototype._isImagesOnly=function(){'use strict';return !!this._config.imagesOnly;};m.prototype._getPageSelectLoggingData=function(){'use strict';return this._config.pageSelectLoggingData;};Object.assign(m.prototype,{_privacyWidgetTags:null,attachmentClassName:"_92"});f.exports=m;}),null);
__d("XComposerXAddPhotoItemController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/composerx\/photo\/item\/",{photo_fbid:{type:"Int",required:true},grid_id:{type:"String",required:true},image_height:{type:"Int",required:true},image_width:{type:"Int",required:true}});}),null);
__d('ComposerXMediaUploadPlusAttachment',['csx','cx','Event','Arbiter','ComposerXAttachmentUtils','ComposerXController','ComposerXDragDrop','ComposerXDragDropUtils','ComposerXMediaUploadAttachment','CSS','DOM','Lockable','Parent','PhotoEditorSaveStates','PhotosMultiUploadInput','PUWApplications','AsyncRequest','ge','mixin','classWithMixins','AttachmentWithPhotoEditorTaggingMixin','AttachmentWithPhotosTaggingFlyoutMixin','PUWSteps','Scroll','SubscriptionsHandler','XComposerXAddPhotoItemController'],(function a(b,c,d,e,f,g,h,i){var j,k;j=babelHelpers.inherits(l,c('classWithMixins')(c('ComposerXMediaUploadAttachment'),c('mixin')(c('AttachmentWithPhotosTaggingFlyoutMixin'),c('AttachmentWithPhotoEditorTaggingMixin'))));k=j&&j.prototype;function l(m,n,o){'use strict';k.constructor.call(this,m,n,o);this._cameraIcon=null;this._eventSuggestionQuerySent=false;this._submitButtonLockable=null;this._cleaningUp=false;this._resetting=false;if(this._config.warningDialog)this._config.warningDialog.setContext(this._submitButton);this._photosToInit=this._config.existingPhotos;if(this._config.qualityChooser)this._config.qualityChooser.addListener('checkboxChanged',function(p){this.getScrollableArea().getUploadItem().getUploadInput().onQualitySettingChanged(p);new (c('AsyncRequest'))().setURI('/ajax/photos/upload/settings/').setData({composer_resolution:p?'high':'standard'}).send();}.bind(this));}l.prototype.getPhotoCount=function(){'use strict';return this.getScrollableArea().getPhotoCount();};l.prototype.getGrid=function(){'use strict';return this._grid;};l.prototype.getGridID=function(){'use strict';return this._gridID;};l.prototype.getWaterfallID=function(){'use strict';if(this._grid){return this._grid.getWaterfallID();}else return c('PhotosMultiUploadInput').getWaterfallID(this._gridID);};l.prototype.getWaterfallAppName=function(){'use strict';return c('PUWApplications').WEB_COMPOSER;};l.prototype.getWaterfallSource=function(){'use strict';return this._config.ref;};l.prototype.getScrollableArea=function(){'use strict';return this.getComponent('upload_area').instance;};l.prototype.initWithComponents=function(){'use strict';k.initWithComponents.call(this);this._gridID=this._uploadArea.id;var m=this.getScrollableArea().getUploadItem(),n=this._config.usePhotoEditorTagging;if(m&&m.getUploadInput().getGrid)this._grid=m.getUploadInput().getGrid();if(n){this.initPhotoEditorTaggingMixin();}else this.initTaggingFlyoutMixin(this,this._config);this.addSubscriptions(c('Arbiter').subscribe('multi-upload/images-upload-start/'+this._gridID,this._onUploadStart.bind(this)),c('Arbiter').subscribe('multi-upload/composer-reset/'+this._gridID,this._handleMultiUploadComposerReset.bind(this)),c('Arbiter').subscribe('multi-upload/images-added/'+this._gridID,this._handleImageAdded.bind(this)),c('Arbiter').subscribe('multi-upload/image-removed/'+this._gridID,this._handleImageRemoved.bind(this)),c('Event').listen(this._root,'submit',this._onSubmit.bind(this),c('Event').Priority.URGENT));if(this.supportsDragDrop()&&!this._dragdrop)this._dragdrop=new (c('ComposerXDragDrop'))(this._root,this.getComposerID());if(!n)this.initTaggingFlyoutWithComponents();this._cameraIcon=this.getComponent('cameraicon');this._moreLink=c('DOM').find(this._root,"._2oh");c('CSS').conditionShow(this._moreLink,this._config.isMediaModifiable);var o=[this._moreLink];this._cameraIcon&&o.push(this._cameraIcon.element);this.getScrollableArea().initialize(o,this._config,this._root,this._gridID,this.getComposerID());this.getScrollableArea().setPlaceholderHandler(this._setPlaceholders.bind(this));this._resetSubmitButtonLockable();var p;if(!this._config.allowNoMedia){p=this._submitButtonLockable.getLock().lock();this.getScrollableArea().setEnableComposerHandler(function(q){if(q){c('Arbiter').inform('ComposerXMediaUploadPlusAttachment/submitEnabled');p.unlock();}else{c('Arbiter').inform('ComposerXMediaUploadPlusAttachment/submitDisabled');p.lock();}}).setAllMediaRemovedHandler(function(){if(!this._cleaningUp&&!this._resetting)if(c('ComposerXController').hasAttachmentWithClassName(this._root,"_4j")){c('ComposerXController').getAttachment(this._root,'/ajax/composerx/attachment/status/');}else if(this._config.editPostID)c('ComposerXController').getAttachment(this._root,this._config.statusAttachmentEndpoint);}.bind(this));}else{p=this._submitButtonLockable.getLock().unlock();this.getScrollableArea().setEnableComposerHandler(function(q){c('Arbiter').inform('ComposerXMediaUploadPlusAttachment/submitEnabled');p.unlock();});}if(!this._fileHandler)this._fileHandler=c('Arbiter').subscribe('ComposerXFilesStore/filesAdded/'+this._composerID+'/mediaupload',function(q,r){if(!r.fileInput.getValue()||r.receivedBySubscriber)return;r.receivedBySubscriber=true;if(this._grid){this._grid.doFileUpload(r.fileInput);}else c('PhotosMultiUploadInput').doFileUpload(this._gridID,r.fileInput);}.bind(this));if(!this._cameraPhotoHandler)this._cameraPhotoHandler=c('Arbiter').subscribe('ComposerXFilesStore/filesAdded/'+this._composerID+'/cameraphoto',function(q,r){var s=c('XComposerXAddPhotoItemController').getURIBuilder().setInt('photo_fbid',r.photoFBID).setString('grid_id',this._gridID).setInt('image_width',this._config.thumbnailSize.width).setInt('image_height',this._config.thumbnailSize.height).getURI();new (c('AsyncRequest'))(s).send();}.bind(this));if(this.supportsDragDrop()&&!this._dragdropHandler){this._dragdropHandler=c('Arbiter').subscribe('ComposerXFilesStore/filesDropped/'+this._composerID+'/mediaupload',function(q,r){if(this._grid){this._grid.onFilesDrop(r.files,r.method);}else c('PhotosMultiUploadInput').onFilesDrop(this._gridID,r.files);}.bind(this));c('ComposerXDragDropUtils').handleDragEnterAndLeave(this._root);}if(!this._photoReminderHandler)this._photoReminderHandler=c('Arbiter').subscribe('ComposerXFilesStore/vaultImagesAdded/'+this._composerID+'/mediaupload',function(q,r){if(!r.receivedBySubscriber){r.receivedBySubscriber=true;c('PhotosMultiUploadInput').onVaultImagesAdded(this._gridID,r.photos);}}.bind(this));if(this._photosToInit){this._photosToInit.forEach(function(q){c('Arbiter').inform(['multi-upload/images-added/'+this._gridID,'multi-upload/images-added'],{fbids:{'0':''+q},tagInfo:{},disableRecognition:true,initialPhoto:true});}.bind(this));this._photosToInit=null;}c('CSS').conditionShow(this.getScrollableArea().getUploadArea().getRoot(),this._config.isMediaModifiable||this.getPhotoCount()>0);if(this._config.postActionsButton!=null)this._config.postActionsButton.initHiddenInputs(this.getComponent('pabhiddeninputs').instance);};l.prototype.reset=function(){'use strict';this._resetting=true;if(this._config.usePhotoEditorTagging){this.resetPhotoEditorTagging();}else this.resetTaggingFlyout();this.getTagger().reset();this._eventSuggestionQuerySent=false;if(this._config.isAutoEventSuggestionEnabled){var m=c('ge')('event_tagging_auto_suggestion');m&&c('CSS').hide(m);}this._resetting=false;if(this._config.prefill)this._resetPrefill();};l.prototype._handleImageAdded=function(m,n){'use strict';this.getScrollableArea().handleImageAdded(m,n);this._checkPhotoMaxSelect();if(this._config.preShowWithTagger&&this.getComponent('withtagger'))this.getTagger().eventuallySwitchToTagger('with');if(n.tagInfo.exifLocation&&n.tagInfo.exifLocation.latitude&&n.tagInfo.exifLocation.longitude){var o=this.getComponent('placetagger');if(o&&o.instance){o.instance.getCore().setLocation(n.tagInfo.exifLocation);this.getTagger().eventuallySwitchToTagger('place');}}if(!this._config.isAutoEventSuggestionEnabled)return;if(this.getComponent('hiddenplaceinput').element.value)return;if(this._eventSuggestionQuerySent)return;this._sendEventsSuggestionRequest({fbid:n.fbids[Object.keys(n.fbids)[0]],anchor_id:'composerCityTagger'});this._eventSuggestionQuerySent=true;};l.prototype._handleImageRemoved=function(m,n){'use strict';this.getScrollableArea().handleImageRemoved(m,n);this._checkPhotoMaxSelect();};l.prototype._handleMultiUploadComposerReset=function(){'use strict';this._resetting=true;this.getScrollableArea().reset();this._resetting=false;};l.prototype.cleanup=function(){'use strict';this._cleaningUp=true;if(this._config.usePhotoEditorTagging){this.cleanupPhotoEditorTagging();}else this.cleanupTaggingFlyout();k.cleanup.call(this);if(!this.persistUploadArea())this.getScrollableArea().cleanup();this._moreLinkListener&&this._moreLinkListener.remove();if(this.getComponent('withtagger'))this._withTaggerIconListener&&this._withTaggerIconListener.remove();if(this._fileHandler){this._fileHandler.unsubscribe();this._fileHandler=null;}if(this._dragdrop){this._dragdrop.deactivate();this._dragdrop=null;}if(this._photoReminderHandler){this._photoReminderHandler.unsubscribe();this._photoReminderHandler=null;}this._cleaningUp=false;};l.prototype.canSwitchAway=function(){'use strict';return !c('Parent').byClass(this._root,'async_saving');};l.prototype.supportsDragDrop=function(){'use strict';return this._config.maxSelect!==1;};l.prototype._setPlaceholders=function(m,n){'use strict';c('ComposerXAttachmentUtils').setStickyPlaceholderForMentions(this.getComponent('maininput'),m);c('ComposerXAttachmentUtils').setStickyPlaceholderForTypeahead(this.getComponent('placetagger').element,n);this._cameraIcon&&c('CSS').conditionClass(this._cameraIcon.element,"_1dsx",this.getScrollableArea().getTotalImageCount()>0);};l.prototype._resetSubmitButtonLockable=function(){'use strict';this._submitButtonLockable=new (c('Lockable'))(this._setSubmitButtonEnabled.bind(this,true),this._setSubmitButtonEnabled.bind(this,false));this._overImageSelectionLimitLock=this._submitButtonLockable.getLock();if(this._config.usePhotoEditorTagging){this.setPhotoEditorFaceRecSubmitButtonLock(this._submitButtonLockable.getLock());}else this.setFaceRecSubmitButtonLock(this._submitButtonLockable.getLock());};l.prototype._onUploadStart=function(){'use strict';var m=this.getScrollableArea().getUploadArea().getRoot(),n=c('DOM').find(m,'.fbScrollableAreaWrap');c('Scroll').setLeft(n,Math.max(0,c('DOM').find(m,'.fbScrollableAreaBody').offsetWidth-n.offsetWidth));};l.prototype._sendEventsSuggestionRequest=function(m){'use strict';new (c('AsyncRequest'))('ajax/events/tagging/suggestion_query').setData(m).setHandler(null).send();};l.prototype._initFileInput=function(){'use strict';};l.prototype._getTotalNumberOfStickersOnPhotos=function(){'use strict';var m=c('DOM').scry(this._root,".fbVaultGridItem"),n=0;m.forEach(function(o){n+=c('PhotoEditorSaveStates').getTotalNumOfStickersOnPhoto(o.getAttribute('data-originalfbid'));});return n;};l.prototype._onSubmit=function(){'use strict';var m=Date.now(),n=this.logWithTaggingData(this.getPhotoCount(),this.getComposerID()),o={volume:this.getPhotoCount(),with_tag_count:n,sticker_count:this._getTotalNumberOfStickersOnPhotos()};this.logStep(c('PUWSteps').CLIENT_PUBLISH_BEGIN,o);var p=new (c('SubscriptionsHandler'))();p.addSubscriptions(c('Event').listen(this._root,'success',function(q){o.dt=Date.now()-m;this.logStep(c('PUWSteps').CLIENT_PUBLISH_SUCCESS,o);this.logStep(c('PUWSteps').CLIENT_FLOW_SUCCESS);p.release();}.bind(this)),c('Event').listen(this._root,'error',function(q){o.dt=Date.now()-m;q=q.getData().response;if(q){o.error_code=q.getError();o.error_info=q.getErrorDescription();}this.logStep(c('PUWSteps').CLIENT_PUBLISH_FAIL,o);p.release();}.bind(this)));};l.prototype._checkPhotoMaxSelect=function(){'use strict';if(this._config.maxSelect>1)if(this.getPhotoCount()>this._config.maxSelect){this._config.warningDialog.show();if(this._overImageSelectionLimitLock)this._overImageSelectionLimitLock.lock();}else{this._config.warningDialog.hide();if(this._overImageSelectionLimitLock)this._overImageSelectionLimitLock.unlock();}};f.exports=l;}),null);
__d("XGroupSellNUXPostToMarketplaceDialogController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/ajax\/groups\/sell\/post_to_marketplace\/",{root_id:{type:"String"},button_id:{type:"String"},checkbox_id:{type:"String"},group_id:{type:"String"},__asyncDialog:{type:"Int"}});}),null);
__d('ComposerXSellAttachmentMixin',['csx','cx','Arbiter','AsyncRequest','ComposerXController','CSS','DataStore','DOM','Event','Focus','GroupSellComposerActionEvents','GroupSellComposerLogger','Input','Parent','SubscriptionsHandler','URI','URLScraper','XGroupSellNUXPostToMarketplaceDialogController','getOrCreateDOMID','setImmediate'],(function a(b,c,d,e,f,g,h,i){var j={initSellInputs:function k(l){this._isUploadingPhotos=false;this._composerSubmitted=false;var m=c('DOM').scry(this._root,"._4t9g");if(m.length>0)this._postOnMarketplaceCheckBox=m[0];var n=this.getComponent('forsale').instance;if(this._linkShare){c('Focus').set(this._getDescriptionTextarea());}else if(!this._config.isDefaultComposer)c('Focus').set(n.getTitleInput());this._inputsEverChanged={title:false,price:false,description:false,pickupNote:false,category:false,submitEnabled:false,launchedSellComposer:false};if(this._sellInputListeners){this._sellInputListeners.release();this._sellInputListeners=null;}if(this._descriptionFocusListener){this._descriptionFocusListener.remove();this._descriptionFocusListener=null;}this._sellInputListeners=new (c('SubscriptionsHandler'))();this._sellInputListeners.addSubscriptions(c('Event').listen(n.getTitleInput(),'input',this._inputsChanged.bind(this)),c('Event').listen(n.getTitleInput(),'change',this._inputsChanged.bind(this)),c('Event').listen(n.getPriceInput(),'input',this._inputsChanged.bind(this)),c('Event').listen(n.getPriceInput(),'change',this._inputsChanged.bind(this)),c('Event').listen(this.getComponent('maininput').element,'input',this._inputsChanged.bind(this)),c('Event').listen(this.getComponent('maininput').element,'change',this._inputsChanged.bind(this)),c('Event').listen(n.getPickupNoteInput(),'input',this._inputsChanged.bind(this)),c('Event').listen(n.getPickupNoteInput(),'change',this._inputsChanged.bind(this)),n.subscribe('categoryChanged',this._inputsChanged.bind(this)),c('Event').listen(this.getSubmitButton(),'click',this._submitButtonClicked.bind(this)));if(this._taggingFlyoutData&&this._taggingFlyoutData.recognitionController)this._sellInputListeners.addSubscriptions(this._taggingFlyoutData.recognitionController.subscribe('done',this._inputsChanged.bind(this)));var o=c('DOM').scry(this._root,"._9s")[0];if(o)this._sellInputListeners.addSubscriptions(c('Event').listen(o,'click',this._removeLinkAttachment.bind(this)));this._urlScraper=new (c('URLScraper'))(this.getComponent('maininput').element,function(){return this.getComponent('maininput').instance.getValue();}.bind(this));this._scraperListener=this._urlScraper.subscribe('match',function(q,r){if(this._hasPhotos||o||this._config.isEditComposer)return;var s=new (c('URI'))(this._config.scraperEndpoint);s.addQueryData({scrape_url:encodeURIComponent(r.url)});c('ComposerXController').getAttachment(this._root,s.toString());}.bind(this));this.setHasPhotos(this.getPhotoCount()>0);this.getScrollableArea().setPlaceholderHandler(function(){});if(l)c('GroupSellComposerLogger').log(this._config.targetID,c('GroupSellComposerActionEvents').COMPOSER_LOAD,this._config.isEditComposer);this._logLaunchSellComposer();this._sellComposerInited=true;this._inputsChanged();var p=this.getComponent('maininput');n.setInitialData(p.instance.getValue(),false);},supportsDragDrop:function k(){return false;},resetSellInputs:function k(){if(this._sellInputListeners){this._sellInputListeners.release();this._sellInputListeners=null;}if(this._urlScraper){this._urlScraper.disable();this._urlScraper.reset();this._urlScraper=null;}if(this._descriptionFocusListener){this._descriptionFocusListener.remove();this._descriptionFocusListener=null;}var l=c('Parent').bySelector(this._root,".child_was_focused");if(l)c('CSS').removeClass(l,"child_was_focused");this._isUploadingPhotos=false;this._composerSubmitted=false;},cleanupSellInputs:function k(){if(this._scraperListener){this._scraperListener.unsubscribe();this._scraperListener=null;}if(!this._descriptionFocusListener)this._descriptionFocusListener=c('Event').listen(this._getDescriptionTextarea(),'focus',function(){this._descriptionFocusListener.remove();this._descriptionFocusListener=null;if(this._nuxTooltip)this._nuxTooltip.show();}.bind(this));},_inputsChanged:function k(){if(!this._sellComposerInited)return;var l=this.getComponent('forsale').instance,m=c('Input').isEmpty(l.getTitleInput()),n=c('Input').isEmpty(l.getHiddenPriceInput()),o=l.requiresCategory(),p=l.hasCategory(),q=this.getComponent('maininput').instance,r=!q.getValue(),s=c('Input').isEmpty(l.getPickupNoteInput());if(!this._inputsEverChanged.title&&!m){c('GroupSellComposerLogger').log(this._config.targetID,c('GroupSellComposerActionEvents').COMPOSER_FILL_TITLE,this._config.isEditComposer);this._inputsEverChanged.title=true;}if(!this._inputsEverChanged.price&&!n){c('GroupSellComposerLogger').log(this._config.targetID,c('GroupSellComposerActionEvents').COMPOSER_FILL_PRICE,this._config.isEditComposer);this._inputsEverChanged.price=true;}if(!this._inputsEverChanged.description&&!r){c('GroupSellComposerLogger').log(this._config.targetID,c('GroupSellComposerActionEvents').COMPOSER_FILL_DESCRIPTION,this._config.isEditComposer);this._inputsEverChanged.description=true;}if(!this._inputsEverChanged.pickupNote&&!s){c('GroupSellComposerLogger').log(this._config.targetID,c('GroupSellComposerActionEvents').COMPOSER_FILL_PICKUP_NOTE,this._config.isEditComposer);this._inputsEverChanged.pickupNote=true;}if(!this._inputsEverChanged.category&&p){c('GroupSellComposerLogger').log(this._config.targetID,c('GroupSellComposerActionEvents').COMPOSER_FILL_CATEGORY,this._config.isEditComposer);this._inputsEverChanged.category=true;}var t=!this._isUploadingPhotos&&!this._composerSubmitted&&!m&&!n&&(!o||p),u=this.getSubmitButton().parentNode,v=c('DOM').find(u,"._314l");c('CSS').conditionShow(v,!t);if(!this._inputsEverChanged.submitEnabled&&t){this._inputsEverChanged.submitEnabled=true;c('GroupSellComposerLogger').log(this._config.targetID,c('GroupSellComposerActionEvents').COMPOSER_SUBMIT_ENABLED,this._config.isEditComposer);}this._setSubmitButtonEnabled(t);},_removeLinkAttachment:function k(){if(!this._linkShare)return;c('DOM').remove(this._linkShare);this._linkShare=null;this._urlScraper.disable();},startedUploadingPhotos:function k(){this._isUploadingPhotos=true;this._inputsChanged();},finishedUploadingPhotos:function k(){this._isUploadingPhotos=false;this._inputsChanged();},setHasPhotos:function k(l){this._hasPhotos=l;if(l)this._removeLinkAttachment();},_getDescriptionTextarea:function k(){return c('DOM').find(this.getComponent('maininput').element,'textarea.input');},_submitButtonClicked:function k(l){this._composerSubmitted=true;this._logComposerSubmitted();if(this._postOnMarketplaceCheckBox&&!this._postOnMarketplaceCheckBox.checked){l.preventDefault();var m=document.getElementsByName('marketplace_from_group_id'),n=m[0].value,o=this._postOnMarketplaceCheckBox.form,p=c('DOM').create('button');p.className='hidden_elem ';p.type='submit';o.appendChild(p);var q=c('XGroupSellNUXPostToMarketplaceDialogController').getURIBuilder().setString('root_id',this._root.id).setString('checkbox_id',this._postOnMarketplaceCheckBox.id).setString('button_id',c('getOrCreateDOMID')(p)).setString('group_id',n).getURI();new (c('AsyncRequest'))().setURI(q).send();}c('setImmediate')(this._inputsChanged.bind(this));},_logLaunchSellComposer:function k(){var l=c('Parent').bySelector(this._root,".focus_target");if(c('CSS').hasClass(l,'child_was_focused')){this._logComposerLaunched();}else{var m=this.getComponent('forsale').instance;this._titleFocusHandler=c('Event').listen(m.getTitleInput(),'focus',this._logComposerLaunched.bind(this));}},_logComposerLaunched:function k(){if(this._titleFocusHandler){this._titleFocusHandler.remove();this._titleFocusHandler=null;}if(this._inputsEverChanged.launchedSellComposer)return;this._inputsEverChanged.launchedSellComposer=true;c('GroupSellComposerLogger').log(this._config.targetID,c('GroupSellComposerActionEvents').LAUNCH_SELL_COMPOSER,this._config.isEditComposer);var l=c('DOM').scry(this._root,"._4t9g");if(l.length>0)c('GroupSellComposerLogger').log(this._config.targetID,c('GroupSellComposerActionEvents').SELL_COMPOSER_POST_TO_MARKETPLACE_SEEN,this._config.isEditComposer);c('Arbiter').inform('GroupSellComposer/launchedComposer');},_logComposerSubmitted:function k(){var l=this.getComponent('forsale').instance,m=this.getComponent('maininput'),n=!!c('DataStore').get(m.element,'groupForSalePostIntercept')&&!c('DataStore').get(m.element,'groupForSalePostInterceptSubmit'),o=parseFloat(c('Input').getValue(l.getHiddenPriceInput()))*100;c('GroupSellComposerLogger').logComposerSubmit(this._config.targetID,c('Input').getValue(l.getTitleInput()),c('Input').getValue(l.getCurrencyInput()),o,m.instance.getValue(),c('Input').getValue(l.getPickupNoteInput()),this.getPhotoCount(),this._config.isEditComposer,n);if(this.resetIntercept)this.resetIntercept();}};f.exports=j;}),null);
__d('ComposerXSellPlusAttachment',['cx','ComposerXMediaUploadPlusAttachment','ComposerXSellAttachmentMixin','GroupSellComposerActionEvents','GroupSellComposerLogger','Parent','classWithMixins','mixin'],(function a(b,c,d,e,f,g,h){var i,j;i=babelHelpers.inherits(k,c('classWithMixins')(c('ComposerXMediaUploadPlusAttachment'),c('mixin')(c('ComposerXSellAttachmentMixin'))));j=i&&i.prototype;function k(l,m,n,o,p){'use strict';j.constructor.call(this,l,m,n);this.attachmentClassName="_4_7-";this._linkShare=o;this._nuxTooltip=p;}k.prototype.initWithComponents=function(l){'use strict';j.initWithComponents.call(this);this.getTagger().hideTaggerIcons();this._root.action=this._config.statusEndpoint;this.initSellInputs(!!l);this.updateEndpoints();};k.prototype.persistUploadArea=function(){'use strict';return true;};k.prototype.reset=function(){'use strict';this.resetSellInputs();j.reset.call(this);};k.prototype.cleanup=function(){'use strict';this.cleanupSellInputs();this.getTagger().showTaggerIcons();this.resetSellInputs();j.cleanup.call(this);};k.prototype.canSwitchAway=function(){'use strict';return !c('Parent').byClass(this._root,'async_saving');};k.prototype._onUploadStart=function(){'use strict';j._onUploadStart.call(this);this.setHasPhotos(true);this.startedUploadingPhotos();};k.prototype._handleImageRemoved=function(l,m){'use strict';j._handleImageRemoved.call(this,l,m);this.updateEndpoints();c('GroupSellComposerLogger').log(this._config.targetID,c('GroupSellComposerActionEvents').COMPOSER_DELETE_PHOTO,this._config.isEditComposer);};k.prototype._handleImageAdded=function(l,m){'use strict';j._handleImageAdded.call(this,l,m);this.finishedUploadingPhotos();this.updateEndpoints();c('GroupSellComposerLogger').log(this._config.targetID,c('GroupSellComposerActionEvents').COMPOSER_ADD_PHOTO,this._config.isEditComposer);};k.prototype.updateEndpoints=function(){'use strict';if(this.getPhotoCount()>0&&!this._config.isEditComposer){this._root.action=this._config.photoEndpoint;this.setHasPhotos(true);}else{this._root.action=this._config.statusEndpoint;this.setHasPhotos(false);}};f.exports=k;}),null);
__d("ComposerXInstanceResetter",[],(function a(b,c,d,e,f,g){function h(i){i.instance.reset();}f.exports=h;}),null);
__d('VaultComposerController',['fbt','Arbiter','CSS','SubscriptionsHandler','areEqual','emptyFunction','removeFromArray'],(function a(b,c,d,e,f,g,h){function i(j,k){this._uploadedImageCount=0;this._uploadingImageCount=0;this._subscriptionsHandler=new (c('SubscriptionsHandler'))();this._hasVideo=false;this._singleSelect=false;this._multiselectElems=k;this._initialPhotoFbids=[];this._photoFbids=[];this.setAllMediaRemovedHandler(c('emptyFunction'));this._subscriptionsHandler.addSubscriptions(c('Arbiter').subscribe('multi-upload/images-added/'+j,function(l,m){var n=Object.keys(m.fbids),o=n.length;this._uploadingImageCount=Math.max(0,this._uploadingImageCount-o);this._uploadedImageCount+=o;if(this._uploadingImageCount>0)return;n.forEach(function(p){var q=m.fbids[p];this._photoFbids.push(q);if(m.initialPhoto)this._initialPhotoFbids.push(q);}.bind(this));this._onImagesChanged();}.bind(this)),c('Arbiter').subscribe('multi-upload/image-removed/'+j,function(l,m){this._uploadedImageCount=Math.max(0,this._uploadedImageCount-1);c('removeFromArray')(this._photoFbids,m);this._onImagesChanged();}.bind(this)),c('Arbiter').subscribe('multi-upload/images-upload-completed/'+j,function(l,m){this._uploadingImageCount=0;this._onImagesChanged();}.bind(this)),c('Arbiter').subscribe('multi-upload/video-added/'+j,function(){this._multiselectElems.forEach(c('CSS').hide);this._enableComposerHandler(true);this._placeholderHandler(h._("Say something about this video...")+'',h._("Where was this video taken?")+'');this._hasVideo=true;}.bind(this)),c('Arbiter').subscribe('multi-upload/video-removed/'+j,function(){this._multiselectElems.forEach(c('CSS').show);this._enableComposerHandler(false);this._placeholderHandler(h._("Say something about this...")+'',h._("Where was this taken?")+'');this._hasVideo=false;this._allMediaRemovedHandler();}.bind(this)),c('Arbiter').subscribe('multi-upload/images-upload-start/'+j,function(l,m){this._uploadingImageCount+=m.imageCount;this._enableComposerHandler(false);var n=this.getTotalImageCount();this._placeholderHandler(i.getPlaceholderText(n),i.getPlacePickerPlaceholderText(n));this._checkForSingleSelect();}.bind(this)),c('Arbiter').subscribe('multi-upload/all-images-removed/'+j,function(){this._multiselectElems.forEach(c('CSS').show);this._uploadedImageCount=0;this._uploadingImageCount=0;this._enableComposerHandler(false);this._placeholderHandler(h._("Say something about this...")+'',h._("Where was this taken?")+'');this._photoFbids.length=0;this._allMediaRemovedHandler();}.bind(this)));}Object.assign(i,{getPlaceholderText:function j(k){if(k===0){return h._("Say something about this...");}else if(k==1){return h._("Say something about this photo...");}else return h._("Say something about these photos...");},getPlacePickerPlaceholderText:function j(k){if(k===0){return h._("Where was this taken?");}else if(k==1){return h._("Where was this photo taken?");}else return h._("Where were these photos taken?");}});Object.assign(i.prototype,{setEnableComposerHandler:function j(k){this._enableComposerHandler=k;return this;},setMultiselectElems:function j(k){this._multiselectElems=k;return this;},setPlaceholderHandler:function j(k){this._placeholderHandler=k;return this;},setAllMediaRemovedHandler:function j(k){this._allMediaRemovedHandler=k;return this;},setSingleSelect:function j(k){this._singleSelect=k;return this;},cleanup:function j(){this._uploadedImageCount=0;this._uploadingImageCount=0;this._initialPhotoFbids.length=0;this._photoFbids.length=0;this._subscriptionsHandler.release();},_checkForSingleSelect:function j(){if(this._singleSelect)this._multiselectElems.forEach(function(k){c('CSS').conditionShow(k,this.getTotalImageCount()===0);}.bind(this));},getTotalImageCount:function j(){return this._uploadingImageCount+this._uploadedImageCount;},getUploadedImageCount:function j(){return this._uploadedImageCount;},enableComposerHandlerIfHasImages:function j(){this._enableComposerHandler(this._uploadedImageCount>0&&this._uploadingImageCount===0);},_onImagesChanged:function j(){this.enableComposerHandlerIfHasImages();this._placeholderHandler(i.getPlaceholderText(this._uploadedImageCount),i.getPlacePickerPlaceholderText(this._uploadedImageCount));this._checkForSingleSelect();if(this._uploadedImageCount===0&&this._uploadingImageCount===0)this._allMediaRemovedHandler();},getPhotoFbids:function j(){return this._photoFbids;},hasChanges:function j(){var k=!c('areEqual')(this._photoFbids,this._initialPhotoFbids);return k||this._hasVideo;}});f.exports=i;}),null);
__d('ComposerXUploadArea',['csx','cx','Arbiter','ComposerXController','CSS','DOM','PhotosMultiUploadInput','VaultComposerController'],(function a(b,c,d,e,f,g,h,i){function j(k,l,m){'use strict';this.$ComposerXUploadArea1=k;this.$ComposerXUploadArea2=l;this.$ComposerXUploadArea3=m;this.$ComposerXUploadArea4=0;}j.prototype.initialize=function(k,l,m,n,o){'use strict';this.$ComposerXUploadArea5=n;if(!this.$ComposerXUploadArea6)this.$ComposerXUploadArea6=new (c('VaultComposerController'))(this.$ComposerXUploadArea5,k);this.$ComposerXUploadArea6.setSingleSelect(l.maxSelect===1).setPlaceholderHandler(this.setPlaceholderHandler.bind(this)).setMultiselectElems(k);c('ComposerXController').registerConditionForComposerCancel(o,this.$ComposerXUploadArea6.hasChanges.bind(this.$ComposerXUploadArea6));this.$ComposerXUploadArea6.setMultiselectElems(k);};j.prototype.setEnableComposerHandler=function(k){'use strict';this.$ComposerXUploadArea6.setEnableComposerHandler(k);this.$ComposerXUploadArea6.enableComposerHandlerIfHasImages();return this;};j.prototype.setAllMediaRemovedHandler=function(k){'use strict';this.$ComposerXUploadArea6.setAllMediaRemovedHandler(k);return this;};j.prototype.setSingleSelect=function(k){'use strict';this.$ComposerXUploadArea6.setSingleSelect(k);return this;};j.prototype.setPlaceholderHandler=function(k){'use strict';this.$ComposerXUploadArea6.setPlaceholderHandler(k);return this;};j.prototype.getUploadArea=function(){'use strict';return this.$ComposerXUploadArea2;};j.prototype.getUploadItem=function(){'use strict';return this.$ComposerXUploadArea3;};j.prototype.getPhotoFbids=function(){'use strict';return this.$ComposerXUploadArea6?this.$ComposerXUploadArea6.getPhotoFbids():null;};j.prototype.handleImageAdded=function(k,l){'use strict';this.$ComposerXUploadArea7(this.getPhotoCount()+Object.keys(l.fbids).length);};j.prototype.handleImageRemoved=function(k,l){'use strict';this.$ComposerXUploadArea7(this.getPhotoCount()-1);};j.prototype.getTotalImageCount=function(){'use strict';return this.$ComposerXUploadArea6?this.$ComposerXUploadArea6.getTotalImageCount():0;};j.prototype.reset=function(){'use strict';c('Arbiter').inform('multi-upload/video-removed/'+this.$ComposerXUploadArea5);this.removeAllImages();};j.prototype.cleanup=function(){'use strict';this.reset();if(this.$ComposerXUploadArea6){this.$ComposerXUploadArea6.cleanup();this.$ComposerXUploadArea6=null;}};j.prototype.$ComposerXUploadArea7=function(k){'use strict';this.$ComposerXUploadArea4=k;};j.prototype.getPhotoCount=function(){'use strict';return this.$ComposerXUploadArea4;};j.prototype.getController=function(){'use strict';return this.$ComposerXUploadArea6;};j.prototype.removeAllImages=function(){'use strict';this.$ComposerXUploadArea7(0);c('DOM').scry(this.$ComposerXUploadArea1,"._yr").forEach(function(l){if(!c('CSS').matchesSelector(l,"._2oh"))c('DOM').remove(l);});c('DOM').scry(this.$ComposerXUploadArea1,"._579").forEach(function(l){if(!c('CSS').matchesSelector(l,"._2oh"))c('DOM').remove(l);});var k=this.$ComposerXUploadArea3.getUploadInput().getGrid();if(k){k.clearSession();}else c('PhotosMultiUploadInput').clearSession(this.$ComposerXUploadArea5);c('Arbiter').inform(['multi-upload/all-images-removed/'+this.$ComposerXUploadArea5,'multi-upload/all-images-removed']);};f.exports=j;}),null);
__d('GroupSellLogger',['BanzaiLogger','GroupSellUserActionEvents','GroupSellSurface'],(function a(b,c,d,e,f,g){'use strict';var h={logComposerTooltipNUXSeen:function i(j){c('BanzaiLogger').log('GroupSellUserActionsLoggerConfig',{event:c('GroupSellUserActionEvents').COMPOSER_TOOLTIP_NUX_SEEN,group_id:j});},_formatComposerInterceptWords:function i(j,k){var l=[];if(k)l=k.slice();if(j&&j>0)l.push(j.toString()+' prices count');return l.join(',');},logComposerInterceptAttempted:function i(j){c('BanzaiLogger').log('GroupSellUserActionsLoggerConfig',{event:c('GroupSellUserActionEvents').GROUP_NON_FOR_SALE_POST_INTERCEPT_ATTEMPTED,group_id:j});},logComposerInterceptDetected:function i(j,k,l){c('BanzaiLogger').log('GroupSellUserActionsLoggerConfig',{event:c('GroupSellUserActionEvents').GROUP_NON_FOR_SALE_POST_INTERCEPT_DETECTED,group_id:j,intercept_words:h._formatComposerInterceptWords(k,l)});},logComposerInterceptCreated:function i(j,k,l){c('BanzaiLogger').log('GroupSellUserActionsLoggerConfig',{event:c('GroupSellUserActionEvents').GROUP_NON_FOR_SALE_POST_INTERCEPT_CREATED,group_id:j,intercept_words:h._formatComposerInterceptWords(k,l)});},logComposerInterceptAccepted:function i(j,k,l){c('BanzaiLogger').log('GroupSellUserActionsLoggerConfig',{event:c('GroupSellUserActionEvents').GROUP_NON_FOR_SALE_POST_INTERCEPT_ACCEPTED,group_id:j,intercept_words:h._formatComposerInterceptWords(k,l)});},logComposerInterceptDeclined:function i(j,k,l){c('BanzaiLogger').log('GroupSellUserActionsLoggerConfig',{event:c('GroupSellUserActionEvents').GROUP_NON_FOR_SALE_POST_INTERCEPT_DECLINED,group_id:j,intercept_words:h._formatComposerInterceptWords(k,l)});},logHScrollViewPermalink:function i(j,k){c('BanzaiLogger').log('GroupSellUserActionsLoggerConfig',{event:c('GroupSellUserActionEvents').H_SCROLL_STORY_CLICKED,group_id:j,group_message_id:k});},logNLUTimeout:function i(j){c('BanzaiLogger').log('GroupSellUserActionsLoggerConfig',{event:c('GroupSellUserActionEvents').GROUP_NON_FOR_SALE_POST_NLU_TIMEOUT,group_id:j});},logNLUError:function i(j){c('BanzaiLogger').log('GroupSellUserActionsLoggerConfig',{event:c('GroupSellUserActionEvents').GROUP_NON_FOR_SALE_POST_NLU_ERROR,group_id:j});},logNonForSaleMarkAsSold:function i(j,k,l){c('BanzaiLogger').log('GroupSellUserActionsLoggerConfig',{event:c('GroupSellUserActionEvents').NON_FOR_SALE_MARK_AS_SOLD,group_id:j,group_message_id:k,description:l,surface:c('GroupSellSurface').DELETE_INTERCEPT});}};f.exports=h;}),null);
__d('GroupSellInterceptUtil',['ReactComposerAttachmentStore','ReactComposerAttachmentType','ReactComposerStatusStore','ReactComposerSellActions','ReactComposerSellStore','ReactComposerStatusActions','Currency','DraftModifier','EditorState','GroupSellLogger','escapeRegex'],(function a(b,c,d,e,f,g){'use strict';var h={nluInterceptSuccess:function i(j,k,l,m){c('ReactComposerSellActions').showNLUIntercept(j,k,l,m);var n=c('ReactComposerStatusStore').getEditorState(j);if(n)c('ReactComposerStatusActions').setOriginalEditorState(j,n);},urlInterceptSuccess:function i(j,k,l,m,n){c('ReactComposerSellActions').showURLIntercept(j,k,l,m,n);var o=c('ReactComposerStatusStore').getEditorState(j);if(o){c('ReactComposerStatusActions').setOriginalEditorState(j,o);if(m){var p=o.getSelection(),q=o.getCurrentContent(),r=c('DraftModifier').insertText(q,p,'\n'+m),s=c('EditorState').createWithContent(r);c('ReactComposerStatusActions').setEditorState(j,s);}}},formatPrice:function i(j,k){if(!k)return j;var l=c('Currency').getFormat(k)||'{symbol}{amount}',m=c('Currency').getSymbol(k)||'';return l.replace('{symbol}',m).replace('{amount}',j);},parseInterceptedPrices:function i(j,k){var l=[];if(!k)return l;var m=new RegExp('\\d+','ig'),n=new RegExp(c('escapeRegex')(k)+'\\s*\\d+','ig'),o=new RegExp('\\d+(?=\\s*'+c('escapeRegex')(k)+')','ig'),p=j.match(n);if(p)p.forEach(function(q){return l=l.concat(q.match(m));});p=j.match(o);if(p)l=l.concat(p);return l;},shouldAttemptInterceptReact:function i(j,k,l,m,n){c('GroupSellLogger').logComposerInterceptAttempted(k);var o=c('ReactComposerAttachmentStore').getIsAttachmentSelected(j,c('ReactComposerAttachmentType').STATUS),p=c('ReactComposerAttachmentStore').getIsAttachmentSelected(j,c('ReactComposerAttachmentType').MEDIA),q=o||p;if(!q||c('ReactComposerSellStore').getInterceptSellAttempt(j))return false;var r=c('ReactComposerStatusStore').getMessageText(j);if(!r)return false;var s=h.getInterceptedWords(r,l),t=h.getInterceptedWordsAfterNumber(r,m),u=h.parseInterceptedPrices(r,n),v=!!(s.length||t.length||u.length);if(v)c('GroupSellLogger').logComposerInterceptDetected(k,u.length?u.length:0,s.concat(t));return v;},getInterceptedWords:function i(j,k){return k.filter(function(l){var m=new RegExp('\\b'+c('escapeRegex')(l)+'\\b','i');return !!j.match(m);});},getInterceptedWordsAfterNumber:function i(j,k){return k.filter(function(l){var m=new RegExp('\\b\\d+\\s?'+c('escapeRegex')(l)+'\\b','i');if(j.match(m))return true;return false;});}};f.exports=h;}),null);
__d('ComposerXForSaleComponent',['cx','fbt','invariant','ReactComposerSellActionType','AdsCurrencyFormatter','Arbiter','ArbiterMixin','ContextualLayer','Currency','CSS','DataStore','Event','GroupSellInterceptUtil','Input','LayerHideOnBlur','SubscriptionsHandler','getActiveElement','getElementText','mixin','setTextContent'],(function a(b,c,d,e,f,g,h,i,j){var k,l;k=babelHelpers.inherits(m,c('mixin')(c('ArbiterMixin')));l=k&&k.prototype;function m(n,o,p){'use strict';l.constructor.call(this);this._inputs=n;this._charCounts=o;this._options=p;this._currency=p.currencies[0];this._currency||j(0);this._currencySymbol=c('Currency').getSymbol(this._currency);this._currencySymbol||j(0);var q=this._inputs.title,r=this._inputs.price,s=this._inputs.pickupNote,t=this._inputs.year;this._subscriptions=new (c('SubscriptionsHandler'))();this._subscriptions.addSubscriptions(c('Event').listen(q,'input',this._titleChanged.bind(this)),c('Event').listen(q,'change',this._titleChanged.bind(this)),c('Event').listen(q,'focus',this._titleFocusChanged.bind(this)),c('Event').listen(q,'blur',this._titleFocusChanged.bind(this)),c('Event').listen(r,'focus',this._priceFocused.bind(this)),c('Event').listen(r,'input',this._priceChanged.bind(this)),c('Event').listen(r,'change',this._priceChanged.bind(this)),c('Event').listen(r,'blur',this._priceBlurred.bind(this)));if(t)this._subscriptions.addSubscriptions(c('Event').listen(t,'input',this._yearChanged.bind(this)),c('Event').listen(t,'change',this._yearChanged.bind(this)),c('Event').listen(t,'blur',this._yearBlurred.bind(this)));if(this._charCounts.pickupNote)this._subscriptions.addSubscriptions(c('Event').listen(s,'input',this._pickupNoteChanged.bind(this)),c('Event').listen(s,'change',this._pickupNoteChanged.bind(this)),c('Event').listen(s,'focus',this._pickupNoteFocusChanged.bind(this)),c('Event').listen(s,'blur',this._pickupNoteFocusChanged.bind(this)));c('Input').setValue(this._inputs.hiddenCurrency,this._currency);this._priceChanged();this._priceBlurred();c('Arbiter').subscribe(c('ReactComposerSellActionType').SAVE_PRICE_TYPE,this._priceTypeChanged.bind(this));this._titleChanged();this._titleFocusChanged();if(this._charCounts.pickupNote){this._pickupNoteChanged();this._pickupNoteFocusChanged();}if(this._inputs.selectCategory&&!this.shouldDisableCategorySelection()){c('CSS').removeClass(this._inputs.categoriesDropdown,"hidden_elem");this._subscriptions=new (c('SubscriptionsHandler'))();this._subscriptions.addSubscriptions(c('Event').listen(this._inputs.selectCategory,'click',this._handleSelectCategory.bind(this)),c('Event').listen(this._inputs.categoriesDropdown,'click',this._handleCategoryClick.bind(this)));this._layer=new (c('ContextualLayer'))({context:this._inputs.selectCategory,position:'below',alignment:'left'},this._inputs.categoriesDropdown);this._layer.enableBehavior(c('LayerHideOnBlur'));}}m.prototype._titleChanged=function(){'use strict';var n=c('Input').getValue(this._inputs.title).trim(),o=this._options.inputMaxChars-n.length;c('setTextContent')(this._charCounts.title,o);};m.prototype._titleFocusChanged=function(){'use strict';c('CSS').conditionShow(this._charCounts.title,c('getActiveElement')()===this._inputs.title);};m.prototype._priceFocused=function(){'use strict';if(c('Input').isEmpty(this._inputs.price))c('Input').setValue(this._inputs.price,this._currencySymbol);};m.prototype.setInitialData=function(n,o){'use strict';this.setInitialPriceIfEmpty(n,o);if(o){var p=n.length,q=n.substr(0,Math.min(30,p));if(q.length<p)q=q.concat('...');var r=this._options.everyThingElseCategoryID.toString();c('Input').setValue(this._inputs.title,q);if(this.requiresCategory())this._setCategory(r,c('getElementText')(this._options.everythingElseCategory));}};m.prototype.setInitialPriceIfEmpty=function(n,o){'use strict';var p=this._getPriceValue();if(!p){var q=c('GroupSellInterceptUtil').parseInterceptedPrices(n,this._currencySymbol);if(q.length){c('Input').setValue(this._inputs.price,q[0]);this._priceChanged();}else if(o)this._inputs.price.focus();}};m.prototype._priceChanged=function(){'use strict';var n=this._getPriceValue();if(n==null){c('Input').setValue(this._inputs.hiddenPrice,'');c('Input').setValue(this._inputs.price,this._currencySymbol);return;}c('Input').setValue(this._inputs.hiddenPrice,''+n);var o=c('Currency').getOffset(this._currency),p=c('AdsCurrencyFormatter').formatCurrencyWithOptionalDecimals(this._currency,n*o);if(p!==c('Input').getValue(this._inputs.price))c('Input').setValue(this._inputs.price,p);};m.prototype._priceBlurred=function(){'use strict';var n=this._getPriceValue();if(n==null)c('Input').reset(this._inputs.price);};m.prototype._getPriceValue=function(){'use strict';var n=c('Input').getValue(this._inputs.price),o=n.replace(/\D/g,'');if(!o.length){return null;}else return parseInt(o,10);};m.prototype._priceTypeChanged=function(n,o){'use strict';c('Input').setValue(this._inputs.hiddenPriceType,o.priceType);};m.prototype._pickupNoteChanged=function(){'use strict';var n=c('Input').getValue(this._inputs.pickupNote).trim();c('setTextContent')(this._charCounts.pickupNote,this._options.inputMaxChars-n.length);};m.prototype._pickupNoteFocusChanged=function(){'use strict';c('CSS').conditionShow(this._charCounts.pickupNote,c('getActiveElement')()===this._inputs.pickupNote);};m.prototype.requiresCategory=function(){'use strict';return !!this._inputs.selectCategory;};m.prototype.hasCategory=function(){'use strict';return (!!this._inputs.categoryIDInput&&!!c('Input').getValue(this._inputs.categoryIDInput));};m.prototype.shouldDisableCategorySelection=function(){'use strict';return this._inputs.categorySelectionDisabled;};m.prototype._handleSelectCategory=function(){'use strict';this._layer.show();};m.prototype._handleCategoryClick=function(event){'use strict';var n=c('DataStore').get(event.target,'categoryID');if(n){this._setCategory(n,c('getElementText')(event.target));this._layer.hide();}};m.prototype._setCategory=function(n,o){'use strict';c('Input').setValue(this._inputs.categoryIDInput,n);c('setTextContent')(this._inputs.selectCategory,o);c('CSS').addClass(this._inputs.selectCategory,"_4oxb");this.inform('categoryChanged');};m.prototype._yearChanged=function(){'use strict';var n=this._getYearValue(),o='';if(n)o+=n;c('Input').setValue(this._inputs.year,o);};m.prototype._yearBlurred=function(){'use strict';var n=this._getYearValue();if(n==null||n<1900||n>new Date().getFullYear()+2){c('Input').setValue(this._inputs.year,'');return;}};m.prototype._getYearValue=function(){'use strict';var n=c('Input').getValue(this._inputs.year),o=n.replace(/\D/g,'');if(!o.length){return null;}else return parseInt(o,10);};m.prototype.reset=function(){'use strict';c('Input').reset(this._inputs.title);c('Input').reset(this._inputs.price);c('Input').reset(this._inputs.hiddenPrice);if(this._charCounts.pickupNote)c('Input').reset(this._inputs.pickupNote);this._charCounts.title.innerText=this._options.inputMaxChars;if(this._charCounts.pickupNote)this._charCounts.pickupNote.innerText=this._options.inputMaxChars;if(this._inputs.categoryIDInput){c('Input').reset(this._inputs.categoryIDInput);c('setTextContent')(this._inputs.selectCategory,i._("Select a Category"));c('CSS').removeClass(this._inputs.selectCategory,"_4oxb");}};m.prototype.getTitleInput=function(){'use strict';return this._inputs.title;};m.prototype.getPriceInput=function(){'use strict';return this._inputs.price;};m.prototype.getCurrencyInput=function(){'use strict';return this._inputs.hiddenCurrency;};m.prototype.getHiddenPriceInput=function(){'use strict';return this._inputs.hiddenPrice;};m.prototype.getPickupNoteInput=function(){'use strict';return this._inputs.pickupNote;};f.exports=m;}),null);
__d("ComposerXForSaleExtrasComponent",[],(function a(b,c,d,e,f,g){function h(){"use strict";}h.prototype.reset=function(){"use strict";};f.exports=h;}),null);